{"version":3,"sources":["assets/mainUI/scripts/UIShopBoxBuy.js"],"names":["cc","Class","Component","properties","boxAdBtnPanel","Node","buyBtn","freeBtn","nameLabel","Label","priceLabel","boxSprite","Sprite","baseItemNode","rewardParent","initBy","e","t","i","o","boxId","shopBoxJson","isCanAdBuy","callBack","price","string","a","pvz","utils","setSpriteFrame","onCheckBoxAdBtnGray","onBoxRewardShow","TAUtils","trackAdUIShow","GameConfig","AdType","Math","floor","length","rewardData","getRewardItem","push","getComponent","initBoxRewardItem","c","s","instantiate","parent","active","childrenCount","children","setMaterial","JsonControl","materialList","onClickAdBox","UIShop","isLookAd","onAdClose","AdUtils","showAdRewardVideo","PlayerData","updateShopBoxDate","Date","now","updateShopBoxExp","popupManager","removePopup","popup","ad","scale","onClickBuyBox","isItemEnough","ItemType","changeItemNum","onChekBoxLvUp","isHaveAdBuyBankTimes","showToast","onCloseUI"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        boxAdBtnPanel: cc.Node,\n        buyBtn: cc.Node,\n        freeBtn: cc.Node,\n        nameLabel: cc.Label,\n        priceLabel: cc.Label,\n        boxSprite: cc.Sprite,\n        baseItemNode: cc.Node,\n        rewardParent: cc.Node\n    },\n    initBy: function (e, t, i, o) {\n        if (void 0 === i) {\n            i = !1;\n        }\n        if (void 0 === o) {\n            o = null;\n        }\n        this.boxId = e;\n        this.shopBoxJson = t;\n        this.isCanAdBuy = i;\n        this.callBack = o;\n        this.price = this.shopBoxJson[\"consume\" + this.boxId];\n        this.priceLabel.string = this.price;\n        if (1 == this.boxId) {\n            this.nameLabel.string = \"银色宝箱\";\n        } else {\n            this.nameLabel.string = \"黄金宝箱\";\n        }\n        var a;\n        if (1 == this.boxId) {\n            a = \"12\";\n        } else {\n            a = \"11\";\n        }\n        cc.pvz.utils.setSpriteFrame(this.boxSprite, \"uiImage\", \"shop/shop\" + a);\n        this.onCheckBoxAdBtnGray(!this.isCanAdBuy);\n        this.onBoxRewardShow();\n        if (this.isCanAdBuy && 2 == this.boxId) {\n            cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType[\"商店宝箱\"]);\n        }\n    },\n    onBoxRewardShow: function () {\n        var e = this.shopBoxJson[\"box\" + this.boxId];\n        var t = Math.floor(e.length / 2);\n        var i = 0;\n        this.rewardData = [];\n        for (var o = 0; o < t; o++) {\n            var a = cc.pvz.utils.getRewardItem(e[i], e[i + 1]);\n            this.rewardData.push(a);\n            i += 2;\n        }\n        this.baseItemNode.getComponent(\"RewardItem\").initBoxRewardItem(this.rewardData[0]);\n        for (var c = 1; c < t; c++) {\n            var s = cc.instantiate(this.baseItemNode);\n            s.parent = this.rewardParent;\n            s.getComponent(\"RewardItem\").initBoxRewardItem(this.rewardData[c]);\n        }\n    },\n    onCheckBoxAdBtnGray: function (e) {\n        if (1 == this.boxId) {\n            this.boxAdBtnPanel.active = !1;\n            this.freeBtn.active = !e;\n            this.buyBtn.active = e;\n        } else {\n            for (var t = 0; t < this.boxAdBtnPanel.childrenCount; t++) {\n                this.boxAdBtnPanel.children[t]\n                    .getComponent(cc.Sprite)\n                    .setMaterial(0, cc.JsonControl.materialList[e ? 1 : 0]);\n            }\n            this.freeBtn.active = !1;\n        }\n    },\n    onClickAdBox: function () {\n        var e = this;\n        if (cc.UIShop.isLookAd) {\n            //\n        } else {\n            if (this.isCanAdBuy) {\n                if (1 == this.boxId) {\n                    this.onAdClose(!0);\n                } else {\n                    (cc.UIShop.isLookAd = !0),\n                        cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType[\"商店宝箱\"], function (t) {\n                            e.onAdClose(t);\n                        });\n                }\n            }\n        }\n    },\n    onAdClose: function (e) {\n        cc.UIShop.isLookAd = !1;\n        if (e) {\n            cc.pvz.PlayerData.updateShopBoxDate(this.boxId, Date.now());\n            if (this.isCanAdBuy && 2 == this.boxId) {\n                cc.pvz.PlayerData.updateShopBoxExp(this.price);\n            }\n            cc.popupManager.removePopup(this);\n            cc.popupManager.popup(\n                \"mainUI\",\n                \"ShopBoxEft\",\n                \"UIShopBoxReward\",\n                {\n                    ad: !1,\n                    scale: !0\n                },\n                this.boxId,\n                this.rewardData,\n                this.callBack\n            );\n        }\n    },\n    onClickBuyBox: function () {\n        if (!cc.UIShop.isLookAd) {\n            if (cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType[\"钻石\"], this.price)) {\n                cc.pvz.PlayerData.updateShopBoxExp(this.price);\n                cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType[\"钻石\"], -this.price);\n                cc.popupManager.removePopup(this);\n                cc.popupManager.popup(\n                    \"mainUI\",\n                    \"ShopBoxEft\",\n                    \"UIShopBoxReward\",\n                    {\n                        ad: !1,\n                        scale: !0\n                    },\n                    this.boxId,\n                    this.rewardData,\n                    function () {\n                        cc.UIShop.onChekBoxLvUp();\n                    }\n                );\n            } else if (cc.pvz.PlayerData.isHaveAdBuyBankTimes(1)) {\n                var e = cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType[\"钻石\"], 100);\n                cc.popupManager.popup(\n                    \"mainUI\",\n                    \"adbuyUI\",\n                    \"UIAdBuy\",\n                    {\n                        ad: !1,\n                        scale: !0\n                    },\n                    e\n                );\n            } else {\n                cc.popupManager.showToast(\"钻石不足！\");\n            }\n        }\n    },\n    onCloseUI: function () {\n        cc.popupManager.removePopup(this);\n    }\n});\n"]}