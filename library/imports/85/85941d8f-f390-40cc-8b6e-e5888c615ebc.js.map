{"version":3,"sources":["assets/rank/scripts/UIAuthorize.js"],"names":["cc","Class","Component","properties","uidLabel","Label","root1","Node","root2","rewardNode","wxNode","initBy","e","t","onCloseCB","preAuth","player","auth","string","pvz","cloud","uid","active","sys","platform","WECHAT_GAME","wx","getSetting","success","authSetting","onClickClose","destroy","popupManager","removePopup","onAuthorizeSucc","GameConfig","ItemType","PlayerData","changeItemNum","showEffectFly","MainControl","getItemEffectPos","math","randomRangeInt","updateItemInfo","onWxAuthorize","console","log","userInfo","avatarUrl","nickName","setAvatar","showToast"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAELC,UAAU,EAAE;IACRC,QAAQ,EAAEJ,EAAE,CAACK,KADL;IAERC,KAAK,EAAEN,EAAE,CAACO,IAFF;IAGRC,KAAK,EAAER,EAAE,CAACO,IAHF;IAIRE,UAAU,EAAET,EAAE,CAACO,IAJP;IAKRG,MAAM,EAAEV,EAAE,CAACO;EALH,CAFP;EASLI,MAAM,EAAE,gBAAUC,CAAV,EAAa;IACjB,IAAIC,CAAC,GAAG,IAAR;IACA,KAAKC,SAAL,GAAiBF,CAAjB;IACA,KAAKG,OAAL,GAAef,EAAE,CAACgB,MAAH,CAAUC,IAAzB;IACA,KAAKb,QAAL,CAAcc,MAAd,GAAuBlB,EAAE,CAACmB,GAAH,CAAOC,KAAP,CAAaC,GAApC;IACA,KAAKf,KAAL,CAAWgB,MAAX,GAAoB,CAAC,CAArB;IACA,KAAKd,KAAL,CAAWc,MAAX,GAAoB,CAAC,CAArB;IACA,KAAKb,UAAL,CAAgBa,MAAhB,GAAyB,KAAKtB,EAAE,CAACgB,MAAH,CAAUC,IAAxC;;IACA,IAAIjB,EAAE,CAACuB,GAAH,CAAOC,QAAP,IAAmBxB,EAAE,CAACuB,GAAH,CAAOE,WAA9B,EAA2C;MACvCC,EAAE,CAACC,UAAH,CAAc;QACVC,OAAO,EAAE,iBAAUhB,CAAV,EAAa;UAClB,IAAI,CAAC,CAAD,KAAOA,CAAC,CAACiB,WAAF,CAAc,gBAAd,CAAX,EAA4C;YACxChB,CAAC,CAACL,KAAF,CAAQc,MAAR,GAAiB,CAAC,CAAlB;UACH,CAFD,MAEO;YACHT,CAAC,CAACP,KAAF,CAAQgB,MAAR,GAAiB,CAAC,CAAlB;UACH;QACJ;MAPS,CAAd;IASH,CAVD,MAUO;MACH,KAAKhB,KAAL,CAAWgB,MAAX,GAAoB,KAAKb,UAAL,CAAgBa,MAApC;MACA,KAAKd,KAAL,CAAWc,MAAX,GAAoB,CAAC,KAAKb,UAAL,CAAgBa,MAArC;IACH;EACJ,CA/BI;EAgCLQ,YAAY,EAAE,wBAAY;IACtB,KAAKpB,MAAL,CAAYqB,OAAZ;IACA/B,EAAE,CAACgC,YAAH,CAAgBC,WAAhB,CAA4B,IAA5B;;IACA,IAAI,KAAKnB,SAAT,EAAoB;MAChB,KAAKA,SAAL,CAAe,KAAK,KAAKC,OAAV,IAAqB,KAAKf,EAAE,CAACgB,MAAH,CAAUC,IAAnD;IACH;EACJ,CAtCI;EAuCLiB,eAAe,EAAE,2BAAY;IACzB,KAAK5B,KAAL,CAAWgB,MAAX,GAAoB,CAAC,CAArB;IACA,KAAKd,KAAL,CAAWc,MAAX,GAAoB,CAAC,CAArB;IACA,KAAKb,UAAL,CAAgBa,MAAhB,GAAyB,CAAC,CAA1B;;IACA,IAAI,KAAKtB,EAAE,CAACgB,MAAH,CAAUC,IAAnB,EAAyB;MACrBjB,EAAE,CAACgB,MAAH,CAAUC,IAAV,GAAiB,CAAjB;MACA,IAAIL,CAAC,GAAGZ,EAAE,CAACmB,GAAH,CAAOgB,UAAP,CAAkBC,QAAlB,CAA2B,IAA3B,CAAR;MACApC,EAAE,CAACmB,GAAH,CAAOkB,UAAP,CAAkBC,aAAlB,CAAgC1B,CAAhC,EAAmC,GAAnC;MACAZ,EAAE,CAACgC,YAAH,CAAgBO,aAAhB,CAA8B3B,CAA9B,EAAiCZ,EAAE,CAACwC,WAAH,CAAeC,gBAAf,CAAgC7B,CAAhC,CAAjC,EAAqEZ,EAAE,CAAC0C,IAAH,CAAQC,cAAR,CAAuB,CAAvB,EAA0B,CAA1B,CAArE;MACA3C,EAAE,CAACwC,WAAH,CAAeI,cAAf;IACH;EACJ,CAlDI;EAmDLC,aAAa,EAAE,uBAAUjC,CAAV,EAAa;IACxB,IAAIC,CAAC,GAAG,IAAR;IACAiC,OAAO,CAACC,GAAR,CAAY,2BAAZ;IACAD,OAAO,CAACC,GAAR,CAAYnC,CAAZ;;IACA,IAAIA,CAAC,CAACoC,QAAF,IAAcpC,CAAC,CAACoC,QAAF,CAAWC,SAAzB,IAAsCrC,CAAC,CAACoC,QAAF,CAAWE,QAArD,EAA+D;MAC3DlD,EAAE,CAACmB,GAAH,CAAOC,KAAP,CAAa+B,SAAb,CAAuBvC,CAAC,CAACoC,QAAF,CAAWE,QAAlC,EAA4CtC,CAAC,CAACoC,QAAF,CAAWC,SAAvD,EAAkE,UAAUrC,CAAV,EAAa;QAC3E,IAAIA,CAAJ,EAAO;UACHC,CAAC,CAACqB,eAAF;QACH,CAFD,MAEO;UACHlC,EAAE,CAACgC,YAAH,CAAgBoB,SAAhB,CAA0B,WAA1B;QACH;MACJ,CAND;IAOH;EACJ;AAhEI,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        uidLabel: cc.Label,\n        root1: cc.Node,\n        root2: cc.Node,\n        rewardNode: cc.Node,\n        wxNode: cc.Node\n    },\n    initBy: function (e) {\n        var t = this;\n        this.onCloseCB = e;\n        this.preAuth = cc.player.auth;\n        this.uidLabel.string = cc.pvz.cloud.uid;\n        this.root1.active = !1;\n        this.root2.active = !1;\n        this.rewardNode.active = 1 != cc.player.auth;\n        if (cc.sys.platform == cc.sys.WECHAT_GAME) {\n            wx.getSetting({\n                success: function (e) {\n                    if (!0 === e.authSetting[\"scope.userInfo\"]) {\n                        t.root2.active = !0;\n                    } else {\n                        t.root1.active = !0;\n                    }\n                }\n            });\n        } else {\n            this.root1.active = this.rewardNode.active;\n            this.root2.active = !this.rewardNode.active;\n        }\n    },\n    onClickClose: function () {\n        this.wxNode.destroy();\n        cc.popupManager.removePopup(this);\n        if (this.onCloseCB) {\n            this.onCloseCB(1 != this.preAuth && 1 == cc.player.auth);\n        }\n    },\n    onAuthorizeSucc: function () {\n        this.root1.active = !1;\n        this.root2.active = !0;\n        this.rewardNode.active = !1;\n        if (1 != cc.player.auth) {\n            cc.player.auth = 1;\n            var e = cc.pvz.GameConfig.ItemType[\"钻石\"];\n            cc.pvz.PlayerData.changeItemNum(e, 100);\n            cc.popupManager.showEffectFly(e, cc.MainControl.getItemEffectPos(e), cc.math.randomRangeInt(1, 4));\n            cc.MainControl.updateItemInfo();\n        }\n    },\n    onWxAuthorize: function (e) {\n        var t = this;\n        console.log(\"xxxxxxxxxxxxxxxxxxxxxxxxx\");\n        console.log(e);\n        if (e.userInfo && e.userInfo.avatarUrl && e.userInfo.nickName) {\n            cc.pvz.cloud.setAvatar(e.userInfo.nickName, e.userInfo.avatarUrl, function (e) {\n                if (e) {\n                    t.onAuthorizeSucc();\n                } else {\n                    cc.popupManager.showToast(\"授权失败,稍后再试\");\n                }\n            });\n        }\n    }\n});\n"]}