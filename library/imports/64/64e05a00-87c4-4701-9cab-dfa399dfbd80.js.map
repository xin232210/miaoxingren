{"version":3,"sources":["assets/mainUI/scripts/UIShopBoxReward.js"],"names":["cc","Class","Component","properties","boxSpine","sp","Skeleton","closeBtn","Node","uiTip","baseItemNode","parentOnePanel","parentMorePanel","onLoad","active","initBy","e","t","i","o","a","callBack","onCheckRewardData","setEventListener","data","name","onShowBoxReward","node","setAnimation","setCompleteListener","butler","playEffect","MainControl","rewardSound","pvz","PlayerData","addMissionProgress","GameConfig","MissionType","rewardData","length","parent","utils","fadeInBtn","position","v2","getComponent","initRewardItem","instantiate","c","setTimeout","s","effectItemList","itemId","onCheckRandomTool","push","onCloseUI","popupManager","removePopup","math","randomRangeInt","showEffectFly","getItemEffectPos","updateItemInfo","RedControl","refreshAllRedTip"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;EACL,WAASD,EAAE,CAACE,SADP;EAELC,UAAU,EAAE;IACRC,QAAQ,EAAEC,EAAE,CAACC,QADL;IAERC,QAAQ,EAAEP,EAAE,CAACQ,IAFL;IAGRC,KAAK,EAAET,EAAE,CAACQ,IAHF;IAIRE,YAAY,EAAEV,EAAE,CAACQ,IAJT;IAKRG,cAAc,EAAEX,EAAE,CAACQ,IALX;IAMRI,eAAe,EAAEZ,EAAE,CAACQ;EANZ,CAFP;EAULK,MAAM,EAAE,kBAAY;IAChB,KAAKH,YAAL,CAAkBI,MAAlB,GAA2B,CAAC,CAA5B;IACA,KAAKL,KAAL,CAAWK,MAAX,GAAoB,CAAC,CAArB;IACA,KAAKP,QAAL,CAAcO,MAAd,GAAuB,CAAC,CAAxB;EACH,CAdI;EAeLC,MAAM,EAAE,gBAAUC,CAAV,EAAaC,CAAb,EAAgBC,CAAhB,EAAmB;IACvB,IAAIC,CAAC,GAAG,IAAR;;IACA,IAAI,KAAK,CAAL,KAAWD,CAAf,EAAkB;MACdA,CAAC,GAAG,IAAJ;IACH;;IACD,IAAIE,CAAC,GAAGJ,CAAR;IACA,KAAKK,QAAL,GAAgBH,CAAhB;IACA,KAAKI,iBAAL,CAAuBL,CAAvB;IACA,KAAKb,QAAL,CAAcmB,gBAAd,CAA+B,UAAUP,CAAV,EAAaC,CAAb,EAAgB;MAC3C,IAAI,WAAWA,CAAC,CAACO,IAAF,CAAOC,IAAtB,EAA4B;QACxBN,CAAC,CAACO,eAAF;MACH;IACJ,CAJD;IAKA,KAAKtB,QAAL,CAAcuB,IAAd,CAAmBb,MAAnB,GAA4B,CAAC,CAA7B;IACA,KAAKV,QAAL,CAAcwB,YAAd,CAA2B,CAA3B,EAA8B,OAAOR,CAAP,GAAW,IAAzC,EAA+C,CAAC,CAAhD;IACA,KAAKhB,QAAL,CAAcyB,mBAAd,CAAkC,YAAY;MAC1CV,CAAC,CAACf,QAAF,CAAWwB,YAAX,CAAwB,CAAxB,EAA2B,OAAOR,CAAP,GAAW,IAAtC,EAA4C,CAAC,CAA7C;MACAD,CAAC,CAACf,QAAF,CAAWyB,mBAAX,CAA+B,IAA/B;IACH,CAHD;IAIA7B,EAAE,CAAC8B,MAAH,CAAUC,UAAV,CAAqB/B,EAAE,CAACgC,WAAH,CAAeC,WAApC;;IACA,IAAI,KAAKb,CAAT,EAAY;MACRpB,EAAE,CAACkC,GAAH,CAAOC,UAAP,CAAkBC,kBAAlB,CAAqCpC,EAAE,CAACkC,GAAH,CAAOG,UAAP,CAAkBC,WAAlB,CAA8B,YAA9B,CAArC,EAAkF,CAAlF;IACH;EACJ,CAtCI;EAuCLZ,eAAe,EAAE,2BAAY;IACzB,IAAIV,CAAC,GAAG,IAAR;IACA,KAAKP,KAAL,CAAWK,MAAX,GAAoB,CAAC,CAArB;IACA,IAAIG,CAAC,GAAG,KAAKsB,UAAL,CAAgBC,MAAxB;IACA,IAAItB,CAAJ;;IACA,IAAID,CAAC,IAAI,CAAT,EAAY;MACRC,CAAC,GAAG,KAAKP,cAAT;IACH,CAFD,MAEO;MACHO,CAAC,GAAG,KAAKN,eAAT;IACH;;IACD,KAAKF,YAAL,CAAkBI,MAAlB,GAA2B,CAAC,CAA5B;IACA,KAAKJ,YAAL,CAAkB+B,MAAlB,GAA2BvB,CAA3B;;IACA,IAAID,CAAC,GAAG,CAAR,EAAW;MACPjB,EAAE,CAACkC,GAAH,CAAOQ,KAAP,CAAaC,SAAb,CAAuB,KAAKjC,YAA5B;IACH;;IACD,KAAKA,YAAL,CAAkBkC,QAAlB,GAA6B5C,EAAE,CAAC6C,EAAH,CAAM,CAAN,EAAS,CAAT,CAA7B;IACA,KAAKnC,YAAL,CAAkBoC,YAAlB,CAA+B,YAA/B,EAA6CC,cAA7C,CAA4D,KAAKR,UAAL,CAAgB,CAAhB,CAA5D,EAAgF,CAAC,CAAjF;;IACA,IAAItB,CAAC,IAAI,CAAT,EAAY;MACR,KAAK,IAAIE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,CAApB,EAAuBE,CAAC,EAAxB,EAA4B;QACxB,IAAIC,CAAC,GAAGpB,EAAE,CAACgD,WAAH,CAAe,KAAKtC,YAApB,CAAR;QACAU,CAAC,CAACqB,MAAF,GAAWvB,CAAX;QACAE,CAAC,CAAC0B,YAAF,CAAe,YAAf,EAA6BC,cAA7B,CAA4C,KAAKR,UAAL,CAAgBpB,CAAhB,CAA5C,EAAgE,CAAC,CAAjE;;QACA,IAAIA,CAAC,IAAIF,CAAC,GAAG,CAAb,EAAgB;UACZ,KAAKV,QAAL,CAAcO,MAAd,GAAuB,CAAC,CAAxB;QACH;MACJ;IACJ,CATD,MASO;MACH,IAAImC,CAAC,GAAG,SAAJA,CAAI,CAAU9B,CAAV,EAAa;QACjB+B,UAAU,CAAC,YAAY;UACnB,IAAI9B,CAAC,GAAGpB,EAAE,CAACgD,WAAH,CAAehC,CAAC,CAACN,YAAjB,CAAR;UACAU,CAAC,CAACqB,MAAF,GAAWvB,CAAX;UACAlB,EAAE,CAACkC,GAAH,CAAOQ,KAAP,CAAaC,SAAb,CAAuBvB,CAAvB;UACAA,CAAC,CAAC0B,YAAF,CAAe,YAAf,EAA6BC,cAA7B,CAA4C/B,CAAC,CAACuB,UAAF,CAAapB,CAAb,CAA5C,EAA6D,CAAC,CAA9D;;UACA,IAAIA,CAAC,IAAIF,CAAC,GAAG,CAAb,EAAgB;YACZD,CAAC,CAACT,QAAF,CAAWO,MAAX,GAAoB,CAAC,CAArB;UACH;QACJ,CARS,EAQP,MAAMK,CAAC,GAAG,CAAV,IAAe,GARR,CAAV;MASH,CAVD;;MAWA,KAAK,IAAIgC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGlC,CAApB,EAAuBkC,CAAC,EAAxB,EAA4B;QACxBF,CAAC,CAACE,CAAD,CAAD;MACH;IACJ;EACJ,CAjFI;EAkFL7B,iBAAiB,EAAE,2BAAUN,CAAV,EAAa;IAC5B,KAAKuB,UAAL,GAAkB,EAAlB;IACA,KAAKa,cAAL,GAAsB,EAAtB;;IACA,KAAK,IAAInC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGD,CAAC,CAACwB,MAAtB,EAA8BvB,CAAC,EAA/B,EAAmC;MAC/B,IAAIC,CAAC,GAAGF,CAAC,CAACC,CAAD,CAAT;;MACA,IAAIC,CAAC,CAACmC,MAAF,IAAY,CAAZ,IAAiBnC,CAAC,CAACmC,MAAF,IAAY,CAAjC,EAAoC;QAChCrD,EAAE,CAACkC,GAAH,CAAOQ,KAAP,CAAaY,iBAAb,CAA+BpC,CAA/B,EAAkC,KAAKqB,UAAvC;MACH,CAFD,MAEO;QACH,KAAKA,UAAL,CAAgBgB,IAAhB,CAAqBrC,CAArB;QACAA,CAAC,CAACmC,MAAF,IAAY,CAAZ,IAAiBnC,CAAC,CAACmC,MAAF,IAAY,CAA7B,IAAkC,KAAKD,cAAL,CAAoBG,IAApB,CAAyBrC,CAAC,CAACmC,MAA3B,CAAlC;MACH;IACJ;EACJ,CA9FI;EA+FLG,SAAS,EAAE,qBAAY;IACnBxD,EAAE,CAACyD,YAAH,CAAgBC,WAAhB,CAA4B,IAA5B;;IACA,IAAI,KAAKN,cAAL,CAAoBZ,MAApB,GAA6B,CAAjC,EAAoC;MAChC,IAAIxB,CAAC,GAAG,CAAC,CAAT;;MACA,KAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKmC,cAAL,CAAoBZ,MAAxC,EAAgDvB,CAAC,EAAjD,EAAqD;QACjD,IAAIC,CAAC,GAAG,KAAKkC,cAAL,CAAoBnC,CAApB,CAAR;;QACA,KAAK,IAAIE,CAAC,GAAGnB,EAAE,CAAC2D,IAAH,CAAQC,cAAR,CAAuB,CAAvB,EAA0B,CAA1B,CAAb,EAA2C,CAAC,CAAD,IAAM5C,CAAN,IAAWA,CAAC,IAAIG,CAA3D,GAAgE;UAC5DA,CAAC,GAAGnB,EAAE,CAAC2D,IAAH,CAAQC,cAAR,CAAuB,CAAvB,EAA0B,CAA1B,CAAJ;QACH;;QACD5C,CAAC,GAAGG,CAAJ;QACAnB,EAAE,CAACyD,YAAH,CAAgBI,aAAhB,CAA8B3C,CAA9B,EAAiClB,EAAE,CAACgC,WAAH,CAAe8B,gBAAf,CAAgC5C,CAAhC,CAAjC,EAAqEC,CAArE;MACH;IACJ;;IACD,IAAI,KAAKE,QAAT,EAAmB;MACf,KAAKA,QAAL;IACH;;IACDrB,EAAE,CAACgC,WAAH,CAAe+B,cAAf;IACA/D,EAAE,CAACgE,UAAH,CAAcC,gBAAd;EACH;AAjHI,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        boxSpine: sp.Skeleton,\n        closeBtn: cc.Node,\n        uiTip: cc.Node,\n        baseItemNode: cc.Node,\n        parentOnePanel: cc.Node,\n        parentMorePanel: cc.Node\n    },\n    onLoad: function () {\n        this.baseItemNode.active = !1;\n        this.uiTip.active = !1;\n        this.closeBtn.active = !1;\n    },\n    initBy: function (e, t, i) {\n        var o = this;\n        if (void 0 === i) {\n            i = null;\n        }\n        var a = e;\n        this.callBack = i;\n        this.onCheckRewardData(t);\n        this.boxSpine.setEventListener(function (e, t) {\n            if (\"kapai\" == t.data.name) {\n                o.onShowBoxReward();\n            }\n        });\n        this.boxSpine.node.active = !0;\n        this.boxSpine.setAnimation(0, \"BX\" + a + \"_1\", !1);\n        this.boxSpine.setCompleteListener(function () {\n            o.boxSpine.setAnimation(0, \"BX\" + a + \"_2\", !0);\n            o.boxSpine.setCompleteListener(null);\n        });\n        cc.butler.playEffect(cc.MainControl.rewardSound);\n        if (2 == a) {\n            cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType[\"高级宝箱抽取装备n次\"], 1);\n        }\n    },\n    onShowBoxReward: function () {\n        var e = this;\n        this.uiTip.active = !0;\n        var t = this.rewardData.length;\n        var i;\n        if (t <= 5) {\n            i = this.parentOnePanel;\n        } else {\n            i = this.parentMorePanel;\n        }\n        this.baseItemNode.active = !0;\n        this.baseItemNode.parent = i;\n        if (t > 5) {\n            cc.pvz.utils.fadeInBtn(this.baseItemNode);\n        }\n        this.baseItemNode.position = cc.v2(0, 0);\n        this.baseItemNode.getComponent(\"RewardItem\").initRewardItem(this.rewardData[0], !0);\n        if (t <= 5) {\n            for (var o = 1; o < t; o++) {\n                var a = cc.instantiate(this.baseItemNode);\n                a.parent = i;\n                a.getComponent(\"RewardItem\").initRewardItem(this.rewardData[o], !0);\n                if (o == t - 1) {\n                    this.closeBtn.active = !0;\n                }\n            }\n        } else {\n            var c = function (o) {\n                setTimeout(function () {\n                    var a = cc.instantiate(e.baseItemNode);\n                    a.parent = i;\n                    cc.pvz.utils.fadeInBtn(a);\n                    a.getComponent(\"RewardItem\").initRewardItem(e.rewardData[o], !0);\n                    if (o == t - 1) {\n                        e.closeBtn.active = !0;\n                    }\n                }, 40 * (o - 1) + 120);\n            };\n            for (var s = 1; s < t; s++) {\n                c(s);\n            }\n        }\n    },\n    onCheckRewardData: function (e) {\n        this.rewardData = [];\n        this.effectItemList = [];\n        for (var t = 0; t < e.length; t++) {\n            var i = e[t];\n            if (i.itemId >= 5 && i.itemId <= 7) {\n                cc.pvz.utils.onCheckRandomTool(i, this.rewardData);\n            } else {\n                this.rewardData.push(i);\n                i.itemId >= 2 && i.itemId <= 4 && this.effectItemList.push(i.itemId);\n            }\n        }\n    },\n    onCloseUI: function () {\n        cc.popupManager.removePopup(this);\n        if (this.effectItemList.length > 0) {\n            var e = -1;\n            for (var t = 0; t < this.effectItemList.length; t++) {\n                var i = this.effectItemList[t];\n                for (var o = cc.math.randomRangeInt(1, 4); -1 != e && e == o; ) {\n                    o = cc.math.randomRangeInt(1, 4);\n                }\n                e = o;\n                cc.popupManager.showEffectFly(i, cc.MainControl.getItemEffectPos(i), o);\n            }\n        }\n        if (this.callBack) {\n            this.callBack();\n        }\n        cc.MainControl.updateItemInfo();\n        cc.RedControl.refreshAllRedTip();\n    }\n});\n"]}