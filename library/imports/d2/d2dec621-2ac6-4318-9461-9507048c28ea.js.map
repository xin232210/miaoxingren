{"version":3,"sources":["assets/mainUI/scripts/ShopBoxItem.js"],"names":["cc","Class","Component","properties","boxCdTimes","Label","boxCdPanel","Node","boxAdBtnPanel","boxBuyBtn","tipLabel","RichText","initShopBoxItem","e","t","i","boxId","shopBoxJson","callBack","price","shopBoxData","pvz","PlayerData","getShopBoxData","o","date","a","Math","floor","Date","now","ShopBoxCD","GameConfig","active","isCanAdBuy","onCheckBoxAdBtnGray","unscheduleAllCallbacks","lastTime","string","utils","formatSeconds3","schedule","refreshCDTime","c","s","length","BoxTipNames","n","r","rewardData","h","p","getRewardItem","push","unschedule","showBoxCdTime","childrenCount","children","getComponent","Sprite","setMaterial","JsonControl","materialList","onClickBoxInfo","UIShop","isLookAd","onStopShopScroll","popupManager","popup","ad","scale","onClickAdBox","onAdClose","AdUtils","showAdRewardVideo","AdType","updateShopBoxDate","updateShopBoxExp","onClickBuyBox","isItemEnough","ItemType","changeItemNum","isHaveAdBuyBankTimes","showToast"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        boxCdTimes: cc.Label,\n        boxCdPanel: cc.Node,\n        boxAdBtnPanel: cc.Node,\n        boxBuyBtn: cc.Node,\n        tipLabel: cc.RichText\n    },\n    initShopBoxItem: function (e, t, i) {\n        if (void 0 === i) {\n            i = null;\n        }\n        this.boxId = e;\n        this.shopBoxJson = t;\n        this.callBack = i;\n        this.price = this.shopBoxJson[\"consume\" + this.boxId];\n        this.shopBoxData = cc.pvz.PlayerData.getShopBoxData();\n        var o = this.shopBoxData.date[this.boxId - 1];\n        var a = Math.floor((Date.now() - o) / 1e3);\n        this.ShopBoxCD = cc.pvz.GameConfig.ShopBoxCD[this.boxId - 1];\n        if (a >= this.ShopBoxCD) {\n            this.boxCdPanel.active = !1;\n            this.isCanAdBuy = !0;\n            this.onCheckBoxAdBtnGray(!1);\n            this.unscheduleAllCallbacks();\n        } else {\n            this.boxCdPanel.active = !0;\n            this.isCanAdBuy = !1;\n            this.onCheckBoxAdBtnGray(!0);\n            this.lastTime = Math.floor(this.ShopBoxCD - a);\n            this.boxCdTimes.string = cc.pvz.utils.formatSeconds3(this.lastTime);\n            this.schedule(this.refreshCDTime, 1);\n        }\n        var c = this.shopBoxJson[\"box\" + this.boxId];\n        var s = c[c.length - 2];\n        this.tipLabel.string = cc.pvz.GameConfig.BoxTipNames[s - 5];\n        var n = Math.floor(c.length / 2);\n        var r = 0;\n        this.rewardData = [];\n        for (var h = 0; h < n; h++) {\n            var p = cc.pvz.utils.getRewardItem(c[r], c[r + 1]);\n            this.rewardData.push(p);\n            r += 2;\n        }\n    },\n    refreshCDTime: function () {\n        this.lastTime--;\n        this.boxCdTimes.string = cc.pvz.utils.formatSeconds3(this.lastTime);\n        if (this.lastTime <= 0) {\n            this.boxCdPanel.active = !1;\n            this.isCanAdBuy = !0;\n            this.onCheckBoxAdBtnGray(!1);\n            this.unschedule(this.refreshCDTime, this);\n        }\n    },\n    showBoxCdTime: function () {\n        this.boxCdPanel.active = !0;\n        this.isCanAdBuy = !1;\n        this.onCheckBoxAdBtnGray(!0);\n        this.lastTime = this.ShopBoxCD;\n        this.boxCdTimes.string = cc.pvz.utils.formatSeconds3(this.lastTime);\n        this.schedule(this.refreshCDTime, 1);\n    },\n    onCheckBoxAdBtnGray: function (e) {\n        if (1 == this.boxId) {\n            this.boxAdBtnPanel.active = !e;\n            this.boxBuyBtn && (this.boxBuyBtn.active = e);\n        } else {\n            for (var t = 0; t < this.boxAdBtnPanel.childrenCount; t++) {\n                this.boxAdBtnPanel.children[t]\n                    .getComponent(cc.Sprite)\n                    .setMaterial(0, cc.JsonControl.materialList[e ? 1 : 0]);\n            }\n        }\n    },\n    onClickBoxInfo: function () {\n        var e = this;\n        if (cc.UIShop.isLookAd) {\n            //\n        } else {\n            cc.UIShop.onStopShopScroll();\n            cc.popupManager.popup(\n                \"mainUI\",\n                \"shopboxBuy\",\n                \"UIShopBoxBuy\",\n                {\n                    ad: !1,\n                    scale: !0\n                },\n                this.boxId,\n                this.shopBoxJson,\n                this.isCanAdBuy,\n                function () {\n                    if (e.callBack) {\n                        e.callBack();\n                    }\n                    e.showBoxCdTime();\n                }\n            );\n        }\n    },\n    onClickAdBox: function () {\n        var e = this;\n        if (cc.UIShop.isLookAd) {\n            //\n        } else {\n            if (this.isCanAdBuy) {\n                cc.UIShop.onStopShopScroll();\n                if (1 == this.boxId) {\n                    this.onAdClose(!0);\n                } else {\n                    (cc.UIShop.isLookAd = !0),\n                        cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType[\"商店宝箱\"], function (t) {\n                            e.onAdClose(t);\n                        });\n                }\n            }\n        }\n    },\n    onAdClose: function (e) {\n        cc.UIShop.isLookAd = !1;\n        if (e) {\n            cc.pvz.PlayerData.updateShopBoxDate(this.boxId, Date.now());\n            if (this.isCanAdBuy && 2 == this.boxId) {\n                cc.pvz.PlayerData.updateShopBoxExp(this.price);\n            }\n            this.showBoxCdTime();\n            cc.popupManager.popup(\n                \"mainUI\",\n                \"ShopBoxEft\",\n                \"UIShopBoxReward\",\n                {\n                    ad: !1,\n                    scale: !0\n                },\n                this.boxId,\n                this.rewardData,\n                this.callBack\n            );\n        }\n    },\n    onClickBuyBox: function () {\n        if (!cc.UIShop.isLookAd) {\n            cc.UIShop.onStopShopScroll();\n            if (cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType[\"钻石\"], this.price)) {\n                cc.pvz.PlayerData.updateShopBoxExp(this.price);\n                cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType[\"钻石\"], -this.price);\n                cc.popupManager.popup(\n                    \"mainUI\",\n                    \"ShopBoxEft\",\n                    \"UIShopBoxReward\",\n                    {\n                        ad: !1,\n                        scale: !0\n                    },\n                    this.boxId,\n                    this.rewardData,\n                    this.callBack\n                );\n            } else if (cc.pvz.PlayerData.isHaveAdBuyBankTimes(1)) {\n                var e = cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType[\"钻石\"], 100);\n                cc.popupManager.popup(\n                    \"mainUI\",\n                    \"adbuyUI\",\n                    \"UIAdBuy\",\n                    {\n                        ad: !1,\n                        scale: !0\n                    },\n                    e\n                );\n            } else {\n                cc.popupManager.showToast(\"钻石不足！\");\n            }\n        }\n    }\n});\n"]}