{"version":3,"sources":["assets/scripts/loading.js"],"names":["cc","Class","Component","properties","progressBar","ProgressBar","onLoad","debug","setDisplayStats","e","RenderFlow","prototype","_updateRenderData","t","_renderComponent","_assembler","_renderFlag","FLAG_UPDATE_RENDER_DATA","_next","_func","call","_render","o","_postRender","start","macro","ENABLE_MULTI_TOUCH","pvz","TAUtils","init","total","waited","loadSubpackage","singleTime","Math","max","barProgress","progress","updateProgress","tween","to","initData","sys","platform","WECHAT_GAME","wx","setKeepScreenOn","keepScreenOn","onError","track","message","stack","isControlAd","AdUtils","initAllAds","PlayerData","initPlayerData","onResReady","onProgressChanged","onAllResReady","assetManager","getBundle","loadBundle","console","log","cloud","login","baseData","length","JSON","parse","player","dataVersion","achievePro","hasOwnProperty","GameConfig","MissionType","a","postLoadData","uploadLoginData","uid","name","level","getStageLevel","checkIntoGame","initShareKey","initShareConfig","runtimeData","director","loadScene","trackBackpack"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        progressBar: cc.ProgressBar\n    },\n    onLoad: function () {\n        cc.debug.setDisplayStats(!1);\n        var e = cc.RenderFlow.prototype._updateRenderData;\n        cc.RenderFlow.prototype._updateRenderData = function (t) {\n            if (!t._renderComponent || !t._renderComponent._assembler) {\n                t._renderFlag &= ~cc.RenderFlow.FLAG_UPDATE_RENDER_DATA;\n                return void this._next._func(t);\n            }\n            e.call(this, t);\n        };\n        var t = cc.RenderFlow.prototype._render;\n        cc.RenderFlow.prototype._render = function (e) {\n            if (e._renderComponent && e._renderComponent._assembler) {\n                t.call(this, e);\n            } else {\n                this._next._func(e);\n            }\n        };\n        var o = cc.RenderFlow.prototype._postRender;\n        cc.RenderFlow.prototype._postRender = function (e) {\n            if (e._renderComponent && e._renderComponent._assembler) {\n                o.call(this, e);\n            } else {\n                this._next._func(e);\n            }\n        };\n    },\n    start: function () {\n        cc.macro.ENABLE_MULTI_TOUCH = !1;\n        cc.pvz.TAUtils.init();\n        this.total = 1;\n        this.waited = 1;\n        this.loadSubpackage(\"uiImage\");\n        this.loadSubpackage(\"mainUI\");\n        this.loadSubpackage(\"actors\");\n        this.loadSubpackage(\"game\");\n        this.singleTime = Math.max(0.3, 1.8 / this.total);\n        this.barProgress = 0;\n        this.progressBar.progress = 0;\n        this.updateProgress();\n    },\n    updateProgress: function () {\n        var e = (this.barProgress + 1) / this.total;\n        cc.tween(this.progressBar)\n            .to(this.singleTime, {\n                progress: e\n            })\n            .start();\n    },\n    initData: function () {\n        if (cc.sys.platform == cc.sys.WECHAT_GAME) {\n            wx.setKeepScreenOn({\n                keepScreenOn: !0\n            });\n            wx.onError(function (e) {\n                cc.pvz.TAUtils.track(\"error\", {\n                    message: e.message,\n                    stack: e.stack\n                });\n            });\n        }\n        cc.isControlAd = !0;\n        cc.pvz.AdUtils.initAllAds();\n        cc.pvz.PlayerData.initPlayerData();\n        this.onResReady();\n    },\n    onProgressChanged: function () {\n        this.barProgress++;\n        this.updateProgress();\n    },\n    onResReady: function () {\n        this.onProgressChanged();\n        this.waited -= 1;\n        if (1 == this.waited) {\n            this.initData();\n        } else {\n            if (0 == this.waited) {\n                this.onAllResReady();\n            }\n        }\n    },\n    loadSubpackage: function (e) {\n        var t = this;\n        if (cc.assetManager.getBundle(e)) {\n            this.onResReady();\n        } else {\n            this.total++;\n            this.waited++;\n            cc.assetManager.loadBundle(e, null, function (o) {\n                if (o) {\n                    console.log(\"load subpackage \" + e + \" fail:\", o);\n                } else {\n                    console.log(\"load subpackage \" + e);\n                    t.onResReady();\n                }\n            });\n        }\n    },\n    onAllResReady: function () {\n        var e = this;\n        cc.pvz.cloud.login(function () {\n            if (cc.pvz.cloud.baseData.length > 2) {\n                var t = JSON.parse(cc.pvz.cloud.baseData);\n                console.log(\"server t:\", t.t, \", local t:\", cc.player.t, \"s version:\", t.dataVersion);\n                var o;\n                if (cc.player.achievePro.hasOwnProperty(cc.pvz.GameConfig.MissionType[\"装备总等级n\"])) {\n                    o = cc.player.achievePro[cc.pvz.GameConfig.MissionType[\"装备总等级n\"]];\n                } else {\n                    o = 0;\n                }\n                var a;\n                if (t.achievePro.hasOwnProperty(cc.pvz.GameConfig.MissionType[\"装备总等级n\"])) {\n                    a = t.achievePro[cc.pvz.GameConfig.MissionType[\"装备总等级n\"]];\n                } else {\n                    a = 0;\n                }\n                if (t.t > cc.player.t || a > o) {\n                    cc.player = t;\n                    cc.pvz.PlayerData.postLoadData();\n                }\n            }\n            cc.pvz.TAUtils.uploadLoginData({\n                uid: cc.pvz.cloud.uid,\n                name: cc.pvz.cloud.name,\n                level: cc.pvz.PlayerData.getStageLevel()\n            });\n            e.checkIntoGame();\n        });\n        cc.pvz.TAUtils.initShareKey();\n        cc.pvz.TAUtils.initShareConfig();\n    },\n    checkIntoGame: function () {\n        if (1 == cc.pvz.PlayerData.getStageLevel()) {\n            cc.pvz.runtimeData.init(0, 1);\n            cc.director.loadScene(\"game1\");\n            cc.pvz.TAUtils.trackBackpack(1);\n        } else {\n            cc.director.loadScene(\"mainUI\");\n        }\n    }\n});\n"]}