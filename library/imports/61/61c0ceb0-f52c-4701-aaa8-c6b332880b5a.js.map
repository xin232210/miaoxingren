{"version":3,"sources":["assets/game/scripts/Bullet.js"],"names":["cc","Class","Component","properties","sprite","Sprite","spriteBundle","spritePath","spine","sp","Skeleton","spinePre","aoeHitEffect","life","tooltip","dieOutScreen","speed","buffSlow","buffIce","buffPoison","dieKeepFrame","hitCount","hitChangeAngle","jsEffExclusive","canReturn","initBy","t","e","scene","lv","dieTimer","hitCounter","lifeTimer","returnTimer","setTimeout","doReturnLogic","bind","onLifeEnd","moveByAngle","i","Math","PI","moveDelta","v2","cos","sin","node","angle","x","y","parent","onMoveEnded","clearTimeout","update","timePaused","mul","director","getScheduler","getTimeScale","position","add","onHitEnemy","enabled","chooseEnemyByBullet","n","o","centerY","sub","s","atan2","doCollisionLogic","tag","getComponent","hp","excludeEnemy","a","doBulletAttLogic","onCollisionEnter","onRangePoisonEnter","addBuffPoison","att","onAoeCollisionEnter"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        sprite: cc.Sprite,\n        spriteBundle: \"\",\n        spritePath: \"\",\n        spine: sp.Skeleton,\n        spinePre: \"\",\n        aoeHitEffect: !1,\n        life: {\n            default: -1,\n            tooltip: \"毫秒，-1为出屏消失\"\n        },\n        dieOutScreen: !0,\n        speed: 500,\n        buffSlow: !1,\n        buffIce: !1,\n        buffPoison: !1,\n        dieKeepFrame: 0,\n        hitCount: {\n            default: 1,\n            tooltip: \"攻击次数，默认1次攻击后消失，填2就穿透1次\"\n        },\n        hitChangeAngle: !1,\n        jsEffExclusive: !1,\n        canReturn: !1\n    },\n    initBy: function (t, e) {\n        this.scene = t;\n        this.lv = e;\n        this.dieTimer = -1;\n        this.hitCounter = this.hitCount;\n        this.lifeTimer = -1;\n        if (this.canReturn && this.scene) {\n            this.returnTimer = this.scene.setTimeout(this.doReturnLogic.bind(this), this.life);\n            this.life += this.life;\n        }\n        if (this.life > 0 && this.scene) {\n            this.lifeTimer = this.scene.setTimeout(this.onLifeEnd.bind(this), this.life);\n        }\n    },\n    moveByAngle: function (t) {\n        if (this.speed > 0) {\n            var e = this.speed / 60;\n            var i = (t * Math.PI) / 180;\n            this.moveDelta = cc.v2(e * Math.cos(i), e * Math.sin(i));\n        }\n        this.node.angle = t;\n    },\n    doReturnLogic: function () {\n        this.moveDelta = cc.v2(-this.moveDelta.x, -this.moveDelta.y);\n    },\n    onLifeEnd: function () {\n        this.node.parent = null;\n    },\n    onMoveEnded: function () {\n        if (-1 != this.lifeTimer && this.scene) {\n            this.scene.clearTimeout(this.lifeTimer);\n            this.lifeTimer = -1;\n        }\n        this.node.parent = null;\n    },\n    update: function () {\n        if (this.scene && !this.scene.timePaused && this.moveDelta) {\n            var t = this.moveDelta.mul(cc.director.getScheduler().getTimeScale());\n            this.node.position = this.node.position.add(t);\n        }\n    },\n    onHitEnemy: function (t) {\n        var e = this;\n        this.hitCounter--;\n        if (this.hitCounter <= 0) {\n            t.enabled = !1;\n            -1 != this.lifeTimer && this.scene && (this.scene.clearTimeout(this.lifeTimer), (this.lifeTimer = -1));\n            if (this.dieKeepFrame > 0) {\n                -1 == this.dieTimer && this.scene &&\n                    (this.dieTimer = this.scene.setTimeout(function () {\n                        e.node.parent = null;\n                    }, (1e3 * this.dieKeepFrame) / 60));\n            } else {\n                this.node.parent = null;\n            }\n        } else if (this.hitChangeAngle && this.scene) {\n            var i = this.scene.chooseEnemyByBullet(this);\n            if (i) {\n                var n = this.node.position;\n                var o = i.node.position.add(cc.v2(0, i.centerY)).sub(n);\n                var s = Math.atan2(o.y, o.x);\n                this.moveByAngle((180 * s) / Math.PI);\n            }\n        }\n    },\n    doCollisionLogic: function (t, e) {\n        if (1 != t.tag) {\n            var i = t.getComponent(\"Enemy\");\n            if (i && i.hp > 0 && i != this.excludeEnemy) {\n                this.a.doBulletAttLogic(this, i);\n                this.onHitEnemy(e);\n            }\n        } else {\n            if (this.dieOutScreen) {\n                this.onMoveEnded();\n            }\n        }\n    },\n    onCollisionEnter: function (t, e) {\n        if (e.enabled) {\n            this.doCollisionLogic(t, e);\n        }\n    },\n    onRangePoisonEnter: function (t) {\n        var e = t.getComponent(\"Enemy\");\n        if (e && e.hp > 0) {\n            e.addBuffPoison(this.a, 5e3, this.att);\n        }\n    },\n    onAoeCollisionEnter: function (t) {\n        var e = t.getComponent(\"Enemy\");\n        if (e && e.hp > 0) {\n            this.a.doBulletAttLogic(this, e);\n        }\n    }\n});"]}