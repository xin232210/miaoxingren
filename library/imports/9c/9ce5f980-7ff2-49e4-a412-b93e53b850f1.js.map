{"version":3,"sources":["assets/rank/scripts/UIRankEnd.js"],"names":["cc","Class","Component","properties","bgSpine","sp","Skeleton","tiSpine","waveLabel","Label","batterWaveTip","Node","coinCountLabel","bgNode","infoPanel","initBy","e","t","scene","active","setAnimation","pvz","utils","spineFromTo","n","runtimeData","wave","string","tmpScore","tmpNewRecord","c","o","i","items","forEach","id","lv","length","push","a","math","randomRangeInt","cloud","uploadScore","butler","resumeDirector","TAUtils","trackAdUIShow","GameConfig","AdType","addCoinAndClose","PlayerData","changeItemNum","ItemType","popupManager","removePopup","getRewardItem","popup","ad","scale","UIFromType","removeAllPopups","removeData","director","loadScene","playEffectAsync","onClickClose","onClickAd","isLookAd","AdUtils","showAdRewardVideo"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        bgSpine: sp.Skeleton,\n        tiSpine: sp.Skeleton,\n        waveLabel: cc.Label,\n        batterWaveTip: cc.Node,\n        coinCountLabel: cc.Label,\n        bgNode: cc.Node,\n        infoPanel: cc.Node\n    },\n    initBy: function (e) {\n        var t = this;\n        this.scene = e;\n        this.bgNode.active = !1;\n        this.infoPanel.active = !1;\n        this.bgSpine.setAnimation(0, \"\", !1);\n        cc.pvz.utils.spineFromTo(this.bgSpine, \"jieshu1_2\", \"jieshu2_2\");\n        cc.pvz.utils.spineFromTo(this.tiSpine, \"jieshu1_1\", \"jieshu2_1\", !0, function () {\n            t.bgNode.active = !0;\n            t.infoPanel.active = !0;\n        });\n        var n = cc.pvz.runtimeData.wave;\n        this.waveLabel.string = \"\" + n;\n        this.coinCountLabel.string = \"x\" + 50 * n;\n        if (cc.pvz.runtimeData.wave > 0 && cc.pvz.runtimeData.wave > cc.tmpScore) {\n            cc.tmpScore = cc.pvz.runtimeData.wave;\n            cc.tmpNewRecord = !0;\n            this.batterWaveTip.active = !0;\n            var c = -1;\n            var o = [];\n            var i = [];\n            cc.pvz.runtimeData.items.forEach(function (e) {\n                if (99 != e.id) {\n                    if (e.lv > c) {\n                        c = e.lv;\n                        o.length = 0;\n                    }\n                    o.push(e.id);\n                    i.push(e.id);\n                    i.push(e.lv);\n                }\n            });\n            var a = \"\" + o[cc.math.randomRangeInt(0, o.length)];\n            cc.pvz.cloud.uploadScore(n, a, i, function () {});\n        } else {\n            this.batterWaveTip.active = !1;\n        }\n        cc.butler.resumeDirector(1);\n        cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType[\"关卡结算\"]);\n    },\n    addCoinAndClose: function (e) {\n        var t;\n        if (e) {\n            t = 100 * cc.pvz.runtimeData.wave;\n        } else {\n            t = 50 * cc.pvz.runtimeData.wave;\n        }\n        cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType[\"金币\"], t);\n        if (e) {\n            cc.popupManager.removePopup(this);\n            var n = cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType[\"金币\"], t);\n            cc.popupManager.popup(\n                \"mainUI\",\n                \"getrewardUI\",\n                \"UIReward\",\n                {\n                    ad: !1,\n                    scale: !1\n                },\n                [n],\n                cc.pvz.GameConfig.UIFromType[\"双倍结算\"],\n                function () {\n                    cc.popupManager.removeAllPopups();\n                    cc.pvz.runtimeData.removeData();\n                    cc.director.loadScene(\"mainUI\");\n                }\n            );\n        } else {\n            cc.butler.playEffectAsync(\"game\", \"sound/getCoin\");\n            cc.popupManager.removeAllPopups();\n            cc.pvz.runtimeData.removeData();\n            cc.director.loadScene(\"mainUI\");\n        }\n    },\n    onClickClose: function () {\n        this.addCoinAndClose(!1);\n    },\n    onClickAd: function () {\n        var e = this;\n        if (this.isLookAd) {\n            //\n        } else {\n            this.isLookAd = !0;\n            cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType[\"关卡结算\"], function (t) {\n                e.isLookAd = !1;\n                if (t) {\n                    e.addCoinAndClose(!0);\n                }\n            });\n        }\n    }\n});\n"]}