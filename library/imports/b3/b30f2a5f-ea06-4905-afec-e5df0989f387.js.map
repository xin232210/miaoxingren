{"version":3,"sources":["assets/game/scripts/ItemRoot.js"],"names":["$prefabInfo","require","cc","Class","Component","properties","dragingRoot","Node","blockRootNode","blockItemsRootNode","buffEffect","barPrefab","linePrefab","onLoad","blockRoot","getComponent","zIndex","macro","MAX_ZINDEX","layoutChildren","t","node","Layout","spacingX","childrenCount","e","children","reduce","width","i","Math","max","forEach","scale","min","updateLayout","setCanDrag","id","pickupFromBoard","n","convertToNodeSpaceAR","position","angle","parent","Tween","stopAllByTarget","initSameIDLvLine","pickup","o","setExtendMode","putdown","setBgSpParent","canUse","lv","y","x","s","lvup","setSelfListenEvent","c","findIndex","a","r","sortAllChildren","tween","to","start"],"mappings":"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","sourceRoot":"/","sourcesContent":["var $prefabInfo = require(\"../../scripts/PrefabInfo\");\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        dragingRoot: cc.Node,\n        blockRootNode: cc.Node,\n        blockItemsRootNode: cc.Node,\n        buffEffect: $prefabInfo,\n        barPrefab: $prefabInfo,\n        linePrefab: $prefabInfo\n    },\n    onLoad: function () {\n        this.blockRoot = this.blockRootNode.getComponent(\"BlockRoot\");\n        this.blockItemsRootNode.zIndex = cc.macro.MAX_ZINDEX - 1;\n    },\n    layoutChildren: function () {\n        var t = this.node.getComponent(cc.Layout);\n        t.spacingX = -1;\n        if (this.node.childrenCount > 1) {\n            var e = this.node.children.reduce(function (t, e) {\n                return t + e.width;\n            }, 0);\n            if (e > 720) {\n                var i = Math.max(0.8, 720 / e);\n                this.node.children.forEach(function (t) {\n                    return (t.scale = i);\n                });\n                t.spacingX = 0;\n            } else {\n                t.spacingX = Math.min(30, (720 - e) / (this.node.childrenCount - 1));\n            }\n        } else {\n            t.spacingX = 15;\n        }\n        t.updateLayout();\n    },\n    setCanDrag: function (t) {\n        this.node.children.forEach(function (e) {\n            var i = e.getComponent(\"Item\");\n            if (i && 0 != i.id) {\n                i.setCanDrag(t);\n            }\n        });\n        this.blockItemsRootNode.children.forEach(function (e) {\n            var i = e.getComponent(\"Item\");\n            if (i && 0 != i.id) {\n                i.setCanDrag(t);\n            }\n        });\n    },\n    pickupFromBoard: function (t, e) {\n        var i = this.dragingRoot;\n        var n = i.convertToNodeSpaceAR(e);\n        t.node.position = n;\n        t.node.angle = 0;\n        t.node.parent = i;\n        cc.Tween.stopAllByTarget(t.node);\n        t.initSameIDLvLine();\n    },\n    pickup: function (t, e) {\n        var i = this.dragingRoot;\n        var n = i.convertToNodeSpaceAR(e);\n        t.node.position = n;\n        t.node.angle = 0;\n        t.node.parent = i;\n        t.node.scale = 1;\n        cc.Tween.stopAllByTarget(t.node);\n        var o = 0 == t.id;\n        this.blockRoot.setExtendMode(o);\n        if (o) {\n            this.setCanDrag(!1);\n        }\n    },\n    putdown: function (t, e) {\n        var i = this.node.convertToNodeSpaceAR(e);\n        t.setBgSpParent(!0);\n        if (t.canUse && 0 != t.id && t.lv < 3 && i.y < 100) {\n            for (var n = 0; n < this.node.childrenCount; n++) {\n                var o = this.node.children[n];\n                if (i.x > o.x - o.width / 2 && i.x < o.x + o.width / 2) {\n                    var s = o.getComponent(\"Item\");\n                    if (s.canUse && s.id == t.id && s.lv == t.lv) {\n                        t.node.parent = null;\n                        this.layoutChildren();\n                        return void s.lvup();\n                    }\n                }\n            }\n        }\n        t.node.parent = this.node;\n        t.node.position = i;\n        t.setSelfListenEvent(!0);\n        var c = this.node.children.findIndex(function (e) {\n            return e.x > t.node.x;\n        });\n        if (-1 == c) {\n            c = this.node.childrenCount;\n        } else {\n            c = c;\n        }\n        for (var a = 0; a < c; a++) {\n            this.node.children[a].zIndex = -1;\n        }\n        for (var r = c; r < this.node.childrenCount; r++) {\n            this.node.children[r].zIndex = 1;\n        }\n        t.node.zIndex = 0;\n        this.node.sortAllChildren();\n        this.layoutChildren();\n        cc.tween(t.node)\n            .to(0.16, {\n                y: 0\n            })\n            .start();\n    }\n});\n"]}