
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/GuideManager.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '3e530AnaFpCRpPVjJjsRRmq', 'GuideManager');
// scripts/GuideManager.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    spine: sp.Skeleton,
    focusNode: cc.Node,
    fingerSpine: sp.Skeleton,
    guideNode: cc.Node,
    guideLabel: cc.Label
  },
  onLoad: function onLoad() {
    var e = this;
    cc.guideManager = this;

    if (this.guideNode) {
      this.guideNode.active = !1;
    }

    this.hackButton();
    cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, function (t) {
      e.node.parent = t;
    });
  },
  isGuiding: function isGuiding() {
    return this.guideNode.active;
  },
  showGuide: function showGuide(e, t, o) {
    var a = this;
    var n = -1;
    !function e() {
      if (++n >= t.length) {
        a.hideGuideDialog();
        a.guideConfig = null;
        o && o(!0);
      } else {
        var i = t[n];
        a.showGuideDialog(i, e);

        if (o) {
          o(!1, n);
        }
      }
    }();
  },
  showGuideDialog: function showGuideDialog(e, t) {
    var o = this;
    this.guideConfig = {
      btn: e.btn,
      r: e.r,
      cb: t
    };
    this.guideNode.zIndex = cc.macro.MAX_ZINDEX;
    this.guideNode.active = !0;

    if (e.y) {
      this.spine.node.y = e.y;
    } else {
      if (e.t) {
        this.spine.node.y = 200;
      } else {
        this.spine.node.y = 0;
      }
    }

    this.spine.setAnimation(0, e.r ? "jiaoxue1_R" : "jiaoxue1", !1);
    this.spine.setCompleteListener(function () {
      o.spine.setAnimation(0, e.r ? "jiaoxue2_R" : "jiaoxue2", !0);
      o.spine.setCompleteListener(null);
    });
    this.guideLabel.string = e.tip;
    this.guideLabel.node.stopAllActions();
    this.guideLabel.node.opacity = 0;
    this.guideLabel.node.runAction(cc.fadeIn(0.5));
    var a;

    if (e.focus) {
      a = e.focus.getBoundingBoxToWorld();
    } else {
      a = cc.rect();
    }

    var n = this.guideNode.parent.convertToNodeSpaceAR(a.center);
    this.focusNode.active = !0;
    this.focusNode.x = n.x;
    this.focusNode.y = n.y;
    this.focusNode.width = this.focusNode.height = 0;
    this.focusNode.opacity = 255;
    cc.tween(this.focusNode).to(0.5, {
      width: a.width,
      height: a.height
    }).start();
    this.fingerSpine.node.active = !e.hideFinger;

    if (this.fingerSpine.node.active) {
      this.fingerSpine.setAnimation(0, e.fingerAni || "dianji", !0);
    }
  },
  hideGuideDialog: function hideGuideDialog() {
    var e = this;
    this.spine.setAnimation(0, this.guideConfig.r ? "jiaoxue3_R" : "jiaoxue3", !1);
    this.spine.setCompleteListener(function () {
      e.guideNode.active = !1;
      e.spine.setCompleteListener(null);
    });
    this.guideLabel.node.runAction(cc.fadeOut(0.2));
    this.focusNode.width = 0;
    this.focusNode.height = 0;
    this.focusNode.active = !1;
    this.fingerSpine.node.active = !1;
  },
  guideLogAndCheckBtnClick: function guideLogAndCheckBtnClick(e) {
    if (this.guideConfig && this.guideConfig.btn == e) {
      this.onStepFinished();
    }
  },
  onStepFinished: function onStepFinished() {
    if (this.guideConfig && this.guideConfig.cb) {
      this.guideConfig.cb();
    }
  },
  onClickGuide: function onClickGuide() {
    console.log("onClickGuide");

    if (this.guideConfig) {
      if (this.guideConfig.btn) {//
      } else {
        this.onStepFinished();
      }
    }
  },
  hackButton: function hackButton() {
    if (!cc.hasHackButton) {
      cc.hasHackButton = !0;
      var e = cc.Button.prototype._onTouchEnded;

      cc.Button.prototype._onTouchEnded = function (t) {
        if (this.interactable && this.enabledInHierarchy && this._pressed) {
          cc.guideManager.guideLogAndCheckBtnClick(this.node.name);
        }

        e.call(this, t);
      };
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL0d1aWRlTWFuYWdlci5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsInNwaW5lIiwic3AiLCJTa2VsZXRvbiIsImZvY3VzTm9kZSIsIk5vZGUiLCJmaW5nZXJTcGluZSIsImd1aWRlTm9kZSIsImd1aWRlTGFiZWwiLCJMYWJlbCIsIm9uTG9hZCIsImUiLCJndWlkZU1hbmFnZXIiLCJhY3RpdmUiLCJoYWNrQnV0dG9uIiwiZGlyZWN0b3IiLCJvbiIsIkRpcmVjdG9yIiwiRVZFTlRfQUZURVJfU0NFTkVfTEFVTkNIIiwidCIsIm5vZGUiLCJwYXJlbnQiLCJpc0d1aWRpbmciLCJzaG93R3VpZGUiLCJvIiwiYSIsIm4iLCJsZW5ndGgiLCJoaWRlR3VpZGVEaWFsb2ciLCJndWlkZUNvbmZpZyIsImkiLCJzaG93R3VpZGVEaWFsb2ciLCJidG4iLCJyIiwiY2IiLCJ6SW5kZXgiLCJtYWNybyIsIk1BWF9aSU5ERVgiLCJ5Iiwic2V0QW5pbWF0aW9uIiwic2V0Q29tcGxldGVMaXN0ZW5lciIsInN0cmluZyIsInRpcCIsInN0b3BBbGxBY3Rpb25zIiwib3BhY2l0eSIsInJ1bkFjdGlvbiIsImZhZGVJbiIsImZvY3VzIiwiZ2V0Qm91bmRpbmdCb3hUb1dvcmxkIiwicmVjdCIsImNvbnZlcnRUb05vZGVTcGFjZUFSIiwiY2VudGVyIiwieCIsIndpZHRoIiwiaGVpZ2h0IiwidHdlZW4iLCJ0byIsInN0YXJ0IiwiaGlkZUZpbmdlciIsImZpbmdlckFuaSIsImZhZGVPdXQiLCJndWlkZUxvZ0FuZENoZWNrQnRuQ2xpY2siLCJvblN0ZXBGaW5pc2hlZCIsIm9uQ2xpY2tHdWlkZSIsImNvbnNvbGUiLCJsb2ciLCJoYXNIYWNrQnV0dG9uIiwiQnV0dG9uIiwicHJvdG90eXBlIiwiX29uVG91Y2hFbmRlZCIsImludGVyYWN0YWJsZSIsImVuYWJsZWRJbkhpZXJhcmNoeSIsIl9wcmVzc2VkIiwibmFtZSIsImNhbGwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0VBQ0wsV0FBU0QsRUFBRSxDQUFDRSxTQURQO0VBRUxDLFVBQVUsRUFBRTtJQUNSQyxLQUFLLEVBQUVDLEVBQUUsQ0FBQ0MsUUFERjtJQUVSQyxTQUFTLEVBQUVQLEVBQUUsQ0FBQ1EsSUFGTjtJQUdSQyxXQUFXLEVBQUVKLEVBQUUsQ0FBQ0MsUUFIUjtJQUlSSSxTQUFTLEVBQUVWLEVBQUUsQ0FBQ1EsSUFKTjtJQUtSRyxVQUFVLEVBQUVYLEVBQUUsQ0FBQ1k7RUFMUCxDQUZQO0VBU0xDLE1BQU0sRUFBRSxrQkFBWTtJQUNoQixJQUFJQyxDQUFDLEdBQUcsSUFBUjtJQUNBZCxFQUFFLENBQUNlLFlBQUgsR0FBa0IsSUFBbEI7O0lBQ0EsSUFBSSxLQUFLTCxTQUFULEVBQW9CO01BQ2hCLEtBQUtBLFNBQUwsQ0FBZU0sTUFBZixHQUF3QixDQUFDLENBQXpCO0lBQ0g7O0lBQ0QsS0FBS0MsVUFBTDtJQUNBakIsRUFBRSxDQUFDa0IsUUFBSCxDQUFZQyxFQUFaLENBQWVuQixFQUFFLENBQUNvQixRQUFILENBQVlDLHdCQUEzQixFQUFxRCxVQUFVQyxDQUFWLEVBQWE7TUFDOURSLENBQUMsQ0FBQ1MsSUFBRixDQUFPQyxNQUFQLEdBQWdCRixDQUFoQjtJQUNILENBRkQ7RUFHSCxDQW5CSTtFQW9CTEcsU0FBUyxFQUFFLHFCQUFZO0lBQ25CLE9BQU8sS0FBS2YsU0FBTCxDQUFlTSxNQUF0QjtFQUNILENBdEJJO0VBdUJMVSxTQUFTLEVBQUUsbUJBQVVaLENBQVYsRUFBYVEsQ0FBYixFQUFnQkssQ0FBaEIsRUFBbUI7SUFDMUIsSUFBSUMsQ0FBQyxHQUFHLElBQVI7SUFDQSxJQUFJQyxDQUFDLEdBQUcsQ0FBQyxDQUFUO0lBQ0EsQ0FBRSxTQUFTZixDQUFULEdBQWE7TUFDWCxJQUFJLEVBQUVlLENBQUYsSUFBT1AsQ0FBQyxDQUFDUSxNQUFiLEVBQXFCO1FBQ2pCRixDQUFDLENBQUNHLGVBQUY7UUFDQUgsQ0FBQyxDQUFDSSxXQUFGLEdBQWdCLElBQWhCO1FBQ0FMLENBQUMsSUFBSUEsQ0FBQyxDQUFDLENBQUMsQ0FBRixDQUFOO01BQ0gsQ0FKRCxNQUlPO1FBQ0gsSUFBSU0sQ0FBQyxHQUFHWCxDQUFDLENBQUNPLENBQUQsQ0FBVDtRQUNBRCxDQUFDLENBQUNNLGVBQUYsQ0FBa0JELENBQWxCLEVBQXFCbkIsQ0FBckI7O1FBQ0EsSUFBSWEsQ0FBSixFQUFPO1VBQ0hBLENBQUMsQ0FBQyxDQUFDLENBQUYsRUFBS0UsQ0FBTCxDQUFEO1FBQ0g7TUFDSjtJQUNKLENBWkEsRUFBRDtFQWFILENBdkNJO0VBd0NMSyxlQUFlLEVBQUUseUJBQVVwQixDQUFWLEVBQWFRLENBQWIsRUFBZ0I7SUFDN0IsSUFBSUssQ0FBQyxHQUFHLElBQVI7SUFDQSxLQUFLSyxXQUFMLEdBQW1CO01BQ2ZHLEdBQUcsRUFBRXJCLENBQUMsQ0FBQ3FCLEdBRFE7TUFFZkMsQ0FBQyxFQUFFdEIsQ0FBQyxDQUFDc0IsQ0FGVTtNQUdmQyxFQUFFLEVBQUVmO0lBSFcsQ0FBbkI7SUFLQSxLQUFLWixTQUFMLENBQWU0QixNQUFmLEdBQXdCdEMsRUFBRSxDQUFDdUMsS0FBSCxDQUFTQyxVQUFqQztJQUNBLEtBQUs5QixTQUFMLENBQWVNLE1BQWYsR0FBd0IsQ0FBQyxDQUF6Qjs7SUFDQSxJQUFJRixDQUFDLENBQUMyQixDQUFOLEVBQVM7TUFDTCxLQUFLckMsS0FBTCxDQUFXbUIsSUFBWCxDQUFnQmtCLENBQWhCLEdBQW9CM0IsQ0FBQyxDQUFDMkIsQ0FBdEI7SUFDSCxDQUZELE1BRU87TUFDSCxJQUFJM0IsQ0FBQyxDQUFDUSxDQUFOLEVBQVM7UUFDTCxLQUFLbEIsS0FBTCxDQUFXbUIsSUFBWCxDQUFnQmtCLENBQWhCLEdBQW9CLEdBQXBCO01BQ0gsQ0FGRCxNQUVPO1FBQ0gsS0FBS3JDLEtBQUwsQ0FBV21CLElBQVgsQ0FBZ0JrQixDQUFoQixHQUFvQixDQUFwQjtNQUNIO0lBQ0o7O0lBQ0QsS0FBS3JDLEtBQUwsQ0FBV3NDLFlBQVgsQ0FBd0IsQ0FBeEIsRUFBMkI1QixDQUFDLENBQUNzQixDQUFGLEdBQU0sWUFBTixHQUFxQixVQUFoRCxFQUE0RCxDQUFDLENBQTdEO0lBQ0EsS0FBS2hDLEtBQUwsQ0FBV3VDLG1CQUFYLENBQStCLFlBQVk7TUFDdkNoQixDQUFDLENBQUN2QixLQUFGLENBQVFzQyxZQUFSLENBQXFCLENBQXJCLEVBQXdCNUIsQ0FBQyxDQUFDc0IsQ0FBRixHQUFNLFlBQU4sR0FBcUIsVUFBN0MsRUFBeUQsQ0FBQyxDQUExRDtNQUNBVCxDQUFDLENBQUN2QixLQUFGLENBQVF1QyxtQkFBUixDQUE0QixJQUE1QjtJQUNILENBSEQ7SUFJQSxLQUFLaEMsVUFBTCxDQUFnQmlDLE1BQWhCLEdBQXlCOUIsQ0FBQyxDQUFDK0IsR0FBM0I7SUFDQSxLQUFLbEMsVUFBTCxDQUFnQlksSUFBaEIsQ0FBcUJ1QixjQUFyQjtJQUNBLEtBQUtuQyxVQUFMLENBQWdCWSxJQUFoQixDQUFxQndCLE9BQXJCLEdBQStCLENBQS9CO0lBQ0EsS0FBS3BDLFVBQUwsQ0FBZ0JZLElBQWhCLENBQXFCeUIsU0FBckIsQ0FBK0JoRCxFQUFFLENBQUNpRCxNQUFILENBQVUsR0FBVixDQUEvQjtJQUNBLElBQUlyQixDQUFKOztJQUNBLElBQUlkLENBQUMsQ0FBQ29DLEtBQU4sRUFBYTtNQUNUdEIsQ0FBQyxHQUFHZCxDQUFDLENBQUNvQyxLQUFGLENBQVFDLHFCQUFSLEVBQUo7SUFDSCxDQUZELE1BRU87TUFDSHZCLENBQUMsR0FBRzVCLEVBQUUsQ0FBQ29ELElBQUgsRUFBSjtJQUNIOztJQUNELElBQUl2QixDQUFDLEdBQUcsS0FBS25CLFNBQUwsQ0FBZWMsTUFBZixDQUFzQjZCLG9CQUF0QixDQUEyQ3pCLENBQUMsQ0FBQzBCLE1BQTdDLENBQVI7SUFDQSxLQUFLL0MsU0FBTCxDQUFlUyxNQUFmLEdBQXdCLENBQUMsQ0FBekI7SUFDQSxLQUFLVCxTQUFMLENBQWVnRCxDQUFmLEdBQW1CMUIsQ0FBQyxDQUFDMEIsQ0FBckI7SUFDQSxLQUFLaEQsU0FBTCxDQUFla0MsQ0FBZixHQUFtQlosQ0FBQyxDQUFDWSxDQUFyQjtJQUNBLEtBQUtsQyxTQUFMLENBQWVpRCxLQUFmLEdBQXVCLEtBQUtqRCxTQUFMLENBQWVrRCxNQUFmLEdBQXdCLENBQS9DO0lBQ0EsS0FBS2xELFNBQUwsQ0FBZXdDLE9BQWYsR0FBeUIsR0FBekI7SUFDQS9DLEVBQUUsQ0FBQzBELEtBQUgsQ0FBUyxLQUFLbkQsU0FBZCxFQUNLb0QsRUFETCxDQUNRLEdBRFIsRUFDYTtNQUNMSCxLQUFLLEVBQUU1QixDQUFDLENBQUM0QixLQURKO01BRUxDLE1BQU0sRUFBRTdCLENBQUMsQ0FBQzZCO0lBRkwsQ0FEYixFQUtLRyxLQUxMO0lBTUEsS0FBS25ELFdBQUwsQ0FBaUJjLElBQWpCLENBQXNCUCxNQUF0QixHQUErQixDQUFDRixDQUFDLENBQUMrQyxVQUFsQzs7SUFDQSxJQUFJLEtBQUtwRCxXQUFMLENBQWlCYyxJQUFqQixDQUFzQlAsTUFBMUIsRUFBa0M7TUFDOUIsS0FBS1AsV0FBTCxDQUFpQmlDLFlBQWpCLENBQThCLENBQTlCLEVBQWlDNUIsQ0FBQyxDQUFDZ0QsU0FBRixJQUFlLFFBQWhELEVBQTBELENBQUMsQ0FBM0Q7SUFDSDtFQUNKLENBekZJO0VBMEZML0IsZUFBZSxFQUFFLDJCQUFZO0lBQ3pCLElBQUlqQixDQUFDLEdBQUcsSUFBUjtJQUNBLEtBQUtWLEtBQUwsQ0FBV3NDLFlBQVgsQ0FBd0IsQ0FBeEIsRUFBMkIsS0FBS1YsV0FBTCxDQUFpQkksQ0FBakIsR0FBcUIsWUFBckIsR0FBb0MsVUFBL0QsRUFBMkUsQ0FBQyxDQUE1RTtJQUNBLEtBQUtoQyxLQUFMLENBQVd1QyxtQkFBWCxDQUErQixZQUFZO01BQ3ZDN0IsQ0FBQyxDQUFDSixTQUFGLENBQVlNLE1BQVosR0FBcUIsQ0FBQyxDQUF0QjtNQUNBRixDQUFDLENBQUNWLEtBQUYsQ0FBUXVDLG1CQUFSLENBQTRCLElBQTVCO0lBQ0gsQ0FIRDtJQUlBLEtBQUtoQyxVQUFMLENBQWdCWSxJQUFoQixDQUFxQnlCLFNBQXJCLENBQStCaEQsRUFBRSxDQUFDK0QsT0FBSCxDQUFXLEdBQVgsQ0FBL0I7SUFDQSxLQUFLeEQsU0FBTCxDQUFlaUQsS0FBZixHQUF1QixDQUF2QjtJQUNBLEtBQUtqRCxTQUFMLENBQWVrRCxNQUFmLEdBQXdCLENBQXhCO0lBQ0EsS0FBS2xELFNBQUwsQ0FBZVMsTUFBZixHQUF3QixDQUFDLENBQXpCO0lBQ0EsS0FBS1AsV0FBTCxDQUFpQmMsSUFBakIsQ0FBc0JQLE1BQXRCLEdBQStCLENBQUMsQ0FBaEM7RUFDSCxDQXRHSTtFQXVHTGdELHdCQUF3QixFQUFFLGtDQUFVbEQsQ0FBVixFQUFhO0lBQ25DLElBQUksS0FBS2tCLFdBQUwsSUFBb0IsS0FBS0EsV0FBTCxDQUFpQkcsR0FBakIsSUFBd0JyQixDQUFoRCxFQUFtRDtNQUMvQyxLQUFLbUQsY0FBTDtJQUNIO0VBQ0osQ0EzR0k7RUE0R0xBLGNBQWMsRUFBRSwwQkFBWTtJQUN4QixJQUFJLEtBQUtqQyxXQUFMLElBQW9CLEtBQUtBLFdBQUwsQ0FBaUJLLEVBQXpDLEVBQTZDO01BQ3pDLEtBQUtMLFdBQUwsQ0FBaUJLLEVBQWpCO0lBQ0g7RUFDSixDQWhISTtFQWlITDZCLFlBQVksRUFBRSx3QkFBWTtJQUN0QkMsT0FBTyxDQUFDQyxHQUFSLENBQVksY0FBWjs7SUFDQSxJQUFJLEtBQUtwQyxXQUFULEVBQXNCO01BQ2xCLElBQUksS0FBS0EsV0FBTCxDQUFpQkcsR0FBckIsRUFBMEIsQ0FDdEI7TUFDSCxDQUZELE1BRU87UUFDSCxLQUFLOEIsY0FBTDtNQUNIO0lBQ0o7RUFDSixDQTFISTtFQTJITGhELFVBQVUsRUFBRSxzQkFBWTtJQUNwQixJQUFJLENBQUNqQixFQUFFLENBQUNxRSxhQUFSLEVBQXVCO01BQ25CckUsRUFBRSxDQUFDcUUsYUFBSCxHQUFtQixDQUFDLENBQXBCO01BQ0EsSUFBSXZELENBQUMsR0FBR2QsRUFBRSxDQUFDc0UsTUFBSCxDQUFVQyxTQUFWLENBQW9CQyxhQUE1Qjs7TUFDQXhFLEVBQUUsQ0FBQ3NFLE1BQUgsQ0FBVUMsU0FBVixDQUFvQkMsYUFBcEIsR0FBb0MsVUFBVWxELENBQVYsRUFBYTtRQUM3QyxJQUFJLEtBQUttRCxZQUFMLElBQXFCLEtBQUtDLGtCQUExQixJQUFnRCxLQUFLQyxRQUF6RCxFQUFtRTtVQUMvRDNFLEVBQUUsQ0FBQ2UsWUFBSCxDQUFnQmlELHdCQUFoQixDQUF5QyxLQUFLekMsSUFBTCxDQUFVcUQsSUFBbkQ7UUFDSDs7UUFDRDlELENBQUMsQ0FBQytELElBQUYsQ0FBTyxJQUFQLEVBQWF2RCxDQUFiO01BQ0gsQ0FMRDtJQU1IO0VBQ0o7QUF0SUksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHNwaW5lOiBzcC5Ta2VsZXRvbixcbiAgICAgICAgZm9jdXNOb2RlOiBjYy5Ob2RlLFxuICAgICAgICBmaW5nZXJTcGluZTogc3AuU2tlbGV0b24sXG4gICAgICAgIGd1aWRlTm9kZTogY2MuTm9kZSxcbiAgICAgICAgZ3VpZGVMYWJlbDogY2MuTGFiZWxcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGNjLmd1aWRlTWFuYWdlciA9IHRoaXM7XG4gICAgICAgIGlmICh0aGlzLmd1aWRlTm9kZSkge1xuICAgICAgICAgICAgdGhpcy5ndWlkZU5vZGUuYWN0aXZlID0gITE7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5oYWNrQnV0dG9uKCk7XG4gICAgICAgIGNjLmRpcmVjdG9yLm9uKGNjLkRpcmVjdG9yLkVWRU5UX0FGVEVSX1NDRU5FX0xBVU5DSCwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIGUubm9kZS5wYXJlbnQgPSB0O1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIGlzR3VpZGluZzogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5ndWlkZU5vZGUuYWN0aXZlO1xuICAgIH0sXG4gICAgc2hvd0d1aWRlOiBmdW5jdGlvbiAoZSwgdCwgbykge1xuICAgICAgICB2YXIgYSA9IHRoaXM7XG4gICAgICAgIHZhciBuID0gLTE7XG4gICAgICAgICEoZnVuY3Rpb24gZSgpIHtcbiAgICAgICAgICAgIGlmICgrK24gPj0gdC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBhLmhpZGVHdWlkZURpYWxvZygpO1xuICAgICAgICAgICAgICAgIGEuZ3VpZGVDb25maWcgPSBudWxsO1xuICAgICAgICAgICAgICAgIG8gJiYgbyghMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciBpID0gdFtuXTtcbiAgICAgICAgICAgICAgICBhLnNob3dHdWlkZURpYWxvZyhpLCBlKTtcbiAgICAgICAgICAgICAgICBpZiAobykge1xuICAgICAgICAgICAgICAgICAgICBvKCExLCBuKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pKCk7XG4gICAgfSxcbiAgICBzaG93R3VpZGVEaWFsb2c6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHZhciBvID0gdGhpcztcbiAgICAgICAgdGhpcy5ndWlkZUNvbmZpZyA9IHtcbiAgICAgICAgICAgIGJ0bjogZS5idG4sXG4gICAgICAgICAgICByOiBlLnIsXG4gICAgICAgICAgICBjYjogdFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLmd1aWRlTm9kZS56SW5kZXggPSBjYy5tYWNyby5NQVhfWklOREVYO1xuICAgICAgICB0aGlzLmd1aWRlTm9kZS5hY3RpdmUgPSAhMDtcbiAgICAgICAgaWYgKGUueSkge1xuICAgICAgICAgICAgdGhpcy5zcGluZS5ub2RlLnkgPSBlLnk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZS50KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zcGluZS5ub2RlLnkgPSAyMDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuc3BpbmUubm9kZS55ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNwaW5lLnNldEFuaW1hdGlvbigwLCBlLnIgPyBcImppYW94dWUxX1JcIiA6IFwiamlhb3h1ZTFcIiwgITEpO1xuICAgICAgICB0aGlzLnNwaW5lLnNldENvbXBsZXRlTGlzdGVuZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgby5zcGluZS5zZXRBbmltYXRpb24oMCwgZS5yID8gXCJqaWFveHVlMl9SXCIgOiBcImppYW94dWUyXCIsICEwKTtcbiAgICAgICAgICAgIG8uc3BpbmUuc2V0Q29tcGxldGVMaXN0ZW5lcihudWxsKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ3VpZGVMYWJlbC5zdHJpbmcgPSBlLnRpcDtcbiAgICAgICAgdGhpcy5ndWlkZUxhYmVsLm5vZGUuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgdGhpcy5ndWlkZUxhYmVsLm5vZGUub3BhY2l0eSA9IDA7XG4gICAgICAgIHRoaXMuZ3VpZGVMYWJlbC5ub2RlLnJ1bkFjdGlvbihjYy5mYWRlSW4oMC41KSk7XG4gICAgICAgIHZhciBhO1xuICAgICAgICBpZiAoZS5mb2N1cykge1xuICAgICAgICAgICAgYSA9IGUuZm9jdXMuZ2V0Qm91bmRpbmdCb3hUb1dvcmxkKCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBhID0gY2MucmVjdCgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBuID0gdGhpcy5ndWlkZU5vZGUucGFyZW50LmNvbnZlcnRUb05vZGVTcGFjZUFSKGEuY2VudGVyKTtcbiAgICAgICAgdGhpcy5mb2N1c05vZGUuYWN0aXZlID0gITA7XG4gICAgICAgIHRoaXMuZm9jdXNOb2RlLnggPSBuLng7XG4gICAgICAgIHRoaXMuZm9jdXNOb2RlLnkgPSBuLnk7XG4gICAgICAgIHRoaXMuZm9jdXNOb2RlLndpZHRoID0gdGhpcy5mb2N1c05vZGUuaGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy5mb2N1c05vZGUub3BhY2l0eSA9IDI1NTtcbiAgICAgICAgY2MudHdlZW4odGhpcy5mb2N1c05vZGUpXG4gICAgICAgICAgICAudG8oMC41LCB7XG4gICAgICAgICAgICAgICAgd2lkdGg6IGEud2lkdGgsXG4gICAgICAgICAgICAgICAgaGVpZ2h0OiBhLmhlaWdodFxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdGFydCgpO1xuICAgICAgICB0aGlzLmZpbmdlclNwaW5lLm5vZGUuYWN0aXZlID0gIWUuaGlkZUZpbmdlcjtcbiAgICAgICAgaWYgKHRoaXMuZmluZ2VyU3BpbmUubm9kZS5hY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMuZmluZ2VyU3BpbmUuc2V0QW5pbWF0aW9uKDAsIGUuZmluZ2VyQW5pIHx8IFwiZGlhbmppXCIsICEwKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaGlkZUd1aWRlRGlhbG9nOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgdGhpcy5zcGluZS5zZXRBbmltYXRpb24oMCwgdGhpcy5ndWlkZUNvbmZpZy5yID8gXCJqaWFveHVlM19SXCIgOiBcImppYW94dWUzXCIsICExKTtcbiAgICAgICAgdGhpcy5zcGluZS5zZXRDb21wbGV0ZUxpc3RlbmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGUuZ3VpZGVOb2RlLmFjdGl2ZSA9ICExO1xuICAgICAgICAgICAgZS5zcGluZS5zZXRDb21wbGV0ZUxpc3RlbmVyKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5ndWlkZUxhYmVsLm5vZGUucnVuQWN0aW9uKGNjLmZhZGVPdXQoMC4yKSk7XG4gICAgICAgIHRoaXMuZm9jdXNOb2RlLndpZHRoID0gMDtcbiAgICAgICAgdGhpcy5mb2N1c05vZGUuaGVpZ2h0ID0gMDtcbiAgICAgICAgdGhpcy5mb2N1c05vZGUuYWN0aXZlID0gITE7XG4gICAgICAgIHRoaXMuZmluZ2VyU3BpbmUubm9kZS5hY3RpdmUgPSAhMTtcbiAgICB9LFxuICAgIGd1aWRlTG9nQW5kQ2hlY2tCdG5DbGljazogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKHRoaXMuZ3VpZGVDb25maWcgJiYgdGhpcy5ndWlkZUNvbmZpZy5idG4gPT0gZSkge1xuICAgICAgICAgICAgdGhpcy5vblN0ZXBGaW5pc2hlZCgpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvblN0ZXBGaW5pc2hlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5ndWlkZUNvbmZpZyAmJiB0aGlzLmd1aWRlQ29uZmlnLmNiKSB7XG4gICAgICAgICAgICB0aGlzLmd1aWRlQ29uZmlnLmNiKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tHdWlkZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcIm9uQ2xpY2tHdWlkZVwiKTtcbiAgICAgICAgaWYgKHRoaXMuZ3VpZGVDb25maWcpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmd1aWRlQ29uZmlnLmJ0bikge1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMub25TdGVwRmluaXNoZWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgaGFja0J1dHRvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIWNjLmhhc0hhY2tCdXR0b24pIHtcbiAgICAgICAgICAgIGNjLmhhc0hhY2tCdXR0b24gPSAhMDtcbiAgICAgICAgICAgIHZhciBlID0gY2MuQnV0dG9uLnByb3RvdHlwZS5fb25Ub3VjaEVuZGVkO1xuICAgICAgICAgICAgY2MuQnV0dG9uLnByb3RvdHlwZS5fb25Ub3VjaEVuZGVkID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pbnRlcmFjdGFibGUgJiYgdGhpcy5lbmFibGVkSW5IaWVyYXJjaHkgJiYgdGhpcy5fcHJlc3NlZCkge1xuICAgICAgICAgICAgICAgICAgICBjYy5ndWlkZU1hbmFnZXIuZ3VpZGVMb2dBbmRDaGVja0J0bkNsaWNrKHRoaXMubm9kZS5uYW1lKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZS5jYWxsKHRoaXMsIHQpO1xuICAgICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgIH1cbn0pO1xuIl19