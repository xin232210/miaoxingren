
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Bullet2.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '109d76PvmlOd5jtepoMkZ3y', 'Bullet2');
// scripts/Bullet2.js

"use strict";

var $soundManager = require("./SoundManager");

var $pool = require("./Pool");

var $battleGround2Ctrl = require("./BattleGround2Ctrl");

var $gate2 = require("./Gate2");

var $role2 = require("./Role2");

var r = cc._decorator;
var l = r.ccclass;
var u = r.property;

var p = function (e) {
  function t() {
    var t = null !== e && e.apply(this, arguments) || this;
    t.label = null;
    t.bodySpr = null;
    t.bodySFS = [];
    t.collBody = null;
    t.par = null;
    t.v = 500;
    t.dmg = 1;
    t.hitTimes = 0;
    t.fCount = 0;
    t.state = 0;
    t.cIdx = 0;
    t.tarColHandle = null;
    return t;
  }

  var o;

  __extends(t, e);

  o = t;

  t.prototype.init = function (e, t, o) {
    this.node.x = e;
    this.node.y = t;
    this.par = o.par;
    this.hitTimes = 0;
    this.v = $battleGround2Ctrl["default"].JSONManager.ConfigBattle[6].v[6];
    this.dmg = o.dmg;
    this.bodySpr.getComponent(cc.Sprite).spriteFrame = this.bodySFS[0];
    this.cIdx = Math.floor((this.node.x + 299) / 10);

    if (this.par.bulletHandles[this.cIdx]) {//
    } else {
      this.par.bulletHandles[this.cIdx] = [];
    }

    this.par.bulletHandles[this.cIdx].push(this.node);
    this.collBody.enabled = 1 === this.par.bulletHandles[this.cIdx].length;
    $soundManager["default"].playEffect2(0);
    this.state = 0;
  };

  t.prototype.remove = function (e) {
    this.updateBulletHandles();

    if (1 === e) {
      this.v = 0;
      this.state = 1;
      this.fCount = 0;
      this.bodySpr.getComponent(cc.Sprite).spriteFrame = this.bodySFS[1];
    } else {
      this.node.parent.getComponent($pool["default"]).destroyPoolItem(this.node);
    }
  };

  t.prototype.start = function () {};

  t.prototype.onCollisionEnter = function (e) {
    o.collTimes++;

    if (this.hitTimes > 0) {//
    } else {
      if (1 === e.tag) {
        e.node.getComponent($role2["default"]).beHit(this);
      } else {
        3 === e.tag && e.node.getComponent($gate2["default"]).beHit(this);
      }

      this.collBody.enabled = !1;
      this.hitTimes++;
      this.remove(1);
    }
  };

  t.prototype.updateBulletHandles = function () {
    this.par.bulletHandles[this.cIdx].shift();

    if (this.par.bulletHandles[this.cIdx].length >= 1) {
      this.par.bulletHandles[this.cIdx][0].getComponent(o).collBody.enabled = !0;
    }
  };

  t.prototype.update = function (e) {
    if (10 === this.par.state) {
      if (1 === this.state) {
        this.fCount++, 3 === this.fCount ? this.bodySpr.getComponent(cc.Sprite).spriteFrame = this.bodySFS[2] : 6 === this.fCount && this.remove(0);
      } else {
        this.node.y += this.v * e, this.node.y >= 799 && this.remove(0);
      }
    }
  };

  t.collTimes = 0;

  __decorate([u(cc.Label)], t.prototype, "label", void 0);

  __decorate([u(cc.Node)], t.prototype, "bodySpr", void 0);

  __decorate([u(cc.SpriteFrame)], t.prototype, "bodySFS", void 0);

  __decorate([u(cc.BoxCollider)], t.prototype, "collBody", void 0);

  return o = __decorate([l], t);
}(cc.Component);

exports["default"] = p;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL0J1bGxldDIuanMiXSwibmFtZXMiOlsiJHNvdW5kTWFuYWdlciIsInJlcXVpcmUiLCIkcG9vbCIsIiRiYXR0bGVHcm91bmQyQ3RybCIsIiRnYXRlMiIsIiRyb2xlMiIsInIiLCJjYyIsIl9kZWNvcmF0b3IiLCJsIiwiY2NjbGFzcyIsInUiLCJwcm9wZXJ0eSIsInAiLCJlIiwidCIsImFwcGx5IiwiYXJndW1lbnRzIiwibGFiZWwiLCJib2R5U3ByIiwiYm9keVNGUyIsImNvbGxCb2R5IiwicGFyIiwidiIsImRtZyIsImhpdFRpbWVzIiwiZkNvdW50Iiwic3RhdGUiLCJjSWR4IiwidGFyQ29sSGFuZGxlIiwibyIsIl9fZXh0ZW5kcyIsInByb3RvdHlwZSIsImluaXQiLCJub2RlIiwieCIsInkiLCJKU09OTWFuYWdlciIsIkNvbmZpZ0JhdHRsZSIsImdldENvbXBvbmVudCIsIlNwcml0ZSIsInNwcml0ZUZyYW1lIiwiTWF0aCIsImZsb29yIiwiYnVsbGV0SGFuZGxlcyIsInB1c2giLCJlbmFibGVkIiwibGVuZ3RoIiwicGxheUVmZmVjdDIiLCJyZW1vdmUiLCJ1cGRhdGVCdWxsZXRIYW5kbGVzIiwicGFyZW50IiwiZGVzdHJveVBvb2xJdGVtIiwic3RhcnQiLCJvbkNvbGxpc2lvbkVudGVyIiwiY29sbFRpbWVzIiwidGFnIiwiYmVIaXQiLCJzaGlmdCIsInVwZGF0ZSIsIl9fZGVjb3JhdGUiLCJMYWJlbCIsIk5vZGUiLCJTcHJpdGVGcmFtZSIsIkJveENvbGxpZGVyIiwiQ29tcG9uZW50IiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxhQUFhLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjs7QUFDQSxJQUFJQyxLQUFLLEdBQUdELE9BQU8sQ0FBQyxRQUFELENBQW5COztBQUNBLElBQUlFLGtCQUFrQixHQUFHRixPQUFPLENBQUMscUJBQUQsQ0FBaEM7O0FBQ0EsSUFBSUcsTUFBTSxH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QUNKO0VBQ0osQ0FYRDs7RUFZQWxDLENBQUMsQ0FBQ3dDLFNBQUYsR0FBYyxDQUFkOztFQUNBSyxVQUFVLENBQUMsQ0FBQ2pELENBQUMsQ0FBQ0osRUFBRSxDQUFDc0QsS0FBSixDQUFGLENBQUQsRUFBZ0I5QyxDQUFDLENBQUNpQixTQUFsQixFQUE2QixPQUE3QixFQUFzQyxLQUFLLENBQTNDLENBQVY7O0VBQ0E0QixVQUFVLENBQUMsQ0FBQ2pELENBQUMsQ0FBQ0osRUFBRSxDQUFDdUQsSUFBSixDQUFGLENBQUQsRUFBZS9DLENBQUMsQ0FBQ2lCLFNBQWpCLEVBQTRCLFNBQTVCLEVBQXVDLEtBQUssQ0FBNUMsQ0FBVjs7RUFDQTRCLFVBQVUsQ0FBQyxDQUFDakQsQ0FBQyxDQUFDSixFQUFFLENBQUN3RCxXQUFKLENBQUYsQ0FBRCxFQUFzQmhELENBQUMsQ0FBQ2lCLFNBQXhCLEVBQW1DLFNBQW5DLEVBQThDLEtBQUssQ0FBbkQsQ0FBVjs7RUFDQTRCLFVBQVUsQ0FBQyxDQUFDakQsQ0FBQyxDQUFDSixFQUFFLENBQUN5RCxXQUFKLENBQUYsQ0FBRCxFQUFzQmpELENBQUMsQ0FBQ2lCLFNBQXhCLEVBQW1DLFVBQW5DLEVBQStDLEtBQUssQ0FBcEQsQ0FBVjs7RUFDQSxPQUFRRixDQUFDLEdBQUc4QixVQUFVLENBQUMsQ0FBQ25ELENBQUQsQ0FBRCxFQUFNTSxDQUFOLENBQXRCO0FBQ0gsQ0ExRk8sQ0EwRkxSLEVBQUUsQ0FBQzBELFNBMUZFLENBQVI7O0FBMkZBQyxPQUFPLFdBQVAsR0FBa0JyRCxDQUFsQiIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyICRzb3VuZE1hbmFnZXIgPSByZXF1aXJlKFwiLi9Tb3VuZE1hbmFnZXJcIik7XG52YXIgJHBvb2wgPSByZXF1aXJlKFwiLi9Qb29sXCIpO1xudmFyICRiYXR0bGVHcm91bmQyQ3RybCA9IHJlcXVpcmUoXCIuL0JhdHRsZUdyb3VuZDJDdHJsXCIpO1xudmFyICRnYXRlMiA9IHJlcXVpcmUoXCIuL0dhdGUyXCIpO1xudmFyICRyb2xlMiA9IHJlcXVpcmUoXCIuL1JvbGUyXCIpO1xudmFyIHIgPSBjYy5fZGVjb3JhdG9yO1xudmFyIGwgPSByLmNjY2xhc3M7XG52YXIgdSA9IHIucHJvcGVydHk7XG52YXIgcCA9IChmdW5jdGlvbiAoZSkge1xuICAgIGZ1bmN0aW9uIHQoKSB7XG4gICAgICAgIHZhciB0ID0gKG51bGwgIT09IGUgJiYgZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpKSB8fCB0aGlzO1xuICAgICAgICB0LmxhYmVsID0gbnVsbDtcbiAgICAgICAgdC5ib2R5U3ByID0gbnVsbDtcbiAgICAgICAgdC5ib2R5U0ZTID0gW107XG4gICAgICAgIHQuY29sbEJvZHkgPSBudWxsO1xuICAgICAgICB0LnBhciA9IG51bGw7XG4gICAgICAgIHQudiA9IDUwMDtcbiAgICAgICAgdC5kbWcgPSAxO1xuICAgICAgICB0LmhpdFRpbWVzID0gMDtcbiAgICAgICAgdC5mQ291bnQgPSAwO1xuICAgICAgICB0LnN0YXRlID0gMDtcbiAgICAgICAgdC5jSWR4ID0gMDtcbiAgICAgICAgdC50YXJDb2xIYW5kbGUgPSBudWxsO1xuICAgICAgICByZXR1cm4gdDtcbiAgICB9XG4gICAgdmFyIG87XG4gICAgX19leHRlbmRzKHQsIGUpO1xuICAgIG8gPSB0O1xuICAgIHQucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoZSwgdCwgbykge1xuICAgICAgICB0aGlzLm5vZGUueCA9IGU7XG4gICAgICAgIHRoaXMubm9kZS55ID0gdDtcbiAgICAgICAgdGhpcy5wYXIgPSBvLnBhcjtcbiAgICAgICAgdGhpcy5oaXRUaW1lcyA9IDA7XG4gICAgICAgIHRoaXMudiA9ICRiYXR0bGVHcm91bmQyQ3RybC5kZWZhdWx0LkpTT05NYW5hZ2VyLkNvbmZpZ0JhdHRsZVs2XS52WzZdO1xuICAgICAgICB0aGlzLmRtZyA9IG8uZG1nO1xuICAgICAgICB0aGlzLmJvZHlTcHIuZ2V0Q29tcG9uZW50KGNjLlNwcml0ZSkuc3ByaXRlRnJhbWUgPSB0aGlzLmJvZHlTRlNbMF07XG4gICAgICAgIHRoaXMuY0lkeCA9IE1hdGguZmxvb3IoKHRoaXMubm9kZS54ICsgMjk5KSAvIDEwKTtcbiAgICAgICAgaWYgKHRoaXMucGFyLmJ1bGxldEhhbmRsZXNbdGhpcy5jSWR4XSkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGFyLmJ1bGxldEhhbmRsZXNbdGhpcy5jSWR4XSA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGFyLmJ1bGxldEhhbmRsZXNbdGhpcy5jSWR4XS5wdXNoKHRoaXMubm9kZSk7XG4gICAgICAgIHRoaXMuY29sbEJvZHkuZW5hYmxlZCA9IDEgPT09IHRoaXMucGFyLmJ1bGxldEhhbmRsZXNbdGhpcy5jSWR4XS5sZW5ndGg7XG4gICAgICAgICRzb3VuZE1hbmFnZXIuZGVmYXVsdC5wbGF5RWZmZWN0MigwKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IDA7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5yZW1vdmUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLnVwZGF0ZUJ1bGxldEhhbmRsZXMoKTtcbiAgICAgICAgaWYgKDEgPT09IGUpIHtcbiAgICAgICAgICAgIHRoaXMudiA9IDA7XG4gICAgICAgICAgICB0aGlzLnN0YXRlID0gMTtcbiAgICAgICAgICAgIHRoaXMuZkNvdW50ID0gMDtcbiAgICAgICAgICAgIHRoaXMuYm9keVNwci5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuYm9keVNGU1sxXTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnQuZ2V0Q29tcG9uZW50KCRwb29sLmRlZmF1bHQpLmRlc3Ryb3lQb29sSXRlbSh0aGlzLm5vZGUpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uICgpIHt9O1xuICAgIHQucHJvdG90eXBlLm9uQ29sbGlzaW9uRW50ZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBvLmNvbGxUaW1lcysrO1xuICAgICAgICBpZiAodGhpcy5oaXRUaW1lcyA+IDApIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoMSA9PT0gZS50YWcpIHtcbiAgICAgICAgICAgICAgICBlLm5vZGUuZ2V0Q29tcG9uZW50KCRyb2xlMi5kZWZhdWx0KS5iZUhpdCh0aGlzKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgMyA9PT0gZS50YWcgJiYgZS5ub2RlLmdldENvbXBvbmVudCgkZ2F0ZTIuZGVmYXVsdCkuYmVIaXQodGhpcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmNvbGxCb2R5LmVuYWJsZWQgPSAhMTtcbiAgICAgICAgICAgIHRoaXMuaGl0VGltZXMrKztcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlKDEpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS51cGRhdGVCdWxsZXRIYW5kbGVzID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnBhci5idWxsZXRIYW5kbGVzW3RoaXMuY0lkeF0uc2hpZnQoKTtcbiAgICAgICAgaWYgKHRoaXMucGFyLmJ1bGxldEhhbmRsZXNbdGhpcy5jSWR4XS5sZW5ndGggPj0gMSkge1xuICAgICAgICAgICAgdGhpcy5wYXIuYnVsbGV0SGFuZGxlc1t0aGlzLmNJZHhdWzBdLmdldENvbXBvbmVudChvKS5jb2xsQm9keS5lbmFibGVkID0gITA7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIHQucHJvdG90eXBlLnVwZGF0ZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICgxMCA9PT0gdGhpcy5wYXIuc3RhdGUpIHtcbiAgICAgICAgICAgIGlmICgxID09PSB0aGlzLnN0YXRlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mQ291bnQrKyxcbiAgICAgICAgICAgICAgICAgICAgMyA9PT0gdGhpcy5mQ291bnRcbiAgICAgICAgICAgICAgICAgICAgICAgID8gKHRoaXMuYm9keVNwci5nZXRDb21wb25lbnQoY2MuU3ByaXRlKS5zcHJpdGVGcmFtZSA9IHRoaXMuYm9keVNGU1syXSlcbiAgICAgICAgICAgICAgICAgICAgICAgIDogNiA9PT0gdGhpcy5mQ291bnQgJiYgdGhpcy5yZW1vdmUoMCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICh0aGlzLm5vZGUueSArPSB0aGlzLnYgKiBlKSwgdGhpcy5ub2RlLnkgPj0gNzk5ICYmIHRoaXMucmVtb3ZlKDApO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICB0LmNvbGxUaW1lcyA9IDA7XG4gICAgX19kZWNvcmF0ZShbdShjYy5MYWJlbCldLCB0LnByb3RvdHlwZSwgXCJsYWJlbFwiLCB2b2lkIDApO1xuICAgIF9fZGVjb3JhdGUoW3UoY2MuTm9kZSldLCB0LnByb3RvdHlwZSwgXCJib2R5U3ByXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbdShjYy5TcHJpdGVGcmFtZSldLCB0LnByb3RvdHlwZSwgXCJib2R5U0ZTXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbdShjYy5Cb3hDb2xsaWRlcildLCB0LnByb3RvdHlwZSwgXCJjb2xsQm9keVwiLCB2b2lkIDApO1xuICAgIHJldHVybiAobyA9IF9fZGVjb3JhdGUoW2xdLCB0KSk7XG59KShjYy5Db21wb25lbnQpO1xuZXhwb3J0cy5kZWZhdWx0ID0gcDtcbiJdfQ==