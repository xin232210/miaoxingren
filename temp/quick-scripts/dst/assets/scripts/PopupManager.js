
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/PopupManager.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '1f46aROMcZBAKSIrLVXbx2j', 'PopupManager');
// scripts/PopupManager.js

"use strict";

var $prefabInfo = require("./PrefabInfo");

cc.Class({
  "extends": cc.Component,
  properties: {
    default_sprite_splash: cc.SpriteFrame,
    onPopup1st: cc.Component.EventHandler,
    onAllClosed: cc.Component.EventHandler,
    taskToastPrfefab: $prefabInfo,
    toastPrefab: $prefabInfo,
    effectPrefab: $prefabInfo,
    effectBattlePrefab: $prefabInfo,
    adToastNode: cc.Node
  },
  onLoad: function onLoad() {
    cc.popupManager = this;

    if (this.adToastNode) {
      this.adToastNode.active = !1;
      this.adToastNode.zIndex = cc.macro.MAX_ZINDEX - 2;
    }

    this.popups = [];
    this.showModals = [];
    this.isAutoPop = !1;
  },
  nonePopupUI: function nonePopupUI() {
    return !this.modal || !this.modal.active;
  },
  createModal: function createModal() {
    if (!this.modal) {
      var e = new cc.Node();
      e.width = 4 * this.node.width;
      e.height = 4 * this.node.height;
      e.color = cc.Color.BLACK;
      e.opacity = 230;
      e.addComponent(cc.BlockInputEvents);
      var t = e.addComponent(cc.Sprite);
      t.sizeMode = cc.Sprite.SizeMode.CUSTOM;
      t.spriteFrame = this.default_sprite_splash;
      this.modal = e;
      this.modal.parent = this.node;
    }
  },
  onAllPopupClosed: function onAllPopupClosed() {
    if (this.modal) {
      this.modal.active = !1;
    }

    if (this.onAllClosed) {
      this.onAllClosed.emit();
    }
  },
  removeAllPopups: function removeAllPopups() {
    this.popups.forEach(function (e) {
      e.node.destroy();
    });
    this.popups = [];
    this.showModals = [];
    cc.pvz.AdUtils.hideAdBanner();
    this.onAllPopupClosed();
  },
  popup: function popup(e, t, o, a) {
    var n = this;
    var i = a.ad;
    var c = void 0 === i || i;
    var s = a.scale;
    var r = void 0 === s || s;
    var l = a.adLeft;
    var u = void 0 !== l && l;
    var p = a.showModal;
    var d = void 0 === p || p;
    var h = a.opacity;
    var f;

    if (void 0 === h) {
      f = 225;
    } else {
      f = h;
    }

    var g = a.usingTop;
    var v = void 0 !== g && g;
    var y = arguments.length;
    var m = new Array(y > 4 ? y - 4 : 0);

    for (var C = 4; C < y; C++) {
      m[C - 4] = arguments[C];
    }

    if (this.popups.length > 0 && this.popups[this.popups.length - 1].onPopupUI) {
      this.popups[this.popups.length - 1].onPopupUI();
    }

    if (this.nonePopupUI()) {
      this.createModal();
      this.modal.active = !0;

      if (this.onPopup1st) {
        this.onPopup1st.emit();
      }
    }

    if (d || this.showModals.some(function (e) {
      return e;
    })) {
      var w;

      if (d) {
        w = this.popups.length;
      } else {
        w = this.showModals.findIndex(function (e) {
          return e;
        });
      }

      this.createModal();
      this.modal.opacity = f;
      this.modal.zIndex = 2 * w + 1;
    } else {
      if (this.modal) {
        this.modal.opacity = 0;
      }
    }

    this.showModals.push(d);

    if (c) {
      this.popups.every(function (e) {
        return !e.__showAd;
      });
    }

    if (v) {
      cc.main2.setUsingTopInfo();
    }

    cc.pvz.utils.useBundleAsset(e, t, cc.Prefab, function (e) {
      var t = cc.instantiate(e);
      var a = t.getComponent(o);
      t.parent = n.node;
      t.zIndex = 2 * n.popups.length + 2;

      if (r) {
        t.scale = 0.5;
        t.runAction(cc.sequence(cc.scaleTo(0.5, 1).easing(cc.easeElasticOut(3)), cc.callFunc(function () {
          if (a.showFinish) {
            a.showFinish.apply(a);
          }
        }, n)));
      } else {
        t.runAction(cc.sequence(cc.delayTime(0.032), cc.callFunc(function () {
          if (a.showFinish) {
            a.showFinish.apply(a);
          }
        }, n)));
      }

      a.__showAd = c;
      a.__showAdAlignLeft = u;
      n.popups.push(a);

      if (a.initBy) {
        a.initBy.apply(a, m);
      }

      if (cc.director.isPaused()) {
        t.parent.sortAllChildren();
      }
    });
  },
  removePopup: function removePopup(e) {
    var t = this.popups.findIndex(function (t) {
      return t == e;
    });

    if (-1 != t) {
      if (-1 != t) {
        this.popups.splice(t, 1);
        this.showModals.splice(t, 1);

        if (t > 0 && this.popups[t - 1].onPopupClosed) {
          this.popups[t - 1].onPopupClosed();
        }

        var o = -1;

        for (var a = this.showModals.length; --a >= 0;) {
          if (this.showModals[a]) {
            o = a;
            break;
          }
        }

        if (-1 !== o) {
          this.createModal();
          this.modal.opacity = 210;
          this.modal.zIndex = 2 * o + 1;
        } else {
          if (this.modal) {
            this.modal.active = !1;
          }
        }
      }

      if (e.__showAd) {
        for (var n = this.popups.length - 1; n >= 0 && !this.popups[n].__showAd; n--) {}
      }

      e.node.destroy();

      if (this.nonePopupUI()) {
        this.onAllPopupClosed();
      }

      if (cc.director.isPaused()) {
        this.node.sortAllChildren();
      }
    }
  },
  showTaskToast: function showTaskToast(e) {
    var t = this.taskToastPrfefab.addNode();
    t.opacity = 255;
    t.zIndex = cc.macro.MAX_ZINDEX - 3;
    t.runAction(cc.sequence(cc.delayTime(1.2), cc.fadeOut(0.4), cc.removeSelf()));
    cc.find("tip", t).getComponent(cc.Label).string = e;
  },
  showToast: function showToast(e) {
    var t = this.toastPrefab.addNode();
    t.y = 0;
    t.opacity = 255;
    t.zIndex = cc.macro.MAX_ZINDEX - 3;
    t.runAction(cc.sequence(cc.moveBy(0.3, 0, 80), cc.delayTime(0.8), cc.fadeOut(0.3), cc.removeSelf()));
    cc.find("tip", t).getComponent(cc.Label).string = e;
  },
  showEffectFly: function showEffectFly(e, t, o) {
    if (void 0 === o) {
      o = 1;
    }

    this.effectPrefab.addEffectNode(e, t, o).zIndex = cc.macro.MAX_ZINDEX;
  },
  showBattleEffect: function showBattleEffect(e, t) {
    var o = this.effectBattlePrefab.addBattleEffectNode(e, t);
    o.y = -200;
    o.x = 0;
    o.zIndex = cc.macro.MAX_ZINDEX - 3;
    o.runAction(cc.sequence(cc.delayTime(2.5), cc.removeSelf()));
  },
  showAdToast: function showAdToast(e) {
    this.adToastNode.active = 2 != e;

    if (this.adToastNode.active) {
      cc.find("blockTouch", this.adToastNode).active = 0 == e;
      cc.find("tip", this.adToastNode).getComponent(cc.Label).string = ["拉取广告中...", "看完广告才有奖励", null, "广告加载失败"][e];
      this.adToastNode.y = 0;
      this.adToastNode.opacity = 255;
      this.adToastNode.stopAllActions();

      if (0 != e) {
        this.adToastNode.runAction(cc.sequence(cc.moveBy(0.3, 0, 80), cc.delayTime(0.8), cc.fadeOut(0.3)));
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1BvcHVwTWFuYWdlci5qcyJdLCJuYW1lcyI6WyIkcHJlZmFiSW5mbyIsInJlcXVpcmUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImRlZmF1bHRfc3ByaXRlX3NwbGFzaCIsIlNwcml0ZUZyYW1lIiwib25Qb3B1cDFzdCIsIkV2ZW50SGFuZGxlciIsIm9uQWxsQ2xvc2VkIiwidGFza1RvYXN0UHJmZWZhYiIsInRvYXN0UHJlZmFiIiwiZWZmZWN0UHJlZmFiIiwiZWZmZWN0QmF0dGxlUHJlZmFiIiwiYWRUb2FzdE5vZGUiLCJOb2RlIiwib25Mb2FkIiwicG9wdXBNYW5hZ2VyIiwiYWN0aXZlIiwiekluZGV4IiwibWFjcm8iLCJNQVhfWklOREVYIiwicG9wdXBzIiwic2hvd01vZGFscyIsImlzQXV0b1BvcCIsIm5vbmVQb3B1cFVJIiwibW9kYWwiLCJjcmVhdGVNb2RhbCIsImUiLCJ3aWR0aCIsIm5vZGUiLCJoZWlnaHQiLCJjb2xvciIsIkNvbG9yIiwiQkxBQ0siLCJvcGFjaXR5IiwiYWRkQ29tcG9uZW50IiwiQmxvY2tJbnB1dEV2ZW50cyIsInQiLCJTcHJpdGUiLCJzaXplTW9kZSIsIlNpemVNb2RlIiwiQ1VTVE9NIiwic3ByaXRlRnJhbWUiLCJwYXJlbnQiLCJvbkFsbFBvcHVwQ2xvc2VkIiwiZW1pdCIsInJlbW92ZUFsbFBvcHVwcyIsImZvckVhY2giLCJkZXN0cm95IiwicHZ6IiwiQWRVdGlscyIsImhpZGVBZEJhbm5lciIsInBvcHVwIiwibyIsImEiLCJuIiwiaSIsImFkIiwiYyIsInMiLCJzY2FsZSIsInIiLCJsIiwiYWRMZWZ0IiwidSIsInAiLCJzaG93TW9kYWwiLCJkIiwiaCIsImYiLCJnIiwidXNpbmdUb3AiLCJ2IiwieSIsImFyZ3VtZW50cyIsImxlbmd0aCIsIm0iLCJBcnJheSIsIkMiLCJvblBvcHVwVUkiLCJzb21lIiwidyIsImZpbmRJbmRleCIsInB1c2giLCJldmVyeSIsIl9fc2hvd0FkIiwibWFpbjIiLCJzZXRVc2luZ1RvcEluZm8iLCJ1dGlscyIsInVzZUJ1bmRsZUFzc2V0IiwiUHJlZmFiIiwiaW5zdGFudGlhdGUiLCJnZXRDb21wb25lbnQiLCJydW5BY3Rpb24iLCJzZXF1ZW5jZSIsInNjYWxlVG8iLCJlYXNpbmciLCJlYXNlRWxhc3RpY091dCIsImNhbGxGdW5jIiwic2hvd0ZpbmlzaCIsImFwcGx5IiwiZGVsYXlUaW1lIiwiX19zaG93QWRBbGlnbkxlZnQiLCJpbml0QnkiLCJkaXJlY3RvciIsImlzUGF1c2VkIiwic29ydEFsbENoaWxkcmVuIiwicmVtb3ZlUG9wdXAiLCJzcGxpY2UiLCJvblBvcHVwQ2xvc2VkIiwic2hvd1Rhc2tUb2FzdCIsImFkZE5vZGUiLCJmYWRlT3V0IiwicmVtb3ZlU2VsZiIsImZpbmQiLCJMYWJlbCIsInN0cmluZyIsInNob3dUb2FzdCIsIm1vdmVCeSIsInNob3dFZmZlY3RGbHkiLCJhZGRFZmZlY3ROb2RlIiwic2hvd0JhdHRsZUVmZmVjdCIsImFkZEJhdHRsZUVmZmVjdE5vZGUiLCJ4Iiwic2hvd0FkVG9hc3QiLCJzdG9wQWxsQWN0aW9ucyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxXQUFXLEdBQUdDLE9BQU8sQ0FBQyxjQUFELENBQXpCOztBQUNBQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNMLFdBQVNELEVBQUUsQ0FBQ0UsU0FEUDtFQUVMQyxVQUFVLEVBQUU7SUFDUkMscUJBQXFCLEVBQUVKLEVBQUUsQ0FBQ0ssV0FEbEI7SUFFUkMsVUFBVSxFQUFFTixFQUFFLENBQUNFLFNBQUgsQ0FBYUssWUFGakI7SUFHUkMsV0FBVyxFQUFFUixFQUFFLENBQUNFLFNBQUgsQ0FBYUssWUFIbEI7SUFJUkUsZ0JBQWdCLEVBQUVYLFdBSlY7SUFLUlksV0FBVyxFQUFFWixXQUxMO0lBTVJhLFlBQVksRUFBRWIsV0FOTjtJQU9SYyxrQkFBa0IsRUFBRWQsV0FQWjtJQVFSZSxXQUFXLEVBQUViLEVBQUUsQ0FBQ2M7RUFS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Q3pCakIsRUFBRSxDQUFDa0gsSUFBSCxDQUFRLFlBQVIsRUFBc0IsS0FBS3JHLFdBQTNCLEVBQXdDSSxNQUF4QyxHQUFpRCxLQUFLVSxDQUF0RDtNQUNBM0IsRUFBRSxDQUFDa0gsSUFBSCxDQUFRLEtBQVIsRUFBZSxLQUFLckcsV0FBcEIsRUFBaUMrRSxZQUFqQyxDQUE4QzVGLEVBQUUsQ0FBQ21ILEtBQWpELEVBQXdEQyxNQUF4RCxHQUFpRSxDQUM3RCxVQUQ2RCxFQUU3RCxVQUY2RCxFQUc3RCxJQUg2RCxFQUk3RCxRQUo2RCxFQUsvRHpGLENBTCtELENBQWpFO01BTUEsS0FBS2QsV0FBTCxDQUFpQjRELENBQWpCLEdBQXFCLENBQXJCO01BQ0EsS0FBSzVELFdBQUwsQ0FBaUJxQixPQUFqQixHQUEyQixHQUEzQjtNQUNBLEtBQUtyQixXQUFMLENBQWlCZ0gsY0FBakI7O01BQ0EsSUFBSSxLQUFLbEcsQ0FBVCxFQUFZO1FBQ1IsS0FBS2QsV0FBTCxDQUFpQmdGLFNBQWpCLENBQTJCN0YsRUFBRSxDQUFDOEYsUUFBSCxDQUFZOUYsRUFBRSxDQUFDc0gsTUFBSCxDQUFVLEdBQVYsRUFBZSxDQUFmLEVBQWtCLEVBQWxCLENBQVosRUFBbUN0SCxFQUFFLENBQUNxRyxTQUFILENBQWEsR0FBYixDQUFuQyxFQUFzRHJHLEVBQUUsQ0FBQ2dILE9BQUgsQ0FBVyxHQUFYLENBQXRELENBQTNCO01BQ0g7SUFDSjtFQUNKO0FBdlBJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciAkcHJlZmFiSW5mbyA9IHJlcXVpcmUoXCIuL1ByZWZhYkluZm9cIik7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgZGVmYXVsdF9zcHJpdGVfc3BsYXNoOiBjYy5TcHJpdGVGcmFtZSxcbiAgICAgICAgb25Qb3B1cDFzdDogY2MuQ29tcG9uZW50LkV2ZW50SGFuZGxlcixcbiAgICAgICAgb25BbGxDbG9zZWQ6IGNjLkNvbXBvbmVudC5FdmVudEhhbmRsZXIsXG4gICAgICAgIHRhc2tUb2FzdFByZmVmYWI6ICRwcmVmYWJJbmZvLFxuICAgICAgICB0b2FzdFByZWZhYjogJHByZWZhYkluZm8sXG4gICAgICAgIGVmZmVjdFByZWZhYjogJHByZWZhYkluZm8sXG4gICAgICAgIGVmZmVjdEJhdHRsZVByZWZhYjogJHByZWZhYkluZm8sXG4gICAgICAgIGFkVG9hc3ROb2RlOiBjYy5Ob2RlXG4gICAgfSxcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MucG9wdXBNYW5hZ2VyID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuYWRUb2FzdE5vZGUpIHtcbiAgICAgICAgICAgIHRoaXMuYWRUb2FzdE5vZGUuYWN0aXZlID0gITE7XG4gICAgICAgICAgICB0aGlzLmFkVG9hc3ROb2RlLnpJbmRleCA9IGNjLm1hY3JvLk1BWF9aSU5ERVggLSAyO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucG9wdXBzID0gW107XG4gICAgICAgIHRoaXMuc2hvd01vZGFscyA9IFtdO1xuICAgICAgICB0aGlzLmlzQXV0b1BvcCA9ICExO1xuICAgIH0sXG4gICAgbm9uZVBvcHVwVUk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLm1vZGFsIHx8ICF0aGlzLm1vZGFsLmFjdGl2ZTtcbiAgICB9LFxuICAgIGNyZWF0ZU1vZGFsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghdGhpcy5tb2RhbCkge1xuICAgICAgICAgICAgdmFyIGUgPSBuZXcgY2MuTm9kZSgpO1xuICAgICAgICAgICAgZS53aWR0aCA9IDQgKiB0aGlzLm5vZGUud2lkdGg7XG4gICAgICAgICAgICBlLmhlaWdodCA9IDQgKiB0aGlzLm5vZGUuaGVpZ2h0O1xuICAgICAgICAgICAgZS5jb2xvciA9IGNjLkNvbG9yLkJMQUNLO1xuICAgICAgICAgICAgZS5vcGFjaXR5ID0gMjMwO1xuICAgICAgICAgICAgZS5hZGRDb21wb25lbnQoY2MuQmxvY2tJbnB1dEV2ZW50cyk7XG4gICAgICAgICAgICB2YXIgdCA9IGUuYWRkQ29tcG9uZW50KGNjLlNwcml0ZSk7XG4gICAgICAgICAgICB0LnNpemVNb2RlID0gY2MuU3ByaXRlLlNpemVNb2RlLkNVU1RPTTtcbiAgICAgICAgICAgIHQuc3ByaXRlRnJhbWUgPSB0aGlzLmRlZmF1bHRfc3ByaXRlX3NwbGFzaDtcbiAgICAgICAgICAgIHRoaXMubW9kYWwgPSBlO1xuICAgICAgICAgICAgdGhpcy5tb2RhbC5wYXJlbnQgPSB0aGlzLm5vZGU7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQWxsUG9wdXBDbG9zZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMubW9kYWwpIHtcbiAgICAgICAgICAgIHRoaXMubW9kYWwuYWN0aXZlID0gITE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMub25BbGxDbG9zZWQpIHtcbiAgICAgICAgICAgIHRoaXMub25BbGxDbG9zZWQuZW1pdCgpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZW1vdmVBbGxQb3B1cHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5wb3B1cHMuZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgZS5ub2RlLmRlc3Ryb3koKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMucG9wdXBzID0gW107XG4gICAgICAgIHRoaXMuc2hvd01vZGFscyA9IFtdO1xuICAgICAgICBjYy5wdnouQWRVdGlscy5oaWRlQWRCYW5uZXIoKTtcbiAgICAgICAgdGhpcy5vbkFsbFBvcHVwQ2xvc2VkKCk7XG4gICAgfSxcbiAgICBwb3B1cDogZnVuY3Rpb24gKGUsIHQsIG8sIGEpIHtcbiAgICAgICAgdmFyIG4gPSB0aGlzO1xuICAgICAgICB2YXIgaSA9IGEuYWQ7XG4gICAgICAgIHZhciBjID0gdm9pZCAwID09PSBpIHx8IGk7XG4gICAgICAgIHZhciBzID0gYS5zY2FsZTtcbiAgICAgICAgdmFyIHIgPSB2b2lkIDAgPT09IHMgfHwgcztcbiAgICAgICAgdmFyIGwgPSBhLmFkTGVmdDtcbiAgICAgICAgdmFyIHUgPSB2b2lkIDAgIT09IGwgJiYgbDtcbiAgICAgICAgdmFyIHAgPSBhLnNob3dNb2RhbDtcbiAgICAgICAgdmFyIGQgPSB2b2lkIDAgPT09IHAgfHwgcDtcbiAgICAgICAgdmFyIGggPSBhLm9wYWNpdHk7XG4gICAgICAgIHZhciBmO1xuICAgICAgICBpZiAodm9pZCAwID09PSBoKSB7XG4gICAgICAgICAgICBmID0gMjI1O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZiA9IGg7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGcgPSBhLnVzaW5nVG9wO1xuICAgICAgICB2YXIgdiA9IHZvaWQgMCAhPT0gZyAmJiBnO1xuICAgICAgICB2YXIgeSA9IGFyZ3VtZW50cy5sZW5ndGg7XG4gICAgICAgIHZhciBtID0gbmV3IEFycmF5KHkgPiA0ID8geSAtIDQgOiAwKTtcbiAgICAgICAgZm9yICh2YXIgQyA9IDQ7IEMgPCB5OyBDKyspIHtcbiAgICAgICAgICAgIG1bQyAtIDRdID0gYXJndW1lbnRzW0NdO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnBvcHVwcy5sZW5ndGggPiAwICYmIHRoaXMucG9wdXBzW3RoaXMucG9wdXBzLmxlbmd0aCAtIDFdLm9uUG9wdXBVSSkge1xuICAgICAgICAgICAgdGhpcy5wb3B1cHNbdGhpcy5wb3B1cHMubGVuZ3RoIC0gMV0ub25Qb3B1cFVJKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubm9uZVBvcHVwVUkoKSkge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVNb2RhbCgpO1xuICAgICAgICAgICAgdGhpcy5tb2RhbC5hY3RpdmUgPSAhMDtcbiAgICAgICAgICAgIGlmICh0aGlzLm9uUG9wdXAxc3QpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uUG9wdXAxc3QuZW1pdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChcbiAgICAgICAgICAgIGQgfHxcbiAgICAgICAgICAgIHRoaXMuc2hvd01vZGFscy5zb21lKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGU7XG4gICAgICAgICAgICB9KVxuICAgICAgICApIHtcbiAgICAgICAgICAgIHZhciB3O1xuICAgICAgICAgICAgaWYgKGQpIHtcbiAgICAgICAgICAgICAgICB3ID0gdGhpcy5wb3B1cHMubGVuZ3RoO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICB3ID0gdGhpcy5zaG93TW9kYWxzLmZpbmRJbmRleChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuY3JlYXRlTW9kYWwoKTtcbiAgICAgICAgICAgIHRoaXMubW9kYWwub3BhY2l0eSA9IGY7XG4gICAgICAgICAgICB0aGlzLm1vZGFsLnpJbmRleCA9IDIgKiB3ICsgMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm1vZGFsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5tb2RhbC5vcGFjaXR5ID0gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNob3dNb2RhbHMucHVzaChkKTtcbiAgICAgICAgaWYgKGMpIHtcbiAgICAgICAgICAgIHRoaXMucG9wdXBzLmV2ZXJ5KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICFlLl9fc2hvd0FkO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgIGNjLm1haW4yLnNldFVzaW5nVG9wSW5mbygpO1xuICAgICAgICB9XG4gICAgICAgIGNjLnB2ei51dGlscy51c2VCdW5kbGVBc3NldChlLCB0LCBjYy5QcmVmYWIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgdCA9IGNjLmluc3RhbnRpYXRlKGUpO1xuICAgICAgICAgICAgdmFyIGEgPSB0LmdldENvbXBvbmVudChvKTtcbiAgICAgICAgICAgIHQucGFyZW50ID0gbi5ub2RlO1xuICAgICAgICAgICAgdC56SW5kZXggPSAyICogbi5wb3B1cHMubGVuZ3RoICsgMjtcbiAgICAgICAgICAgIGlmIChyKSB7XG4gICAgICAgICAgICAgICAgdC5zY2FsZSA9IDAuNTtcbiAgICAgICAgICAgICAgICB0LnJ1bkFjdGlvbihcbiAgICAgICAgICAgICAgICAgICAgY2Muc2VxdWVuY2UoXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5zY2FsZVRvKDAuNSwgMSkuZWFzaW5nKGNjLmVhc2VFbGFzdGljT3V0KDMpKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5zaG93RmluaXNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2hvd0ZpbmlzaC5hcHBseShhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBuKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdC5ydW5BY3Rpb24oXG4gICAgICAgICAgICAgICAgICAgIGNjLnNlcXVlbmNlKFxuICAgICAgICAgICAgICAgICAgICAgICAgY2MuZGVsYXlUaW1lKDAuMDMyKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmNhbGxGdW5jKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoYS5zaG93RmluaXNoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGEuc2hvd0ZpbmlzaC5hcHBseShhKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9LCBuKVxuICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGEuX19zaG93QWQgPSBjO1xuICAgICAgICAgICAgYS5fX3Nob3dBZEFsaWduTGVmdCA9IHU7XG4gICAgICAgICAgICBuLnBvcHVwcy5wdXNoKGEpO1xuICAgICAgICAgICAgaWYgKGEuaW5pdEJ5KSB7XG4gICAgICAgICAgICAgICAgYS5pbml0QnkuYXBwbHkoYSwgbSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2MuZGlyZWN0b3IuaXNQYXVzZWQoKSkge1xuICAgICAgICAgICAgICAgIHQucGFyZW50LnNvcnRBbGxDaGlsZHJlbigpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIHJlbW92ZVBvcHVwOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdCA9IHRoaXMucG9wdXBzLmZpbmRJbmRleChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgcmV0dXJuIHQgPT0gZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmICgtMSAhPSB0KSB7XG4gICAgICAgICAgICBpZiAoLTEgIT0gdCkge1xuICAgICAgICAgICAgICAgIHRoaXMucG9wdXBzLnNwbGljZSh0LCAxKTtcbiAgICAgICAgICAgICAgICB0aGlzLnNob3dNb2RhbHMuc3BsaWNlKHQsIDEpO1xuICAgICAgICAgICAgICAgIGlmICh0ID4gMCAmJiB0aGlzLnBvcHVwc1t0IC0gMV0ub25Qb3B1cENsb3NlZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnBvcHVwc1t0IC0gMV0ub25Qb3B1cENsb3NlZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB2YXIgbyA9IC0xO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGEgPSB0aGlzLnNob3dNb2RhbHMubGVuZ3RoOyAtLWEgPj0gMDsgKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLnNob3dNb2RhbHNbYV0pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBhO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKC0xICE9PSBvKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlTW9kYWwoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RhbC5vcGFjaXR5ID0gMjEwO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm1vZGFsLnpJbmRleCA9IDIgKiBvICsgMTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RhbCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5tb2RhbC5hY3RpdmUgPSAhMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChlLl9fc2hvd0FkKSB7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbiA9IHRoaXMucG9wdXBzLmxlbmd0aCAtIDE7IG4gPj0gMCAmJiAhdGhpcy5wb3B1cHNbbl0uX19zaG93QWQ7IG4tLSkge31cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUubm9kZS5kZXN0cm95KCk7XG4gICAgICAgICAgICBpZiAodGhpcy5ub25lUG9wdXBVSSgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkFsbFBvcHVwQ2xvc2VkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2MuZGlyZWN0b3IuaXNQYXVzZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5zb3J0QWxsQ2hpbGRyZW4oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2hvd1Rhc2tUb2FzdDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLnRhc2tUb2FzdFByZmVmYWIuYWRkTm9kZSgpO1xuICAgICAgICB0Lm9wYWNpdHkgPSAyNTU7XG4gICAgICAgIHQuekluZGV4ID0gY2MubWFjcm8uTUFYX1pJTkRFWCAtIDM7XG4gICAgICAgIHQucnVuQWN0aW9uKGNjLnNlcXVlbmNlKGNjLmRlbGF5VGltZSgxLjIpLCBjYy5mYWRlT3V0KDAuNCksIGNjLnJlbW92ZVNlbGYoKSkpO1xuICAgICAgICBjYy5maW5kKFwidGlwXCIsIHQpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gZTtcbiAgICB9LFxuICAgIHNob3dUb2FzdDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLnRvYXN0UHJlZmFiLmFkZE5vZGUoKTtcbiAgICAgICAgdC55ID0gMDtcbiAgICAgICAgdC5vcGFjaXR5ID0gMjU1O1xuICAgICAgICB0LnpJbmRleCA9IGNjLm1hY3JvLk1BWF9aSU5ERVggLSAzO1xuICAgICAgICB0LnJ1bkFjdGlvbihjYy5zZXF1ZW5jZShjYy5tb3ZlQnkoMC4zLCAwLCA4MCksIGNjLmRlbGF5VGltZSgwLjgpLCBjYy5mYWRlT3V0KDAuMyksIGNjLnJlbW92ZVNlbGYoKSkpO1xuICAgICAgICBjYy5maW5kKFwidGlwXCIsIHQpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gZTtcbiAgICB9LFxuICAgIHNob3dFZmZlY3RGbHk6IGZ1bmN0aW9uIChlLCB0LCBvKSB7XG4gICAgICAgIGlmICh2b2lkIDAgPT09IG8pIHtcbiAgICAgICAgICAgIG8gPSAxO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZWZmZWN0UHJlZmFiLmFkZEVmZmVjdE5vZGUoZSwgdCwgbykuekluZGV4ID0gY2MubWFjcm8uTUFYX1pJTkRFWDtcbiAgICB9LFxuICAgIHNob3dCYXR0bGVFZmZlY3Q6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHZhciBvID0gdGhpcy5lZmZlY3RCYXR0bGVQcmVmYWIuYWRkQmF0dGxlRWZmZWN0Tm9kZShlLCB0KTtcbiAgICAgICAgby55ID0gLTIwMDtcbiAgICAgICAgby54ID0gMDtcbiAgICAgICAgby56SW5kZXggPSBjYy5tYWNyby5NQVhfWklOREVYIC0gMztcbiAgICAgICAgby5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MuZGVsYXlUaW1lKDIuNSksIGNjLnJlbW92ZVNlbGYoKSkpO1xuICAgIH0sXG4gICAgc2hvd0FkVG9hc3Q6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMuYWRUb2FzdE5vZGUuYWN0aXZlID0gMiAhPSBlO1xuICAgICAgICBpZiAodGhpcy5hZFRvYXN0Tm9kZS5hY3RpdmUpIHtcbiAgICAgICAgICAgIGNjLmZpbmQoXCJibG9ja1RvdWNoXCIsIHRoaXMuYWRUb2FzdE5vZGUpLmFjdGl2ZSA9IDAgPT0gZTtcbiAgICAgICAgICAgIGNjLmZpbmQoXCJ0aXBcIiwgdGhpcy5hZFRvYXN0Tm9kZSkuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBbXG4gICAgICAgICAgICAgICAgXCLmi4nlj5blub/lkYrkuK0uLi5cIixcbiAgICAgICAgICAgICAgICBcIueci+WujOW5v+WRiuaJjeacieWlluWKsVwiLFxuICAgICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgICAgXCLlub/lkYrliqDovb3lpLHotKVcIlxuICAgICAgICAgICAgXVtlXTtcbiAgICAgICAgICAgIHRoaXMuYWRUb2FzdE5vZGUueSA9IDA7XG4gICAgICAgICAgICB0aGlzLmFkVG9hc3ROb2RlLm9wYWNpdHkgPSAyNTU7XG4gICAgICAgICAgICB0aGlzLmFkVG9hc3ROb2RlLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgICAgICBpZiAoMCAhPSBlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5hZFRvYXN0Tm9kZS5ydW5BY3Rpb24oY2Muc2VxdWVuY2UoY2MubW92ZUJ5KDAuMywgMCwgODApLCBjYy5kZWxheVRpbWUoMC44KSwgY2MuZmFkZU91dCgwLjMpKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdfQ==