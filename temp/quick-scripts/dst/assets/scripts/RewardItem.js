
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/RewardItem.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '45b8fBIhzxILZkRHu8edIIh', 'RewardItem');
// scripts/RewardItem.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    iconSprite: cc.Sprite,
    spine: sp.Skeleton,
    fragNode: cc.Node,
    qualitySprite: cc.Sprite,
    countLabel: cc.Label
  },
  initBoxRewardItem: function initBoxRewardItem(e) {
    this.RewardData = e;
    this.itemId = this.RewardData.itemId;
    this.count = this.RewardData.count;
    this.countLabel.string = "x" + cc.pvz.utils.formatItemNum(this.count);
    var t = cc.JsonControl.getItemJson(this.itemId);
    cc.JsonControl.getItemIcon(this.iconSprite, t.Icon);
    cc.JsonControl.getQualityBgIcon(this.qualitySprite, t.Quality);
  },
  onClickShopBox: function onClickShopBox() {
    if (this.itemId >= 5 && this.itemId <= 7) {
      cc.popupManager.popup("mainUI", "shopboxList", "UIShopBoxDetail", {
        ad: !1,
        scale: !0
      }, this.itemId);
    }
  },
  initShopBoxToolItem: function initShopBoxToolItem(e, t) {
    var o = this;
    var a = e;
    var n = cc.JsonControl.getToolJson(a);
    cc.JsonControl.getQualityBgIcon(this.qualitySprite, n.quality);
    var i = cc.pvz.PlayerData.getToolData(a);
    var c = cc.pvz.utils.getLevelInterval(i.lv);
    this.spine.node.scale = n.scale;
    cc.pvz.utils.useBundleAsset("actors", "character/Characters", sp.SkeletonData, function (e) {
      o.spine.skeletonData = e;
      o.spine.setAnimation(0, "Idle", !0);
    });
    this.fragNode.active = t;

    if (t) {
      for (var s = 0; s < this.node.childrenCount; s++) {
        this.node.children[s].getComponent(cc.Sprite).setMaterial(0, cc.JsonControl.materialList[t ? 1 : 0]);
      }
    }
  },
  initRewardItem: function initRewardItem(e, t) {
    var o = this;

    if (void 0 === t) {
      t = !0;
    }

    this.RewardData = e;
    this.itemId = this.RewardData.itemId;
    this.count = this.RewardData.count;
    this.toolId = this.RewardData.toolId;
    this.countLabel.string = "x" + this.count;
    var a = cc.JsonControl.getItemJson(this.itemId);

    if (this.spine) {
      this.spine.node.active = this.itemId == cc.pvz.GameConfig.ItemType["固定碎片"];
    }

    if (this.iconSprite) {
      this.iconSprite.node.active = this.itemId != cc.pvz.GameConfig.ItemType["固定碎片"];
    }

    if (this.itemId === cc.pvz.GameConfig.ItemType["固定碎片"]) {
      if (this.fragNode) {
        this.fragNode.active = !0;
      }

      var n = cc.JsonControl.getToolJson(this.toolId);
      cc.JsonControl.getQualityBgIcon(this.qualitySprite, n.quality);
      var i = cc.pvz.PlayerData.getToolData(this.toolId);
      var c = cc.pvz.utils.getLevelInterval(i.lv);
      this.spine.node.scale = n.scale;
      cc.pvz.utils.useBundleAsset("actors", "character/Characters", this.toolId, sp.SkeletonData, function (e) {
        o.spine.skeletonData = e;
        o.spine.setAnimation(0, "Idle", !0);
      });
    } else {
      cc.JsonControl.getItemIcon(this.iconSprite, a.Icon);
      cc.JsonControl.getQualityBgIcon(this.qualitySprite, a.Quality);
      this.fragNode && (this.fragNode.active = !1);
    }

    if (t) {
      this.onSaveReward();
    }
  },
  onSaveReward: function onSaveReward() {
    switch (this.itemId) {
      case cc.pvz.GameConfig.ItemType["体力"]:
        cc.pvz.PlayerData.addPower(this.count, !0);
        break;

      case cc.pvz.GameConfig.ItemType["荣誉"]:
        cc.pvz.PlayerData.updateActLevelScore(this.count);
        break;

      case cc.pvz.GameConfig.ItemType["固定碎片"]:
        cc.pvz.PlayerData.updateToolFragCount(this.toolId, this.count);
        break;

      default:
        cc.pvz.PlayerData.changeItemNum(this.itemId, this.count);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1Jld2FyZEl0ZW0uanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJpY29uU3ByaXRlIiwiU3ByaXRlIiwic3BpbmUiLCJzcCIsIlNrZWxldG9uIiwiZnJhZ05vZGUiLCJOb2RlIiwicXVhbGl0eVNwcml0ZSIsImNvdW50TGFiZWwiLCJMYWJlbCIsImluaXRCb3hSZXdhcmRJdGVtIiwiZSIsIlJld2FyZERhdGEiLCJpdGVtSWQiLCJjb3VudCIsInN0cmluZyIsInB2eiIsInV0aWxzIiwiZm9ybWF0SXRlbU51bSIsInQiLCJKc29uQ29udHJvbCIsImdldEl0ZW1Kc29uIiwiZ2V0SXRlbUljb24iLCJJY29uIiwiZ2V0UXVhbGl0eUJnSWNvbiIsIlF1YWxpdHkiLCJvbkNsaWNrU2hvcEJveCIsInBvcHVwTWFuYWdlciIsInBvcHVwIiwiYWQiLCJzY2FsZSIsImluaXRTaG9wQm94VG9vbEl0ZW0iLCJvIiwiYSIsIm4iLCJnZXRUb29sSnNvbiIsInF1YWxpdHkiLCJpIiwiUGxheWVyRGF0YSIsImdldFRvb2xEYXRhIiwiYyIsImdldExldmVsSW50ZXJ2YWwiLCJsdiIsIm5vZGUiLCJ1c2VCdW5kbGVBc3NldCIsIlNrZWxldG9uRGF0YSIsInNrZWxldG9uRGF0YSIsInNldEFuaW1hdGlvbiIsImFjdGl2ZSIsInMiLCJjaGlsZHJlbkNvdW50IiwiY2hpbGRyZW4iLCJnZXRDb21wb25lbnQiLCJzZXRNYXRlcmlhbCIsIm1hdGVyaWFsTGlzdCIsImluaXRSZXdhcmRJdGVtIiwidG9vbElkIiwiR2FtZUNvbmZpZyIsIkl0ZW1UeXBlIiwib25TYXZlUmV3YXJkIiwiYWRkUG93ZXIiLCJ1cGRhdGVBY3RMZXZlbFNjb3JlIiwidXBkYXRlVG9vbEZyYWdDb3VudCIsImNoYW5nZUl0ZW1OdW0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0VBQ0ws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QW1ELEtBQUsxQyxLQUF4RDtRQUNBOztNQUNKO1FBQ0lsQixFQUFFLENBQUNvQixHQUFILENBQU9zQixVQUFQLENBQWtCeUIsYUFBbEIsQ0FBZ0MsS0FBS2xELE1BQXJDLEVBQTZDLEtBQUtDLEtBQWxEO0lBWFI7RUFhSDtBQXhHSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgaWNvblNwcml0ZTogY2MuU3ByaXRlLFxuICAgICAgICBzcGluZTogc3AuU2tlbGV0b24sXG4gICAgICAgIGZyYWdOb2RlOiBjYy5Ob2RlLFxuICAgICAgICBxdWFsaXR5U3ByaXRlOiBjYy5TcHJpdGUsXG4gICAgICAgIGNvdW50TGFiZWw6IGNjLkxhYmVsXG4gICAgfSxcbiAgICBpbml0Qm94UmV3YXJkSXRlbTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdGhpcy5SZXdhcmREYXRhID0gZTtcbiAgICAgICAgdGhpcy5pdGVtSWQgPSB0aGlzLlJld2FyZERhdGEuaXRlbUlkO1xuICAgICAgICB0aGlzLmNvdW50ID0gdGhpcy5SZXdhcmREYXRhLmNvdW50O1xuICAgICAgICB0aGlzLmNvdW50TGFiZWwuc3RyaW5nID0gXCJ4XCIgKyBjYy5wdnoudXRpbHMuZm9ybWF0SXRlbU51bSh0aGlzLmNvdW50KTtcbiAgICAgICAgdmFyIHQgPSBjYy5Kc29uQ29udHJvbC5nZXRJdGVtSnNvbih0aGlzLml0ZW1JZCk7XG4gICAgICAgIGNjLkpzb25Db250cm9sLmdldEl0ZW1JY29uKHRoaXMuaWNvblNwcml0ZSwgdC5JY29uKTtcbiAgICAgICAgY2MuSnNvbkNvbnRyb2wuZ2V0UXVhbGl0eUJnSWNvbih0aGlzLnF1YWxpdHlTcHJpdGUsIHQuUXVhbGl0eSk7XG4gICAgfSxcbiAgICBvbkNsaWNrU2hvcEJveDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pdGVtSWQgPj0gNSAmJiB0aGlzLml0ZW1JZCA8PSA3KSB7XG4gICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgICAgICBcInNob3Bib3hMaXN0XCIsXG4gICAgICAgICAgICAgICAgXCJVSVNob3BCb3hEZXRhaWxcIixcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFkOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICEwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGlzLml0ZW1JZFxuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgaW5pdFNob3BCb3hUb29sSXRlbTogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdmFyIG8gPSB0aGlzO1xuICAgICAgICB2YXIgYSA9IGU7XG4gICAgICAgIHZhciBuID0gY2MuSnNvbkNvbnRyb2wuZ2V0VG9vbEpzb24oYSk7XG4gICAgICAgIGNjLkpzb25Db250cm9sLmdldFF1YWxpdHlCZ0ljb24odGhpcy5xdWFsaXR5U3ByaXRlLCBuLnF1YWxpdHkpO1xuICAgICAgICB2YXIgaSA9IGNjLnB2ei5QbGF5ZXJEYXRhLmdldFRvb2xEYXRhKGEpO1xuICAgICAgICB2YXIgYyA9IGNjLnB2ei51dGlscy5nZXRMZXZlbEludGVydmFsKGkubHYpO1xuICAgICAgICB0aGlzLnNwaW5lLm5vZGUuc2NhbGUgPSBuLnNjYWxlO1xuICAgICAgICBjYy5wdnoudXRpbHMudXNlQnVuZGxlQXNzZXQoXCJhY3RvcnNcIiwgXCJjaGFyYWN0ZXIvQ2hhcmFjdGVyc1wiLCBzcC5Ta2VsZXRvbkRhdGEsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBvLnNwaW5lLnNrZWxldG9uRGF0YSA9IGU7XG4gICAgICAgICAgICBvLnNwaW5lLnNldEFuaW1hdGlvbigwLCBcIklkbGVcIiwgITApO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5mcmFnTm9kZS5hY3RpdmUgPSB0O1xuICAgICAgICBpZiAodCkge1xuICAgICAgICAgICAgZm9yICh2YXIgcyA9IDA7IHMgPCB0aGlzLm5vZGUuY2hpbGRyZW5Db3VudDsgcysrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub2RlLmNoaWxkcmVuW3NdLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNldE1hdGVyaWFsKDAsIGNjLkpzb25Db250cm9sLm1hdGVyaWFsTGlzdFt0ID8gMSA6IDBdKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgaW5pdFJld2FyZEl0ZW06IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHZhciBvID0gdGhpcztcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gdCkge1xuICAgICAgICAgICAgdCA9ICEwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuUmV3YXJkRGF0YSA9IGU7XG4gICAgICAgIHRoaXMuaXRlbUlkID0gdGhpcy5SZXdhcmREYXRhLml0ZW1JZDtcbiAgICAgICAgdGhpcy5jb3VudCA9IHRoaXMuUmV3YXJkRGF0YS5jb3VudDtcbiAgICAgICAgdGhpcy50b29sSWQgPSB0aGlzLlJld2FyZERhdGEudG9vbElkO1xuICAgICAgICB0aGlzLmNvdW50TGFiZWwuc3RyaW5nID0gXCJ4XCIgKyB0aGlzLmNvdW50O1xuICAgICAgICB2YXIgYSA9IGNjLkpzb25Db250cm9sLmdldEl0ZW1Kc29uKHRoaXMuaXRlbUlkKTtcbiAgICAgICAgaWYgKHRoaXMuc3BpbmUpIHtcbiAgICAgICAgICAgIHRoaXMuc3BpbmUubm9kZS5hY3RpdmUgPSB0aGlzLml0ZW1JZCA9PSBjYy5wdnouR2FtZUNvbmZpZy5JdGVtVHlwZVtcIuWbuuWumueijueJh1wiXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pY29uU3ByaXRlKSB7XG4gICAgICAgICAgICB0aGlzLmljb25TcHJpdGUubm9kZS5hY3RpdmUgPSB0aGlzLml0ZW1JZCAhPSBjYy5wdnouR2FtZUNvbmZpZy5JdGVtVHlwZVtcIuWbuuWumueijueJh1wiXTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5pdGVtSWQgPT09IGNjLnB2ei5HYW1lQ29uZmlnLkl0ZW1UeXBlW1wi5Zu65a6a56KO54mHXCJdKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5mcmFnTm9kZSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZnJhZ05vZGUuYWN0aXZlID0gITA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgbiA9IGNjLkpzb25Db250cm9sLmdldFRvb2xKc29uKHRoaXMudG9vbElkKTtcbiAgICAgICAgICAgIGNjLkpzb25Db250cm9sLmdldFF1YWxpdHlCZ0ljb24odGhpcy5xdWFsaXR5U3ByaXRlLCBuLnF1YWxpdHkpO1xuICAgICAgICAgICAgdmFyIGkgPSBjYy5wdnouUGxheWVyRGF0YS5nZXRUb29sRGF0YSh0aGlzLnRvb2xJZCk7XG4gICAgICAgICAgICB2YXIgYyA9IGNjLnB2ei51dGlscy5nZXRMZXZlbEludGVydmFsKGkubHYpO1xuICAgICAgICAgICAgdGhpcy5zcGluZS5ub2RlLnNjYWxlID0gbi5zY2FsZTtcbiAgICAgICAgICAgIGNjLnB2ei51dGlscy51c2VCdW5kbGVBc3NldChcImFjdG9yc1wiLCBcImNoYXJhY3Rlci9DaGFyYWN0ZXJzXCIsIHRoaXMudG9vbElkLCBzcC5Ta2VsZXRvbkRhdGEsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgby5zcGluZS5za2VsZXRvbkRhdGEgPSBlO1xuICAgICAgICAgICAgICAgIG8uc3BpbmUuc2V0QW5pbWF0aW9uKDAsIFwiSWRsZVwiLCAhMCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLkpzb25Db250cm9sLmdldEl0ZW1JY29uKHRoaXMuaWNvblNwcml0ZSwgYS5JY29uKTtcbiAgICAgICAgICAgIGNjLkpzb25Db250cm9sLmdldFF1YWxpdHlCZ0ljb24odGhpcy5xdWFsaXR5U3ByaXRlLCBhLlF1YWxpdHkpO1xuICAgICAgICAgICAgdGhpcy5mcmFnTm9kZSAmJiAodGhpcy5mcmFnTm9kZS5hY3RpdmUgPSAhMSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgIHRoaXMub25TYXZlUmV3YXJkKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uU2F2ZVJld2FyZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBzd2l0Y2ggKHRoaXMuaXRlbUlkKSB7XG4gICAgICAgICAgICBjYXNlIGNjLnB2ei5HYW1lQ29uZmlnLkl0ZW1UeXBlW1wi5L2T5YqbXCJdOlxuICAgICAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLmFkZFBvd2VyKHRoaXMuY291bnQsICEwKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MucHZ6LkdhbWVDb25maWcuSXRlbVR5cGVbXCLojaPoqolcIl06XG4gICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEudXBkYXRlQWN0TGV2ZWxTY29yZSh0aGlzLmNvdW50KTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgY2MucHZ6LkdhbWVDb25maWcuSXRlbVR5cGVbXCLlm7rlrprnoo7niYdcIl06XG4gICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEudXBkYXRlVG9vbEZyYWdDb3VudCh0aGlzLnRvb2xJZCwgdGhpcy5jb3VudCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLmNoYW5nZUl0ZW1OdW0odGhpcy5pdGVtSWQsIHRoaXMuY291bnQpO1xuICAgICAgICB9XG4gICAgfVxufSk7Il19