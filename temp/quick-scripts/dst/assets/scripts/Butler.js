
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Butler.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'f2ea01mWfhFUqhZWXpl3KFV', 'Butler');
// scripts/Butler.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    loadingBar: cc.ProgressBar
  },
  onLoad: function onLoad() {
    cc.butler = this;
    this.dFlag = 0;
    cc.pvz.time = 0;
    cc.director.on(cc.Director.EVENT_BEFORE_UPDATE, this.beforeDirectorUpdate, this);

    if (cc.sys.platform == cc.sys.WECHAT_GAME) {
      this.polyfillSafeArea();
    }
  },
  polyfillSafeArea: function polyfillSafeArea() {
    if (wx.getSystemInfoSync().safeArea) {//
    } else {
      console.log("polyfill safeArea");

      cc.sys.getSafeAreaRect = function () {
        var e = cc.view.getVisibleSize();
        return cc.rect(0, 0, e.width, e.height);
      };
    }
  },
  beforeDirectorUpdate: function beforeDirectorUpdate() {
    if (this.checkToHandleGameHide) {
      this.handleGameHide();
    }

    var e = 1e3 * cc.director.getDeltaTime();
    cc.pvz.time += e * cc.director.getScheduler().getTimeScale();

    if (cc.pvz.cloud && cc.pvz.cloud.uid && cc.pvz.cloud.needSaveToCloud > 0) {
      cc.pvz.PlayerData.saveDataToLocalOnline();
      cc.pvz.cloud.needSaveToCloud = 0;
    }
  },
  start: function start() {
    var e = this;
    cc.game.addPersistRootNode(this.node);

    if (cc.sys.platform == cc.sys.WECHAT_GAME) {
      wx.onHide(function () {
        console.log("wx.onHide");
        e.handleGameHide();
      });
      wx.onShow(function () {
        console.log("wx.onShow");
        e.handleGameShow();
        cc.pvz.TAUtils.onWxShow();
      });
    } else {
      if (cc.sys.platform == cc.sys.BYTEDANCE_GAME) {
        tt.onHide(function () {
          console.log("tt.onHide");
          e.handleGameHide();
        }), tt.onShow(function () {
          console.log("tt.onShow");
          e.handleGameShow();
        });
      } else {
        cc.game.on(cc.game.EVENT_HIDE, function () {
          console.log("cc.game.EVENT_HIDE, frame:", cc.director.getTotalFrames());
          e.handleGameHide();
        }), cc.game.on(cc.game.EVENT_SHOW, function () {
          console.log("cc.game.EVENT_SHOW, frame:", cc.director.getTotalFrames());
          e.handleGameShow();
        });
      }
    }

    cc.pvz.TAUtils.onCheckGameVersion();
  },
  handleGameHide: function handleGameHide() {
    console.log("handleGameHide");
    this.pauseMusic();
    cc.audioEngine.stopAllEffects();

    if (cc.isRestart) {//
    } else {
      this.saveData();
    }
  },
  handleGameShow: function handleGameShow() {
    this.resumeMusic();
  },
  pauseDirector: function pauseDirector(e) {
    if (0 == this.dFlag) {
      cc.director.pause();
    }

    this.dFlag |= 1 << e;
  },
  resumeDirector: function resumeDirector(e) {
    this.dFlag &= ~(1 << e);

    if (0 == this.dFlag) {
      cc.director.resume();
    }
  },
  playMusic: function playMusic(e) {
    this.music = e;

    if (cc.player && cc.player.isMMute) {//
    } else {
      this.playingMusic = e;

      if (e) {
        console.log("playmusic");
        cc.audioEngine.playMusic(e, !0);
      }
    }
  },
  pauseMusic: function pauseMusic() {
    cc.audioEngine.pauseMusic();
  },
  resumeMusic: function resumeMusic() {
    if (cc.player && cc.player.isMMute) {
      console.log("resumeMusic return");
    } else {
      if (this.music != this.playingMusic) {
        console.log("resumeMusic play new"), this.playMusic(this.music);
      } else {
        console.log("resumeMusic resume old"), cc.audioEngine.resumeMusic();
      }
    }
  },
  playEffect: function playEffect(e, t) {
    if (void 0 === t) {
      t = !1;
    }

    return cc.player && cc.player.isSMute ? -1 : e ? cc.audioEngine.playEffect(e, t) : -1;
  },
  resumeEffect: function resumeEffect(e) {
    if (cc.player && cc.player.isSMute) {
      return -1;
    }

    cc.audioEngine.resumeEffect(e);
  },
  playEffectAsync: function playEffectAsync(e, t, o) {
    var a = this;

    if (void 0 === o) {
      o = !1;
    }

    if (!cc.player || !cc.player.isSMute) {
      var n = null;

      if (o) {
        if (this.exclusiveMap) {//
        } else {
          this.exclusiveMap = {};
        }

        n = e + t;

        if (this.exclusiveMap[n]) {
          return;
        }

        this.exclusiveMap[n] = !0;
      }

      cc.pvz.utils.useBundleAsset(e, t, cc.AudioClip, function (e) {
        if (o) {
          var t = a.playEffect(e, !1);

          if (-1 == t) {
            a.exclusiveMap[n] = !1;
          } else {
            cc.audioEngine.setFinishCallback(t, function () {
              a.exclusiveMap[n] = !1;
            });
          }
        } else {
          a.playEffect(e, !1);
        }
      });
    }
  },
  playEffectAsync2: function playEffectAsync2(e) {
    if (!cc.player || !cc.player.isSMute) {
      var t = e.indexOf(",");
      this.playEffectAsync(e.substring(0, t), e.substring(t + 1));
    }
  },
  setMusicSwitch: function setMusicSwitch(e) {
    if (cc.player.isMMute != e) {
      this.node.emit("music-switch", e);
    }

    this.setMusicMute(e);

    if (cc.player.isMMute) {
      this.pauseMusic();
    } else {
      this.resumeMusic();
    }
  },
  setSoundSwitch: function setSoundSwitch(e) {
    this.setSoundMute(e);

    if (cc.player.isSMute) {
      cc.audioEngine.stopAllEffects();
    }
  },
  saveData: function saveData() {
    cc.pvz.PlayerData.saveData();
  },
  setMusicMute: function setMusicMute(e) {
    cc.player.isMMute = e;
    cc.pvz.PlayerData.onDataChanged();
  },
  setSoundMute: function setSoundMute(e) {
    cc.player.isSMute = e;
    cc.pvz.PlayerData.onDataChanged();
  },
  onToggleMusic: function onToggleMusic(e) {
    console.log("onToggleMusic", e.isChecked);
    this.setMusicSwitch(!e.isChecked);
    this.setSoundSwitch(!e.isChecked);
  },
  loadBundles: function loadBundles(e, t, o) {
    var a = this;

    if (this.loadingBar) {
      this.loadingBar.progress = 0;
    }

    this.loadedBundle = 0;
    cc.assetManager.loadBundle(e[0], null, function n(i, c) {
      if (i) {
        console.log("load subpackage  fail:", i);
      } else {
        console.log("load bundle " + c.name + " successfully.");
        a.loadedBundle++;

        if (a.loadedBundle == e.length) {
          o && o();
        } else {
          cc.assetManager.loadBundle(e[a.loadedBundle], null, n);
        }

        a.loadingBar && cc.tween(a.loadingBar).to(0.2, {
          progress: (a.loadedBundle + 1) / t
        }).start();
      }
    });

    if (this.loadingBar) {
      cc.tween(this.loadingBar).to(0.2, {
        progress: (this.loadedBundle + 1) / t
      }).start();
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL0J1dGxlci5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImxvYWRpbmdCYXIiLCJQcm9ncmVzc0JhciIsIm9uTG9hZCIsImJ1dGxlciIsImRGbGFnIiwicHZ6IiwidGltZSIsImRpcmVjdG9yIiwib24iLCJEaXJlY3RvciIsIkVWRU5UX0JFRk9SRV9VUERBVEUiLCJiZWZvcmVEaXJlY3RvclVwZGF0ZSIsInN5cyIsInBsYXRmb3JtIiwiV0VDSEFUX0dBTUUiLCJwb2x5ZmlsbFNhZmVBcmVhIiwid3giLCJnZXRTeXN0ZW1JbmZvU3luYyIsInNhZmVBcmVhIiwiY29uc29sZSIsImxvZyIsImdldFNhZmVBcmVhUmVjdCIsImUiLCJ2aWV3IiwiZ2V0VmlzaWJsZVNpemUiLCJyZWN0Iiwid2lkdGgiLCJoZWlnaHQiLCJjaGVja1RvSGFuZGxlR2FtZUhpZGUiLCJoYW5kbGVHYW1lSGlkZSIsImdldERlbHRhVGltZSIsImdldFNjaGVkdWxlciIsImdldFRpbWVTY2FsZSIsImNsb3VkIiwidWlkIiwibmVlZFNhdmVUb0Nsb3VkIiwiUGxheWVyRGF0YSIsInNhdmVEYXRhVG9Mb2NhbE9ubGluZSIsInN0YXJ0IiwiZ2FtZSIsImFkZFBlcnNpc3RSb290Tm9kZSIsIm5vZGUiLCJvbkhpZGUiLCJvblNob3ciLCJoYW5kbGVHYW1lU2hvdyIsIlRBVXRpbHMiLCJvbld4U2hvdyIsIkJZVEVEQU5DRV9HQU1FIiwidHQiLCJFVkVOVF9ISURFIiwiZ2V0VG90YWxGcmFtZXMiLCJFVkVOVF9TSE9XIiwib25DaGVja0dhbWVWZXJzaW9uIiwicGF1c2VNdXNpYyIsImF1ZGlvRW5naW5lIiwic3RvcEFsbEVmZmVjdHMiLCJpc1Jlc3RhcnQiLCJzYXZlRGF0YSIsInJlc3VtZU11c2ljIiwicGF1c2VEaXJlY3RvciIsInBhdXNlIiwicmVzdW1lRGlyZWN0b3IiLCJyZXN1bWUiLCJwbGF5TXVzaWMiLCJtdXNpYyIsInBsYXllciIsImlzTU11dGUiLCJwbGF5aW5nTXVzaWMiLCJwbGF5RWZmZWN0IiwidCIsImlzU011dGUiLCJyZXN1bWVFZmZlY3QiLCJwbGF5RWZmZWN0QXN5bmMiLCJvIiwiYSIsIm4iLCJleGNsdXNpdmVNYXAiLCJ1dGlscyIsInVzZUJ1bmRsZUFzc2V0IiwiQXVkaW9DbGlwIiwic2V0RmluaXNoQ2FsbGJhY2siLCJwbGF5RWZmZWN0QXN5bmMyIiwiaW5kZXhPZiIsInN1YnN0cmluZyIsInNldE11c2ljU3dpdGNoIiwiZW1pdCIsInNldE11c2ljTXV0ZSIsInNldFNvdW5kU3dpdGNoIiwic2V0U291bmRNdXRlIiwib25EYXRhQ2hhbmdlZCIsIm9uVG9nZ2xlTXVzaWMiLCJpc0NoZWNrZWQiLCJsb2FkQnVuZGxlcyIsInByb2dyZXNzIiwibG9hZGVkQnVuZGxlIiwiYXNzZXRNYW5hZ2VyIiwibG9hZEJ1bmRsZSIsImkiLCJjIiwibmFtZSIsImxlbmd0aCIsInR3ZWVuIiwidG8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0VBQ0wsV0FBU0QsRUFBRSxDQUFDRSxTQURQO0VBRUxDLFVBQVUsRUFBRTtJQUNSQyxVQUFVLEVBQUVKLEVBQUUsQ0FBQ0s7RUFEUCxDQUZQO0VBS0xDLE1BQU0sRUFBRSxrQkFBWTtJQUNoQk4sRUFBRSxDQUFDTyxNQUFILEdBQVksSUFBWjtJQUNBLEtBQUtDLEtBQUwsR0FBYSxDQUFiO0lBQ0FSLEVBQUUsQ0FBQ1MsR0FBSCxDQUFPQyxJQUFQLEdBQWMsQ0FBZDtJQUNBVixFQUFFLENBQUNXLFFBQUgsQ0FBWUMsRUFBWixDQUFlWixFQUFFLENBQUNhLFFBQUgsQ0FBWUMsbUJBQTNCLEVBQWdELEtBQUtDLG9CQUFyRCxFQUEyRSxJQUEzRTs7SUFDQSxJQUFJZixFQUFFLENBQUNnQixHQUFILENBQU9DLFFBQVAsSUFBbUJqQixFQUFFLENBQUNnQixHQUFILENBQU9FLFdBQTlCLEVBQTJDO01BQ3ZDLEtBQUtDLGdCQUFM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Q0FBQyxDQUFDb0IsWUFBRixHQUFpQixDQUFsQixJQUF1QnpCO1FBRDVCLENBRmIsRUFLSy9CLEtBTEwsRUFESjtNQU9IO0lBQ0osQ0FuQkQ7O0lBb0JBLElBQUksS0FBS3RDLFVBQVQsRUFBcUI7TUFDakJKLEVBQUUsQ0FBQ3lHLEtBQUgsQ0FBUyxLQUFLckcsVUFBZCxFQUNLc0csRUFETCxDQUNRLEdBRFIsRUFDYTtRQUNMVCxRQUFRLEVBQUUsQ0FBQyxLQUFLQyxZQUFMLEdBQW9CLENBQXJCLElBQTBCekI7TUFEL0IsQ0FEYixFQUlLL0IsS0FKTDtJQUtIO0VBQ0o7QUFsUEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGxvYWRpbmdCYXI6IGNjLlByb2dyZXNzQmFyXG4gICAgfSxcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MuYnV0bGVyID0gdGhpcztcbiAgICAgICAgdGhpcy5kRmxhZyA9IDA7XG4gICAgICAgIGNjLnB2ei50aW1lID0gMDtcbiAgICAgICAgY2MuZGlyZWN0b3Iub24oY2MuRGlyZWN0b3IuRVZFTlRfQkVGT1JFX1VQREFURSwgdGhpcy5iZWZvcmVEaXJlY3RvclVwZGF0ZSwgdGhpcyk7XG4gICAgICAgIGlmIChjYy5zeXMucGxhdGZvcm0gPT0gY2Muc3lzLldFQ0hBVF9HQU1FKSB7XG4gICAgICAgICAgICB0aGlzLnBvbHlmaWxsU2FmZUFyZWEoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcG9seWZpbGxTYWZlQXJlYTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAod3guZ2V0U3lzdGVtSW5mb1N5bmMoKS5zYWZlQXJlYSkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicG9seWZpbGwgc2FmZUFyZWFcIik7XG4gICAgICAgICAgICBjYy5zeXMuZ2V0U2FmZUFyZWFSZWN0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBlID0gY2Mudmlldy5nZXRWaXNpYmxlU2l6ZSgpO1xuICAgICAgICAgICAgICAgIHJldHVybiBjYy5yZWN0KDAsIDAsIGUud2lkdGgsIGUuaGVpZ2h0KTtcbiAgICAgICAgICAgIH07XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGJlZm9yZURpcmVjdG9yVXBkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmNoZWNrVG9IYW5kbGVHYW1lSGlkZSkge1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVHYW1lSGlkZSgpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBlID0gMWUzICogY2MuZGlyZWN0b3IuZ2V0RGVsdGFUaW1lKCk7XG4gICAgICAgIGNjLnB2ei50aW1lICs9IGUgKiBjYy5kaXJlY3Rvci5nZXRTY2hlZHVsZXIoKS5nZXRUaW1lU2NhbGUoKTtcbiAgICAgICAgaWYgKGNjLnB2ei5jbG91ZCAmJiBjYy5wdnouY2xvdWQudWlkICYmIGNjLnB2ei5jbG91ZC5uZWVkU2F2ZVRvQ2xvdWQgPiAwKSB7XG4gICAgICAgICAgICBjYy5wdnouUGxheWVyRGF0YS5zYXZlRGF0YVRvTG9jYWxPbmxpbmUoKTtcbiAgICAgICAgICAgIGNjLnB2ei5jbG91ZC5uZWVkU2F2ZVRvQ2xvdWQgPSAwO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzdGFydDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGNjLmdhbWUuYWRkUGVyc2lzdFJvb3ROb2RlKHRoaXMubm9kZSk7XG4gICAgICAgIGlmIChjYy5zeXMucGxhdGZvcm0gPT0gY2Muc3lzLldFQ0hBVF9HQU1FKSB7XG4gICAgICAgICAgICB3eC5vbkhpZGUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwid3gub25IaWRlXCIpO1xuICAgICAgICAgICAgICAgIGUuaGFuZGxlR2FtZUhpZGUoKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd3gub25TaG93KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInd4Lm9uU2hvd1wiKTtcbiAgICAgICAgICAgICAgICBlLmhhbmRsZUdhbWVTaG93KCk7XG4gICAgICAgICAgICAgICAgY2MucHZ6LlRBVXRpbHMub25XeFNob3coKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5wbGF0Zm9ybSA9PSBjYy5zeXMuQllURURBTkNFX0dBTUUpIHtcbiAgICAgICAgICAgICAgICB0dC5vbkhpZGUoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInR0Lm9uSGlkZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgZS5oYW5kbGVHYW1lSGlkZSgpO1xuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgICAgICB0dC5vblNob3coZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJ0dC5vblNob3dcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmhhbmRsZUdhbWVTaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5nYW1lLm9uKGNjLmdhbWUuRVZFTlRfSElERSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNjLmdhbWUuRVZFTlRfSElERSwgZnJhbWU6XCIsIGNjLmRpcmVjdG9yLmdldFRvdGFsRnJhbWVzKCkpO1xuICAgICAgICAgICAgICAgICAgICBlLmhhbmRsZUdhbWVIaWRlKCk7XG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgICAgIGNjLmdhbWUub24oY2MuZ2FtZS5FVkVOVF9TSE9XLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNjLmdhbWUuRVZFTlRfU0hPVywgZnJhbWU6XCIsIGNjLmRpcmVjdG9yLmdldFRvdGFsRnJhbWVzKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5oYW5kbGVHYW1lU2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjYy5wdnouVEFVdGlscy5vbkNoZWNrR2FtZVZlcnNpb24oKTtcbiAgICB9LFxuICAgIGhhbmRsZUdhbWVIaWRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiaGFuZGxlR2FtZUhpZGVcIik7XG4gICAgICAgIHRoaXMucGF1c2VNdXNpYygpO1xuICAgICAgICBjYy5hdWRpb0VuZ2luZS5zdG9wQWxsRWZmZWN0cygpO1xuICAgICAgICBpZiAoY2MuaXNSZXN0YXJ0KSB7XG4gICAgICAgICAgICAvL1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zYXZlRGF0YSgpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBoYW5kbGVHYW1lU2hvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnJlc3VtZU11c2ljKCk7XG4gICAgfSxcbiAgICBwYXVzZURpcmVjdG9yOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoMCA9PSB0aGlzLmRGbGFnKSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5wYXVzZSgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuZEZsYWcgfD0gMSA8PCBlO1xuICAgIH0sXG4gICAgcmVzdW1lRGlyZWN0b3I6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMuZEZsYWcgJj0gfigxIDw8IGUpO1xuICAgICAgICBpZiAoMCA9PSB0aGlzLmRGbGFnKSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5yZXN1bWUoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcGxheU11c2ljOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLm11c2ljID0gZTtcbiAgICAgICAgaWYgKGNjLnBsYXllciAmJiBjYy5wbGF5ZXIuaXNNTXV0ZSkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucGxheWluZ011c2ljID0gZTtcbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJwbGF5bXVzaWNcIik7XG4gICAgICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUucGxheU11c2ljKGUsICEwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgcGF1c2VNdXNpYzogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5hdWRpb0VuZ2luZS5wYXVzZU11c2ljKCk7XG4gICAgfSxcbiAgICByZXN1bWVNdXNpYzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoY2MucGxheWVyICYmIGNjLnBsYXllci5pc01NdXRlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlc3VtZU11c2ljIHJldHVyblwiKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLm11c2ljICE9IHRoaXMucGxheWluZ011c2ljKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJyZXN1bWVNdXNpYyBwbGF5IG5ld1wiKSwgdGhpcy5wbGF5TXVzaWModGhpcy5tdXNpYyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwicmVzdW1lTXVzaWMgcmVzdW1lIG9sZFwiKSwgY2MuYXVkaW9FbmdpbmUucmVzdW1lTXVzaWMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgcGxheUVmZmVjdDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gdCkge1xuICAgICAgICAgICAgdCA9ICExO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBjYy5wbGF5ZXIgJiYgY2MucGxheWVyLmlzU011dGUgPyAtMSA6IGUgPyBjYy5hdWRpb0VuZ2luZS5wbGF5RWZmZWN0KGUsIHQpIDogLTE7XG4gICAgfSxcbiAgICByZXN1bWVFZmZlY3Q6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChjYy5wbGF5ZXIgJiYgY2MucGxheWVyLmlzU011dGUpIHtcbiAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgfVxuICAgICAgICBjYy5hdWRpb0VuZ2luZS5yZXN1bWVFZmZlY3QoZSk7XG4gICAgfSxcbiAgICBwbGF5RWZmZWN0QXN5bmM6IGZ1bmN0aW9uIChlLCB0LCBvKSB7XG4gICAgICAgIHZhciBhID0gdGhpcztcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbykge1xuICAgICAgICAgICAgbyA9ICExO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY2MucGxheWVyIHx8ICFjYy5wbGF5ZXIuaXNTTXV0ZSkge1xuICAgICAgICAgICAgdmFyIG4gPSBudWxsO1xuICAgICAgICAgICAgaWYgKG8pIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5leGNsdXNpdmVNYXApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmV4Y2x1c2l2ZU1hcCA9IHt9O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBuID0gZSArIHQ7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZXhjbHVzaXZlTWFwW25dKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5leGNsdXNpdmVNYXBbbl0gPSAhMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNjLnB2ei51dGlscy51c2VCdW5kbGVBc3NldChlLCB0LCBjYy5BdWRpb0NsaXAsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHQgPSBhLnBsYXlFZmZlY3QoZSwgITEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoLTEgPT0gdCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgYS5leGNsdXNpdmVNYXBbbl0gPSAhMTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmF1ZGlvRW5naW5lLnNldEZpbmlzaENhbGxiYWNrKHQsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhLmV4Y2x1c2l2ZU1hcFtuXSA9ICExO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhLnBsYXlFZmZlY3QoZSwgITEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBwbGF5RWZmZWN0QXN5bmMyOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoIWNjLnBsYXllciB8fCAhY2MucGxheWVyLmlzU011dGUpIHtcbiAgICAgICAgICAgIHZhciB0ID0gZS5pbmRleE9mKFwiLFwiKTtcbiAgICAgICAgICAgIHRoaXMucGxheUVmZmVjdEFzeW5jKGUuc3Vic3RyaW5nKDAsIHQpLCBlLnN1YnN0cmluZyh0ICsgMSkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzZXRNdXNpY1N3aXRjaDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKGNjLnBsYXllci5pc01NdXRlICE9IGUpIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5lbWl0KFwibXVzaWMtc3dpdGNoXCIsIGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0TXVzaWNNdXRlKGUpO1xuICAgICAgICBpZiAoY2MucGxheWVyLmlzTU11dGUpIHtcbiAgICAgICAgICAgIHRoaXMucGF1c2VNdXNpYygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZXN1bWVNdXNpYygpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBzZXRTb3VuZFN3aXRjaDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgdGhpcy5zZXRTb3VuZE11dGUoZSk7XG4gICAgICAgIGlmIChjYy5wbGF5ZXIuaXNTTXV0ZSkge1xuICAgICAgICAgICAgY2MuYXVkaW9FbmdpbmUuc3RvcEFsbEVmZmVjdHMoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgc2F2ZURhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MucHZ6LlBsYXllckRhdGEuc2F2ZURhdGEoKTtcbiAgICB9LFxuICAgIHNldE11c2ljTXV0ZTogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY2MucGxheWVyLmlzTU11dGUgPSBlO1xuICAgICAgICBjYy5wdnouUGxheWVyRGF0YS5vbkRhdGFDaGFuZ2VkKCk7XG4gICAgfSxcbiAgICBzZXRTb3VuZE11dGU6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGNjLnBsYXllci5pc1NNdXRlID0gZTtcbiAgICAgICAgY2MucHZ6LlBsYXllckRhdGEub25EYXRhQ2hhbmdlZCgpO1xuICAgIH0sXG4gICAgb25Ub2dnbGVNdXNpYzogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJvblRvZ2dsZU11c2ljXCIsIGUuaXNDaGVja2VkKTtcbiAgICAgICAgdGhpcy5zZXRNdXNpY1N3aXRjaCghZS5pc0NoZWNrZWQpO1xuICAgICAgICB0aGlzLnNldFNvdW5kU3dpdGNoKCFlLmlzQ2hlY2tlZCk7XG4gICAgfSxcbiAgICBsb2FkQnVuZGxlczogZnVuY3Rpb24gKGUsIHQsIG8pIHtcbiAgICAgICAgdmFyIGEgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5sb2FkaW5nQmFyKSB7XG4gICAgICAgICAgICB0aGlzLmxvYWRpbmdCYXIucHJvZ3Jlc3MgPSAwO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubG9hZGVkQnVuZGxlID0gMDtcbiAgICAgICAgY2MuYXNzZXRNYW5hZ2VyLmxvYWRCdW5kbGUoZVswXSwgbnVsbCwgZnVuY3Rpb24gbihpLCBjKSB7XG4gICAgICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9hZCBzdWJwYWNrYWdlICBmYWlsOlwiLCBpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2FkIGJ1bmRsZSBcIiArIGMubmFtZSArIFwiIHN1Y2Nlc3NmdWxseS5cIik7XG4gICAgICAgICAgICAgICAgYS5sb2FkZWRCdW5kbGUrKztcbiAgICAgICAgICAgICAgICBpZiAoYS5sb2FkZWRCdW5kbGUgPT0gZS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgbyAmJiBvKCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY2MuYXNzZXRNYW5hZ2VyLmxvYWRCdW5kbGUoZVthLmxvYWRlZEJ1bmRsZV0sIG51bGwsIG4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhLmxvYWRpbmdCYXIgJiZcbiAgICAgICAgICAgICAgICAgICAgY2NcbiAgICAgICAgICAgICAgICAgICAgICAgIC50d2VlbihhLmxvYWRpbmdCYXIpXG4gICAgICAgICAgICAgICAgICAgICAgICAudG8oMC4yLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6IChhLmxvYWRlZEJ1bmRsZSArIDEpIC8gdFxuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdGFydCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKHRoaXMubG9hZGluZ0Jhcikge1xuICAgICAgICAgICAgY2MudHdlZW4odGhpcy5sb2FkaW5nQmFyKVxuICAgICAgICAgICAgICAgIC50bygwLjIsIHtcbiAgICAgICAgICAgICAgICAgICAgcHJvZ3Jlc3M6ICh0aGlzLmxvYWRlZEJ1bmRsZSArIDEpIC8gdFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLnN0YXJ0KCk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdfQ==