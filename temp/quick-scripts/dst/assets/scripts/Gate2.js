
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Gate2.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'd38e1GOzXlHE6pl6LVEnVvY', 'Gate2');
// scripts/Gate2.js

"use strict";

var $pool = require("./Pool");

var $battleGround2Ctrl = require("./BattleGround2Ctrl");

var $role2 = require("./Role2");

var c = cc._decorator;
var s = c.ccclass;
var r = c.property;

var l = function (e) {
  function t() {
    var t = null !== e && e.apply(this, arguments) || this;
    t.sep = null;
    t.gates = [];
    t.gateStrs = [];
    t.gateColors = [];
    t.par = null;
    t.sepWidth = 5;
    t.nextHitTime = 0;
    t.v = 0;
    t.buffs = [[300, 0, 0, 0], [300, 0, 0, 0]];
    return t;
  }

  __extends(t, e);

  t.prototype.init = function (e) {
    if (void 0 === e) {
      e = {};
    }

    this.par = e.par;
    this.v = $battleGround2Ctrl["default"].JSONManager.ConfigBattle[6].v[0];
    this.buffs[0][0] = this.par.WIDTH / 2;
    this.buffs[1][0] = this.par.WIDTH / 2;
    this.buffs[0][3] = 0;
    this.buffs[1][3] = 0;
    this.gates[0].width = this.par.WIDTH / 2;
    this.gates[0].x = -this.par.WIDTH / 4;
    this.gates[1].width = this.par.WIDTH / 2;
    this.gates[1].x = this.par.WIDTH / 4;
    this.buffs[0][1] = e.gateInfo[0][0];
    this.buffs[0][2] = e.gateInfo[0][1];
    this.buffs[1][1] = e.gateInfo[1][0];
    this.buffs[1][2] = e.gateInfo[1][1];
    this.sep.x = 0;
    this.nextHitTime = 0;
    this.setText();
  };

  t.prototype.moving = function (e) {
    if (10 === this.par.state) {
      this.node.y -= this.v * e;
      this.nextHitTime -= e;

      if (this.nextHitTime <= 0) {
        if (this.buffs[0][3] > 0) {
          this.addBuff(0);

          if (this.buffs[0][3] > this.buffs[1][3]) {
            this.setGateWidth(0, this.sepWidth);
            this.setGateWidth(1, -this.sepWidth);
          }

          this.nextHitTime = $battleGround2Ctrl["default"].JSONManager.ConfigBattle[6].v[1];
        }

        if (this.buffs[1][3] > 0) {
          this.addBuff(1);

          if (this.buffs[1][3] > this.buffs[0][3]) {
            this.setGateWidth(1, this.sepWidth);
            this.setGateWidth(0, -this.sepWidth);
          }

          this.nextHitTime = $battleGround2Ctrl["default"].JSONManager.ConfigBattle[6].v[1];
        }

        this.buffs[0][3] = 0;
        this.buffs[1][3] = 0;
      }

      if (this.node.y < this.par.endLineY + this.node.height / 2) {
        this.use();
      }
    }
  };

  t.prototype.addBuff = function (e) {
    this.buffs[e][2]++;

    if (0 === this.buffs[e][2]) {
      this.buffs[e][2] = 1;
    }

    if (2 === this.buffs[e][1] && this.buffs[e][2] > 8) {
      this.buffs[e][2] = 8;
    }
  };

  t.prototype.setGateWidth = function (e, t) {
    this.buffs[e][0] += t;

    if (this.buffs[e][0] < 10 * this.sepWidth) {
      this.buffs[e][0] = 10 * this.sepWidth;
    } else {
      if (this.buffs[e][0] > this.par.WIDTH - 10 * this.sepWidth) {
        this.buffs[e][0] = this.par.WIDTH - 10 * this.sepWidth;
      }
    }

    this.gates[e].width = this.buffs[e][0];

    if (0 === e) {
      this.gates[e].x = -this.par.WIDTH / 2 + this.gates[e].width / 2;
      this.sep.x = -this.par.WIDTH / 2 + this.gates[e].width;
    } else {
      this.gates[e].x = this.par.WIDTH / 2 - this.gates[e].width / 2;
    }

    this.gates[e].getComponent(cc.Sprite).spriteFrame = this.gateColors[t > 0 ? 0 : 1];
  };

  t.prototype.beHit = function (e) {
    if (e.node.x < -this.par.WIDTH / 2 + this.buffs[0][0]) {
      this.buffs[0][3]++;
    } else {
      this.buffs[1][3]++;
    }

    this.setText();
  };

  t.prototype.use = function () {
    if (this.par.player.x < this.sep.x) {
      this.getBuff(this.buffs[0][1], this.buffs[0][2]);
    } else {
      this.getBuff(this.buffs[1][1], this.buffs[1][2]);
    }

    this.node.parent.getComponent($pool["default"]).destroyPoolItem(this.node);
  };

  t.prototype.getBuff = function (e, t) {
    var o = this.par.player.getComponent($role2["default"]);

    switch (e) {
      case 1:
        if (t > 0) {
          o.bulletConfig.rate -= 0.015 * t;
          o.bulletConfig.rate < 1 / 15 && (o.bulletConfig.rate = 1 / 15);
        } else {
          o.bulletConfig.rate *= Math.abs(t);
        }

        break;

      case 2:
        o.bulletConfig.nums += t;

        if (o.bulletConfig.nums < 1) {
          o.bulletConfig.nums = 1;
        }

        if (o.bulletConfig.nums > 10) {
          o.bulletConfig.nums = 10;
        }

        break;

      case 3:
        if (t > 0) {
          o.bulletConfig.dmg *= t;
        } else {
          o.bulletConfig.dmg /= Math.abs(t);
          o.bulletConfig.dmg = Math.floor(o.bulletConfig.dmg);
        }

        this.par.refreshAtk();
        break;

      case 4:
      case 5:
        o.bulletConfig.dmg += t;
        this.par.refreshAtk();
    }
  };

  t.prototype.setText = function () {
    var e = {
      1: ["攻速 ", "x", "÷"],
      2: ["弹道 ", "+", "-"],
      3: ["攻击 ", "x", "÷"],
      4: ["攻击 ", "+", "-"],
      5: ["攻击 ", "+", "-"]
    };
    this.gateStrs[0].node.setScale(this.buffs[0][0] / 300);
    this.gateStrs[1].node.setScale(this.buffs[1][0] / 300);
    this.gateStrs[0].string = e[this.buffs[0][1]][0] + e[this.buffs[0][1]][this.buffs[0][2] >= 0 ? 1 : 2] + " " + Math.abs(this.buffs[0][2]);
    this.gateStrs[1].string = e[this.buffs[1][1]][0] + e[this.buffs[1][1]][this.buffs[1][2] >= 0 ? 1 : 2] + " " + Math.abs(this.buffs[1][2]);
  };

  t.prototype.start = function () {};

  t.prototype.update = function (e) {
    this.moving(e);
  };

  __decorate([r(cc.Node)], t.prototype, "sep", void 0);

  __decorate([r(cc.Node)], t.prototype, "gates", void 0);

  __decorate([r(cc.Label)], t.prototype, "gateStrs", void 0);

  __decorate([r(cc.SpriteFrame)], t.prototype, "gateColors", void 0);

  return __decorate([s], t);
}(cc.Component);

exports["default"] = l;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL0dhdGUyLmpzIl0sIm5hbWVzIjpbIiRwb29sIiwicmVxdWlyZSIsIiRiYXR0bGVHcm91bmQyQ3RybCIsIiRyb2xlMiIsImMiLCJjYyIsIl9kZWNvcmF0b3IiLCJzIiwiY2NjbGFzcyIsInIiLCJwcm9wZXJ0eSIsImwiLCJlIiwidCIsImFwcGx5IiwiYXJndW1lbnRzIiwic2VwIiwiZ2F0ZXMiLCJnYXRlU3RycyIsImdhdGVDb2xvcnMiLCJwYXIiLCJzZXBXaWR0aCIsIm5leHRIaXRUaW1lIiwidiIsImJ1ZmZzIiwiX19leHRlbmRzIiwicHJvdG90eXBlIiwiaW5pdCIsIkpTT05NYW5hZ2VyIiwiQ29uZmlnQmF0dGxlIiwiV0lEVEgiLCJ3aWR0aCIsIngiLCJnYXRlSW5mbyIsInNldFRleHQiLCJtb3ZpbmciLCJzdGF0ZSIsIm5vZGUiLCJ5IiwiYWRkQnVmZiIsInNldEdhdGVXaWR0aCIsImVuZExpbmVZIiwiaGVpZ2h0IiwidXNlIiwiZ2V0Q29tcG9uZW50IiwiU3ByaXRlIiwic3ByaXRlRnJhbWUiLCJiZUhpdCIsInBsYXllciIsImdldEJ1ZmYiLCJwYXJlbnQiLCJkZXN0cm95UG9vbEl0ZW0iLCJvIiwiYnVsbGV0Q29uZmlnIiwicmF0ZSIsIk1hdGgiLCJhYnMiLCJudW1zIiwiZG1nIiwiZmxvb3IiLCJyZWZyZXNoQXRrIiwic2V0U2NhbGUiLCJzdHJpbmciLCJzdGFydCIsInVwZGF0ZSIsIl9fZGVjb3JhdGUiLCJOb2RlIiwiTGFiZWwiLCJTcHJpdGVGcmFtZSIsIkNvbXBvbmVudCIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsS0FBSyxHQUFHQyxPQUFPLENBQUMsUUFBRCxDQUFuQjs7QUFDQSxJQUFJQyxrQkFBa0IsR0FBR0QsT0FBTyxDQUFDLHFCQUFELENBQWhDOztBQUNBLElBQUlFLE1BQU0sR0FBR0YsT0FBTyxDQUFDLFNBQUQsQ0FBcEI7O0FBQ0EsSUFBSUcsQ0FBQyxH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LENBQUM2RCxJQUFKLENBQUYsQ0FBRCxFQUFlckQsQ0FBQyxDQUFDYSxTQUFqQixFQUE0QixLQUE1QixFQUFtQyxLQUFLLENBQXhDLENBQVY7O0VBQ0F1QyxVQUFVLENBQUMsQ0FBQ3hELENBQUMsQ0FBQ0osRUFBRSxDQUFDNkQsSUFBSixDQUFGLENBQUQsRUFBZXJELENBQUMsQ0FBQ2EsU0FBakIsRUFBNEIsT0FBNUIsRUFBcUMsS0FBSyxDQUExQyxDQUFWOztFQUNBdUMsVUFBVSxDQUFDLENBQUN4RCxDQUFDLENBQUNKLEVBQUUsQ0FBQzhELEtBQUosQ0FBRixDQUFELEVBQWdCdEQsQ0FBQyxDQUFDYSxTQUFsQixFQUE2QixVQUE3QixFQUF5QyxLQUFLLENBQTlDLENBQVY7O0VBQ0F1QyxVQUFVLENBQUMsQ0FBQ3hELENBQUMsQ0FBQ0osRUFBRSxDQUFDK0QsV0FBSixDQUFGLENBQUQsRUFBc0J2RCxDQUFDLENBQUNhLFNBQXhCLEVBQW1DLFlBQW5DLEVBQWlELEtBQUssQ0FBdEQsQ0FBVjs7RUFDQSxPQUFPdUMsVUFBVSxDQUFDLENBQUMxRCxDQUFELENBQUQsRUFBTU0sQ0FBTixDQUFqQjtBQUNILENBakxPLENBaUxMUixFQUFFLENBQUNnRSxTQWpMRSxDQUFSOztBQWtMQUMsT0FBTyxXQUFQLEdBQWtCM0QsQ0FBbEIiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciAkcG9vbCA9IHJlcXVpcmUoXCIuL1Bvb2xcIik7XG52YXIgJGJhdHRsZUdyb3VuZDJDdHJsID0gcmVxdWlyZShcIi4vQmF0dGxlR3JvdW5kMkN0cmxcIik7XG52YXIgJHJvbGUyID0gcmVxdWlyZShcIi4vUm9sZTJcIik7XG52YXIgYyA9IGNjLl9kZWNvcmF0b3I7XG52YXIgcyA9IGMuY2NjbGFzcztcbnZhciByID0gYy5wcm9wZXJ0eTtcbnZhciBsID0gKGZ1bmN0aW9uIChlKSB7XG4gICAgZnVuY3Rpb24gdCgpIHtcbiAgICAgICAgdmFyIHQgPSAobnVsbCAhPT0gZSAmJiBlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykpIHx8IHRoaXM7XG4gICAgICAgIHQuc2VwID0gbnVsbDtcbiAgICAgICAgdC5nYXRlcyA9IFtdO1xuICAgICAgICB0LmdhdGVTdHJzID0gW107XG4gICAgICAgIHQuZ2F0ZUNvbG9ycyA9IFtdO1xuICAgICAgICB0LnBhciA9IG51bGw7XG4gICAgICAgIHQuc2VwV2lkdGggPSA1O1xuICAgICAgICB0Lm5leHRIaXRUaW1lID0gMDtcbiAgICAgICAgdC52ID0gMDtcbiAgICAgICAgdC5idWZmcyA9IFtcbiAgICAgICAgICAgIFszMDAsIDAsIDAsIDBdLFxuICAgICAgICAgICAgWzMwMCwgMCwgMCwgMF1cbiAgICAgICAgXTtcbiAgICAgICAgcmV0dXJuIHQ7XG4gICAgfVxuICAgIF9fZXh0ZW5kcyh0LCBlKTtcbiAgICB0LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gZSkge1xuICAgICAgICAgICAgZSA9IHt9O1xuICAgICAgICB9XG4gICAgICAgIHRoaXMucGFyID0gZS5wYXI7XG4gICAgICAgIHRoaXMudiA9ICRiYXR0bGVHcm91bmQyQ3RybC5kZWZhdWx0LkpTT05NYW5hZ2VyLkNvbmZpZ0JhdHRsZVs2XS52WzBdO1xuICAgICAgICB0aGlzLmJ1ZmZzWzBdWzBdID0gdGhpcy5wYXIuV0lEVEggLyAyO1xuICAgICAgICB0aGlzLmJ1ZmZzWzFdWzBdID0gdGhpcy5wYXIuV0lEVEggLyAyO1xuICAgICAgICB0aGlzLmJ1ZmZzWzBdWzNdID0gMDtcbiAgICAgICAgdGhpcy5idWZmc1sxXVszXSA9IDA7XG4gICAgICAgIHRoaXMuZ2F0ZXNbMF0ud2lkdGggPSB0aGlzLnBhci5XSURUSCAvIDI7XG4gICAgICAgIHRoaXMuZ2F0ZXNbMF0ueCA9IC10aGlzLnBhci5XSURUSCAvIDQ7XG4gICAgICAgIHRoaXMuZ2F0ZXNbMV0ud2lkdGggPSB0aGlzLnBhci5XSURUSCAvIDI7XG4gICAgICAgIHRoaXMuZ2F0ZXNbMV0ueCA9IHRoaXMucGFyLldJRFRIIC8gNDtcbiAgICAgICAgdGhpcy5idWZmc1swXVsxXSA9IGUuZ2F0ZUluZm9bMF1bMF07XG4gICAgICAgIHRoaXMuYnVmZnNbMF1bMl0gPSBlLmdhdGVJbmZvWzBdWzFdO1xuICAgICAgICB0aGlzLmJ1ZmZzWzFdWzFdID0gZS5nYXRlSW5mb1sxXVswXTtcbiAgICAgICAgdGhpcy5idWZmc1sxXVsyXSA9IGUuZ2F0ZUluZm9bMV1bMV07XG4gICAgICAgIHRoaXMuc2VwLnggPSAwO1xuICAgICAgICB0aGlzLm5leHRIaXRUaW1lID0gMDtcbiAgICAgICAgdGhpcy5zZXRUZXh0KCk7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5tb3ZpbmcgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoMTAgPT09IHRoaXMucGFyLnN0YXRlKSB7XG4gICAgICAgICAgICB0aGlzLm5vZGUueSAtPSB0aGlzLnYgKiBlO1xuICAgICAgICAgICAgdGhpcy5uZXh0SGl0VGltZSAtPSBlO1xuICAgICAgICAgICAgaWYgKHRoaXMubmV4dEhpdFRpbWUgPD0gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZzWzBdWzNdID4gMCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZEJ1ZmYoMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZzWzBdWzNdID4gdGhpcy5idWZmc1sxXVszXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRHYXRlV2lkdGgoMCwgdGhpcy5zZXBXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLnNldEdhdGVXaWR0aCgxLCAtdGhpcy5zZXBXaWR0aCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgdGhpcy5uZXh0SGl0VGltZSA9ICRiYXR0bGVHcm91bmQyQ3RybC5kZWZhdWx0LkpTT05NYW5hZ2VyLkNvbmZpZ0JhdHRsZVs2XS52WzFdO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAodGhpcy5idWZmc1sxXVszXSA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRCdWZmKDEpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5idWZmc1sxXVszXSA+IHRoaXMuYnVmZnNbMF1bM10pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0R2F0ZVdpZHRoKDEsIHRoaXMuc2VwV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRHYXRlV2lkdGgoMCwgLXRoaXMuc2VwV2lkdGgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmV4dEhpdFRpbWUgPSAkYmF0dGxlR3JvdW5kMkN0cmwuZGVmYXVsdC5KU09OTWFuYWdlci5Db25maWdCYXR0bGVbNl0udlsxXTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmc1swXVszXSA9IDA7XG4gICAgICAgICAgICAgICAgdGhpcy5idWZmc1sxXVszXSA9IDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5ub2RlLnkgPCB0aGlzLnBhci5lbmRMaW5lWSArIHRoaXMubm9kZS5oZWlnaHQgLyAyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51c2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgdC5wcm90b3R5cGUuYWRkQnVmZiA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHRoaXMuYnVmZnNbZV1bMl0rKztcbiAgICAgICAgaWYgKDAgPT09IHRoaXMuYnVmZnNbZV1bMl0pIHtcbiAgICAgICAgICAgIHRoaXMuYnVmZnNbZV1bMl0gPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmICgyID09PSB0aGlzLmJ1ZmZzW2VdWzFdICYmIHRoaXMuYnVmZnNbZV1bMl0gPiA4KSB7XG4gICAgICAgICAgICB0aGlzLmJ1ZmZzW2VdWzJdID0gODtcbiAgICAgICAgfVxuICAgIH07XG4gICAgdC5wcm90b3R5cGUuc2V0R2F0ZVdpZHRoID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdGhpcy5idWZmc1tlXVswXSArPSB0O1xuICAgICAgICBpZiAodGhpcy5idWZmc1tlXVswXSA8IDEwICogdGhpcy5zZXBXaWR0aCkge1xuICAgICAgICAgICAgdGhpcy5idWZmc1tlXVswXSA9IDEwICogdGhpcy5zZXBXaWR0aDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmJ1ZmZzW2VdWzBdID4gdGhpcy5wYXIuV0lEVEggLSAxMCAqIHRoaXMuc2VwV2lkdGgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJ1ZmZzW2VdWzBdID0gdGhpcy5wYXIuV0lEVEggLSAxMCAqIHRoaXMuc2VwV2lkdGg7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5nYXRlc1tlXS53aWR0aCA9IHRoaXMuYnVmZnNbZV1bMF07XG4gICAgICAgIGlmICgwID09PSBlKSB7XG4gICAgICAgICAgICB0aGlzLmdhdGVzW2VdLnggPSAtdGhpcy5wYXIuV0lEVEggLyAyICsgdGhpcy5nYXRlc1tlXS53aWR0aCAvIDI7XG4gICAgICAgICAgICB0aGlzLnNlcC54ID0gLXRoaXMucGFyLldJRFRIIC8gMiArIHRoaXMuZ2F0ZXNbZV0ud2lkdGg7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdhdGVzW2VdLnggPSB0aGlzLnBhci5XSURUSCAvIDIgLSB0aGlzLmdhdGVzW2VdLndpZHRoIC8gMjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmdhdGVzW2VdLmdldENvbXBvbmVudChjYy5TcHJpdGUpLnNwcml0ZUZyYW1lID0gdGhpcy5nYXRlQ29sb3JzW3QgPiAwID8gMCA6IDFdO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuYmVIaXQgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoZS5ub2RlLnggPCAtdGhpcy5wYXIuV0lEVEggLyAyICsgdGhpcy5idWZmc1swXVswXSkge1xuICAgICAgICAgICAgdGhpcy5idWZmc1swXVszXSsrO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5idWZmc1sxXVszXSsrO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuc2V0VGV4dCgpO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUudXNlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5wYXIucGxheWVyLnggPCB0aGlzLnNlcC54KSB7XG4gICAgICAgICAgICB0aGlzLmdldEJ1ZmYodGhpcy5idWZmc1swXVsxXSwgdGhpcy5idWZmc1swXVsyXSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmdldEJ1ZmYodGhpcy5idWZmc1sxXVsxXSwgdGhpcy5idWZmc1sxXVsyXSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ub2RlLnBhcmVudC5nZXRDb21wb25lbnQoJHBvb2wuZGVmYXVsdCkuZGVzdHJveVBvb2xJdGVtKHRoaXMubm9kZSk7XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5nZXRCdWZmID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdmFyIG8gPSB0aGlzLnBhci5wbGF5ZXIuZ2V0Q29tcG9uZW50KCRyb2xlMi5kZWZhdWx0KTtcbiAgICAgICAgc3dpdGNoIChlKSB7XG4gICAgICAgICAgICBjYXNlIDE6XG4gICAgICAgICAgICAgICAgaWYgKHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uYnVsbGV0Q29uZmlnLnJhdGUgLT0gMC4wMTUgKiB0O1xuICAgICAgICAgICAgICAgICAgICBvLmJ1bGxldENvbmZpZy5yYXRlIDwgMSAvIDE1ICYmIChvLmJ1bGxldENvbmZpZy5yYXRlID0gMSAvIDE1KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvLmJ1bGxldENvbmZpZy5yYXRlICo9IE1hdGguYWJzKHQpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMjpcbiAgICAgICAgICAgICAgICBvLmJ1bGxldENvbmZpZy5udW1zICs9IHQ7XG4gICAgICAgICAgICAgICAgaWYgKG8uYnVsbGV0Q29uZmlnLm51bXMgPCAxKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uYnVsbGV0Q29uZmlnLm51bXMgPSAxO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoby5idWxsZXRDb25maWcubnVtcyA+IDEwKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uYnVsbGV0Q29uZmlnLm51bXMgPSAxMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDM6XG4gICAgICAgICAgICAgICAgaWYgKHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG8uYnVsbGV0Q29uZmlnLmRtZyAqPSB0O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG8uYnVsbGV0Q29uZmlnLmRtZyAvPSBNYXRoLmFicyh0KTtcbiAgICAgICAgICAgICAgICAgICAgby5idWxsZXRDb25maWcuZG1nID0gTWF0aC5mbG9vcihvLmJ1bGxldENvbmZpZy5kbWcpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB0aGlzLnBhci5yZWZyZXNoQXRrKCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICBjYXNlIDQ6XG4gICAgICAgICAgICBjYXNlIDU6XG4gICAgICAgICAgICAgICAgby5idWxsZXRDb25maWcuZG1nICs9IHQ7XG4gICAgICAgICAgICAgICAgdGhpcy5wYXIucmVmcmVzaEF0aygpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB0LnByb3RvdHlwZS5zZXRUZXh0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IHtcbiAgICAgICAgICAgIDE6IFtcIuaUu+mAnyBcIiwgXCJ4XCIsIFwiw7dcIl0sXG4gICAgICAgICAgICAyOiBbXCLlvLnpgZMgXCIsIFwiK1wiLCBcIi1cIl0sXG4gICAgICAgICAgICAzOiBbXCLmlLvlh7sgXCIsIFwieFwiLCBcIsO3XCJdLFxuICAgICAgICAgICAgNDogW1wi5pS75Ye7IFwiLCBcIitcIiwgXCItXCJdLFxuICAgICAgICAgICAgNTogW1wi5pS75Ye7IFwiLCBcIitcIiwgXCItXCJdXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuZ2F0ZVN0cnNbMF0ubm9kZS5zZXRTY2FsZSh0aGlzLmJ1ZmZzWzBdWzBdIC8gMzAwKTtcbiAgICAgICAgdGhpcy5nYXRlU3Ryc1sxXS5ub2RlLnNldFNjYWxlKHRoaXMuYnVmZnNbMV1bMF0gLyAzMDApO1xuICAgICAgICB0aGlzLmdhdGVTdHJzWzBdLnN0cmluZyA9XG4gICAgICAgICAgICBlW3RoaXMuYnVmZnNbMF1bMV1dWzBdICtcbiAgICAgICAgICAgIGVbdGhpcy5idWZmc1swXVsxXV1bdGhpcy5idWZmc1swXVsyXSA+PSAwID8gMSA6IDJdICtcbiAgICAgICAgICAgIFwiIFwiICtcbiAgICAgICAgICAgIE1hdGguYWJzKHRoaXMuYnVmZnNbMF1bMl0pO1xuICAgICAgICB0aGlzLmdhdGVTdHJzWzFdLnN0cmluZyA9XG4gICAgICAgICAgICBlW3RoaXMuYnVmZnNbMV1bMV1dWzBdICtcbiAgICAgICAgICAgIGVbdGhpcy5idWZmc1sxXVsxXV1bdGhpcy5idWZmc1sxXVsyXSA+PSAwID8gMSA6IDJdICtcbiAgICAgICAgICAgIFwiIFwiICtcbiAgICAgICAgICAgIE1hdGguYWJzKHRoaXMuYnVmZnNbMV1bMl0pO1xuICAgIH07XG4gICAgdC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbiAoKSB7fTtcbiAgICB0LnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLm1vdmluZyhlKTtcbiAgICB9O1xuICAgIF9fZGVjb3JhdGUoW3IoY2MuTm9kZSldLCB0LnByb3RvdHlwZSwgXCJzZXBcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtyKGNjLk5vZGUpXSwgdC5wcm90b3R5cGUsIFwiZ2F0ZXNcIiwgdm9pZCAwKTtcbiAgICBfX2RlY29yYXRlKFtyKGNjLkxhYmVsKV0sIHQucHJvdG90eXBlLCBcImdhdGVTdHJzXCIsIHZvaWQgMCk7XG4gICAgX19kZWNvcmF0ZShbcihjYy5TcHJpdGVGcmFtZSldLCB0LnByb3RvdHlwZSwgXCJnYXRlQ29sb3JzXCIsIHZvaWQgMCk7XG4gICAgcmV0dXJuIF9fZGVjb3JhdGUoW3NdLCB0KTtcbn0pKGNjLkNvbXBvbmVudCk7XG5leHBvcnRzLmRlZmF1bHQgPSBsO1xuIl19