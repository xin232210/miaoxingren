
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/loading.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '66743DrwvlEwIWvKFiPlrpI', 'loading');
// scripts/loading.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    progressBar: cc.ProgressBar
  },
  onLoad: function onLoad() {
    cc.debug.setDisplayStats(!1);
    var e = cc.RenderFlow.prototype._updateRenderData;

    cc.RenderFlow.prototype._updateRenderData = function (t) {
      if (!t._renderComponent || !t._renderComponent._assembler) {
        t._renderFlag &= ~cc.RenderFlow.FLAG_UPDATE_RENDER_DATA;
        return void this._next._func(t);
      }

      e.call(this, t);
    };

    var t = cc.RenderFlow.prototype._render;

    cc.RenderFlow.prototype._render = function (e) {
      if (e._renderComponent && e._renderComponent._assembler) {
        t.call(this, e);
      } else {
        this._next._func(e);
      }
    };

    var o = cc.RenderFlow.prototype._postRender;

    cc.RenderFlow.prototype._postRender = function (e) {
      if (e._renderComponent && e._renderComponent._assembler) {
        o.call(this, e);
      } else {
        this._next._func(e);
      }
    };
  },
  start: function start() {
    cc.macro.ENABLE_MULTI_TOUCH = !1;
    cc.pvz.TAUtils.init();
    this.total = 1;
    this.waited = 1;
    this.loadSubpackage("uiImage");
    this.loadSubpackage("mainUI");
    this.loadSubpackage("actors");
    this.loadSubpackage("game");
    this.singleTime = Math.max(0.3, 1.8 / this.total);
    this.barProgress = 0;
    this.progressBar.progress = 0;
    this.updateProgress();
  },
  updateProgress: function updateProgress() {
    var e = (this.barProgress + 1) / this.total;
    cc.tween(this.progressBar).to(this.singleTime, {
      progress: e
    }).start();
  },
  initData: function initData() {
    if (cc.sys.platform == cc.sys.WECHAT_GAME) {
      wx.setKeepScreenOn({
        keepScreenOn: !0
      });
      wx.onError(function (e) {
        cc.pvz.TAUtils.track("error", {
          message: e.message,
          stack: e.stack
        });
      });
    }

    cc.isControlAd = !0;
    cc.pvz.AdUtils.initAllAds();
    cc.pvz.PlayerData.initPlayerData();
    this.onResReady();
  },
  onProgressChanged: function onProgressChanged() {
    this.barProgress++;
    this.updateProgress();
  },
  onResReady: function onResReady() {
    this.onProgressChanged();
    this.waited -= 1;

    if (1 == this.waited) {
      this.initData();
    } else {
      if (0 == this.waited) {
        this.onAllResReady();
      }
    }
  },
  loadSubpackage: function loadSubpackage(e) {
    var t = this;

    if (cc.assetManager.getBundle(e)) {
      this.onResReady();
    } else {
      this.total++;
      this.waited++;
      cc.assetManager.loadBundle(e, null, function (o) {
        if (o) {
          console.log("load subpackage " + e + " fail:", o);
        } else {
          console.log("load subpackage " + e);
          t.onResReady();
        }
      });
    }
  },
  onAllResReady: function onAllResReady() {
    var e = this;
    cc.pvz.cloud.login(function () {
      if (cc.pvz.cloud.baseData.length > 2) {
        var t = JSON.parse(cc.pvz.cloud.baseData);
        console.log("server t:", t.t, ", local t:", cc.player.t, "s version:", t.dataVersion);
        var o;

        if (cc.player.achievePro.hasOwnProperty(cc.pvz.GameConfig.MissionType["装备总等级n"])) {
          o = cc.player.achievePro[cc.pvz.GameConfig.MissionType["装备总等级n"]];
        } else {
          o = 0;
        }

        var a;

        if (t.achievePro.hasOwnProperty(cc.pvz.GameConfig.MissionType["装备总等级n"])) {
          a = t.achievePro[cc.pvz.GameConfig.MissionType["装备总等级n"]];
        } else {
          a = 0;
        }

        if (t.t > cc.player.t || a > o) {
          cc.player = t;
          cc.pvz.PlayerData.postLoadData();
        }
      }

      cc.pvz.TAUtils.uploadLoginData({
        uid: cc.pvz.cloud.uid,
        name: cc.pvz.cloud.name,
        level: cc.pvz.PlayerData.getStageLevel()
      });
      e.checkIntoGame();
    });
    cc.pvz.TAUtils.initShareKey();
    cc.pvz.TAUtils.initShareConfig();
  },
  checkIntoGame: function checkIntoGame() {
    if (1 == cc.pvz.PlayerData.getStageLevel()) {
      cc.pvz.runtimeData.init(0, 1);
      cc.director.loadScene("game1");
      cc.pvz.TAUtils.trackBackpack(1);
    } else {
      cc.director.loadScene("mainUI");
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL2xvYWRpbmcuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJwcm9ncmVzc0JhciIsIlByb2dyZXNzQmFyIiwib25Mb2FkIiwiZGVidWciLCJzZXREaXNwbGF5U3RhdHMiLCJlIiwiUmVuZGVyRmxvdyIsInByb3RvdHlwZSIsIl91cGRhdGVSZW5kZXJEYXRhIiwidCIsIl9yZW5kZXJDb21wb25lbnQiLCJfYXNzZW1ibGVyIiwiX3JlbmRlckZsYWciLCJGTEFHX1VQREFURV9SRU5ERVJfREFUQSIsIl9uZXh0IiwiX2Z1bmMiLCJjYWxsIiwiX3JlbmRlciIsIm8iLCJfcG9zdFJlbmRlciIsInN0YXJ0IiwibWFjcm8iLCJFTkFCTEVfTVVMVElfVE9VQ0giLCJwdnoiLCJUQVV0aWxzIiwiaW5pdCIsInRvdGFsIiwid2FpdGVkIiwibG9hZFN1YnBhY2thZ2UiLCJzaW5nbGVUaW1lIiwiTWF0aCIsIm1heCIsImJhclByb2dyZXNzIiwicHJvZ3Jlc3MiLCJ1cGRhdGVQcm9ncmVzcyIsInR3ZWVuIiwidG8iLCJpbml0RGF0YSIsInN5cyIsInBsYXRmb3JtIiwiV0VDSEFUX0dBTUUiLCJ3eCIsInNldEtlZXBTY3JlZW5PbiIsImtlZXBTY3JlZW5PbiIsIm9uRXJyb3IiLCJ0cmFjayIsIm1lc3NhZ2UiLCJzdGFjayIsImlzQ29udHJvbEFkIiwiQWRVdGlscyIsImluaXRBbGxBZHMiLCJQbGF5ZXJEYXRhIiwiaW5pdFBsYXllckRhdGEiLCJvblJlc1JlYWR5Iiwib25Qcm9ncmVzc0NoYW5nZWQiLCJvbkFsbFJlc1JlYWR5IiwiYXNzZXRNYW5hZ2VyIiwiZ2V0QnVuZGxlIiwibG9hZEJ1bmRsZSIsImNvbnNvbGUiLCJsb2ciLCJjbG91ZCIsImxvZ2luIiwiYmFzZURhdGEiLCJsZW5ndGgiLCJKU09OIiwicGFyc2UiLCJwbGF5ZXIiLCJkYXRhVmVyc2lvbiIsImFjaGlldmVQcm8iLCJoYXNPd25Qcm9wZXJ0eSIsIkdhbWVDb25maWciLCJNaXNzaW9uVHlwZSIsImEiLCJwb3N0TG9hZERhdGEiLCJ1cGxvYWRMb2dpbkRhdGEiLCJ1aWQiLCJuYW1lIiwibGV2ZWwiLCJnZXRTdGFnZUxldmVsIiwiY2hlY2tJbnRvR2FtZSIsImluaXRTaGFyZUtleSIsImluaXRTaGFyZUNvbmZpZyIsInJ1bnRpbWVEYXRhIiwiZGlyZWN0b3IiLCJsb2FkU2NlbmUiLCJ0cmFja0JhY2twYWNrIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNMLFdBQVNELEVBQUUsQ0FBQ0UsU0FEUDtFQUVMQyxVQUFVLEVBQUU7SUFDUkMsV0FBVyxFQUFFSixFQUFFLENBQUNLO0VBRFIsQ0FGUDtFQUtMQyxNQUFNLEVBQUUsa0JBQVk7SUFDaEJOLEVBQUUsQ0FBQ08sS0FBSCxDQUFTQyxlQUFULENBQXlCLENBQUMsQ0FBMUI7SUFDQSxJQUFJQyxDQUFDLEdBQUdULEVBQUUsQ0FBQ1UsVUFBSCxDQUFjQyxTQUFkLENBQXdCQyxpQkFBaEM7O0lBQ0FaLEVBQUUsQ0FBQ1UsVUFBSCxDQUFjQyxTQUFkLENBQXdCQyxpQkFBeEIsR0FBNEMsVUFBVUMsQ0FBVixFQUFhO01BQ3JELElBQUksQ0FBQ0EsQ0FBQyxDQUFDQyxnQkFBSCxJQUF1QixDQUFDRCxDQUFDLENBQUNDLGdCQUFGLENBQW1CQyxVQUEvQyxFQUEyRDtRQUN2REYsQ0FBQyxDQUFDRyxXQUFGLElBQWlCLENBQUNoQixFQUFFLENBQUNVLFVBQUgsQ0FBY08sdUJBQWhDO1FBQ0EsT0FBTyxLQUFLLEtBQUtDLEtBQUwsQ0FBV0MsS0FBWCxDQUFpQk4sQ0FBakIsQ0FBWjtNQUNIOztNQUNESixDQUFDLENBQUNXLElBQUYsQ0FBTyxJQUFQLEVBQWFQLENBQWI7SUFDSCxDQU5EOztJQU9BLElBQUlBLENBQUMsR0FBR2IsRUFBRSxDQUFDVSxVQUFILENBQWNDLFNBQWQsQ0FBd0JVLE9BQWhDOztJQUNBckIsRUFBRSxDQUFDVSxVQUFI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SkksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHByb2dyZXNzQmFyOiBjYy5Qcm9ncmVzc0JhclxuICAgIH0sXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLmRlYnVnLnNldERpc3BsYXlTdGF0cyghMSk7XG4gICAgICAgIHZhciBlID0gY2MuUmVuZGVyRmxvdy5wcm90b3R5cGUuX3VwZGF0ZVJlbmRlckRhdGE7XG4gICAgICAgIGNjLlJlbmRlckZsb3cucHJvdG90eXBlLl91cGRhdGVSZW5kZXJEYXRhID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIGlmICghdC5fcmVuZGVyQ29tcG9uZW50IHx8ICF0Ll9yZW5kZXJDb21wb25lbnQuX2Fzc2VtYmxlcikge1xuICAgICAgICAgICAgICAgIHQuX3JlbmRlckZsYWcgJj0gfmNjLlJlbmRlckZsb3cuRkxBR19VUERBVEVfUkVOREVSX0RBVEE7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHZvaWQgdGhpcy5fbmV4dC5fZnVuYyh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGUuY2FsbCh0aGlzLCB0KTtcbiAgICAgICAgfTtcbiAgICAgICAgdmFyIHQgPSBjYy5SZW5kZXJGbG93LnByb3RvdHlwZS5fcmVuZGVyO1xuICAgICAgICBjYy5SZW5kZXJGbG93LnByb3RvdHlwZS5fcmVuZGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLl9yZW5kZXJDb21wb25lbnQgJiYgZS5fcmVuZGVyQ29tcG9uZW50Ll9hc3NlbWJsZXIpIHtcbiAgICAgICAgICAgICAgICB0LmNhbGwodGhpcywgZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX25leHQuX2Z1bmMoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIHZhciBvID0gY2MuUmVuZGVyRmxvdy5wcm90b3R5cGUuX3Bvc3RSZW5kZXI7XG4gICAgICAgIGNjLlJlbmRlckZsb3cucHJvdG90eXBlLl9wb3N0UmVuZGVyID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLl9yZW5kZXJDb21wb25lbnQgJiYgZS5fcmVuZGVyQ29tcG9uZW50Ll9hc3NlbWJsZXIpIHtcbiAgICAgICAgICAgICAgICBvLmNhbGwodGhpcywgZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX25leHQuX2Z1bmMoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgfSxcbiAgICBzdGFydDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5tYWNyby5FTkFCTEVfTVVMVElfVE9VQ0ggPSAhMTtcbiAgICAgICAgY2MucHZ6LlRBVXRpbHMuaW5pdCgpO1xuICAgICAgICB0aGlzLnRvdGFsID0gMTtcbiAgICAgICAgdGhpcy53YWl0ZWQgPSAxO1xuICAgICAgICB0aGlzLmxvYWRTdWJwYWNrYWdlKFwidWlJbWFnZVwiKTtcbiAgICAgICAgdGhpcy5sb2FkU3VicGFja2FnZShcIm1haW5VSVwiKTtcbiAgICAgICAgdGhpcy5sb2FkU3VicGFja2FnZShcImFjdG9yc1wiKTtcbiAgICAgICAgdGhpcy5sb2FkU3VicGFja2FnZShcImdhbWVcIik7XG4gICAgICAgIHRoaXMuc2luZ2xlVGltZSA9IE1hdGgubWF4KDAuMywgMS44IC8gdGhpcy50b3RhbCk7XG4gICAgICAgIHRoaXMuYmFyUHJvZ3Jlc3MgPSAwO1xuICAgICAgICB0aGlzLnByb2dyZXNzQmFyLnByb2dyZXNzID0gMDtcbiAgICAgICAgdGhpcy51cGRhdGVQcm9ncmVzcygpO1xuICAgIH0sXG4gICAgdXBkYXRlUHJvZ3Jlc3M6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSAodGhpcy5iYXJQcm9ncmVzcyArIDEpIC8gdGhpcy50b3RhbDtcbiAgICAgICAgY2MudHdlZW4odGhpcy5wcm9ncmVzc0JhcilcbiAgICAgICAgICAgIC50byh0aGlzLnNpbmdsZVRpbWUsIHtcbiAgICAgICAgICAgICAgICBwcm9ncmVzczogZVxuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5zdGFydCgpO1xuICAgIH0sXG4gICAgaW5pdERhdGE6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5wbGF0Zm9ybSA9PSBjYy5zeXMuV0VDSEFUX0dBTUUpIHtcbiAgICAgICAgICAgIHd4LnNldEtlZXBTY3JlZW5Pbih7XG4gICAgICAgICAgICAgICAga2VlcFNjcmVlbk9uOiAhMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB3eC5vbkVycm9yKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgY2MucHZ6LlRBVXRpbHMudHJhY2soXCJlcnJvclwiLCB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGUubWVzc2FnZSxcbiAgICAgICAgICAgICAgICAgICAgc3RhY2s6IGUuc3RhY2tcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNjLmlzQ29udHJvbEFkID0gITA7XG4gICAgICAgIGNjLnB2ei5BZFV0aWxzLmluaXRBbGxBZHMoKTtcbiAgICAgICAgY2MucHZ6LlBsYXllckRhdGEuaW5pdFBsYXllckRhdGEoKTtcbiAgICAgICAgdGhpcy5vblJlc1JlYWR5KCk7XG4gICAgfSxcbiAgICBvblByb2dyZXNzQ2hhbmdlZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmJhclByb2dyZXNzKys7XG4gICAgICAgIHRoaXMudXBkYXRlUHJvZ3Jlc3MoKTtcbiAgICB9LFxuICAgIG9uUmVzUmVhZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vblByb2dyZXNzQ2hhbmdlZCgpO1xuICAgICAgICB0aGlzLndhaXRlZCAtPSAxO1xuICAgICAgICBpZiAoMSA9PSB0aGlzLndhaXRlZCkge1xuICAgICAgICAgICAgdGhpcy5pbml0RGF0YSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKDAgPT0gdGhpcy53YWl0ZWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uQWxsUmVzUmVhZHkoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgbG9hZFN1YnBhY2thZ2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgaWYgKGNjLmFzc2V0TWFuYWdlci5nZXRCdW5kbGUoZSkpIHtcbiAgICAgICAgICAgIHRoaXMub25SZXNSZWFkeSgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy50b3RhbCsrO1xuICAgICAgICAgICAgdGhpcy53YWl0ZWQrKztcbiAgICAgICAgICAgIGNjLmFzc2V0TWFuYWdlci5sb2FkQnVuZGxlKGUsIG51bGwsIGZ1bmN0aW9uIChvKSB7XG4gICAgICAgICAgICAgICAgaWYgKG8pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2FkIHN1YnBhY2thZ2UgXCIgKyBlICsgXCIgZmFpbDpcIiwgbyk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJsb2FkIHN1YnBhY2thZ2UgXCIgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgdC5vblJlc1JlYWR5KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQWxsUmVzUmVhZHk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICBjYy5wdnouY2xvdWQubG9naW4oZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKGNjLnB2ei5jbG91ZC5iYXNlRGF0YS5sZW5ndGggPiAyKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBKU09OLnBhcnNlKGNjLnB2ei5jbG91ZC5iYXNlRGF0YSk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzZXJ2ZXIgdDpcIiwgdC50LCBcIiwgbG9jYWwgdDpcIiwgY2MucGxheWVyLnQsIFwicyB2ZXJzaW9uOlwiLCB0LmRhdGFWZXJzaW9uKTtcbiAgICAgICAgICAgICAgICB2YXIgbztcbiAgICAgICAgICAgICAgICBpZiAoY2MucGxheWVyLmFjaGlldmVQcm8uaGFzT3duUHJvcGVydHkoY2MucHZ6LkdhbWVDb25maWcuTWlzc2lvblR5cGVbXCLoo4XlpIfmgLvnrYnnuqduXCJdKSkge1xuICAgICAgICAgICAgICAgICAgICBvID0gY2MucGxheWVyLmFjaGlldmVQcm9bY2MucHZ6LkdhbWVDb25maWcuTWlzc2lvblR5cGVbXCLoo4XlpIfmgLvnrYnnuqduXCJdXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBvID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIGE7XG4gICAgICAgICAgICAgICAgaWYgKHQuYWNoaWV2ZVByby5oYXNPd25Qcm9wZXJ0eShjYy5wdnouR2FtZUNvbmZpZy5NaXNzaW9uVHlwZVtcIuijheWkh+aAu+etiee6p25cIl0pKSB7XG4gICAgICAgICAgICAgICAgICAgIGEgPSB0LmFjaGlldmVQcm9bY2MucHZ6LkdhbWVDb25maWcuTWlzc2lvblR5cGVbXCLoo4XlpIfmgLvnrYnnuqduXCJdXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBhID0gMDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKHQudCA+IGNjLnBsYXllci50IHx8IGEgPiBvKSB7XG4gICAgICAgICAgICAgICAgICAgIGNjLnBsYXllciA9IHQ7XG4gICAgICAgICAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLnBvc3RMb2FkRGF0YSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNjLnB2ei5UQVV0aWxzLnVwbG9hZExvZ2luRGF0YSh7XG4gICAgICAgICAgICAgICAgdWlkOiBjYy5wdnouY2xvdWQudWlkLFxuICAgICAgICAgICAgICAgIG5hbWU6IGNjLnB2ei5jbG91ZC5uYW1lLFxuICAgICAgICAgICAgICAgIGxldmVsOiBjYy5wdnouUGxheWVyRGF0YS5nZXRTdGFnZUxldmVsKClcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZS5jaGVja0ludG9HYW1lKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjYy5wdnouVEFVdGlscy5pbml0U2hhcmVLZXkoKTtcbiAgICAgICAgY2MucHZ6LlRBVXRpbHMuaW5pdFNoYXJlQ29uZmlnKCk7XG4gICAgfSxcbiAgICBjaGVja0ludG9HYW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgxID09IGNjLnB2ei5QbGF5ZXJEYXRhLmdldFN0YWdlTGV2ZWwoKSkge1xuICAgICAgICAgICAgY2MucHZ6LnJ1bnRpbWVEYXRhLmluaXQoMCwgMSk7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoXCJnYW1lMVwiKTtcbiAgICAgICAgICAgIGNjLnB2ei5UQVV0aWxzLnRyYWNrQmFja3BhY2soMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoXCJtYWluVUlcIik7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdfQ==