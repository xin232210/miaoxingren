
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/scripts/Tool.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '90351EISPtCoJXWzb3n6Exa', 'Tool');
// scripts/Tool.js

"use strict";

var $subpub = require("./Subpub");

var n = function () {
  function e() {}

  e.init = function (t) {
    var o = cc.find("Canvas");
    e.ScreenWH[0] = o.width;
    e.ScreenWH[1] = o.height;
    e.BattlegroundBoard[0] = t.x - t.width / 2;
    e.BattlegroundBoard[1] = t.x + t.width / 2;
    e.BattlegroundBoard[2] = t.y - t.height / 2;
    e.BattlegroundBoard[3] = t.y + t.height / 2;
    cc.director.getCollisionManager().enabled = !0;
  };

  e.isInBattleGround = function (t, o) {
    return t >= e.BattlegroundBoard[0] - 100 && t <= e.BattlegroundBoard[1] + 100 && o >= e.BattlegroundBoard[2] - 100 && o <= e.BattlegroundBoard[3] + 100;
  };

  e.getAngle = function (e, t) {
    if (0 === e) {
      if (0 === t) {
        return 0;
      } else {
        if (t > 0) {
          return 90;
        } else {
          return 270;
        }
      }
    }

    if (0 === t) {
      if (e > 0) {
        return 0;
      } else {
        return 180;
      }
    }

    var o = 180 * Math.atan(Math.abs(t) / Math.abs(e)) / Math.PI;

    if (t > 0) {
      if (e < 0) {
        o = 180 - o;
      }
    } else {
      if (e > 0) {
        o = 360 - o;
      } else {
        o = 180 + o;
      }
    }

    return o;
  };

  e.setValueTo = function (e, t, o) {
    if (e < t) {
      return t;
    } else {
      if (e > o) {
        return o;
      } else {
        return e;
      }
    }
  };

  e.isInEllipse = function (e, t, o, a, n, i) {
    return (e - o) * (e - o) / (n * n) + (t - a) * (t - a) / (i * i) <= 1;
  };

  e.isInRect = function (e, t, o, a, n, i) {
    return e >= o - n / 2 && e <= o + n / 2 && t >= a - i / 2 && t <= a + i / 2;
  };

  e.randomPointInNode = function (e) {
    return [e.x - e.width / 2 + Math.random() * e.width, e.y - e.height / 2 + Math.random() * e.height];
  };

  e.randomInt = function (e, t) {
    return Math.floor(Math.random() * (t - e + 1)) + e;
  };

  e.randomFromArr = function (e) {
    return e[Math.floor(Math.random() * e.length)];
  };

  e.randomFromArr2 = function (e, t) {
    if (e.length <= t) {
      return e;
    }

    if (t <= 0) {
      return [];
    }

    var o = [];
    var a = e.map(function (e) {
      return e;
    });

    for (var n = 0; n < t; n++) {
      var i = Math.floor(Math.random() * (a.length - n));
      o.push(a[i]);
      a[i] = a[a.length - 1 - n];
    }

    return o;
  };

  e.randomByWeight = function (e, t) {
    if (void 0 === t) {
      t = [];
    }

    var o = [];
    var a = 0;
    var n = {};
    t.map(function (e) {
      n[e] = 1;
    });

    for (var i = 0; i < e.length; i++) {
      if (n[i]) {//
      } else {
        o.push({
          idx: i,
          w: e[i]
        });
        a += e[i];
      }
    }

    var c = Math.random() * a;

    for (i = 0; i < o.length; i++) {
      if (c < o[i].w) {
        return o[i].idx;
      }

      c -= o[i].w;
    }

    console.log("Tools.randombyWeight发生未知错误：", o, a, c);
  };

  e.getPrefab = function (e, t, o) {
    var a = e.getChildByName(o);

    if (a) {//
    } else {
      (a = cc.instantiate(t)).setParent(e);
      a.name = o;
    }

    a.active = !0;
    return a;
  };

  e.showVideoAd = function (e, t) {
    cc.pvz.AdUtils.showAdRewardVideo(e, function (e) {
      if (e) {
        t();
      }
    });
  };

  e.formatBigNum3 = function (e) {
    if (e < 1e4) {
      return "" + e;
    } else {
      if (e % 1e3 == 0) {
        return e / 1e3 + "K";
      } else {
        return (e / 1e3).toFixed(1) + "K";
      }
    }
  };

  e.resetGamePauseInfo = function () {
    e.gameTimeScale = 1;
    e.gamePause = 0;
  };

  e.pauseGame = function () {
    e.gamePause = 1;
    $subpub["default"].publishEx("Spine.SetTimeScale", {
      timeScale: 0
    });
  };

  e.resumeGame = function () {
    e.gamePause = 0;
    $subpub["default"].publishEx("Spine.SetTimeScale", {
      timeScale: e.gameTimeScale
    });
  };

  e.setGameTimeScale = function (t) {
    e.gameTimeScale = t;

    if (e.gamePause) {//
    } else {
      $subpub["default"].publishEx("Spine.SetTimeScale", {
        timeScale: t
      });
    }
  };

  e.copyArr = function (t) {
    if (void 0 === t) {
      t = [];
    }

    var o = [];

    for (var a = 0; a < t.length; a++) {
      if (Array.isArray(t[a])) {
        o.push(e.copyArr(t[a]));
      } else {
        o.push(t[a]);
      }
    }

    return o;
  };

  e.getRGBColor = function (e) {
    var t = [0, 0, 0];

    for (var o = 0; o < 3; o++) {
      t[o] = parseInt("0x" + e[2 * o + 1] + e[2 * o + 2]);
    }

    return new cc.Color(t[0], t[1], t[2]);
  };

  e.shuffle = function (e) {
    for (var t = 0; t < e.length; t++) {
      var o = Math.floor(Math.random() * (e.length - t)) + t;
      var a = e[t];
      e[t] = e[o];
      e[o] = a;
    }

    return e;
  };

  e.ScreenWH = [0, 0];
  e.BattlegroundBoard = [0, 0, 0, 0];
  e.inSceneTest = 1;
  e.gameTimeScale = 1;
  e.gamePause = 0;
  return e;
}();

exports["default"] = n;

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9zY3JpcHRzL1Rvb2wuanMiXSwibmFtZXMiOlsiJHN1YnB1YiIsInJlcXVpcmUiLCJuIiwiZSIsImluaXQiLCJ0IiwibyIsImNjIiwiZmluZCIsIlNjcmVlbldIIiwid2lkdGgiLCJoZWlnaHQiLCJCYXR0bGVncm91bmRCb2FyZCIsIngiLCJ5IiwiZGlyZWN0b3IiLCJnZXRDb2xsaXNpb25NYW5hZ2VyIiwiZW5hYmxlZCIsImlzSW5CYXR0bGVHcm91bmQiLCJnZXRBbmdsZSIsIk1hdGgiLCJhdGFuIiwiYWJzIiwiUEkiLCJzZXRWYWx1ZVRvIiwiaXNJbkVsbGlwc2UiLCJhIiwiaSIsImlzSW5SZWN0IiwicmFuZG9tUG9pbnRJbk5vZGUiLCJyYW5kb20iLCJyYW5kb21JbnQiLCJmbG9vciIsInJhbmRvbUZyb21BcnIiLCJsZW5ndGgiLCJyYW5kb21Gcm9tQXJyMiIsIm1hcCIsInB1c2giLCJyYW5kb21CeVdlaWdodCIsImlkeCIsInciLCJjIiwiY29uc29sZSIsImxvZyIsImdldFByZWZhYiIsImdldENoaWxkQnlOYW1lIiwiaW5zdGFudGlhdGUiLCJzZXRQYXJlbnQiLCJuYW1lIiwiYWN0aXZlIiwic2hvd1ZpZGVvQWQiLCJwdnoiLCJBZFV0aWxzIiwic2hvd0FkUmV3YXJkVmlkZW8iLCJmb3JtYXRCaWdOdW0zIiwidG9GaXhlZCIsInJlc2V0R2FtZVBhdXNlSW5mbyIsImdhbWVUaW1lU2NhbGUiLCJnYW1lUGF1c2UiLCJwYXVzZUdhbWUiLCJwdWJsaXNoRXgiLCJ0aW1lU2NhbGUiLCJyZXN1bWVHYW1lIiwic2V0R2FtZVRpbWVTY2FsZSIsImNvcHlBcnIiLCJBcnJheSIsImlzQXJyYXkiLCJnZXRSR0JDb2xvciIsInBhcnNlSW50IiwiQ29sb3IiLCJzaHVmZmxlIiwiaW5TY2VuZVRlc3QiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLE9BQU8sR0FBR0MsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0FB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ZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyICRzdWJwdWIgPSByZXF1aXJlKFwiLi9TdWJwdWJcIik7XG52YXIgbiA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gZSgpIHt9XG4gICAgZS5pbml0ID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdmFyIG8gPSBjYy5maW5kKFwiQ2FudmFzXCIpO1xuICAgICAgICBlLlNjcmVlbldIWzBdID0gby53aWR0aDtcbiAgICAgICAgZS5TY3JlZW5XSFsxXSA9IG8uaGVpZ2h0O1xuICAgICAgICBlLkJhdHRsZWdyb3VuZEJvYXJkWzBdID0gdC54IC0gdC53aWR0aCAvIDI7XG4gICAgICAgIGUuQmF0dGxlZ3JvdW5kQm9hcmRbMV0gPSB0LnggKyB0LndpZHRoIC8gMjtcbiAgICAgICAgZS5CYXR0bGVncm91bmRCb2FyZFsyXSA9IHQueSAtIHQuaGVpZ2h0IC8gMjtcbiAgICAgICAgZS5CYXR0bGVncm91bmRCb2FyZFszXSA9IHQueSArIHQuaGVpZ2h0IC8gMjtcbiAgICAgICAgY2MuZGlyZWN0b3IuZ2V0Q29sbGlzaW9uTWFuYWdlcigpLmVuYWJsZWQgPSAhMDtcbiAgICB9O1xuICAgIGUuaXNJbkJhdHRsZUdyb3VuZCA9IGZ1bmN0aW9uICh0LCBvKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICB0ID49IGUuQmF0dGxlZ3JvdW5kQm9hcmRbMF0gLSAxMDAgJiZcbiAgICAgICAgICAgIHQgPD0gZS5CYXR0bGVncm91bmRCb2FyZFsxXSArIDEwMCAmJlxuICAgICAgICAgICAgbyA+PSBlLkJhdHRsZWdyb3VuZEJvYXJkWzJdIC0gMTAwICYmXG4gICAgICAgICAgICBvIDw9IGUuQmF0dGxlZ3JvdW5kQm9hcmRbM10gKyAxMDBcbiAgICAgICAgKTtcbiAgICB9O1xuICAgIGUuZ2V0QW5nbGUgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICBpZiAoMCA9PT0gZSkge1xuICAgICAgICAgICAgaWYgKDAgPT09IHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiA5MDtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gMjcwO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoMCA9PT0gdCkge1xuICAgICAgICAgICAgaWYgKGUgPiAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDA7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiAxODA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG8gPSAoMTgwICogTWF0aC5hdGFuKE1hdGguYWJzKHQpIC8gTWF0aC5hYnMoZSkpKSAvIE1hdGguUEk7XG4gICAgICAgIGlmICh0ID4gMCkge1xuICAgICAgICAgICAgaWYgKGUgPCAwKSB7XG4gICAgICAgICAgICAgICAgbyA9IDE4MCAtIG87XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZSA+IDApIHtcbiAgICAgICAgICAgICAgICBvID0gMzYwIC0gbztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgbyA9IDE4MCArIG87XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG87XG4gICAgfTtcbiAgICBlLnNldFZhbHVlVG8gPSBmdW5jdGlvbiAoZSwgdCwgbykge1xuICAgICAgICBpZiAoZSA8IHQpIHtcbiAgICAgICAgICAgIHJldHVybiB0O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKGUgPiBvKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG87XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfTtcbiAgICBlLmlzSW5FbGxpcHNlID0gZnVuY3Rpb24gKGUsIHQsIG8sIGEsIG4sIGkpIHtcbiAgICAgICAgcmV0dXJuICgoZSAtIG8pICogKGUgLSBvKSkgLyAobiAqIG4pICsgKCh0IC0gYSkgKiAodCAtIGEpKSAvIChpICogaSkgPD0gMTtcbiAgICB9O1xuICAgIGUuaXNJblJlY3QgPSBmdW5jdGlvbiAoZSwgdCwgbywgYSwgbiwgaSkge1xuICAgICAgICByZXR1cm4gZSA+PSBvIC0gbiAvIDIgJiYgZSA8PSBvICsgbiAvIDIgJiYgdCA+PSBhIC0gaSAvIDIgJiYgdCA8PSBhICsgaSAvIDI7XG4gICAgfTtcbiAgICBlLnJhbmRvbVBvaW50SW5Ob2RlID0gZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgcmV0dXJuIFtlLnggLSBlLndpZHRoIC8gMiArIE1hdGgucmFuZG9tKCkgKiBlLndpZHRoLCBlLnkgLSBlLmhlaWdodCAvIDIgKyBNYXRoLnJhbmRvbSgpICogZS5oZWlnaHRdO1xuICAgIH07XG4gICAgZS5yYW5kb21JbnQgPSBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogKHQgLSBlICsgMSkpICsgZTtcbiAgICB9O1xuICAgIGUucmFuZG9tRnJvbUFyciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHJldHVybiBlW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGUubGVuZ3RoKV07XG4gICAgfTtcbiAgICBlLnJhbmRvbUZyb21BcnIyID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgaWYgKGUubGVuZ3RoIDw9IHQpIHtcbiAgICAgICAgICAgIHJldHVybiBlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0IDw9IDApIHtcbiAgICAgICAgICAgIHJldHVybiBbXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbyA9IFtdO1xuICAgICAgICB2YXIgYSA9IGUubWFwKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgdDsgbisrKSB7XG4gICAgICAgICAgICB2YXIgaSA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIChhLmxlbmd0aCAtIG4pKTtcbiAgICAgICAgICAgIG8ucHVzaChhW2ldKTtcbiAgICAgICAgICAgIGFbaV0gPSBhW2EubGVuZ3RoIC0gMSAtIG5dO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvO1xuICAgIH07XG4gICAgZS5yYW5kb21CeVdlaWdodCA9IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIGlmICh2b2lkIDAgPT09IHQpIHtcbiAgICAgICAgICAgIHQgPSBbXTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbyA9IFtdO1xuICAgICAgICB2YXIgYSA9IDA7XG4gICAgICAgIHZhciBuID0ge307XG4gICAgICAgIHQubWFwKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBuW2VdID0gMTtcbiAgICAgICAgfSk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKG5baV0pIHtcbiAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBvLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBpZHg6IGksXG4gICAgICAgICAgICAgICAgICAgIHc6IGVbaV1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBhICs9IGVbaV07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGMgPSBNYXRoLnJhbmRvbSgpICogYTtcbiAgICAgICAgZm9yIChpID0gMDsgaSA8IG8ubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmIChjIDwgb1tpXS53KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIG9baV0uaWR4O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgYyAtPSBvW2ldLnc7XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJUb29scy5yYW5kb21ieVdlaWdodOWPkeeUn+acquefpemUmeivr++8mlwiLCBvLCBhLCBjKTtcbiAgICB9O1xuICAgIGUuZ2V0UHJlZmFiID0gZnVuY3Rpb24gKGUsIHQsIG8pIHtcbiAgICAgICAgdmFyIGEgPSBlLmdldENoaWxkQnlOYW1lKG8pO1xuICAgICAgICBpZiAoYSkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIChhID0gY2MuaW5zdGFudGlhdGUodCkpLnNldFBhcmVudChlKTtcbiAgICAgICAgICAgIGEubmFtZSA9IG87XG4gICAgICAgIH1cbiAgICAgICAgYS5hY3RpdmUgPSAhMDtcbiAgICAgICAgcmV0dXJuIGE7XG4gICAgfTtcbiAgICBlLnNob3dWaWRlb0FkID0gZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgY2MucHZ6LkFkVXRpbHMuc2hvd0FkUmV3YXJkVmlkZW8oZSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGUuZm9ybWF0QmlnTnVtMyA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmIChlIDwgMWU0KSB7XG4gICAgICAgICAgICByZXR1cm4gXCJcIiArIGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoZSAlIDFlMyA9PSAwKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGUgLyAxZTMgKyBcIktcIjtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIChlIC8gMWUzKS50b0ZpeGVkKDEpICsgXCJLXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGUucmVzZXRHYW1lUGF1c2VJbmZvID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBlLmdhbWVUaW1lU2NhbGUgPSAxO1xuICAgICAgICBlLmdhbWVQYXVzZSA9IDA7XG4gICAgfTtcbiAgICBlLnBhdXNlR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZS5nYW1lUGF1c2UgPSAxO1xuICAgICAgICAkc3VicHViLmRlZmF1bHQucHVibGlzaEV4KFwiU3BpbmUuU2V0VGltZVNjYWxlXCIsIHtcbiAgICAgICAgICAgIHRpbWVTY2FsZTogMFxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIGUucmVzdW1lR2FtZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZS5nYW1lUGF1c2UgPSAwO1xuICAgICAgICAkc3VicHViLmRlZmF1bHQucHVibGlzaEV4KFwiU3BpbmUuU2V0VGltZVNjYWxlXCIsIHtcbiAgICAgICAgICAgIHRpbWVTY2FsZTogZS5nYW1lVGltZVNjYWxlXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgZS5zZXRHYW1lVGltZVNjYWxlID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgZS5nYW1lVGltZVNjYWxlID0gdDtcbiAgICAgICAgaWYgKGUuZ2FtZVBhdXNlKSB7XG4gICAgICAgICAgICAvL1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJHN1YnB1Yi5kZWZhdWx0LnB1Ymxpc2hFeChcIlNwaW5lLlNldFRpbWVTY2FsZVwiLCB7XG4gICAgICAgICAgICAgICAgdGltZVNjYWxlOiB0XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZS5jb3B5QXJyID0gZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gdCkge1xuICAgICAgICAgICAgdCA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvID0gW107XG4gICAgICAgIGZvciAodmFyIGEgPSAwOyBhIDwgdC5sZW5ndGg7IGErKykge1xuICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkodFthXSkpIHtcbiAgICAgICAgICAgICAgICBvLnB1c2goZS5jb3B5QXJyKHRbYV0pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgby5wdXNoKHRbYV0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHJldHVybiBvO1xuICAgIH07XG4gICAgZS5nZXRSR0JDb2xvciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0ID0gWzAsIDAsIDBdO1xuICAgICAgICBmb3IgKHZhciBvID0gMDsgbyA8IDM7IG8rKykge1xuICAgICAgICAgICAgdFtvXSA9IHBhcnNlSW50KFwiMHhcIiArIGVbMiAqIG8gKyAxXSArIGVbMiAqIG8gKyAyXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5ldyBjYy5Db2xvcih0WzBdLCB0WzFdLCB0WzJdKTtcbiAgICB9O1xuICAgIGUuc2h1ZmZsZSA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGZvciAodmFyIHQgPSAwOyB0IDwgZS5sZW5ndGg7IHQrKykge1xuICAgICAgICAgICAgdmFyIG8gPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAoZS5sZW5ndGggLSB0KSkgKyB0O1xuICAgICAgICAgICAgdmFyIGEgPSBlW3RdO1xuICAgICAgICAgICAgZVt0XSA9IGVbb107XG4gICAgICAgICAgICBlW29dID0gYTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZTtcbiAgICB9O1xuICAgIGUuU2NyZWVuV0ggPSBbMCwgMF07XG4gICAgZS5CYXR0bGVncm91bmRCb2FyZCA9IFswLCAwLCAwLCAwXTtcbiAgICBlLmluU2NlbmVUZXN0ID0gMTtcbiAgICBlLmdhbWVUaW1lU2NhbGUgPSAxO1xuICAgIGUuZ2FtZVBhdXNlID0gMDtcbiAgICByZXR1cm4gZTtcbn0pKCk7XG5leHBvcnRzLmRlZmF1bHQgPSBuO1xuIl19