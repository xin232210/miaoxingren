
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game/scripts/Bullet.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '61c0c6w9SxHAaqoxrMyiAta', 'Bullet');
// game/scripts/Bullet.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    sprite: cc.Sprite,
    spriteBundle: "",
    spritePath: "",
    spine: sp.Skeleton,
    spinePre: "",
    aoeHitEffect: !1,
    life: {
      "default": -1,
      tooltip: "毫秒，-1为出屏消失"
    },
    dieOutScreen: !0,
    speed: 500,
    buffSlow: !1,
    buffIce: !1,
    buffPoison: !1,
    dieKeepFrame: 0,
    hitCount: {
      "default": 1,
      tooltip: "攻击次数，默认1次攻击后消失，填2就穿透1次"
    },
    hitChangeAngle: !1,
    jsEffExclusive: !1,
    canReturn: !1
  },
  initBy: function initBy(t, e) {
    this.scene = t;
    this.lv = e;
    this.dieTimer = -1;
    this.hitCounter = this.hitCount;
    this.lifeTimer = -1;

    if (this.canReturn) {
      this.returnTimer = this.scene.setTimeout(this.doReturnLogic.bind(this), this.life);
      this.life += this.life;
    }

    if (this.life > 0) {
      this.lifeTimer = this.scene.setTimeout(this.onLifeEnd.bind(this), this.life);
    }
  },
  moveByAngle: function moveByAngle(t) {
    if (this.speed > 0) {
      var e = this.speed / 60;
      var i = t * Math.PI / 180;
      this.moveDelta = cc.v2(e * Math.cos(i), e * Math.sin(i));
    }

    this.node.angle = t;
  },
  doReturnLogic: function doReturnLogic() {
    this.moveDelta = cc.v2(-this.moveDelta.x, -this.moveDelta.y);
  },
  onLifeEnd: function onLifeEnd() {
    this.node.parent = null;
  },
  onMoveEnded: function onMoveEnded() {
    if (-1 != this.lifeTimer) {
      this.scene.clearTimeout(this.lifeTimer);
      this.lifeTimer = -1;
    }

    this.node.parent = null;
  },
  update: function update() {
    if (!this.scene.timePaused && this.moveDelta) {
      var t = this.moveDelta.mul(cc.director.getScheduler().getTimeScale());
      this.node.position = this.node.position.add(t);
    }
  },
  onHitEnemy: function onHitEnemy(t) {
    var e = this;
    this.hitCounter--;

    if (this.hitCounter <= 0) {
      t.enabled = !1;
      -1 != this.lifeTimer && (this.scene.clearTimeout(this.lifeTimer), this.lifeTimer = -1);

      if (this.dieKeepFrame > 0) {
        -1 == this.dieTimer && (this.dieTimer = this.scene.setTimeout(function () {
          e.node.parent = null;
        }, 1e3 * this.dieKeepFrame / 60));
      } else {
        this.node.parent = null;
      }
    } else if (this.hitChangeAngle) {
      var i = this.scene.chooseEnemyByBullet(this);

      if (i) {
        var n = this.node.position;
        var o = i.node.position.add(cc.v2(0, i.centerY)).sub(n);
        var s = Math.atan2(o.y, o.x);
        this.moveByAngle(180 * s / Math.PI);
      }
    }
  },
  doCollisionLogic: function doCollisionLogic(t, e) {
    if (1 != t.tag) {
      var i = t.getComponent("Enemy");

      if (i && i.hp > 0 && i != this.excludeEnemy) {
        this.a.doBulletAttLogic(this, i);
        this.onHitEnemy(e);
      }
    } else {
      if (this.dieOutScreen) {
        this.onMoveEnded();
      }
    }
  },
  onCollisionEnter: function onCollisionEnter(t, e) {
    if (e.enabled) {
      this.doCollisionLogic(t, e);
    }
  },
  onRangePoisonEnter: function onRangePoisonEnter(t) {
    var e = t.getComponent("Enemy");

    if (e && e.hp > 0) {
      e.addBuffPoison(this.a, 5e3, this.att);
    }
  },
  onAoeCollisionEnter: function onAoeCollisionEnter(t) {
    var e = t.getComponent("Enemy");

    if (e && e.hp > 0) {
      this.a.doBulletAttLogic(this, e);
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9nYW1lL3NjcmlwdHMvQnVsbGV0LmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwic3ByaXRlIiwiU3ByaXRlIiwic3ByaXRlQnVuZGxlIiwic3ByaXRlUGF0aCIsInNwaW5lIiwic3AiLCJTa2VsZXRvbiIsInNwaW5lUHJlIiwiYW9lSGl0RWZmZWN0IiwibGlmZSIsInRvb2x0aXAiLCJkaWVPdXRTY3JlZW4iLCJzcGVlZCIsImJ1ZmZTbG93IiwiYnVmZkljZSIsImJ1ZmZQb2lzb24iLCJkaWVLZWVwRnJhbWUiLCJoaXRDb3VudCIsImhpdENoYW5nZUFuZ2xlIiwianNFZmZFeGNsdXNpdmUiLCJjYW5SZXR1cm4iLCJpbml0QnkiLCJ0IiwiZSIsInNjZW5lIiwibHYiLCJkaWVUaW1lciIsImhpdENvdW50ZXIiLCJsaWZlVGltZXIiLCJyZXR1cm5UaW1lciIsInNldFRpbWVvdXQiLCJkb1JldHVybkxvZ2ljIiwiYmluZCIsIm9uTGlmZUVuZCIsIm1vdmVCeUFuZ2xlIiwiaSIsIk1hdGgiLCJQSSIsIm1vdmVEZWx0YSIsInYyIiwiY29zIiwic2luIiwibm9kZSIsImFuZ2xlIiwieCIsInkiLCJwYXJlbnQiLCJvbk1vdmVFbmRlZCIsImNsZWFyVGltZW91dCIsInVwZGF0ZSIsInRpbWVQYXVzZWQiLCJtdWwiLCJkaXJlY3RvciIsImdldFNjaGVkdWxlciIsImdldFRpbWVTY2FsZSIsInBvc2l0aW9uIiwiYWRkIiwib25IaXRFbmVteSIsImVuYWJsZWQiLCJjaG9vc2VFbmVteUJ5QnVsbGV0IiwibiIsIm8iLCJjZW50ZXJZIiwic3ViIiwicyIsImF0YW4yIiwiZG9Db2xsaXNpb25Mb2dpYyIsInRhZyIsImdldENvbXBvbmVudCIsImhwIiwiZXhjbHVkZUVuZW15IiwiYSIsImRvQnVsbGV0QXR0TG9naWMiLCJvbkNvbGxpc2lvbkVudGVyIiwib25SYW5nZVBvaXNvbkVudGVyIiwiYWRkQnVmZlBvaXNvbiIs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Q3pDLEtBQUtDLENBQUwsQ0FBT0MsZ0JBQVAsQ0FBd0IsSUFBeEIsRUFBOEJyQyxDQUE5QjtRQUNBLEtBQUtzQixVQUFMLENBQWdCbEMsQ0FBaEI7TUFDSDtJQUNKLENBTkQsTUFNTztNQUNILElBQUksS0FBS1osWUFBVCxFQUF1QjtRQUNuQixLQUFLb0MsV0FBTDtNQUNIO0lBQ0o7RUFDSixDQXhHSTtFQXlHTDBCLGdCQUFnQixFQUFFLDBCQUFVbkQsQ0FBVixFQUFhQyxDQUFiLEVBQWdCO0lBQzlCLElBQUlBLENBQUMsQ0FBQ21DLE9BQU4sRUFBZTtNQUNYLEtBQUtRLGdCQUFMLENBQXNCNUMsQ0FBdEIsRUFBeUJDLENBQXpCO0lBQ0g7RUFDSixDQTdHSTtFQThHTG1ELGtCQUFrQixFQUFFLDRCQUFVcEQsQ0FBVixFQUFhO0lBQzdCLElBQUlDLENBQUMsR0FBR0QsQ0FBQyxDQUFDOEMsWUFBRixDQUFlLE9BQWYsQ0FBUjs7SUFDQSxJQUFJN0MsQ0FBQyxJQUFJQSxDQUFDLENBQUM4QyxFQUFGLEdBQU8sQ0FBaEIsRUFBbUI7TUFDZjlDLENBQUMsQ0FBQ29ELGFBQUYsQ0FBZ0IsS0FBS0osQ0FBckIsRUFBd0IsR0FBeEIsRUFBNkIsS0FBS0ssR0FBbEM7SUFDSDtFQUNKLENBbkhJO0VBb0hMQyxtQkFBbUIsRUFBRSw2QkFBVXZELENBQVYsRUFBYTtJQUM5QixJQUFJQyxDQUFDLEdBQUdELENBQUMsQ0FBQzhDLFlBQUYsQ0FBZSxPQUFmLENBQVI7O0lBQ0EsSUFBSTdDLENBQUMsSUFBSUEsQ0FBQyxDQUFDOEMsRUFBRixHQUFPLENBQWhCLEVBQW1CO01BQ2YsS0FBS0UsQ0FBTCxDQUFPQyxnQkFBUCxDQUF3QixJQUF4QixFQUE4QmpELENBQTlCO0lBQ0g7RUFDSjtBQXpISSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgc3ByaXRlOiBjYy5TcHJpdGUsXG4gICAgICAgIHNwcml0ZUJ1bmRsZTogXCJcIixcbiAgICAgICAgc3ByaXRlUGF0aDogXCJcIixcbiAgICAgICAgc3BpbmU6IHNwLlNrZWxldG9uLFxuICAgICAgICBzcGluZVByZTogXCJcIixcbiAgICAgICAgYW9lSGl0RWZmZWN0OiAhMSxcbiAgICAgICAgbGlmZToge1xuICAgICAgICAgICAgZGVmYXVsdDogLTEsXG4gICAgICAgICAgICB0b29sdGlwOiBcIuavq+enku+8jC0x5Li65Ye65bGP5raI5aSxXCJcbiAgICAgICAgfSxcbiAgICAgICAgZGllT3V0U2NyZWVuOiAhMCxcbiAgICAgICAgc3BlZWQ6IDUwMCxcbiAgICAgICAgYnVmZlNsb3c6ICExLFxuICAgICAgICBidWZmSWNlOiAhMSxcbiAgICAgICAgYnVmZlBvaXNvbjogITEsXG4gICAgICAgIGRpZUtlZXBGcmFtZTogMCxcbiAgICAgICAgaGl0Q291bnQ6IHtcbiAgICAgICAgICAgIGRlZmF1bHQ6IDEsXG4gICAgICAgICAgICB0b29sdGlwOiBcIuaUu+WHu+asoeaVsO+8jOm7mOiupDHmrKHmlLvlh7vlkI7mtojlpLHvvIzloasy5bCx56m/6YCPMeasoVwiXG4gICAgICAgIH0sXG4gICAgICAgIGhpdENoYW5nZUFuZ2xlOiAhMSxcbiAgICAgICAganNFZmZFeGNsdXNpdmU6ICExLFxuICAgICAgICBjYW5SZXR1cm46ICExXG4gICAgfSxcbiAgICBpbml0Qnk6IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgIHRoaXMuc2NlbmUgPSB0O1xuICAgICAgICB0aGlzLmx2ID0gZTtcbiAgICAgICAgdGhpcy5kaWVUaW1lciA9IC0xO1xuICAgICAgICB0aGlzLmhpdENvdW50ZXIgPSB0aGlzLmhpdENvdW50O1xuICAgICAgICB0aGlzLmxpZmVUaW1lciA9IC0xO1xuICAgICAgICBpZiAodGhpcy5jYW5SZXR1cm4pIHtcbiAgICAgICAgICAgIHRoaXMucmV0dXJuVGltZXIgPSB0aGlzLnNjZW5lLnNldFRpbWVvdXQodGhpcy5kb1JldHVybkxvZ2ljLmJpbmQodGhpcyksIHRoaXMubGlmZSk7XG4gICAgICAgICAgICB0aGlzLmxpZmUgKz0gdGhpcy5saWZlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmxpZmUgPiAwKSB7XG4gICAgICAgICAgICB0aGlzLmxpZmVUaW1lciA9IHRoaXMuc2NlbmUuc2V0VGltZW91dCh0aGlzLm9uTGlmZUVuZC5iaW5kKHRoaXMpLCB0aGlzLmxpZmUpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBtb3ZlQnlBbmdsZTogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgaWYgKHRoaXMuc3BlZWQgPiAwKSB7XG4gICAgICAgICAgICB2YXIgZSA9IHRoaXMuc3BlZWQgLyA2MDtcbiAgICAgICAgICAgIHZhciBpID0gKHQgKiBNYXRoLlBJKSAvIDE4MDtcbiAgICAgICAgICAgIHRoaXMubW92ZURlbHRhID0gY2MudjIoZSAqIE1hdGguY29zKGkpLCBlICogTWF0aC5zaW4oaSkpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubm9kZS5hbmdsZSA9IHQ7XG4gICAgfSxcbiAgICBkb1JldHVybkxvZ2ljOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubW92ZURlbHRhID0gY2MudjIoLXRoaXMubW92ZURlbHRhLngsIC10aGlzLm1vdmVEZWx0YS55KTtcbiAgICB9LFxuICAgIG9uTGlmZUVuZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLm5vZGUucGFyZW50ID0gbnVsbDtcbiAgICB9LFxuICAgIG9uTW92ZUVuZGVkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICgtMSAhPSB0aGlzLmxpZmVUaW1lcikge1xuICAgICAgICAgICAgdGhpcy5zY2VuZS5jbGVhclRpbWVvdXQodGhpcy5saWZlVGltZXIpO1xuICAgICAgICAgICAgdGhpcy5saWZlVGltZXIgPSAtMTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm5vZGUucGFyZW50ID0gbnVsbDtcbiAgICB9LFxuICAgIHVwZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIXRoaXMuc2NlbmUudGltZVBhdXNlZCAmJiB0aGlzLm1vdmVEZWx0YSkge1xuICAgICAgICAgICAgdmFyIHQgPSB0aGlzLm1vdmVEZWx0YS5tdWwoY2MuZGlyZWN0b3IuZ2V0U2NoZWR1bGVyKCkuZ2V0VGltZVNjYWxlKCkpO1xuICAgICAgICAgICAgdGhpcy5ub2RlLnBvc2l0aW9uID0gdGhpcy5ub2RlLnBvc2l0aW9uLmFkZCh0KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25IaXRFbmVteTogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICB0aGlzLmhpdENvdW50ZXItLTtcbiAgICAgICAgaWYgKHRoaXMuaGl0Q291bnRlciA8PSAwKSB7XG4gICAgICAgICAgICB0LmVuYWJsZWQgPSAhMTtcbiAgICAgICAgICAgIC0xICE9IHRoaXMubGlmZVRpbWVyICYmICh0aGlzLnNjZW5lLmNsZWFyVGltZW91dCh0aGlzLmxpZmVUaW1lciksICh0aGlzLmxpZmVUaW1lciA9IC0xKSk7XG4gICAgICAgICAgICBpZiAodGhpcy5kaWVLZWVwRnJhbWUgPiAwKSB7XG4gICAgICAgICAgICAgICAgLTEgPT0gdGhpcy5kaWVUaW1lciAmJlxuICAgICAgICAgICAgICAgICAgICAodGhpcy5kaWVUaW1lciA9IHRoaXMuc2NlbmUuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLm5vZGUucGFyZW50ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgfSwgKDFlMyAqIHRoaXMuZGllS2VlcEZyYW1lKSAvIDYwKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMubm9kZS5wYXJlbnQgPSBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaGl0Q2hhbmdlQW5nbGUpIHtcbiAgICAgICAgICAgIHZhciBpID0gdGhpcy5zY2VuZS5jaG9vc2VFbmVteUJ5QnVsbGV0KHRoaXMpO1xuICAgICAgICAgICAgaWYgKGkpIHtcbiAgICAgICAgICAgICAgICB2YXIgbiA9IHRoaXMubm9kZS5wb3NpdGlvbjtcbiAgICAgICAgICAgICAgICB2YXIgbyA9IGkubm9kZS5wb3NpdGlvbi5hZGQoY2MudjIoMCwgaS5jZW50ZXJZKSkuc3ViKG4pO1xuICAgICAgICAgICAgICAgIHZhciBzID0gTWF0aC5hdGFuMihvLnksIG8ueCk7XG4gICAgICAgICAgICAgICAgdGhpcy5tb3ZlQnlBbmdsZSgoMTgwICogcykgLyBNYXRoLlBJKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgZG9Db2xsaXNpb25Mb2dpYzogZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgaWYgKDEgIT0gdC50YWcpIHtcbiAgICAgICAgICAgIHZhciBpID0gdC5nZXRDb21wb25lbnQoXCJFbmVteVwiKTtcbiAgICAgICAgICAgIGlmIChpICYmIGkuaHAgPiAwICYmIGkgIT0gdGhpcy5leGNsdWRlRW5lbXkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmEuZG9CdWxsZXRBdHRMb2dpYyh0aGlzLCBpKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uSGl0RW5lbXkoZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5kaWVPdXRTY3JlZW4pIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uTW92ZUVuZGVkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ29sbGlzaW9uRW50ZXI6IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgIGlmIChlLmVuYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZG9Db2xsaXNpb25Mb2dpYyh0LCBlKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25SYW5nZVBvaXNvbkVudGVyOiBmdW5jdGlvbiAodCkge1xuICAgICAgICB2YXIgZSA9IHQuZ2V0Q29tcG9uZW50KFwiRW5lbXlcIik7XG4gICAgICAgIGlmIChlICYmIGUuaHAgPiAwKSB7XG4gICAgICAgICAgICBlLmFkZEJ1ZmZQb2lzb24odGhpcy5hLCA1ZTMsIHRoaXMuYXR0KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25Bb2VDb2xsaXNpb25FbnRlcjogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdmFyIGUgPSB0LmdldENvbXBvbmVudChcIkVuZW15XCIpO1xuICAgICAgICBpZiAoZSAmJiBlLmhwID4gMCkge1xuICAgICAgICAgICAgdGhpcy5hLmRvQnVsbGV0QXR0TG9naWModGhpcywgZSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdfQ==