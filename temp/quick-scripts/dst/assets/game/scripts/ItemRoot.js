
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game/scripts/ItemRoot.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'b30f2pf6gZJBa/s5d8JifOH', 'ItemRoot');
// game/scripts/ItemRoot.js

"use strict";

var $prefabInfo = require("../../scripts/PrefabInfo");

cc.Class({
  "extends": cc.Component,
  properties: {
    dragingRoot: cc.Node,
    blockRootNode: cc.Node,
    blockItemsRootNode: cc.Node,
    buffEffect: $prefabInfo,
    barPrefab: $prefabInfo,
    linePrefab: $prefabInfo
  },
  onLoad: function onLoad() {
    this.blockRoot = this.blockRootNode.getComponent("BlockRoot");
    this.blockItemsRootNode.zIndex = cc.macro.MAX_ZINDEX - 1;
  },
  layoutChildren: function layoutChildren() {
    var t = this.node.getComponent(cc.Layout);
    t.spacingX = -1;

    if (this.node.childrenCount > 1) {
      var e = this.node.children.reduce(function (t, e) {
        return t + e.width;
      }, 0);

      if (e > 720) {
        var i = Math.max(0.8, 720 / e);
        this.node.children.forEach(function (t) {
          return t.scale = i;
        });
        t.spacingX = 0;
      } else {
        t.spacingX = Math.min(30, (720 - e) / (this.node.childrenCount - 1));
      }
    } else {
      t.spacingX = 15;
    }

    t.updateLayout();
  },
  setCanDrag: function setCanDrag(t) {
    this.node.children.forEach(function (e) {
      var i = e.getComponent("Item");

      if (i && 0 != i.id) {
        i.setCanDrag(t);
      }
    });
    this.blockItemsRootNode.children.forEach(function (e) {
      var i = e.getComponent("Item");

      if (i && 0 != i.id) {
        i.setCanDrag(t);
      }
    });
  },
  pickupFromBoard: function pickupFromBoard(t, e) {
    var i = this.dragingRoot;
    var n = i.convertToNodeSpaceAR(e);
    t.node.position = n;
    t.node.angle = 0;
    t.node.parent = i;
    cc.Tween.stopAllByTarget(t.node);
    t.initSameIDLvLine();
  },
  pickup: function pickup(t, e) {
    var i = this.dragingRoot;
    var n = i.convertToNodeSpaceAR(e);
    t.node.position = n;
    t.node.angle = 0;
    t.node.parent = i;
    t.node.scale = 1;
    cc.Tween.stopAllByTarget(t.node);
    var o = 0 == t.id;
    this.blockRoot.setExtendMode(o);

    if (o) {
      this.setCanDrag(!1);
    }
  },
  putdown: function putdown(t, e) {
    var i = this.node.convertToNodeSpaceAR(e);
    t.setBgSpParent(!0);

    if (t.canUse && 0 != t.id && t.lv < 3 && i.y < 100) {
      for (var n = 0; n < this.node.childrenCount; n++) {
        var o = this.node.children[n];

        if (i.x > o.x - o.width / 2 && i.x < o.x + o.width / 2) {
          var s = o.getComponent("Item");

          if (s.canUse && s.id == t.id && s.lv == t.lv) {
            t.node.parent = null;
            this.layoutChildren();
            return void s.lvup();
          }
        }
      }
    }

    t.node.parent = this.node;
    t.node.position = i;
    t.setSelfListenEvent(!0);
    var c = this.node.children.findIndex(function (e) {
      return e.x > t.node.x;
    });

    if (-1 == c) {
      c = this.node.childrenCount;
    } else {
      c = c;
    }

    for (var a = 0; a < c; a++) {
      this.node.children[a].zIndex = -1;
    }

    for (var r = c; r < this.node.childrenCount; r++) {
      this.node.children[r].zIndex = 1;
    }

    t.node.zIndex = 0;
    this.node.sortAllChildren();
    this.layoutChildren();
    cc.tween(t.node).to(0.16, {
      y: 0
    }).start();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9nYW1lL3NjcmlwdHMvSXRlbVJvb3QuanMiXSwibmFtZXMiOlsiJHByZWZhYkluZm8iLCJyZXF1aXJlIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJkcmFnaW5nUm9vdCIsIk5vZGUiLCJibG9ja1Jvb3ROb2RlIiwiYmxvY2tJdGVtc1Jvb3ROb2RlIiwiYnVmZkVmZmVjdCIsImJhclByZWZhYiIsImxpbmVQcmVmYWIiLCJvbkxvYWQiLCJibG9ja1Jvb3QiLCJnZXRDb21wb25lbnQiLCJ6SW5kZXgiLCJtYWNybyIsIk1BWF9aSU5ERVgiLCJsYXlvdXRDaGlsZHJlbiIsInQiLCJub2RlIiwiTGF5b3V0Iiwic3BhY2luZ1giLCJjaGlsZHJlbkNvdW50IiwiZSIsImNoaWxkcmVuIiwicmVkdWNlIiwid2lkdGgiLCJpIiwiTWF0aCIsIm1heCIsImZvckVhY2giLCJzY2FsZSIsIm1pbiIsInVwZGF0ZUxheW91dCIsInNldENhbkRyYWciLCJpZCIsInBpY2t1cEZyb21Cb2FyZCIsIm4iLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsInBvc2l0aW9uIiwiYW5nbGUiLCJwYXJlbnQiLCJUd2VlbiIsInN0b3BBbGxCeVRhcmdldCIsImluaXRTYW1lSURMdkxpbmUiLCJwaWNrdXAiLCJvIiwic2V0RXh0ZW5kTW9kZSIsInB1dGRvd24iLCJzZXRCZ1NwUGFyZW50IiwiY2FuVXNlIiwibHYiLCJ5IiwieCIsInMiLCJsdnVwIiwic2V0U2VsZkxpc3RlbkV2ZW50IiwiYyIsImZpbmRJbmRleCIsImEiLCJyIiwic29ydEFsbENoaWxkcmVuIiwidHdlZW4iLCJ0byIsInN0YXJ0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBLElBQUlBLFdBQVcsR0FBR0MsT0FBTyxDQUFDLDBCQUFELENBQXpCOztBQUNBQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNMLFdBQVNELEVBQUUsQ0FBQ0UsU0FEUDtFQUVMQyxVQUFVLEVBQUU7SUFDUkMsV0FBVyxFQUFFSixFQUFFLENBQUNLLElBRFI7SUFFUkMsYUFBYSxFQUFFTixFQUFFLENBQUNLLElBRlY7SUFHUkUsa0JBQWtCLEVBQUVQLEVBQUUsQ0FBQ0ssSUFIZjtJQUlSRyxVQUFVLEVBQUVWLFdBSko7SUFLUlcsU0FBUyxFQUFFWCxXQUxIO0lBTVJZLFVBQVUsRUFBRVo7RUFOSixDQUZQO0VBVUxhLE1BQU0sRUFBRSxrQkFBWTtJQUNoQixLQUFLQyxTQUFMLEdBQWlCLEtBQUtOLGFBQUwsQ0FBbUJPLFlBQW5CLENBQWdDLFdBQWhDLENBQWpCO0lBQ0EsS0FBS04sa0JBQUwsQ0FBd0JPLE1BQXhCLEdBQWlDZCxFQUFFLENBQUNlLEtBQUgsQ0FBU0MsVUFBVCxHQUFzQixDQUF2RDtFQUNILENBYkk7RUFjTEMsY0FBYyxFQUFFLDBCQUFZO0lBQ3hCLElBQUlDLENBQUMsR0FBRyxLQUFLQyxJQUFMLENBQVVOLFlBQVYsQ0FBdUJiLEVBQUUsQ0FBQ29CLE1BQTFCLENBQVI7SUFDQUYsQ0FBQyxDQUFDRyxRQUFGLEdBQWEsQ0FBQyxDQUFkOztJQUNBLElBQUksS0FBS0YsSUFBTCxDQUFVRyxhQUFWLEdBQTBCLENBQTlCLEVBQWlDO01BQzdCLElBQUlDLENBQUMsR0FBRyxLQUFLSixJQUFMLENBQVVLLFFBQVYsQ0FBbUJDLE1BQW5CLENBQTBCLFVBQVVQLENBQVYsRUFBYUssQ0FBYixFQUFnQjtRQUM5QyxPQUFPTCxDQUFDLEdBQUdLLENBQUMsQ0FBQ0csS0FBYjtNQUNILENBRk8sRUFFTCxDQUZLLENBQVI7O01BR0EsSUFBSUgsQ0FBQyxHQUFHLEdBQVIsRUFBYTtRQUNULElBQUlJLENBQUMsR0FBR0MsSUFBSSxDQUFDQyxHQUFMLENBQVMsR0FBVCxFQUFjLE1BQU1OLENBQXBCLENBQVI7UUFDQSxLQUFLSixJQUFMLENBQVVLLFFBQVYsQ0FBbUJNLE9BQW5CLENBQTJCLFVBQVVaLENBQVYsRUFBYTtVQUNwQyxPQUFRQSxDQUFDLENBQUNhLEtBQUYsR0FBVUosQ0FBbEI7UUFDSCxDQUZEO1FBR0FULENBQUMsQ0FBQ0csUUFBRixHQUFhLENBQWI7TUFDSCxDQU5ELE1BTU87UUFDSEgsQ0FBQyxDQUFDRyxRQUFGLEdBQWFPLElBQUksQ0FBQ0ksR0FBTCxDQUFTLEVBQVQsRUFBYSxDQUFDLE1BQU1ULENBQVAsS0FBYSxLQUFLSixJQUFMLENBQVVHLGFBQVYsR0FBMEIsQ0FBdkMsQ0FBYixDQUFiO01BQ0g7SUFDSixDQWJELE1BYU87TUFDSEosQ0FBQyxDQUFDRyxRQUFGLEdBQWEsRUFBYjtJQUNIOztJQUNESCxDQUFDLENBQUNlLFlBQUY7RUFDSCxDQWxDSTtFQW1DTEMsVUFBVSxFQUFFLG9CQUFVaEIsQ0FBVixFQUFhO0lBQ3JCLEtBQUtDLElBQUwsQ0FBVUssUUFBVixDQUFtQk0sT0FBbkIsQ0FBMkIsVUFBVVAsQ0FBVixFQUFhO01BQ3BDLElBQUlJLENBQUMsR0FBR0osQ0FBQyxDQUFDVixZQUFGLENBQWUsTUFBZixDQUFSOztNQUNBLElBQUljLENBQUMsSUFBSSxLQUFLQSxDQUFDLENBQUNRLEVBQWhCLEVBQW9CO1FBQ2hCUixDQUFDLENBQUNPLFVBQUYsQ0FBYWhCLENBQWI7TUFDSDtJQUNKLENBTEQ7SUFNQSxLQUFLWCxrQkFBTCxDQUF3QmlCLFFBQXhCLENBQWlDTSxPQUFqQyxDQUF5QyxVQUFVUCxDQUFWLEVBQWE7TUFDbEQsSUFBSUksQ0FBQyxHQUFHSixDQUFDLENBQUNWLFlBQUYsQ0FBZSxNQUFmLENBQVI7O01BQ0EsSUFBSWMsQ0FBQyxJQUFJLEtBQUtBLENBQUMsQ0FBQ1EsRUFBaEIsRUFBb0I7UUFDaEJSLENBQUMsQ0FBQ08sVUFBRixDQUFhaEIsQ0FBYjtNQUNIO0lBQ0osQ0FMRDtFQU1ILENBaERJO0VBaURMa0IsZUFBZSxFQUFFLHlCQUFVbEIsQ0FBVixFQUFhSyxDQUFiLEVBQWdCO0lBQzdCLElBQUlJLENBQUMsR0FBRyxLQUFLdkIsV0FBYjtJQUNBLElBQUlpQyxDQUFDLEdBQUdWLENBQUMsQ0FBQ1csb0JBQUYsQ0FBdUJmLENBQXZCLENBQVI7SUFDQUwsQ0FBQyxDQUFDQyxJQUFGLENBQU9vQixRQUFQLEdBQWtCRixDQUFsQjtJQUNBbkIsQ0FBQyxDQUFDQyxJQUFGLENBQU9xQixLQUFQLEdBQWUsQ0FBZjtJQUNBdEIsQ0FBQyxDQUFDQyxJQUFGLENBQU9zQixNQUFQLEdBQWdCZCxDQUFoQjtJQUNBM0IsRUFBRSxDQUFDMEMsS0FBSCxDQUFTQyxlQUFULENBQXlCekIsQ0FBQyxDQUFDQyxJQUEzQjtJQUNBRCxDQUFDLENBQUMwQixnQkFBRjtFQUNILENBekRJO0VBMERMQyxNQUFNLEVBQUUsZ0JBQVUzQixDQUFWLEVBQWFLLENBQWIsRUFBZ0I7SUFDcEIsSUFBSUksQ0FBQyxHQUFHLEtBQUt2QixXQUFiO0lBQ0EsSUFBSWlDLENBQUMsR0FBR1YsQ0FBQyxDQUFDVyxvQkFBRixDQUF1QmYsQ0FBdkIsQ0FBUjtJQUNBTCxDQUFDLENBQUNDLElBQUYsQ0FBT29CLFFBQVAsR0FBa0JGLENBQWxCO0lBQ0FuQixDQUFDLENBQUNDLElBQUYsQ0FBT3FCLEtBQVAsR0FBZSxDQUFmO0lBQ0F0QixDQUFDLENBQUNDLElBQUYsQ0FBT3NCLE1BQVAsR0FBZ0JkLENBQWhCO0lBQ0FULENBQUMsQ0FBQ0MsSUFBRixDQUFPWSxLQUFQLEdBQWUsQ0FBZjtJQUNBL0IsRUFBRSxDQUFDMEMsS0FBSCxDQUFTQyxlQUFULENBQXlCekIsQ0FBQyxDQUFDQyxJQUEzQjtJQUNBLElBQUkyQixDQUFDLEdBQUcsS0FBSzVCLENBQUMsQ0FBQ2lCLEVBQWY7SUFDQSxLQUFLdkIsU0FBTCxDQUFlbUMsYUFBZixDQUE2QkQsQ0FBN0I7O0lBQ0EsSUFBSUEsQ0FBSixFQUFPO01BQ0gsS0FBS1osVUFBTCxDQUFnQixDQUFDLENBQWpCO0lBQ0g7RUFDSixDQXZFSTtFQXdFTGMsT0FBTyxFQUFFLGlCQUFVOUIsQ0FBVixFQUFhSyxDQUFiLEVBQWdCO0lBQ3JCLElBQUlJLENBQUMsR0FBRyxLQUFLUixJQUFMLENBQVVtQixvQkFBVixDQUErQmYsQ0FBL0IsQ0FBUjtJQUNBTCxDQUFDLENBQUMrQixhQUFGLENBQWdCLENBQUMsQ0FBakI7O0lBQ0EsSUFBSS9CLENBQUMsQ0FBQ2dDLE1BQUYsSUFBWSxLQUFLaEMsQ0FBQyxDQUFDaUIsRUFBbkIsSUFBeUJqQixDQUFDLENBQUNpQyxFQUFGLEdBQU8sQ0FBaEMsSUFBcUN4QixDQUFDLENBQUN5QixDQUFGLEdBQU0sR0FBL0MsRUFBb0Q7TUFDaEQsS0FBSyxJQUFJZixDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLEtBQUtsQixJQUFMLENBQVVHLGFBQTlCLEVBQTZDZSxDQUFDLEVBQTlDLEVBQWtEO1FBQzlDLElBQUlTLENBQUMsR0FBRyxLQUFLM0IsSUFBTCxDQUFVSyxRQUFWLENBQW1CYSxDQUFuQixDQUFSOztRQUNBLElBQUlWLENBQUMsQ0FBQzBCLENBQUYsR0FBTVAsQ0FBQyxDQUFDTyxDQUFGLEdBQU1QLENBQUMsQ0FBQ3BCLEtBQUYsR0FBVSxDQUF0QixJQUEyQkMsQ0FBQyxDQUFDMEIsQ0FBRixHQUFNUCxDQUFDLENBQUNPLENBQUYsR0FBTVAsQ0FBQyxDQUFDcEIsS0FBRixHQUFVLENBQXJELEVBQXdEO1VBQ3BELElBQUk0QixDQUFDLEdBQUdSLENBQUMsQ0FBQ2pDLFlBQUYsQ0FBZSxNQUFmLENBQVI7O1VBQ0EsSUFBSXlDLENBQUMsQ0FBQ0osTUFBRixJQUFZSSxDQUFDLENBQUNuQixFQUFGLElBQVFqQixDQUFDLENBQUNpQixFQUF0QixJQUE0Qm1CLENBQUMsQ0FBQ0gsRUFBRixJQUFRakMsQ0FBQyxDQUFDaUMsRUFBMUMsRUFBOEM7WUFDMUNqQyxDQUFDLENBQUNDLElBQUYsQ0FBT3NCLE1BQVAsR0FBZ0IsSUFBaEI7WUFDQSxLQUFLeEIsY0FBTDtZQUNBLE9BQU8sS0FBS3FDLENBQUMsQ0FBQ0MsSUFBRixFQUFaO1VBQ0g7UUFDSjtNQUNKO0lBQ0o7O0lBQ0RyQyxDQUFDLENBQUNDLElBQUYsQ0FBT3NCLE1BQVAsR0FBZ0IsS0FBS3RCLElBQXJCO0lBQ0FELENBQUMsQ0FBQ0MsSUFBRixDQUFPb0IsUUFBUCxHQUFrQlosQ0FBbEI7SUFDQVQsQ0FBQyxDQUFDc0Msa0JBQUYsQ0FBcUIsQ0FBQyxDQUF0QjtJQUNBLElBQUlDLENBQUMsR0FBRyxLQUFLdEMsSUFBTCxDQUFVSyxRQUFWLENBQW1Ca0MsU0FBbkIsQ0FBNkIsVUFBVW5DLENBQVYsRUFBYTtNQUM5QyxPQUFPQSxDQUFDLENBQUM4QixDQUFGLEdBQU1uQyxDQUFDLENBQUNDLElBQUYsQ0FBT2tDLENBQXBCO0lBQ0gsQ0FGTyxDQUFSOztJQUdBLElBQUksQ0FBQyxDQUFELElBQU1JLENBQVYsRUFBYTtNQUNUQSxDQUFDLEdBQUcsS0FBS3RDLElBQUwsQ0FBVUcsYUFBZDtJQUNILENBRkQsTUFFTztNQUNIbUMsQ0FBQyxHQUFHQSxDQUFKO0lBQ0g7O0lBQ0QsS0FBSyxJQUFJRSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHRixDQUFwQixFQUF1QkUsQ0FBQyxFQUF4QixFQUE0QjtNQUN4QixLQUFLeEMsSUFBTCxDQUFVSyxRQUFWLENBQW1CbUMsQ0FBbkIsRUFBc0I3QyxNQUF0QixHQUErQixDQUFDLENBQWhDO0lBQ0g7O0lBQ0QsS0FBSyxJQUFJOEMsQ0FBQyxHQUFHSCxDQUFiLEVBQWdCRyxDQUFDLEdBQUcsS0FBS3pDLElBQUwsQ0FBVUcsYUFBOUIsRUFBNkNzQyxDQUFDLEVBQTlDLEVBQWtEO01BQzlDLEtBQUt6QyxJQUFMLENBQVVLLFFBQVYsQ0FBbUJvQyxDQUFuQixFQUFzQjlDLE1BQXRCLEdBQStCLENBQS9CO0lBQ0g7O0lBQ0RJLENBQUMsQ0FBQ0MsSUFBRixDQUFPTCxNQUFQLEdBQWdCLENBQWhCO0lBQ0EsS0FBS0ssSUFBTCxDQUFVMEMsZUFBVjtJQUNBLEtBQUs1QyxjQUFMO0lBQ0FqQixFQUFFLENBQUM4RCxLQUFILENBQVM1QyxDQUFDLENBQUNDLElBQVgsRUFDSzRDLEVBREwsQ0FDUSxJQURSLEVBQ2M7TUFDTlgsQ0FBQyxFQUFFO0lBREcsQ0FEZCxFQUlLWSxLQUpMO0VBS0g7QUFqSEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsidmFyICRwcmVmYWJJbmZvID0gcmVxdWlyZShcIi4uLy4uL3NjcmlwdHMvUHJlZmFiSW5mb1wiKTtcbmNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBkcmFnaW5nUm9vdDogY2MuTm9kZSxcbiAgICAgICAgYmxvY2tSb290Tm9kZTogY2MuTm9kZSxcbiAgICAgICAgYmxvY2tJdGVtc1Jvb3ROb2RlOiBjYy5Ob2RlLFxuICAgICAgICBidWZmRWZmZWN0OiAkcHJlZmFiSW5mbyxcbiAgICAgICAgYmFyUHJlZmFiOiAkcHJlZmFiSW5mbyxcbiAgICAgICAgbGluZVByZWZhYjogJHByZWZhYkluZm9cbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmJsb2NrUm9vdCA9IHRoaXMuYmxvY2tSb290Tm9kZS5nZXRDb21wb25lbnQoXCJCbG9ja1Jvb3RcIik7XG4gICAgICAgIHRoaXMuYmxvY2tJdGVtc1Jvb3ROb2RlLnpJbmRleCA9IGNjLm1hY3JvLk1BWF9aSU5ERVggLSAxO1xuICAgIH0sXG4gICAgbGF5b3V0Q2hpbGRyZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzLm5vZGUuZ2V0Q29tcG9uZW50KGNjLkxheW91dCk7XG4gICAgICAgIHQuc3BhY2luZ1ggPSAtMTtcbiAgICAgICAgaWYgKHRoaXMubm9kZS5jaGlsZHJlbkNvdW50ID4gMSkge1xuICAgICAgICAgICAgdmFyIGUgPSB0aGlzLm5vZGUuY2hpbGRyZW4ucmVkdWNlKGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHQgKyBlLndpZHRoO1xuICAgICAgICAgICAgfSwgMCk7XG4gICAgICAgICAgICBpZiAoZSA+IDcyMCkge1xuICAgICAgICAgICAgICAgIHZhciBpID0gTWF0aC5tYXgoMC44LCA3MjAgLyBlKTtcbiAgICAgICAgICAgICAgICB0aGlzLm5vZGUuY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gKHQuc2NhbGUgPSBpKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0LnNwYWNpbmdYID0gMDtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdC5zcGFjaW5nWCA9IE1hdGgubWluKDMwLCAoNzIwIC0gZSkgLyAodGhpcy5ub2RlLmNoaWxkcmVuQ291bnQgLSAxKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0LnNwYWNpbmdYID0gMTU7XG4gICAgICAgIH1cbiAgICAgICAgdC51cGRhdGVMYXlvdXQoKTtcbiAgICB9LFxuICAgIHNldENhbkRyYWc6IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHRoaXMubm9kZS5jaGlsZHJlbi5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICB2YXIgaSA9IGUuZ2V0Q29tcG9uZW50KFwiSXRlbVwiKTtcbiAgICAgICAgICAgIGlmIChpICYmIDAgIT0gaS5pZCkge1xuICAgICAgICAgICAgICAgIGkuc2V0Q2FuRHJhZyh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYmxvY2tJdGVtc1Jvb3ROb2RlLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHZhciBpID0gZS5nZXRDb21wb25lbnQoXCJJdGVtXCIpO1xuICAgICAgICAgICAgaWYgKGkgJiYgMCAhPSBpLmlkKSB7XG4gICAgICAgICAgICAgICAgaS5zZXRDYW5EcmFnKHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIHBpY2t1cEZyb21Cb2FyZDogZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgdmFyIGkgPSB0aGlzLmRyYWdpbmdSb290O1xuICAgICAgICB2YXIgbiA9IGkuY29udmVydFRvTm9kZVNwYWNlQVIoZSk7XG4gICAgICAgIHQubm9kZS5wb3NpdGlvbiA9IG47XG4gICAgICAgIHQubm9kZS5hbmdsZSA9IDA7XG4gICAgICAgIHQubm9kZS5wYXJlbnQgPSBpO1xuICAgICAgICBjYy5Ud2Vlbi5zdG9wQWxsQnlUYXJnZXQodC5ub2RlKTtcbiAgICAgICAgdC5pbml0U2FtZUlETHZMaW5lKCk7XG4gICAgfSxcbiAgICBwaWNrdXA6IGZ1bmN0aW9uICh0LCBlKSB7XG4gICAgICAgIHZhciBpID0gdGhpcy5kcmFnaW5nUm9vdDtcbiAgICAgICAgdmFyIG4gPSBpLmNvbnZlcnRUb05vZGVTcGFjZUFSKGUpO1xuICAgICAgICB0Lm5vZGUucG9zaXRpb24gPSBuO1xuICAgICAgICB0Lm5vZGUuYW5nbGUgPSAwO1xuICAgICAgICB0Lm5vZGUucGFyZW50ID0gaTtcbiAgICAgICAgdC5ub2RlLnNjYWxlID0gMTtcbiAgICAgICAgY2MuVHdlZW4uc3RvcEFsbEJ5VGFyZ2V0KHQubm9kZSk7XG4gICAgICAgIHZhciBvID0gMCA9PSB0LmlkO1xuICAgICAgICB0aGlzLmJsb2NrUm9vdC5zZXRFeHRlbmRNb2RlKG8pO1xuICAgICAgICBpZiAobykge1xuICAgICAgICAgICAgdGhpcy5zZXRDYW5EcmFnKCExKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcHV0ZG93bjogZnVuY3Rpb24gKHQsIGUpIHtcbiAgICAgICAgdmFyIGkgPSB0aGlzLm5vZGUuY29udmVydFRvTm9kZVNwYWNlQVIoZSk7XG4gICAgICAgIHQuc2V0QmdTcFBhcmVudCghMCk7XG4gICAgICAgIGlmICh0LmNhblVzZSAmJiAwICE9IHQuaWQgJiYgdC5sdiA8IDMgJiYgaS55IDwgMTAwKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBuID0gMDsgbiA8IHRoaXMubm9kZS5jaGlsZHJlbkNvdW50OyBuKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgbyA9IHRoaXMubm9kZS5jaGlsZHJlbltuXTtcbiAgICAgICAgICAgICAgICBpZiAoaS54ID4gby54IC0gby53aWR0aCAvIDIgJiYgaS54IDwgby54ICsgby53aWR0aCAvIDIpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHMgPSBvLmdldENvbXBvbmVudChcIkl0ZW1cIik7XG4gICAgICAgICAgICAgICAgICAgIGlmIChzLmNhblVzZSAmJiBzLmlkID09IHQuaWQgJiYgcy5sdiA9PSB0Lmx2KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0Lm5vZGUucGFyZW50ID0gbnVsbDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMubGF5b3V0Q2hpbGRyZW4oKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkIHMubHZ1cCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHQubm9kZS5wYXJlbnQgPSB0aGlzLm5vZGU7XG4gICAgICAgIHQubm9kZS5wb3NpdGlvbiA9IGk7XG4gICAgICAgIHQuc2V0U2VsZkxpc3RlbkV2ZW50KCEwKTtcbiAgICAgICAgdmFyIGMgPSB0aGlzLm5vZGUuY2hpbGRyZW4uZmluZEluZGV4KGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICByZXR1cm4gZS54ID4gdC5ub2RlLng7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAoLTEgPT0gYykge1xuICAgICAgICAgICAgYyA9IHRoaXMubm9kZS5jaGlsZHJlbkNvdW50O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgYyA9IGM7XG4gICAgICAgIH1cbiAgICAgICAgZm9yICh2YXIgYSA9IDA7IGEgPCBjOyBhKyspIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5jaGlsZHJlblthXS56SW5kZXggPSAtMTtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciByID0gYzsgciA8IHRoaXMubm9kZS5jaGlsZHJlbkNvdW50OyByKyspIHtcbiAgICAgICAgICAgIHRoaXMubm9kZS5jaGlsZHJlbltyXS56SW5kZXggPSAxO1xuICAgICAgICB9XG4gICAgICAgIHQubm9kZS56SW5kZXggPSAwO1xuICAgICAgICB0aGlzLm5vZGUuc29ydEFsbENoaWxkcmVuKCk7XG4gICAgICAgIHRoaXMubGF5b3V0Q2hpbGRyZW4oKTtcbiAgICAgICAgY2MudHdlZW4odC5ub2RlKVxuICAgICAgICAgICAgLnRvKDAuMTYsIHtcbiAgICAgICAgICAgICAgICB5OiAwXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLnN0YXJ0KCk7XG4gICAgfVxufSk7XG4iXX0=