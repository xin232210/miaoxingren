
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game/scripts/GameHub.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '2c42cev+JZCEbLE3R/JF/EL', 'GameHub');
// game/scripts/GameHub.js

"use strict";

var $prefabInfo = require("../../scripts/PrefabInfo");

cc.Class({
  "extends": cc.Component,
  properties: {
    bagRoot: cc.Node,
    gameRoot: cc.Node,
    ani: cc.Animation,
    actBuffPanel: cc.Node,
    moneyLabel: cc.Label,
    waveLabel: cc.Label,
    lvLabel: cc.Label,
    expBar: cc.ProgressBar,
    lvupEffect: $prefabInfo,
    lvupAudio: cc.AudioClip,
    levelsJsonFile: cc.JsonAsset,
    lvupJsonFile: cc.JsonAsset
  },
  onLoad: function onLoad() {
    this.bagRoot.active = !0;
    this.bag = this.bagRoot.getComponent("game1");
    this.gameRoot.active = !1;
    this.game = this.gameRoot.getComponent("game");
    this.game.enabled = !1;
    this.bag.hub = this;
    this.bag.game = this.game;
    this.game.hub = this;
    this.game.bag = this.bag;
  },
  start: function start() {
    this.actBuffPanel.active = 1 == cc.pvz.runtimeData.mode;

    if (this.actBuffPanel.active) {
      this.actBuffPanel.getComponent("ActBuffPanel").initActBuffInfo();
    }

    var t = null;

    switch (cc.pvz.runtimeData.mode) {
      case 0:
        t = this.levelsJsonFile.json[cc.pvz.runtimeData.level - 1];
        break;

      case 1:
        t = cc.JsonControl.ActLevelJson[cc.pvz.runtimeData.level - 1];
        break;

      case 2:
        t = cc.JsonControl.rankLevelJsonFile.json[0];
    }

    this.levelData = t;
    this.updateLevel();
    this.updateExp();
    this.updateMoney();
    cc.butler.node.on("money", this.onGetMoney, this);
  },
  onPopup1st: function onPopup1st() {
    if (this.bag.onPopup1st) {
      this.bag.onPopup1st();
    }

    if (this.game.onPopup1st) {
      this.game.onPopup1st();
    }
  },
  onAllClosed: function onAllClosed() {
    if (this.bag.onAllClosed) {
      this.bag.onAllClosed();
    }

    if (this.game.onAllClosed) {
      this.game.onAllClosed();
    }
  },
  onGetMoney: function onGetMoney() {
    this.updateMoney();
  },
  updateLevel: function updateLevel() {
    if (2 == cc.pvz.runtimeData.mode) {
      this.waveLabel.string = "第" + (cc.pvz.runtimeData.wave + 1) + "波";
    } else {
      this.waveLabel.node.active = this.levelData.wave > 0;
      this.waveLabel.node.active && (this.waveLabel.string = "第" + (cc.pvz.runtimeData.wave + 1) + "/" + this.levelData.wave + "波");
    }
  },
  updateMoney: function updateMoney() {
    this.moneyLabel.string = cc.pvz.runtimeData.money;
  },
  updateExp: function updateExp() {
    var t = this.lvupJsonFile.json[cc.pvz.runtimeData.lv].exp;
    this.lvLabel.string = cc.pvz.runtimeData.lv + 1;
    this.expBar.progress = cc.pvz.runtimeData.exp / t;
  },
  showLvupEffect: function showLvupEffect(t) {
    this.lvupEffect.addNodeByWorldPos(t);
    cc.butler.playEffect(this.lvupAudio);
  },
  onClickStart: function onClickStart() {
    var t = this;

    if (this.bag.checkStartGame(this.onClickStart)) {
      this.ani.play("bag-to-game").wrapMode = cc.WrapMode.Normal;
      this.ani.once("finished", function () {
        t.game.cbs = [];
        t.bag.onClickStart(t.game);
        t.game.startLogic(t.bag);
      });
    }
  },
  backToBag: function backToBag() {
    var t = this;
    this.game.onBackFromGame();
    this.bag.onBackFromGame();
    this.updateLevel();
    this.ani.play("bag-to-game").wrapMode = cc.WrapMode.Reverse;
    this.ani.once("finished", function () {
      if (cc.pvz.runtimeData.autoTimes > 0) {
        cc.pvz.runtimeData.autoTimes--;
        t.bag.doRefreshLogic(!0);
        t.bag.saveRuntimeData();
      }
    });
  },
  onClickPause: function onClickPause() {
    cc.popupManager.popup("game", "fightset", "UIGamePause", {
      scale: !1
    });
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9nYW1lL3NjcmlwdHMvR2FtZUh1Yi5qcyJdLCJuYW1lcyI6WyIkcHJlZmFiSW5mbyIsInJlcXVpcmUiLCJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImJhZ1Jvb3QiLCJOb2RlIiwiZ2FtZVJvb3QiLCJhbmkiLCJBbmltYXRpb24iLCJhY3RCdWZmUGFuZWwiLCJtb25leUxhYmVsIiwiTGFiZWwiLCJ3YXZlTGFiZWwiLCJsdkxhYmVsIiwiZXhwQmFyIiwiUHJvZ3Jlc3NCYXIiLCJsdnVwRWZmZWN0IiwibHZ1cEF1ZGlvIiwiQXVkaW9DbGlwIiwibGV2ZWxzSnNvbkZpbGUiLCJKc29uQXNzZXQiLCJsdnVwSnNvbkZpbGUiLCJvbkxvYWQiLCJhY3RpdmUiLCJiYWciLCJnZXRDb21wb25lbnQiLCJnYW1lIiwiZW5hYmxlZCIsImh1YiIsInN0YXJ0IiwicHZ6IiwicnVudGltZURhdGEiLCJtb2RlIiwiaW5pdEFjdEJ1ZmZJbmZvIiwidCIsImpzb24iLCJsZXZlbCIsIkpzb25Db250cm9sIiwiQWN0TGV2ZWxKc29uIiwicmFua0xldmVsSnNvbkZpbGUiLCJsZXZlbERhdGEiLCJ1cGRhdGVMZXZlbCIsInVwZGF0ZUV4cCIsInVwZGF0ZU1vbmV5IiwiYnV0bGVyIiwibm9kZSIsIm9uIiwib25HZXRNb25leSIsIm9uUG9wdXAxc3QiLCJvbkFsbENsb3NlZCIsInN0cmluZyIsIndhdmUiLCJtb25leSIsImx2IiwiZXhwIiwicHJvZ3Jlc3MiLCJzaG93THZ1cEVmZmVjdCIsImFkZE5vZGVCeVdvcmxkUG9zIiwicGxheUVmZmVjdCIsIm9uQ2xpY2tTdGFydCIsImNoZWNrU3RhcnRHYW1lIiwicGxheSIsIndyYXBNb2RlIiwiV3JhcE1vZGUiLCJOb3JtYWwiLCJvbmNlIiwiY2JzIiwic3RhcnRMb2dpYyIsImJhY2tUb0JhZyIsIm9uQmFja0Zyb21HYW1lIiwiUmV2ZXJzZSIsImF1dG9UaW1lcyIsImRvUmVmcmVzaExvZ2ljIiwic2F2ZVJ1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QUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgJHByZWZhYkluZm8gPSByZXF1aXJlKFwiLi4vLi4vc2NyaXB0cy9QcmVmYWJJbmZvXCIpO1xuY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGJhZ1Jvb3Q6IGNjLk5vZGUsXG4gICAgICAgIGdhbWVSb290OiBjYy5Ob2RlLFxuICAgICAgICBhbmk6IGNjLkFuaW1hdGlvbixcbiAgICAgICAgYWN0QnVmZlBhbmVsOiBjYy5Ob2RlLFxuICAgICAgICBtb25leUxhYmVsOiBjYy5MYWJlbCxcbiAgICAgICAgd2F2ZUxhYmVsOiBjYy5MYWJlbCxcbiAgICAgICAgbHZMYWJlbDogY2MuTGFiZWwsXG4gICAgICAgIGV4cEJhcjogY2MuUHJvZ3Jlc3NCYXIsXG4gICAgICAgIGx2dXBFZmZlY3Q6ICRwcmVmYWJJbmZvLFxuICAgICAgICBsdnVwQXVkaW86IGNjLkF1ZGlvQ2xpcCxcbiAgICAgICAgbGV2ZWxzSnNvbkZpbGU6IGNjLkpzb25Bc3NldCxcbiAgICAgICAgbHZ1cEpzb25GaWxlOiBjYy5Kc29uQXNzZXRcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmJhZ1Jvb3QuYWN0aXZlID0gITA7XG4gICAgICAgIHRoaXMuYmFnID0gdGhpcy5iYWdSb290LmdldENvbXBvbmVudChcImdhbWUxXCIpO1xuICAgICAgICB0aGlzLmdhbWVSb290LmFjdGl2ZSA9ICExO1xuICAgICAgICB0aGlzLmdhbWUgPSB0aGlzLmdhbWVSb290LmdldENvbXBvbmVudChcImdhbWVcIik7XG4gICAgICAgIHRoaXMuZ2FtZS5lbmFibGVkID0gITE7XG4gICAgICAgIHRoaXMuYmFnLmh1YiA9IHRoaXM7XG4gICAgICAgIHRoaXMuYmFnLmdhbWUgPSB0aGlzLmdhbWU7XG4gICAgICAgIHRoaXMuZ2FtZS5odWIgPSB0aGlzO1xuICAgICAgICB0aGlzLmdhbWUuYmFnID0gdGhpcy5iYWc7XG4gICAgfSxcbiAgICBzdGFydDogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmFjdEJ1ZmZQYW5lbC5hY3RpdmUgPSAxID09IGNjLnB2ei5ydW50aW1lRGF0YS5tb2RlO1xuICAgICAgICBpZiAodGhpcy5hY3RCdWZmUGFuZWwuYWN0aXZlKSB7XG4gICAgICAgICAgICB0aGlzLmFjdEJ1ZmZQYW5lbC5nZXRDb21wb25lbnQoXCJBY3RCdWZmUGFuZWxcIikuaW5pdEFjdEJ1ZmZJbmZvKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHQgPSBudWxsO1xuICAgICAgICBzd2l0Y2ggKGNjLnB2ei5ydW50aW1lRGF0YS5tb2RlKSB7XG4gICAgICAgICAgICBjYXNlIDA6XG4gICAgICAgICAgICAgICAgdCA9IHRoaXMubGV2ZWxzSnNvbkZpbGUuanNvbltjYy5wdnoucnVudGltZURhdGEubGV2ZWwgLSAxXTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgMTpcbiAgICAgICAgICAgICAgICB0ID0gY2MuSnNvbkNvbnRyb2wuQWN0TGV2ZWxKc29uW2NjLnB2ei5ydW50aW1lRGF0YS5sZXZlbCAtIDFdO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgY2FzZSAyOlxuICAgICAgICAgICAgICAgIHQgPSBjYy5Kc29uQ29udHJvbC5yYW5rTGV2ZWxKc29uRmlsZS5qc29uWzBdO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGV2ZWxEYXRhID0gdDtcbiAgICAgICAgdGhpcy51cGRhdGVMZXZlbCgpO1xuICAgICAgICB0aGlzLnVwZGF0ZUV4cCgpO1xuICAgICAgICB0aGlzLnVwZGF0ZU1vbmV5KCk7XG4gICAgICAgIGNjLmJ1dGxlci5ub2RlLm9uKFwibW9uZXlcIiwgdGhpcy5vbkdldE1vbmV5LCB0aGlzKTtcbiAgICB9LFxuICAgIG9uUG9wdXAxc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuYmFnLm9uUG9wdXAxc3QpIHtcbiAgICAgICAgICAgIHRoaXMuYmFnLm9uUG9wdXAxc3QoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5nYW1lLm9uUG9wdXAxc3QpIHtcbiAgICAgICAgICAgIHRoaXMuZ2FtZS5vblBvcHVwMXN0KCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQWxsQ2xvc2VkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmJhZy5vbkFsbENsb3NlZCkge1xuICAgICAgICAgICAgdGhpcy5iYWcub25BbGxDbG9zZWQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5nYW1lLm9uQWxsQ2xvc2VkKSB7XG4gICAgICAgICAgICB0aGlzLmdhbWUub25BbGxDbG9zZWQoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25HZXRNb25leTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLnVwZGF0ZU1vbmV5KCk7XG4gICAgfSxcbiAgICB1cGRhdGVMZXZlbDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoMiA9PSBjYy5wdnoucnVudGltZURhdGEubW9kZSkge1xuICAgICAgICAgICAgdGhpcy53YXZlTGFiZWwuc3RyaW5nID0gXCLnrKxcIiArIChjYy5wdnoucnVudGltZURhdGEud2F2ZSArIDEpICsgXCLms6JcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMud2F2ZUxhYmVsLm5vZGUuYWN0aXZlID0gdGhpcy5sZXZlbERhdGEud2F2ZSA+IDA7XG4gICAgICAgICAgICB0aGlzLndhdmVMYWJlbC5ub2RlLmFjdGl2ZSAmJlxuICAgICAgICAgICAgICAgICh0aGlzLndhdmVMYWJlbC5zdHJpbmcgPSBcIuesrFwiICsgKGNjLnB2ei5ydW50aW1lRGF0YS53YXZlICsgMSkgKyBcIi9cIiArIHRoaXMubGV2ZWxEYXRhLndhdmUgKyBcIuazolwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdXBkYXRlTW9uZXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5tb25leUxhYmVsLnN0cmluZyA9IGNjLnB2ei5ydW50aW1lRGF0YS5tb25leTtcbiAgICB9LFxuICAgIHVwZGF0ZUV4cDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdCA9IHRoaXMubHZ1cEpzb25GaWxlLmpzb25bY2MucHZ6LnJ1bnRpbWVEYXRhLmx2XS5leHA7XG4gICAgICAgIHRoaXMubHZMYWJlbC5zdHJpbmcgPSBjYy5wdnoucnVudGltZURhdGEubHYgKyAxO1xuICAgICAgICB0aGlzLmV4cEJhci5wcm9ncmVzcyA9IGNjLnB2ei5ydW50aW1lRGF0YS5leHAgLyB0O1xuICAgIH0sXG4gICAgc2hvd0x2dXBFZmZlY3Q6IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHRoaXMubHZ1cEVmZmVjdC5hZGROb2RlQnlXb3JsZFBvcyh0KTtcbiAgICAgICAgY2MuYnV0bGVyLnBsYXlFZmZlY3QodGhpcy5sdnVwQXVkaW8pO1xuICAgIH0sXG4gICAgb25DbGlja1N0YXJ0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuYmFnLmNoZWNrU3RhcnRHYW1lKHRoaXMub25DbGlja1N0YXJ0KSkge1xuICAgICAgICAgICAgdGhpcy5hbmkucGxheShcImJhZy10by1nYW1lXCIpLndyYXBNb2RlID0gY2MuV3JhcE1vZGUuTm9ybWFsO1xuICAgICAgICAgICAgdGhpcy5hbmkub25jZShcImZpbmlzaGVkXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB0LmdhbWUuY2JzID0gW107XG4gICAgICAgICAgICAgICAgdC5iYWcub25DbGlja1N0YXJ0KHQuZ2FtZSk7XG4gICAgICAgICAgICAgICAgdC5nYW1lLnN0YXJ0TG9naWModC5iYWcpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGJhY2tUb0JhZzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgIHRoaXMuZ2FtZS5vbkJhY2tGcm9tR2FtZSgpO1xuICAgICAgICB0aGlzLmJhZy5vbkJhY2tGcm9tR2FtZSgpO1xuICAgICAgICB0aGlzLnVwZGF0ZUxldmVsKCk7XG4gICAgICAgIHRoaXMuYW5pLnBsYXkoXCJiYWctdG8tZ2FtZVwiKS53cmFwTW9kZSA9IGNjLldyYXBNb2RlLlJldmVyc2U7XG4gICAgICAgIHRoaXMuYW5pLm9uY2UoXCJmaW5pc2hlZFwiLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoY2MucHZ6LnJ1bnRpbWVEYXRhLmF1dG9UaW1lcyA+IDApIHtcbiAgICAgICAgICAgICAgICBjYy5wdnoucnVudGltZURhdGEuYXV0b1RpbWVzLS07XG4gICAgICAgICAgICAgICAgdC5iYWcuZG9SZWZyZXNoTG9naWMoITApO1xuICAgICAgICAgICAgICAgIHQuYmFnLnNhdmVSdW50aW1lRGF0YSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIG9uQ2xpY2tQYXVzZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXCJnYW1lXCIsIFwiZmlnaHRzZXRcIiwgXCJVSUdhbWVQYXVzZVwiLCB7XG4gICAgICAgICAgICBzY2FsZTogITFcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG4iXX0=