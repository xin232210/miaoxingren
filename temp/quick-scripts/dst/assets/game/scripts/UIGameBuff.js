
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/game/scripts/UIGameBuff.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '3c3e3QNLFFGdJGkC8r81WVP', 'UIGameBuff');
// game/scripts/UIGameBuff.js

"use strict";

var i = cc.Class({
  name: "BuffNode",
  properties: {
    bgSp: cc.Sprite,
    qualitySp: cc.Sprite,
    iconSp: cc.Sprite,
    nameLabel: cc.Label,
    descLabel: cc.RichText
  }
});
cc.Class({
  "extends": cc.Component,
  properties: {
    heroJsonFile: cc.JsonAsset,
    buffJsonFile: cc.JsonAsset,
    buffNodes: [i],
    refreshNode: cc.Node,
    refreshTimesLabel: cc.Label,
    getAllNode: cc.Node,
    getAllTimesLabel: cc.Label,
    btnsLayout: cc.Layout
  },
  onLoad: function onLoad() {
    this.buffNodes.forEach(function (t) {
      return t.descLabel.enabled = !1;
    });
  },
  initBy: function initBy(t) {
    var e = this;
    this.scene = t;
    this.buffPool = [];
    this.buffJsonFile.json.forEach(function (t) {
      if (!(cc.pvz.runtimeData.buffs.filter(function (e) {
        return e == t.id;
      }).length >= t.gettimes)) {
        if (t.id < 100) {
          e.buffPool.push(t.id);
        } else {
          var i = Math.floor(t.id / 100);
          var n = cc.pvz.PlayerData.getToolData(i);

          if (n.pos >= 0 && n.lv >= t.locklevel) {
            var o = parseInt(t.frontskill);

            if ("" == t.frontskill || cc.pvz.runtimeData.buffs.some(function (t) {
              return t == o;
            })) {
              e.buffPool.push(t.id);
            }
          }
        }
      }
    });
    var i = [];

    if (1 == cc.pvz.PlayerData.getStageLevel() && cc.pvz.runtimeData.guide < 9) {
      i.push(24);
    }

    if (2 == cc.pvz.runtimeData.mode) {
      i.push(13, 14, 15, 16, 17, 18, 22, 23, 24, 31);
    }

    i.forEach(function (t) {
      var i = e.buffPool.findIndex(function (e) {
        return e == t;
      });

      if (-1 != i) {
        e.buffPool.splice(i, 1);
      }
    });
    this.refresh(!0);
    cc.pvz.PlayerData.checkAndResetAdData();
    this.getAllNode.active = this.getAdCount(1) > 0;
    this.getAllTimesLabel.string = this.getAdCount(1) + "/" + this.getAdMaxCount(1);
    this.updateRefreshTimes();

    if (this.getAllNode.active) {
      cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["buff全部"]);
    }
  },
  getAdMaxCount: function getAdMaxCount(t) {
    if (2 == cc.pvz.runtimeData.mode) {
      if (0 == t) {
        return 3;
      } else {
        return 1;
      }
    } else {
      if (0 == t) {
        return 10;
      } else {
        return 3;
      }
    }
  },
  getAdCount: function getAdCount(t) {
    if (2 == cc.pvz.runtimeData.mode) {
      if (0 == t) {
        return cc.pvz.runtimeData.buffRefreshCount;
      } else {
        return cc.pvz.runtimeData.buffAllCount;
      }
    } else {
      return cc.pvz.PlayerData.getAdBuffTimes(t);
    }
  },
  useAdCount: function useAdCount(t) {
    if (2 == cc.pvz.runtimeData.mode) {
      if (0 == t) {
        cc.pvz.runtimeData.buffRefreshCount--;
      } else {
        cc.pvz.runtimeData.buffAllCount--;
      }
    } else {
      cc.pvz.PlayerData.updateAdBuffTimes(t);
    }
  },
  updateRefreshTimes: function updateRefreshTimes() {
    this.refreshNode.active = this.getAdCount(0) > 0;
    this.refreshTimesLabel.string = this.getAdCount(0) + "/" + this.getAdMaxCount(0);
    this.btnsLayout.updateLayout();

    if (this.refreshNode.active) {
      cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["buff刷新"]);
    }
  },
  refresh: function refresh(t) {
    var e = this;
    this.buffs = [];

    if (t && cc.pvz.runtimeData.showGame1st) {
      [301, 501, 801].forEach(function (t) {
        if (cc.pvz.runtimeData.hasEnableBuff(t)) {//
        } else {
          e.buffs.push(t);
        }
      });
    }

    var i = t && 5 == cc.pvz.runtimeData.guide;

    if (i) {
      this.buffs.push(201);
    }

    var n = function n() {
      for (var t = e.buffPool[cc.math.randomRangeInt(0, e.buffPool.length)]; e.buffs.some(function (e) {
        return e == t;
      });) {
        t = e.buffPool[cc.math.randomRangeInt(0, e.buffPool.length)];
      }

      e.buffs.push(t);
    };

    for (var o = this.buffs.length; o < this.buffNodes.length; o++) {
      n();
    }

    var s = function s() {
      var t = e.buffs[c];
      var i = e.buffJsonFile.json.find(function (e) {
        return e.id == t;
      });
      var n = e.buffNodes[c];
      cc.pvz.utils.setSpriteFrame(n.bgSp, "uiImage", "game/buff_di" + i.quality);
      cc.pvz.utils.setSpriteFrame(n.qualitySp, "uiImage", "item/pz_" + i.quality);
      cc.pvz.utils.setSpriteFrame(n.iconSp, "uiImage", "skill/skill" + i.icon);
      n.nameLabel.string = i.name;
      n.descLabel.string = i.desc;
      n.descLabel.enabled = !0;
    };

    for (var c = 0; c < this.buffNodes.length; c++) {
      s();
    }

    if (i) {
      var a = this.scene;
      a.timePaused = !0;
      cc.butler.resumeDirector(1);
      var r = this.buffNodes[0].bgSp.node.parent;
      cc.guideManager.showGuide(0, [{
        tip: "击败怪物提升等级，能获得卡皮巴拉的强化",
        focus: r,
        btn: r.name,
        y: -450
      }, {
        hideFinger: !0,
        tip: "尽量击败怪物们变得更强吧！"
      }], function (t) {
        if (t) {
          a.timePaused = !1;
        }
      });
    }
  },
  onClickClose: function onClickClose() {
    cc.popupManager.removePopup(this);
    this.scene.checkIsSucc();
  },
  onClickBuff: function onClickBuff(t, e) {
    var i = this.buffs[parseInt(e)];
    cc.pvz.runtimeData.addBuff(i, this.heroJsonFile.json);
    this.onClickClose();
  },
  onClickRefresh: function onClickRefresh() {
    var t = this;

    if (this.getAdCount(0) <= 0) {//
    } else {
      cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["buff刷新"], function (e) {
        if (e) {
          t.useAdCount(0);
          t.updateRefreshTimes();
          t.refresh(!1);
        }
      });
    }
  },
  onClickGetAll: function onClickGetAll() {
    var t = this;

    if (this.getAdCount(1) <= 0) {//
    } else {
      cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["buff全部"], function (e) {
        if (e) {
          t.useAdCount(1);
          t.buffs.forEach(function (e) {
            cc.pvz.runtimeData.addBuff(e, t.heroJsonFile.json);
          });
          t.onClickClose();
        }
      });
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9nYW1lL3NjcmlwdHMvVUlHYW1lQnVmZi5qcyJdLCJuYW1lcyI6WyJpIiwiY2MiLCJDbGFzcyIsIm5hbWUiLCJwcm9wZXJ0aWVzIiwiYmdTcCIsIlNwcml0ZSIsInF1YWxpdHlTcCIsImljb25TcCIsIm5hbWVMYWJlbCIsIkxhYmVsIiwiZGVzY0xhYmVsIiwiUmljaFRleHQiLCJDb21wb25lbnQiLCJoZXJvSnNvbkZpbGUiLCJKc29uQXNzZXQiLCJidWZmSnNvbkZpbGUiLCJidWZmTm9kZXMiLCJyZWZyZXNoTm9kZSIsIk5vZGUiLCJyZWZyZXNoVGltZXNMYWJlbCIsImdldEFsbE5vZGUiLCJnZXRBbGxUaW1lc0xhYmVsIiwiYnRuc0xheW91dCIsIkxheW91dCIsIm9uTG9hZCIsImZvckVhY2giLCJ0IiwiZW5hYmxlZCIsImluaXRCeSIsImUiLCJzY2VuZSIsImJ1ZmZQb29sIiwianNvbiIsInB2eiIsInJ1bnRpbWVEYXRhIiwiYnVmZnMiLCJmaWx0ZXIiLCJpZCIsImxlbmd0aCIsImdldHRpbWVzIiwicHVzaCIsIk1hdGgiLCJmbG9vciIsIm4iLCJQbGF5ZXJEYXRhIiwiZ2V0VG9vbERhdGEiLCJwb3MiLCJsdiIsImxvY2tsZXZlbCIsIm8iLCJwYXJzZUludCIsImZyb250c2tpbGwiLCJzb21lIiwiZ2V0U3RhZ2VMZXZlbCIsImd1aWRlIiwibW9kZSIsImZpbmRJbmRleCIsInNwbGljZSIsInJlZnJlc2giLCJjaGVja0FuZFJlc2V0QWREYXRhIiwiYWN0aXZlIiwiZ2V0QWRDb3VudCIsInN0cmluZyIsImdldEFkTWF4Q291bnQiLCJ1cGRhdGVSZWZyZXNoVGltZXMiLCJUQVV0aWxzIiwidHJhY2tBZFVJU2hvdyIsIkdhbWVDb25maWciLCJBZFR5cGUiLCJidWZmUmVmcmVzaENvdW50IiwiYnVmZkFsbENvdW50IiwiZ2V0QWRCdWZmVGltZXMiLCJ1c2VBZENvdW50IiwidXBkYXRlQWRCdWZmVGltZXMiLCJ1cGRhdGVMYXlvdXQiLCJzaG93R2FtZTFzdCIsImhhc0VuYWJsZUJ1ZmYiLCJtYXRoIiwicmFuZG9tUmFuZ2VJbnQiLCJzIiwiYyIsImZpbmQiLCJ1dGlscyIsInNldFNwcml0ZUZyYW1lIiwicXVhbGl0eSIsImljb24iLCJkZXNjIiwiYSIsInRpbWVQYXVzZWQiLCJidXRsZXIiLCJyZXN1bWVEaXJlY3RvciIsInIiLCJub2RlIiwicGFyZW50IiwiZ3VpZGVNYW5hZ2VyIiwic2hvd0d1aWRlIiwidGlwIiwiZm9jdXMiLCJidG4iLCJ5IiwiaGlkZUZpbmdlciIsIm9uQ2xpY2tDbG9zZSIsInBvcHVwTWFuYWdlciIsInJlbW92ZVBvcHVwIiwiY2hlY2tJc1N1Y2MiLCJvbkNsaWNrQnVmZiIsImFkZEJ1ZmYiLCJvbkNsaWNrUmVmcmVzaCIsIkFkVXRpbHMiLCJzaG93QWRSZXdhcmRWaWRlbyIsIm9uQ2xpY2tHZXRBbGwiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsSUFBSUEsQ0FBQyxHQUFHQyxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNiQyxJQUFJLEVBQUUsVUFETztFQUViQyxVQUFVLEVBQUU7SUFDUkMsSUFBSSxFQUFFSixFQUFFLENBQUNLLE1BREQ7SUFFUkMsU0FBUyxFQUFFTixFQUFFLENBQUNLLE1BRk47SUFHUkUsTUFBTSxFQUFFUCxFQUFFLENBQUNLLE1BSEg7SUFJUkcsU0FBUyxFQUFFUixFQUFFLENBQUNTLEtBSk47SUFLUkMsU0FBUyxFQUFFVixFQUFFLENBQUNXO0VBTE47QUFGQyxDQUFULENBQVI7QUFVQVgsRUFBRSxDQUFDQyxLQUFILENBQVM7RUFDTCxXQUFTRCxFQUFFLENBQUNZLFNBRFA7RUFFTFQsVUFBVSxFQUFFO0lBQ1JVLFlBQVksRUFBRWIsRUFBRSxDQUFDYyxTQURUO0lBRVJDLFlBQVksRUFBRWYsRUFBRSxDQUFDYyxTQUZUO0lBR1JFLFNBQVMsRUFBRSxDQUFDakIsQ0FBRCxDQUhIO0lBSVJrQixXQUFXLEVBQUVqQixFQUFFLENBQUNrQixJQUpSO0lBS1JDLGlCQUFpQixFQUFFbkIsRUFB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QWEsQ0FBYjtVQUNBOUMsQ0FBQyxDQUFDc0Msa0JBQUY7VUFDQXRDLENBQUMsQ0FBQ2dDLE9BQUYsQ0FBVSxDQUFDLENBQVg7UUFDSDtNQUNKLENBTkQ7SUFPSDtFQUNKLENBcE5JO0VBcU5Mb0QsYUFBYSxFQUFFLHlCQUFZO0lBQ3ZCLElBQUlwRixDQUFDLEdBQUcsSUFBUjs7SUFDQSxJQUFJLEtBQUttQyxVQUFMLENBQWdCLENBQWhCLEtBQXNCLENBQTFCLEVBQTZCLENBQ3pCO0lBQ0gsQ0FGRCxNQUVPO01BQ0g3RCxFQUFFLENBQUNpQyxHQUFILENBQU8yRSxPQUFQLENBQWVDLGlCQUFmLENBQWlDN0csRUFBRSxDQUFDaUMsR0FBSCxDQUFPa0MsVUFBUCxDQUFrQkMsTUFBbEIsQ0FBeUIsUUFBekIsQ0FBakMsRUFBcUUsVUFBVXZDLENBQVYsRUFBYTtRQUM5RSxJQUFJQSxDQUFKLEVBQU87VUFDSEgsQ0FBQyxDQUFDOEMsVUFBRixDQUFhLENBQWI7VUFDQTlDLENBQUMsQ0FBQ1MsS0FBRixDQUFRVixPQUFSLENBQWdCLFVBQVVJLENBQVYsRUFBYTtZQUN6QjdCLEVBQUUsQ0FBQ2lDLEdBQUgsQ0FBT0MsV0FBUCxDQUFtQndFLE9BQW5CLENBQTJCN0UsQ0FBM0IsRUFBOEJILENBQUMsQ0FBQ2IsWUFBRixDQUFlbUIsSUFBN0M7VUFDSCxDQUZEO1VBR0FOLENBQUMsQ0FBQzJFLFlBQUY7UUFDSDtNQUNKLENBUkQ7SUFTSDtFQUNKO0FBcE9JLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciBpID0gY2MuQ2xhc3Moe1xuICAgIG5hbWU6IFwiQnVmZk5vZGVcIixcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGJnU3A6IGNjLlNwcml0ZSxcbiAgICAgICAgcXVhbGl0eVNwOiBjYy5TcHJpdGUsXG4gICAgICAgIGljb25TcDogY2MuU3ByaXRlLFxuICAgICAgICBuYW1lTGFiZWw6IGNjLkxhYmVsLFxuICAgICAgICBkZXNjTGFiZWw6IGNjLlJpY2hUZXh0XG4gICAgfVxufSk7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgaGVyb0pzb25GaWxlOiBjYy5Kc29uQXNzZXQsXG4gICAgICAgIGJ1ZmZKc29uRmlsZTogY2MuSnNvbkFzc2V0LFxuICAgICAgICBidWZmTm9kZXM6IFtpXSxcbiAgICAgICAgcmVmcmVzaE5vZGU6IGNjLk5vZGUsXG4gICAgICAgIHJlZnJlc2hUaW1lc0xhYmVsOiBjYy5MYWJlbCxcbiAgICAgICAgZ2V0QWxsTm9kZTogY2MuTm9kZSxcbiAgICAgICAgZ2V0QWxsVGltZXNMYWJlbDogY2MuTGFiZWwsXG4gICAgICAgIGJ0bnNMYXlvdXQ6IGNjLkxheW91dFxuICAgIH0sXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYnVmZk5vZGVzLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHJldHVybiAodC5kZXNjTGFiZWwuZW5hYmxlZCA9ICExKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpbml0Qnk6IGZ1bmN0aW9uICh0KSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgdGhpcy5zY2VuZSA9IHQ7XG4gICAgICAgIHRoaXMuYnVmZlBvb2wgPSBbXTtcbiAgICAgICAgdGhpcy5idWZmSnNvbkZpbGUuanNvbi5mb3JFYWNoKGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgIShcbiAgICAgICAgICAgICAgICAgICAgY2MucHZ6LnJ1bnRpbWVEYXRhLmJ1ZmZzLmZpbHRlcihmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGUgPT0gdC5pZDtcbiAgICAgICAgICAgICAgICAgICAgfSkubGVuZ3RoID49IHQuZ2V0dGltZXNcbiAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICBpZiAodC5pZCA8IDEwMCkge1xuICAgICAgICAgICAgICAgICAgICBlLmJ1ZmZQb29sLnB1c2godC5pZCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSBNYXRoLmZsb29yKHQuaWQgLyAxMDApO1xuICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IGNjLnB2ei5QbGF5ZXJEYXRhLmdldFRvb2xEYXRhKGkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAobi5wb3MgPj0gMCAmJiBuLmx2ID49IHQubG9ja2xldmVsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgbyA9IHBhcnNlSW50KHQuZnJvbnRza2lsbCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJcIiA9PSB0LmZyb250c2tpbGwgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5wdnoucnVudGltZURhdGEuYnVmZnMuc29tZShmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdCA9PSBvO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLmJ1ZmZQb29sLnB1c2godC5pZCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgaSA9IFtdO1xuICAgICAgICBpZiAoMSA9PSBjYy5wdnouUGxheWVyRGF0YS5nZXRTdGFnZUxldmVsKCkgJiYgY2MucHZ6LnJ1bnRpbWVEYXRhLmd1aWRlIDwgOSkge1xuICAgICAgICAgICAgaS5wdXNoKDI0KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoMiA9PSBjYy5wdnoucnVudGltZURhdGEubW9kZSkge1xuICAgICAgICAgICAgaS5wdXNoKDEzLCAxNCwgMTUsIDE2LCAxNywgMTgsIDIyLCAyMywgMjQsIDMxKTtcbiAgICAgICAgfVxuICAgICAgICBpLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgIHZhciBpID0gZS5idWZmUG9vbC5maW5kSW5kZXgoZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZSA9PSB0O1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoLTEgIT0gaSkge1xuICAgICAgICAgICAgICAgIGUuYnVmZlBvb2wuc3BsaWNlKGksIDEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5yZWZyZXNoKCEwKTtcbiAgICAgICAgY2MucHZ6LlBsYXllckRhdGEuY2hlY2tBbmRSZXNldEFkRGF0YSgpO1xuICAgICAgICB0aGlzLmdldEFsbE5vZGUuYWN0aXZlID0gdGhpcy5nZXRBZENvdW50KDEpID4gMDtcbiAgICAgICAgdGhpcy5nZXRBbGxUaW1lc0xhYmVsLnN0cmluZyA9IHRoaXMuZ2V0QWRDb3VudCgxKSArIFwiL1wiICsgdGhpcy5nZXRBZE1heENvdW50KDEpO1xuICAgICAgICB0aGlzLnVwZGF0ZVJlZnJlc2hUaW1lcygpO1xuICAgICAgICBpZiAodGhpcy5nZXRBbGxOb2RlLmFjdGl2ZSkge1xuICAgICAgICAgICAgY2MucHZ6LlRBVXRpbHMudHJhY2tBZFVJU2hvdyhjYy5wdnouR2FtZUNvbmZpZy5BZFR5cGVbXCJidWZm5YWo6YOoXCJdKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgZ2V0QWRNYXhDb3VudDogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgaWYgKDIgPT0gY2MucHZ6LnJ1bnRpbWVEYXRhLm1vZGUpIHtcbiAgICAgICAgICAgIGlmICgwID09IHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMztcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoMCA9PSB0KSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDEwO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgZ2V0QWRDb3VudDogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgaWYgKDIgPT0gY2MucHZ6LnJ1bnRpbWVEYXRhLm1vZGUpIHtcbiAgICAgICAgICAgIGlmICgwID09IHQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gY2MucHZ6LnJ1bnRpbWVEYXRhLmJ1ZmZSZWZyZXNoQ291bnQ7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBjYy5wdnoucnVudGltZURhdGEuYnVmZkFsbENvdW50O1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGNjLnB2ei5QbGF5ZXJEYXRhLmdldEFkQnVmZlRpbWVzKHQpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB1c2VBZENvdW50OiBmdW5jdGlvbiAodCkge1xuICAgICAgICBpZiAoMiA9PSBjYy5wdnoucnVudGltZURhdGEubW9kZSkge1xuICAgICAgICAgICAgaWYgKDAgPT0gdCkge1xuICAgICAgICAgICAgICAgIGNjLnB2ei5ydW50aW1lRGF0YS5idWZmUmVmcmVzaENvdW50LS07XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNjLnB2ei5ydW50aW1lRGF0YS5idWZmQWxsQ291bnQtLTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLnVwZGF0ZUFkQnVmZlRpbWVzKHQpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICB1cGRhdGVSZWZyZXNoVGltZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5yZWZyZXNoTm9kZS5hY3RpdmUgPSB0aGlzLmdldEFkQ291bnQoMCkgPiAwO1xuICAgICAgICB0aGlzLnJlZnJlc2hUaW1lc0xhYmVsLnN0cmluZyA9IHRoaXMuZ2V0QWRDb3VudCgwKSArIFwiL1wiICsgdGhpcy5nZXRBZE1heENvdW50KDApO1xuICAgICAgICB0aGlzLmJ0bnNMYXlvdXQudXBkYXRlTGF5b3V0KCk7XG4gICAgICAgIGlmICh0aGlzLnJlZnJlc2hOb2RlLmFjdGl2ZSkge1xuICAgICAgICAgICAgY2MucHZ6LlRBVXRpbHMudHJhY2tBZFVJU2hvdyhjYy5wdnouR2FtZUNvbmZpZy5BZFR5cGVbXCJidWZm5Yi35pawXCJdKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcmVmcmVzaDogZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICB0aGlzLmJ1ZmZzID0gW107XG4gICAgICAgIGlmICh0ICYmIGNjLnB2ei5ydW50aW1lRGF0YS5zaG93R2FtZTFzdCkge1xuICAgICAgICAgICAgWzMwMSwgNTAxLCA4MDFdLmZvckVhY2goZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICBpZiAoY2MucHZ6LnJ1bnRpbWVEYXRhLmhhc0VuYWJsZUJ1ZmYodCkpIHtcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBlLmJ1ZmZzLnB1c2godCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGkgPSB0ICYmIDUgPT0gY2MucHZ6LnJ1bnRpbWVEYXRhLmd1aWRlO1xuICAgICAgICBpZiAoaSkge1xuICAgICAgICAgICAgdGhpcy5idWZmcy5wdXNoKDIwMSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG4gPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBmb3IgKFxuICAgICAgICAgICAgICAgIHZhciB0ID0gZS5idWZmUG9vbFtjYy5tYXRoLnJhbmRvbVJhbmdlSW50KDAsIGUuYnVmZlBvb2wubGVuZ3RoKV07XG4gICAgICAgICAgICAgICAgZS5idWZmcy5zb21lKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBlID09IHQ7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICB0ID0gZS5idWZmUG9vbFtjYy5tYXRoLnJhbmRvbVJhbmdlSW50KDAsIGUuYnVmZlBvb2wubGVuZ3RoKV07XG4gICAgICAgICAgICBlLmJ1ZmZzLnB1c2godCk7XG4gICAgICAgIH07XG4gICAgICAgIGZvciAodmFyIG8gPSB0aGlzLmJ1ZmZzLmxlbmd0aDsgbyA8IHRoaXMuYnVmZk5vZGVzLmxlbmd0aDsgbysrKSB7XG4gICAgICAgICAgICBuKCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgdCA9IGUuYnVmZnNbY107XG4gICAgICAgICAgICB2YXIgaSA9IGUuYnVmZkpzb25GaWxlLmpzb24uZmluZChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBlLmlkID09IHQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHZhciBuID0gZS5idWZmTm9kZXNbY107XG4gICAgICAgICAgICBjYy5wdnoudXRpbHMuc2V0U3ByaXRlRnJhbWUobi5iZ1NwLCBcInVpSW1hZ2VcIiwgXCJnYW1lL2J1ZmZfZGlcIiArIGkucXVhbGl0eSk7XG4gICAgICAgICAgICBjYy5wdnoudXRpbHMuc2V0U3ByaXRlRnJhbWUobi5xdWFsaXR5U3AsIFwidWlJbWFnZVwiLCBcIml0ZW0vcHpfXCIgKyBpLnF1YWxpdHkpO1xuICAgICAgICAgICAgY2MucHZ6LnV0aWxzLnNldFNwcml0ZUZyYW1lKG4uaWNvblNwLCBcInVpSW1hZ2VcIiwgXCJza2lsbC9za2lsbFwiICsgaS5pY29uKTtcbiAgICAgICAgICAgIG4ubmFtZUxhYmVsLnN0cmluZyA9IGkubmFtZTtcbiAgICAgICAgICAgIG4uZGVzY0xhYmVsLnN0cmluZyA9IGkuZGVzYztcbiAgICAgICAgICAgIG4uZGVzY0xhYmVsLmVuYWJsZWQgPSAhMDtcbiAgICAgICAgfTtcbiAgICAgICAgZm9yICh2YXIgYyA9IDA7IGMgPCB0aGlzLmJ1ZmZOb2Rlcy5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgcygpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpKSB7XG4gICAgICAgICAgICB2YXIgYSA9IHRoaXMuc2NlbmU7XG4gICAgICAgICAgICBhLnRpbWVQYXVzZWQgPSAhMDtcbiAgICAgICAgICAgIGNjLmJ1dGxlci5yZXN1bWVEaXJlY3RvcigxKTtcbiAgICAgICAgICAgIHZhciByID0gdGhpcy5idWZmTm9kZXNbMF0uYmdTcC5ub2RlLnBhcmVudDtcbiAgICAgICAgICAgIGNjLmd1aWRlTWFuYWdlci5zaG93R3VpZGUoXG4gICAgICAgICAgICAgICAgMCxcbiAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRpcDogXCLlh7votKXmgKrnianmj5DljYfnrYnnuqfvvIzog73ojrflvpfljaHnmq7lt7Tmi4nnmoTlvLrljJZcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvY3VzOiByLFxuICAgICAgICAgICAgICAgICAgICAgICAgYnRuOiByLm5hbWUsXG4gICAgICAgICAgICAgICAgICAgICAgICB5OiAtNDUwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGhpZGVGaW5nZXI6ICEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgdGlwOiBcIuWwvemHj+WHu+i0peaAqueJqeS7rOWPmOW+l+abtOW8uuWQp++8gVwiXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhLnRpbWVQYXVzZWQgPSAhMTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5wb3B1cE1hbmFnZXIucmVtb3ZlUG9wdXAodGhpcyk7XG4gICAgICAgIHRoaXMuc2NlbmUuY2hlY2tJc1N1Y2MoKTtcbiAgICB9LFxuICAgIG9uQ2xpY2tCdWZmOiBmdW5jdGlvbiAodCwgZSkge1xuICAgICAgICB2YXIgaSA9IHRoaXMuYnVmZnNbcGFyc2VJbnQoZSldO1xuICAgICAgICBjYy5wdnoucnVudGltZURhdGEuYWRkQnVmZihpLCB0aGlzLmhlcm9Kc29uRmlsZS5qc29uKTtcbiAgICAgICAgdGhpcy5vbkNsaWNrQ2xvc2UoKTtcbiAgICB9LFxuICAgIG9uQ2xpY2tSZWZyZXNoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgaWYgKHRoaXMuZ2V0QWRDb3VudCgwKSA8PSAwKSB7XG4gICAgICAgICAgICAvL1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MucHZ6LkFkVXRpbHMuc2hvd0FkUmV3YXJkVmlkZW8oY2MucHZ6LkdhbWVDb25maWcuQWRUeXBlW1wiYnVmZuWIt+aWsFwiXSwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgICAgICAgICB0LnVzZUFkQ291bnQoMCk7XG4gICAgICAgICAgICAgICAgICAgIHQudXBkYXRlUmVmcmVzaFRpbWVzKCk7XG4gICAgICAgICAgICAgICAgICAgIHQucmVmcmVzaCghMSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tHZXRBbGw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHQgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5nZXRBZENvdW50KDEpIDw9IDApIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5wdnouQWRVdGlscy5zaG93QWRSZXdhcmRWaWRlbyhjYy5wdnouR2FtZUNvbmZpZy5BZFR5cGVbXCJidWZm5YWo6YOoXCJdLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHQudXNlQWRDb3VudCgxKTtcbiAgICAgICAgICAgICAgICAgICAgdC5idWZmcy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5wdnoucnVudGltZURhdGEuYWRkQnVmZihlLCB0Lmhlcm9Kc29uRmlsZS5qc29uKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIHQub25DbGlja0Nsb3NlKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdfQ==