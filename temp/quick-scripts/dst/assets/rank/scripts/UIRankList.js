
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/rank/scripts/UIRankList.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '7e668v3Iv1KNrC3lKjau9id', 'UIRankList');
// rank/scripts/UIRankList.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    top123Nodes: [cc.Node],
    rank1234Nodes: [cc.Node],
    emptyTip: cc.Node,
    rankMeNode: cc.Node,
    boxJsonFile: cc.JsonAsset,
    boxPopupRoot: cc.Node
  },
  getBoxIDByRank: function getBoxIDByRank(e) {
    var t = e + 1;

    for (var n = 0; n < this.boxJsonFile.json.length; n++) {
      var c = this.boxJsonFile.json[n];

      if (t >= c.rank1 && t <= c.rank2) {
        return c.ID;
      }
    }

    return this.boxJsonFile.json[this.boxJsonFile.json.length - 1].ID;
  },
  fillRankNode: function fillRankNode(e, t) {
    var n = -1 != t.rank;
    var c = null;

    if (e) {
      c = this.rankMeNode;
      t.uInfo = t.info;
    } else {
      if (t.rank < 3) {
        c = this.rank1234Nodes[t.rank];
      } else {
        (c = cc.instantiate(this.rank1234Nodes[3])).parent = this.rank1234Nodes[3].parent;
      }
    }

    var o;

    if (t.uInfo.name && "NONAME" != t.uInfo.name) {
      o = t.uInfo.name;
    } else {
      o = "用户" + t.uInfo.uid;
    }

    if (n) {
      cc.find("ranknum", c).getComponent(cc.Label).string = t.rank + 1;
    } else {
      cc.find("ranknum", c).getComponent(cc.Label).string = "无";
    }

    cc.find("name", c).getComponent(cc.Label).string = o;
    cc.find("wavenum", c).getComponent(cc.Label).string = t.uInfo.score + "波";
    var i = cc.find("icon", c).getComponent(cc.Sprite);

    if (t.uInfo.avatarUrl && t.uInfo.avatarUrl.length > 0) {
      cc.assetManager.loadRemote(t.uInfo.avatarUrl, {
        ext: ".jpg"
      }, function (e, t) {
        var n = new cc.SpriteFrame();
        n.setTexture(t);
        i.spriteFrame = n;
      });
    }

    var a = cc.find("box", c).getComponent(cc.Sprite);

    if (n) {
      var r = this.getBoxIDByRank(t.rank);
      cc.pvz.utils.setSpriteFrame(a, "rank", "img/bx" + r);
      a.getComponent(cc.Button).clickEvents[0].customEventData = r;
    } else {
      a.node.active = !1;
    }

    if (n && t.rank < 3) {
      var s = this.top123Nodes[t.rank];
      cc.find("name", s).getComponent(cc.Label).string = o;
      cc.find("wavenum", s).getComponent(cc.Label).string = t.uInfo.score + "波";
      var p;

      if (t.uInfo.exInfo.length > 0) {
        p = t.uInfo.exInfo;
      } else {
        p = "1";
      }

      cc.pvz.utils.useBundleAsset("actors", "character/Characters", sp.SkeletonData, function (e) {
        var t = cc.find("spine", s).getComponent(sp.Skeleton);
        t.skeletonData = e;
        t.setAnimation(0, "stand1", !0);
      });
      s.active = !0;
    }

    c.active = !0;
  },
  initBy: function initBy(e) {
    var t = this;
    this.uiNode = e;
    this.top123Nodes.forEach(function (e) {
      return e.active = !1;
    });
    this.rank1234Nodes.forEach(function (e) {
      return e.active = !1;
    });
    this.emptyTip.active = !0;
    this.boxPopupRoot.active = !1;
    this.pageCount = 0;
    cc.pvz.cloud.rankList(0, function (e, n) {
      if (e && n.length > 0) {
        n.forEach(function (e) {
          t.fillRankNode(!1, e);
        });
        t.pageCount = 1;
        t.emptyTip.active = !1;
      }
    });
    this.updateMyRank();
  },
  updateMyRank: function updateMyRank() {
    var e = this;
    cc.pvz.cloud.myRank(function (t, n) {
      if (t) {
        if (-1 != n.rank && n.rank < cc.tmpRank) {
          e.showRankUp(cc.tmpRank + 1, n.rank + 1);
        }

        cc.tmpRank = n.rank;
        cc.tmpScore = n.info.score;
        e.fillRankNode(!0, n);
      }
    });
  },
  showFinish: function showFinish() {
    this.uiNode.active = !1;
  },
  onScrollEvent: function onScrollEvent(e, t) {
    var n = this;

    if (t != cc.ScrollView.EventType.SCROLL_BEGAN) {
      if (t == cc.ScrollView.EventType.SCROLL_TO_BOTTOM && this.pageCount < 5) {
        if (this.isFetching) {
          return;
        }

        this.isFetching = !0;
        cc.pvz.cloud.rankList(20 * this.pageCount, function (e, t) {
          n.isFetching = !1;

          if (e && t.length > 0) {
            t.forEach(function (e) {
              n.fillRankNode(!1, e);
            });
            n.pageCount++;
          }
        });
      }
    } else {
      this.hideBoxPopup();
    }
  },
  showRankUp: function showRankUp(e, t) {
    var n = this;
    cc.pvz.utils.useBundleAsset("rank", "RankUpEffect", cc.Prefab, function (c) {
      var o = cc.instantiate(c);
      o.getComponent("UIRankUpEffect").initBy(e, t);
      o.parent = n.node;
    });
  },
  onClickClose: function onClickClose() {
    this.uiNode.active = !0;
    cc.popupManager.removePopup(this);
  },
  onClickAuthorize: function onClickAuthorize() {
    var e = this;
    cc.popupManager.popup("rank", "shouquanUI", "UIAuthorize", {
      ad: !1,
      scale: !1
    }, function (t) {
      if (t) {
        e.updateMyRank();
      }
    });
  },
  onClickShare: function onClickShare() {
    var e;

    if (cc.tmpRank >= 0) {
      e = "我获得了第" + (cc.tmpRank + 1) + "名，你也来试试吧";
    } else {
      e = "无尽排位赛，你也来试试吧";
    }

    cc.pvz.TAUtils.shareCurrent(e, function () {
      cc.popupManager.showToast("分享成功");
    });
  },
  onClickBox: function onClickBox(e, t) {
    var n = parseInt(t);
    var c = this.boxJsonFile.json.find(function (e) {
      return e.ID == n;
    });
    cc.find("num1", this.boxPopupRoot).getComponent(cc.Label).string = "x" + c.reward[1];
    cc.find("num2", this.boxPopupRoot).getComponent(cc.Label).string = "x" + c.reward[3];
    var o = e.target.convertToWorldSpaceAR(cc.Vec2.ZERO);
    var i = this.boxPopupRoot.parent.convertToNodeSpaceAR(o);
    this.boxPopupRoot.position = i;
    this.boxPopupRoot.active = !0;
  },
  onClickBg: function onClickBg() {
    this.hideBoxPopup();
  },
  hideBoxPopup: function hideBoxPopup() {
    this.boxPopupRoot.active = !1;
  },
  onClickUpload: function onClickUpload() {
    cc.pvz.cloud.uploadScore(13, function () {});
    cc.pvz.cloud.myRank(function () {});
    cc.pvz.cloud.rankList(0, function () {});
    cc.pvz.cloud.rankList(20, function () {});
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9yYW5rL3NjcmlwdHMvVUlSYW5rTGlzdC5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsInRvcDEyM05vZGVzIiwiTm9kZSIsInJhbmsxMjM0Tm9kZXMiLCJlbXB0eVRpcCIsInJhbmtNZU5vZGUiLCJib3hKc29uRmlsZSIsIkpzb25Bc3NldCIsImJveFBvcHVwUm9vdCIsImdldEJveElEQnlSYW5rIiwiZSIsInQiLCJuIiwianNvbiIsImxlbmd0aCIsImMiLCJyYW5rMSIsInJhbmsyIiwiSUQiLCJmaWxsUmFua05vZGUiLCJyYW5rIiwidUluZm8iLCJpbmZvIiwiaW5zdGFudGlhdGUiLCJwYXJlbnQiLCJvIiwibmFtZSIsInVpZCIsImZpbmQiLCJnZXRDb21wb25lbnQiLCJMYWJlbCIsInN0cmluZyIsInNjb3JlIiwiaSIsIlNwcml0ZSIsImF2YXRhclVybCIsImFzc2V0TWFuYWdlciIsImxvYWRSZW1vdGUiLCJleHQiLCJTcHJpdGVGcmFtZSIsInNldFRleHR1cmUiLCJzcHJpdGVGcmFtZSIsImEiLCJyIiwicHZ6IiwidXRpbHMiLCJzZXRTcHJpdGVGcmFtZSIsIkJ1dHRvbiIsImNsaWNrRXZlbnRzIiwiY3VzdG9tRXZlbnREYXRhIiwibm9kZSIsImFjdGl2ZSIsInMiLCJwIiwiZXhJbmZvIiwidXNlQnVuZGxlQXNzZXQiLCJzcCIsIlNrZWxldG9uRGF0YSIsIlNrZWxldG9uIiwic2tlbGV0b25EYXRhIiwic2V0QW5pbWF0aW9uIiwiaW5pdEJ5IiwidWlOb2RlIiwiZm9yRWFjaCIsInBhZ2VDb3VudCIsImNsb3VkIiwicmFua0xpc3QiLCJ1cGRhdGVNeVJhbmsiLCJteVJhbmsiLCJ0bXBSYW5rIiwic2hvd1JhbmtVcCIsInRtcFNjb3JlIiwic2hvd0ZpbmlzaCIsIm9uU2Nyb2xsRXZlbnQiLCJTY3JvbGxWaWV3IiwiRXZlbnRUeXBlIiwiU0NST0xMX0JFR0FOIiwiU0NST0xMX1RPX0JPVFRPTSIsImlzRmV0Y2hpbmciLCJoaWRlQm94UG9wdXAiLCJQcmVmYWIiLCJvbkNsaWNrQ2xvc2UiLCJwb3B1cE1hbmFnZXIiLCJyZW1vdmVQb3B1cCIsIm9uQ2xpY2tBdXRob3JpemUiLCJwb3B1cCIsImFkIiwic2NhbGUiLCJvbkNsaWNrU2hhcmUiLCJUQVV0aWxzIiwic2hhcmVDdXJyZW50Iiwic2hvd1RvYXN0Iiwib25DbGlja0JveCIsInBhcnNlSW50IiwicmV3YXJkIiwidGFyZ2V0IiwiY29udmVydFRvV29ybGRTcGFjZUFSIiwiVmVjMiIsIlpFUk8iLCJjb252ZXJ0VG9Ob2RlU3BhY2VBUiIsInBvc2l0aW9uIiwib25DbGlja0JnIiwib25DbGlja1VwbG9hZCIsInVwbG9hZFNjb3JlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNMLFdBQVNELEVBQUUsQ0FBQ0UsU0FEUDtFQUVMQyxVQUFVLEVBQUU7SUFDUkMsV0FBVyxFQUFFLENBQUNKLEVBQUUsQ0FBQ0ssSUFBSixDQURMO0lBRVJDLGFBQWEsRUFBRSxDQUFDTixFQUFFLENBQUNLLElBQUosQ0FGUDtJQUdSRSxRQUFRLEVBQUVQLEVBQUUsQ0FBQ0ssSUFITDtJQUlSRyxVQUFVLEVBQUVSLEVBQUUsQ0FBQ0ssSUFKUDtJQUtSSSxXQUFXLEVBQUVULEVBQUUsQ0FBQ1UsU0FMUjtJQU1SQyxZQUFZLEVBQUVYLEVBQUUsQ0FBQ0s7RUFOVCxDQUZQO0VBVUxPLGNBQWMsRUFBRSx3QkFBVUMsQ0FBVixFQUFhO0lBQ3pCLElBQUlDLENBQUMsR0FBR0QsQ0FBQyxHQUFHLENBQVo7O0lBQ0EsS0FBSyxJQUFJRSxDQUFDLEdBQUcsQ0FBYixFQUFnQkEsQ0FBQyxHQUFHLEtBQUtOLFdBQUwsQ0FBaUJPLElBQWpCLENBQXNCQyxNQUExQyxFQUFrREYsQ0FBQyxFQUFuRCxFQUF1RDtNQUNuRCxJQUFJRyxDQUFDLEdBQUcsS0FBS1QsV0FBTCxDQUFpQk8sSUFBakIsQ0FBc0JELENBQXRCLENBQVI7O01B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QUFDK0UsTUFBRixDQUFTLENBQVQsQ0FBekU7SUFDQSxJQUFJckUsQ0FBQyxHQUFHZixDQUFDLENBQUNxRixNQUFGLENBQVNDLHFCQUFULENBQStCbkcsRUFBRSxDQUFDb0csSUFBSCxDQUFRQyxJQUF2QyxDQUFSO0lBQ0EsSUFBSWpFLENBQUMsR0FBRyxLQUFLekIsWUFBTCxDQUFrQmdCLE1BQWxCLENBQXlCMkUsb0JBQXpCLENBQThDMUUsQ0FBOUMsQ0FBUjtJQUNBLEtBQUtqQixZQUFMLENBQWtCNEYsUUFBbEIsR0FBNkJuRSxDQUE3QjtJQUNBLEtBQUt6QixZQUFMLENBQWtCMkMsTUFBbEIsR0FBMkIsQ0FBQyxDQUE1QjtFQUNILENBdk1JO0VBd01Ma0QsU0FBUyxFQUFFLHFCQUFZO0lBQ25CLEtBQUt0QixZQUFMO0VBQ0gsQ0ExTUk7RUEyTUxBLFlBQVksRUFBRSx3QkFBWTtJQUN0QixLQUFLdkUsWUFBTCxDQUFrQjJDLE1BQWxCLEdBQTJCLENBQUMsQ0FBNUI7RUFDSCxDQTdNSTtFQThNTG1ELGFBQWEsRUFBRSx5QkFBWTtJQUN2QnpHLEVBQUUsQ0FBQytDLEdBQUgsQ0FBT3FCLEtBQVAsQ0FBYXNDLFdBQWIsQ0FBeUIsRUFBekIsRUFBNkIsWUFBWSxDQUFFLENBQTNDO0lBQ0ExRyxFQUFFLENBQUMrQyxHQUFILENBQU9xQixLQUFQLENBQWFHLE1BQWIsQ0FBb0IsWUFBWSxDQUFFLENBQWxDO0lBQ0F2RSxFQUFFLENBQUMrQyxHQUFILENBQU9xQixLQUFQLENBQWFDLFFBQWIsQ0FBc0IsQ0FBdEIsRUFBeUIsWUFBWSxDQUFFLENBQXZDO0lBQ0FyRSxFQUFFLENBQUMrQyxHQUFILENBQU9xQixLQUFQLENBQWFDLFFBQWIsQ0FBc0IsRUFBdEIsRUFBMEIsWUFBWSxDQUFFLENBQXhDO0VBQ0g7QUFuTkksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIHRvcDEyM05vZGVzOiBbY2MuTm9kZV0sXG4gICAgICAgIHJhbmsxMjM0Tm9kZXM6IFtjYy5Ob2RlXSxcbiAgICAgICAgZW1wdHlUaXA6IGNjLk5vZGUsXG4gICAgICAgIHJhbmtNZU5vZGU6IGNjLk5vZGUsXG4gICAgICAgIGJveEpzb25GaWxlOiBjYy5Kc29uQXNzZXQsXG4gICAgICAgIGJveFBvcHVwUm9vdDogY2MuTm9kZVxuICAgIH0sXG4gICAgZ2V0Qm94SURCeVJhbms6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0ID0gZSArIDE7XG4gICAgICAgIGZvciAodmFyIG4gPSAwOyBuIDwgdGhpcy5ib3hKc29uRmlsZS5qc29uLmxlbmd0aDsgbisrKSB7XG4gICAgICAgICAgICB2YXIgYyA9IHRoaXMuYm94SnNvbkZpbGUuanNvbltuXTtcbiAgICAgICAgICAgIGlmICh0ID49IGMucmFuazEgJiYgdCA8PSBjLnJhbmsyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGMuSUQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuYm94SnNvbkZpbGUuanNvblt0aGlzLmJveEpzb25GaWxlLmpzb24ubGVuZ3RoIC0gMV0uSUQ7XG4gICAgfSxcbiAgICBmaWxsUmFua05vZGU6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHZhciBuID0gLTEgIT0gdC5yYW5rO1xuICAgICAgICB2YXIgYyA9IG51bGw7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICBjID0gdGhpcy5yYW5rTWVOb2RlO1xuICAgICAgICAgICAgdC51SW5mbyA9IHQuaW5mbztcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmICh0LnJhbmsgPCAzKSB7XG4gICAgICAgICAgICAgICAgYyA9IHRoaXMucmFuazEyMzROb2Rlc1t0LnJhbmtdO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAoYyA9IGNjLmluc3RhbnRpYXRlKHRoaXMucmFuazEyMzROb2Rlc1szXSkpLnBhcmVudCA9IHRoaXMucmFuazEyMzROb2Rlc1szXS5wYXJlbnQ7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG87XG4gICAgICAgIGlmICh0LnVJbmZvLm5hbWUgJiYgXCJOT05BTUVcIiAhPSB0LnVJbmZvLm5hbWUpIHtcbiAgICAgICAgICAgIG8gPSB0LnVJbmZvLm5hbWU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBvID0gXCLnlKjmiLdcIiArIHQudUluZm8udWlkO1xuICAgICAgICB9XG4gICAgICAgIGlmIChuKSB7XG4gICAgICAgICAgICBjYy5maW5kKFwicmFua251bVwiLCBjKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHQucmFuayArIDE7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5maW5kKFwicmFua251bVwiLCBjKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwi5pegXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2MuZmluZChcIm5hbWVcIiwgYykuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBvO1xuICAgICAgICBjYy5maW5kKFwid2F2ZW51bVwiLCBjKS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IHQudUluZm8uc2NvcmUgKyBcIuazolwiO1xuICAgICAgICB2YXIgaSA9IGNjLmZpbmQoXCJpY29uXCIsIGMpLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xuICAgICAgICBpZiAodC51SW5mby5hdmF0YXJVcmwgJiYgdC51SW5mby5hdmF0YXJVcmwubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgY2MuYXNzZXRNYW5hZ2VyLmxvYWRSZW1vdGUoXG4gICAgICAgICAgICAgICAgdC51SW5mby5hdmF0YXJVcmwsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBleHQ6IFwiLmpwZ1wiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbiA9IG5ldyBjYy5TcHJpdGVGcmFtZSgpO1xuICAgICAgICAgICAgICAgICAgICBuLnNldFRleHR1cmUodCk7XG4gICAgICAgICAgICAgICAgICAgIGkuc3ByaXRlRnJhbWUgPSBuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBjYy5maW5kKFwiYm94XCIsIGMpLmdldENvbXBvbmVudChjYy5TcHJpdGUpO1xuICAgICAgICBpZiAobikge1xuICAgICAgICAgICAgdmFyIHIgPSB0aGlzLmdldEJveElEQnlSYW5rKHQucmFuayk7XG4gICAgICAgICAgICBjYy5wdnoudXRpbHMuc2V0U3ByaXRlRnJhbWUoYSwgXCJyYW5rXCIsIFwiaW1nL2J4XCIgKyByKTtcbiAgICAgICAgICAgIGEuZ2V0Q29tcG9uZW50KGNjLkJ1dHRvbikuY2xpY2tFdmVudHNbMF0uY3VzdG9tRXZlbnREYXRhID0gcjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGEubm9kZS5hY3RpdmUgPSAhMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAobiAmJiB0LnJhbmsgPCAzKSB7XG4gICAgICAgICAgICB2YXIgcyA9IHRoaXMudG9wMTIzTm9kZXNbdC5yYW5rXTtcbiAgICAgICAgICAgIGNjLmZpbmQoXCJuYW1lXCIsIHMpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gbztcbiAgICAgICAgICAgIGNjLmZpbmQoXCJ3YXZlbnVtXCIsIHMpLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gdC51SW5mby5zY29yZSArIFwi5rOiXCI7XG4gICAgICAgICAgICB2YXIgcDtcbiAgICAgICAgICAgIGlmICh0LnVJbmZvLmV4SW5mby5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgcCA9IHQudUluZm8uZXhJbmZvO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBwID0gXCIxXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYy5wdnoudXRpbHMudXNlQnVuZGxlQXNzZXQoXCJhY3RvcnNcIiwgXCJjaGFyYWN0ZXIvQ2hhcmFjdGVyc1wiLCBzcC5Ta2VsZXRvbkRhdGEsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHQgPSBjYy5maW5kKFwic3BpbmVcIiwgcykuZ2V0Q29tcG9uZW50KHNwLlNrZWxldG9uKTtcbiAgICAgICAgICAgICAgICB0LnNrZWxldG9uRGF0YSA9IGU7XG4gICAgICAgICAgICAgICAgdC5zZXRBbmltYXRpb24oMCwgXCJzdGFuZDFcIiwgITApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBzLmFjdGl2ZSA9ICEwO1xuICAgICAgICB9XG4gICAgICAgIGMuYWN0aXZlID0gITA7XG4gICAgfSxcbiAgICBpbml0Qnk6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgdGhpcy51aU5vZGUgPSBlO1xuICAgICAgICB0aGlzLnRvcDEyM05vZGVzLmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIHJldHVybiAoZS5hY3RpdmUgPSAhMSk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnJhbmsxMjM0Tm9kZXMuZm9yRWFjaChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIChlLmFjdGl2ZSA9ICExKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZW1wdHlUaXAuYWN0aXZlID0gITA7XG4gICAgICAgIHRoaXMuYm94UG9wdXBSb290LmFjdGl2ZSA9ICExO1xuICAgICAgICB0aGlzLnBhZ2VDb3VudCA9IDA7XG4gICAgICAgIGNjLnB2ei5jbG91ZC5yYW5rTGlzdCgwLCBmdW5jdGlvbiAoZSwgbikge1xuICAgICAgICAgICAgaWYgKGUgJiYgbi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgbi5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIHQuZmlsbFJhbmtOb2RlKCExLCBlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB0LnBhZ2VDb3VudCA9IDE7XG4gICAgICAgICAgICAgICAgdC5lbXB0eVRpcC5hY3RpdmUgPSAhMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMudXBkYXRlTXlSYW5rKCk7XG4gICAgfSxcbiAgICB1cGRhdGVNeVJhbms6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICBjYy5wdnouY2xvdWQubXlSYW5rKGZ1bmN0aW9uICh0LCBuKSB7XG4gICAgICAgICAgICBpZiAodCkge1xuICAgICAgICAgICAgICAgIGlmICgtMSAhPSBuLnJhbmsgJiYgbi5yYW5rIDwgY2MudG1wUmFuaykge1xuICAgICAgICAgICAgICAgICAgICBlLnNob3dSYW5rVXAoY2MudG1wUmFuayArIDEsIG4ucmFuayArIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYy50bXBSYW5rID0gbi5yYW5rO1xuICAgICAgICAgICAgICAgIGNjLnRtcFNjb3JlID0gbi5pbmZvLnNjb3JlO1xuICAgICAgICAgICAgICAgIGUuZmlsbFJhbmtOb2RlKCEwLCBuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBzaG93RmluaXNoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMudWlOb2RlLmFjdGl2ZSA9ICExO1xuICAgIH0sXG4gICAgb25TY3JvbGxFdmVudDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdmFyIG4gPSB0aGlzO1xuICAgICAgICBpZiAodCAhPSBjYy5TY3JvbGxWaWV3LkV2ZW50VHlwZS5TQ1JPTExfQkVHQU4pIHtcbiAgICAgICAgICAgIGlmICh0ID09IGNjLlNjcm9sbFZpZXcuRXZlbnRUeXBlLlNDUk9MTF9UT19CT1RUT00gJiYgdGhpcy5wYWdlQ291bnQgPCA1KSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuaXNGZXRjaGluZykge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRoaXMuaXNGZXRjaGluZyA9ICEwO1xuICAgICAgICAgICAgICAgIGNjLnB2ei5jbG91ZC5yYW5rTGlzdCgyMCAqIHRoaXMucGFnZUNvdW50LCBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICAgICAgICAgICAgICBuLmlzRmV0Y2hpbmcgPSAhMTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUgJiYgdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0LmZvckVhY2goZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuLmZpbGxSYW5rTm9kZSghMSwgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIG4ucGFnZUNvdW50Kys7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaGlkZUJveFBvcHVwKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNob3dSYW5rVXA6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHZhciBuID0gdGhpcztcbiAgICAgICAgY2MucHZ6LnV0aWxzLnVzZUJ1bmRsZUFzc2V0KFwicmFua1wiLCBcIlJhbmtVcEVmZmVjdFwiLCBjYy5QcmVmYWIsIGZ1bmN0aW9uIChjKSB7XG4gICAgICAgICAgICB2YXIgbyA9IGNjLmluc3RhbnRpYXRlKGMpO1xuICAgICAgICAgICAgby5nZXRDb21wb25lbnQoXCJVSVJhbmtVcEVmZmVjdFwiKS5pbml0QnkoZSwgdCk7XG4gICAgICAgICAgICBvLnBhcmVudCA9IG4ubm9kZTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBvbkNsaWNrQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy51aU5vZGUuYWN0aXZlID0gITA7XG4gICAgICAgIGNjLnBvcHVwTWFuYWdlci5yZW1vdmVQb3B1cCh0aGlzKTtcbiAgICB9LFxuICAgIG9uQ2xpY2tBdXRob3JpemU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICBcInJhbmtcIixcbiAgICAgICAgICAgIFwic2hvdXF1YW5VSVwiLFxuICAgICAgICAgICAgXCJVSUF1dGhvcml6ZVwiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGFkOiAhMSxcbiAgICAgICAgICAgICAgICBzY2FsZTogITFcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgIGlmICh0KSB7XG4gICAgICAgICAgICAgICAgICAgIGUudXBkYXRlTXlSYW5rKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICApO1xuICAgIH0sXG4gICAgb25DbGlja1NoYXJlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlO1xuICAgICAgICBpZiAoY2MudG1wUmFuayA+PSAwKSB7XG4gICAgICAgICAgICBlID0gXCLmiJHojrflvpfkuobnrKxcIiArIChjYy50bXBSYW5rICsgMSkgKyBcIuWQje+8jOS9oOS5n+adpeivleivleWQp1wiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZSA9IFwi5peg5bC95o6S5L2N6LWb77yM5L2g5Lmf5p2l6K+V6K+V5ZCnXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2MucHZ6LlRBVXRpbHMuc2hhcmVDdXJyZW50KGUsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5zaG93VG9hc3QoXCLliIbkuqvmiJDlip9cIik7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgb25DbGlja0JveDogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdmFyIG4gPSBwYXJzZUludCh0KTtcbiAgICAgICAgdmFyIGMgPSB0aGlzLmJveEpzb25GaWxlLmpzb24uZmluZChmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgcmV0dXJuIGUuSUQgPT0gbjtcbiAgICAgICAgfSk7XG4gICAgICAgIGNjLmZpbmQoXCJudW0xXCIsIHRoaXMuYm94UG9wdXBSb290KS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwieFwiICsgYy5yZXdhcmRbMV07XG4gICAgICAgIGNjLmZpbmQoXCJudW0yXCIsIHRoaXMuYm94UG9wdXBSb290KS5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9IFwieFwiICsgYy5yZXdhcmRbM107XG4gICAgICAgIHZhciBvID0gZS50YXJnZXQuY29udmVydFRvV29ybGRTcGFjZUFSKGNjLlZlYzIuWkVSTyk7XG4gICAgICAgIHZhciBpID0gdGhpcy5ib3hQb3B1cFJvb3QucGFyZW50LmNvbnZlcnRUb05vZGVTcGFjZUFSKG8pO1xuICAgICAgICB0aGlzLmJveFBvcHVwUm9vdC5wb3NpdGlvbiA9IGk7XG4gICAgICAgIHRoaXMuYm94UG9wdXBSb290LmFjdGl2ZSA9ICEwO1xuICAgIH0sXG4gICAgb25DbGlja0JnOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuaGlkZUJveFBvcHVwKCk7XG4gICAgfSxcbiAgICBoaWRlQm94UG9wdXA6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ib3hQb3B1cFJvb3QuYWN0aXZlID0gITE7XG4gICAgfSxcbiAgICBvbkNsaWNrVXBsb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGNjLnB2ei5jbG91ZC51cGxvYWRTY29yZSgxMywgZnVuY3Rpb24gKCkge30pO1xuICAgICAgICBjYy5wdnouY2xvdWQubXlSYW5rKGZ1bmN0aW9uICgpIHt9KTtcbiAgICAgICAgY2MucHZ6LmNsb3VkLnJhbmtMaXN0KDAsIGZ1bmN0aW9uICgpIHt9KTtcbiAgICAgICAgY2MucHZ6LmNsb3VkLnJhbmtMaXN0KDIwLCBmdW5jdGlvbiAoKSB7fSk7XG4gICAgfVxufSk7Il19