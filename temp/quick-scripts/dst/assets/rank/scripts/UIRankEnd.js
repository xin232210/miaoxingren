
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/rank/scripts/UIRankEnd.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '9ce5fmAf/JJ5KQSuT5TuFDx', 'UIRankEnd');
// rank/scripts/UIRankEnd.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    bgSpine: sp.Skeleton,
    tiSpine: sp.Skeleton,
    waveLabel: cc.Label,
    batterWaveTip: cc.Node,
    coinCountLabel: cc.Label,
    bgNode: cc.Node,
    infoPanel: cc.Node
  },
  initBy: function initBy(e) {
    var t = this;
    this.scene = e;
    this.bgNode.active = !1;
    this.infoPanel.active = !1;
    this.bgSpine.setAnimation(0, "", !1);
    cc.pvz.utils.spineFromTo(this.bgSpine, "jieshu1_2", "jieshu2_2");
    cc.pvz.utils.spineFromTo(this.tiSpine, "jieshu1_1", "jieshu2_1", !0, function () {
      t.bgNode.active = !0;
      t.infoPanel.active = !0;
    });
    var n = cc.pvz.runtimeData.wave;
    this.waveLabel.string = "" + n;
    this.coinCountLabel.string = "x" + 50 * n;

    if (cc.pvz.runtimeData.wave > 0 && cc.pvz.runtimeData.wave > cc.tmpScore) {
      cc.tmpScore = cc.pvz.runtimeData.wave;
      cc.tmpNewRecord = !0;
      this.batterWaveTip.active = !0;
      var c = -1;
      var o = [];
      var i = [];
      cc.pvz.runtimeData.items.forEach(function (e) {
        if (99 != e.id) {
          if (e.lv > c) {
            c = e.lv;
            o.length = 0;
          }

          o.push(e.id);
          i.push(e.id);
          i.push(e.lv);
        }
      });
      var a = "" + o[cc.math.randomRangeInt(0, o.length)];
      cc.pvz.cloud.uploadScore(n, a, i, function () {});
    } else {
      this.batterWaveTip.active = !1;
    }

    cc.butler.resumeDirector(1);
    cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["关卡结算"]);
  },
  addCoinAndClose: function addCoinAndClose(e) {
    var t;

    if (e) {
      t = 100 * cc.pvz.runtimeData.wave;
    } else {
      t = 50 * cc.pvz.runtimeData.wave;
    }

    cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["金币"], t);

    if (e) {
      cc.popupManager.removePopup(this);
      var n = cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["金币"], t);
      cc.popupManager.popup("mainUI", "getrewardUI", "UIReward", {
        ad: !1,
        scale: !1
      }, [n], cc.pvz.GameConfig.UIFromType["双倍结算"], function () {
        cc.popupManager.removeAllPopups();
        cc.pvz.runtimeData.removeData();
        cc.director.loadScene("mainUI");
      });
    } else {
      cc.butler.playEffectAsync("game", "sound/getCoin");
      cc.popupManager.removeAllPopups();
      cc.pvz.runtimeData.removeData();
      cc.director.loadScene("mainUI");
    }
  },
  onClickClose: function onClickClose() {
    this.addCoinAndClose(!1);
  },
  onClickAd: function onClickAd() {
    var e = this;

    if (this.isLookAd) {//
    } else {
      this.isLookAd = !0;
      cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["关卡结算"], function (t) {
        e.isLookAd = !1;

        if (t) {
          e.addCoinAndClose(!0);
        }
      });
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9yYW5rL3NjcmlwdHMvVUlSYW5rRW5kLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwiYmdTcGluZSIsInNwIiwiU2tlbGV0b24iLCJ0aVNwaW5lIiwid2F2ZUxhYmVsIiwiTGFiZWwiLCJiYXR0ZXJXYXZlVGlwIiwiTm9kZSIsImNvaW5Db3VudExhYmVsIiwiYmdOb2RlIiwiaW5mb1BhbmVsIiwiaW5pdEJ5IiwiZSIsInQiLCJzY2VuZSIsImFjdGl2ZSIsInNldEFuaW1hdGlvbiIsInB2eiIsInV0aWxzIiwic3BpbmVGcm9tVG8iLCJuIiwicnVudGltZURhdGEiLCJ3YXZlIiwic3RyaW5nIiwidG1wU2NvcmUiLCJ0bXBOZXdSZWNvcmQiLCJjIiwibyIsImkiLCJpdGVtcyIsImZvckVhY2giLCJpZCIsImx2IiwibGVuZ3RoIiwicHVzaCIsImEiLCJtYXRoIiwicmFuZG9tUmFuZ2VJbnQiLCJjbG91ZCIsInVwbG9hZFNjb3JlIiwiYnV0bGVyIiwicmVzdW1lRGlyZWN0b3IiLCJUQVV0aWxzIiwidHJhY2tBZFVJU2hvdyIsIkdhbWVDb25maWciLCJBZFR5cGUiLCJhZGRDb2luQW5kQ2xvc2UiLCJQbGF5ZXJEYXRhIiwiY2hhbmdlSXRlbU51bSIsIkl0ZW1UeXBlIiwicG9wdXBNYW5hZ2VyIiwicmVtb3ZlUG9wdXAiLCJnZXRSZXdhcmRJdGVtIiwicG9wdXAiLCJhZCIsInNjYWxlIiwiVUlGcm9tVHlwZSIsInJlbW92ZUFsbFBvcHVwcyIsInJlbW92ZURhdGEiLCJkaXJlY3RvciIsImxvYWRTY2VuZSIsInBsYXlFZmZlY3RBc3luYyIsIm9uQ2xpY2tDbG9zZSIsIm9uQ2xpY2tBZCIsImlzTG9va0FkIiwiQWRVdGlscyIsInNob3dBZFJld2FyZFZpZGVvIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNMLFdBQVNELEVBQUUsQ0FBQ0UsU0FE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akI7TUFDQXBFLEVBQUUsQ0FBQ3FCLEdBQUgsQ0FBT2dELE9BQVAsQ0FBZUMsaUJBQWYsQ0FBaUN0RSxFQUFFLENBQUNxQixHQUFILENBQU8yQixVQUFQLENBQWtCQyxNQUFsQixDQUF5QixNQUF6QixDQUFqQyxFQUFtRSxVQUFVaEMsQ0FBVixFQUFhO1FBQzVFRCxDQUFDLENBQUNvRCxRQUFGLEdBQWEsQ0FBQyxDQUFkOztRQUNBLElBQUluRCxDQUFKLEVBQU87VUFDSEQsQ0FBQyxDQUFDa0MsZUFBRixDQUFrQixDQUFDLENBQW5CO1FBQ0g7TUFDSixDQUxEO0lBTUg7RUFDSjtBQXJHSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgYmdTcGluZTogc3AuU2tlbGV0b24sXG4gICAgICAgIHRpU3BpbmU6IHNwLlNrZWxldG9uLFxuICAgICAgICB3YXZlTGFiZWw6IGNjLkxhYmVsLFxuICAgICAgICBiYXR0ZXJXYXZlVGlwOiBjYy5Ob2RlLFxuICAgICAgICBjb2luQ291bnRMYWJlbDogY2MuTGFiZWwsXG4gICAgICAgIGJnTm9kZTogY2MuTm9kZSxcbiAgICAgICAgaW5mb1BhbmVsOiBjYy5Ob2RlXG4gICAgfSxcbiAgICBpbml0Qnk6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIHZhciB0ID0gdGhpcztcbiAgICAgICAgdGhpcy5zY2VuZSA9IGU7XG4gICAgICAgIHRoaXMuYmdOb2RlLmFjdGl2ZSA9ICExO1xuICAgICAgICB0aGlzLmluZm9QYW5lbC5hY3RpdmUgPSAhMTtcbiAgICAgICAgdGhpcy5iZ1NwaW5lLnNldEFuaW1hdGlvbigwLCBcIlwiLCAhMSk7XG4gICAgICAgIGNjLnB2ei51dGlscy5zcGluZUZyb21Ubyh0aGlzLmJnU3BpbmUsIFwiamllc2h1MV8yXCIsIFwiamllc2h1Ml8yXCIpO1xuICAgICAgICBjYy5wdnoudXRpbHMuc3BpbmVGcm9tVG8odGhpcy50aVNwaW5lLCBcImppZXNodTFfMVwiLCBcImppZXNodTJfMVwiLCAhMCwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdC5iZ05vZGUuYWN0aXZlID0gITA7XG4gICAgICAgICAgICB0LmluZm9QYW5lbC5hY3RpdmUgPSAhMDtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBuID0gY2MucHZ6LnJ1bnRpbWVEYXRhLndhdmU7XG4gICAgICAgIHRoaXMud2F2ZUxhYmVsLnN0cmluZyA9IFwiXCIgKyBuO1xuICAgICAgICB0aGlzLmNvaW5Db3VudExhYmVsLnN0cmluZyA9IFwieFwiICsgNTAgKiBuO1xuICAgICAgICBpZiAoY2MucHZ6LnJ1bnRpbWVEYXRhLndhdmUgPiAwICYmIGNjLnB2ei5ydW50aW1lRGF0YS53YXZlID4gY2MudG1wU2NvcmUpIHtcbiAgICAgICAgICAgIGNjLnRtcFNjb3JlID0gY2MucHZ6LnJ1bnRpbWVEYXRhLndhdmU7XG4gICAgICAgICAgICBjYy50bXBOZXdSZWNvcmQgPSAhMDtcbiAgICAgICAgICAgIHRoaXMuYmF0dGVyV2F2ZVRpcC5hY3RpdmUgPSAhMDtcbiAgICAgICAgICAgIHZhciBjID0gLTE7XG4gICAgICAgICAgICB2YXIgbyA9IFtdO1xuICAgICAgICAgICAgdmFyIGkgPSBbXTtcbiAgICAgICAgICAgIGNjLnB2ei5ydW50aW1lRGF0YS5pdGVtcy5mb3JFYWNoKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKDk5ICE9IGUuaWQpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGUubHYgPiBjKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjID0gZS5sdjtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8ubGVuZ3RoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBvLnB1c2goZS5pZCk7XG4gICAgICAgICAgICAgICAgICAgIGkucHVzaChlLmlkKTtcbiAgICAgICAgICAgICAgICAgICAgaS5wdXNoKGUubHYpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdmFyIGEgPSBcIlwiICsgb1tjYy5tYXRoLnJhbmRvbVJhbmdlSW50KDAsIG8ubGVuZ3RoKV07XG4gICAgICAgICAgICBjYy5wdnouY2xvdWQudXBsb2FkU2NvcmUobiwgYSwgaSwgZnVuY3Rpb24gKCkge30pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5iYXR0ZXJXYXZlVGlwLmFjdGl2ZSA9ICExO1xuICAgICAgICB9XG4gICAgICAgIGNjLmJ1dGxlci5yZXN1bWVEaXJlY3RvcigxKTtcbiAgICAgICAgY2MucHZ6LlRBVXRpbHMudHJhY2tBZFVJU2hvdyhjYy5wdnouR2FtZUNvbmZpZy5BZFR5cGVbXCLlhbPljaHnu5PnrpdcIl0pO1xuICAgIH0sXG4gICAgYWRkQ29pbkFuZENsb3NlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgIHQgPSAxMDAgKiBjYy5wdnoucnVudGltZURhdGEud2F2ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHQgPSA1MCAqIGNjLnB2ei5ydW50aW1lRGF0YS53YXZlO1xuICAgICAgICB9XG4gICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLmNoYW5nZUl0ZW1OdW0oY2MucHZ6LkdhbWVDb25maWcuSXRlbVR5cGVbXCLph5HluIFcIl0sIHQpO1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnJlbW92ZVBvcHVwKHRoaXMpO1xuICAgICAgICAgICAgdmFyIG4gPSBjYy5wdnoudXRpbHMuZ2V0UmV3YXJkSXRlbShjYy5wdnouR2FtZUNvbmZpZy5JdGVtVHlwZVtcIumHkeW4gVwiXSwgdCk7XG4gICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgICAgICBcImdldHJld2FyZFVJXCIsXG4gICAgICAgICAgICAgICAgXCJVSVJld2FyZFwiLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZTogITFcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFtuXSxcbiAgICAgICAgICAgICAgICBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5Y+M5YCN57uT566XXCJdLFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnJlbW92ZUFsbFBvcHVwcygpO1xuICAgICAgICAgICAgICAgICAgICBjYy5wdnoucnVudGltZURhdGEucmVtb3ZlRGF0YSgpO1xuICAgICAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoXCJtYWluVUlcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLmJ1dGxlci5wbGF5RWZmZWN0QXN5bmMoXCJnYW1lXCIsIFwic291bmQvZ2V0Q29pblwiKTtcbiAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5yZW1vdmVBbGxQb3B1cHMoKTtcbiAgICAgICAgICAgIGNjLnB2ei5ydW50aW1lRGF0YS5yZW1vdmVEYXRhKCk7XG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoXCJtYWluVUlcIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tDbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB0aGlzLmFkZENvaW5BbmRDbG9zZSghMSk7XG4gICAgfSxcbiAgICBvbkNsaWNrQWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICBpZiAodGhpcy5pc0xvb2tBZCkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaXNMb29rQWQgPSAhMDtcbiAgICAgICAgICAgIGNjLnB2ei5BZFV0aWxzLnNob3dBZFJld2FyZFZpZGVvKGNjLnB2ei5HYW1lQ29uZmlnLkFkVHlwZVtcIuWFs+WNoee7k+eul1wiXSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICBlLmlzTG9va0FkID0gITE7XG4gICAgICAgICAgICAgICAgaWYgKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZS5hZGRDb2luQW5kQ2xvc2UoITApO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfVxufSk7XG4iXX0=