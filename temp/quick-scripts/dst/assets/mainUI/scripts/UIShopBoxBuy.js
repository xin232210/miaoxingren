
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/mainUI/scripts/UIShopBoxBuy.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'aef5fdFr7VIBruIb8sJlU17', 'UIShopBoxBuy');
// mainUI/scripts/UIShopBoxBuy.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    boxAdBtnPanel: cc.Node,
    buyBtn: cc.Node,
    freeBtn: cc.Node,
    nameLabel: cc.Label,
    priceLabel: cc.Label,
    boxSprite: cc.Sprite,
    baseItemNode: cc.Node,
    rewardParent: cc.Node
  },
  initBy: function initBy(e, t, i, o) {
    if (void 0 === i) {
      i = !1;
    }

    if (void 0 === o) {
      o = null;
    }

    this.boxId = e;
    this.shopBoxJson = t;
    this.isCanAdBuy = i;
    this.callBack = o;
    this.price = this.shopBoxJson["consume" + this.boxId];
    this.priceLabel.string = this.price;

    if (1 == this.boxId) {
      this.nameLabel.string = "银色宝箱";
    } else {
      this.nameLabel.string = "黄金宝箱";
    }

    var a;

    if (1 == this.boxId) {
      a = "12";
    } else {
      a = "11";
    }

    cc.pvz.utils.setSpriteFrame(this.boxSprite, "uiImage", "shop/shop" + a);
    this.onCheckBoxAdBtnGray(!this.isCanAdBuy);
    this.onBoxRewardShow();

    if (this.isCanAdBuy && 2 == this.boxId) {
      cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["商店宝箱"]);
    }
  },
  onBoxRewardShow: function onBoxRewardShow() {
    var e = this.shopBoxJson["box" + this.boxId];
    var t = Math.floor(e.length / 2);
    var i = 0;
    this.rewardData = [];

    for (var o = 0; o < t; o++) {
      var a = cc.pvz.utils.getRewardItem(e[i], e[i + 1]);
      this.rewardData.push(a);
      i += 2;
    }

    this.baseItemNode.getComponent("RewardItem").initBoxRewardItem(this.rewardData[0]);

    for (var c = 1; c < t; c++) {
      var s = cc.instantiate(this.baseItemNode);
      s.parent = this.rewardParent;
      s.getComponent("RewardItem").initBoxRewardItem(this.rewardData[c]);
    }
  },
  onCheckBoxAdBtnGray: function onCheckBoxAdBtnGray(e) {
    if (1 == this.boxId) {
      this.boxAdBtnPanel.active = !1;
      this.freeBtn.active = !e;
      this.buyBtn.active = e;
    } else {
      for (var t = 0; t < this.boxAdBtnPanel.childrenCount; t++) {
        this.boxAdBtnPanel.children[t].getComponent(cc.Sprite).setMaterial(0, cc.JsonControl.materialList[e ? 1 : 0]);
      }

      this.freeBtn.active = !1;
    }
  },
  onClickAdBox: function onClickAdBox() {
    var e = this;

    if (cc.UIShop.isLookAd) {//
    } else {
      if (this.isCanAdBuy) {
        if (1 == this.boxId) {
          this.onAdClose(!0);
        } else {
          cc.UIShop.isLookAd = !0, cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["商店宝箱"], function (t) {
            e.onAdClose(t);
          });
        }
      }
    }
  },
  onAdClose: function onAdClose(e) {
    cc.UIShop.isLookAd = !1;

    if (e) {
      cc.pvz.PlayerData.updateShopBoxDate(this.boxId, Date.now());

      if (this.isCanAdBuy && 2 == this.boxId) {
        cc.pvz.PlayerData.updateShopBoxExp(this.price);
      }

      cc.popupManager.removePopup(this);
      cc.popupManager.popup("mainUI", "ShopBoxEft", "UIShopBoxReward", {
        ad: !1,
        scale: !0
      }, this.boxId, this.rewardData, this.callBack);
    }
  },
  onClickBuyBox: function onClickBuyBox() {
    if (!cc.UIShop.isLookAd) {
      if (cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["钻石"], this.price)) {
        cc.pvz.PlayerData.updateShopBoxExp(this.price);
        cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["钻石"], -this.price);
        cc.popupManager.removePopup(this);
        cc.popupManager.popup("mainUI", "ShopBoxEft", "UIShopBoxReward", {
          ad: !1,
          scale: !0
        }, this.boxId, this.rewardData, function () {
          cc.UIShop.onChekBoxLvUp();
        });
      } else if (cc.pvz.PlayerData.isHaveAdBuyBankTimes(1)) {
        var e = cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["钻石"], 100);
        cc.popupManager.popup("mainUI", "adbuyUI", "UIAdBuy", {
          ad: !1,
          scale: !0
        }, e);
      } else {
        cc.popupManager.showToast("钻石不足！");
      }
    }
  },
  onCloseUI: function onCloseUI() {
    cc.popupManager.removePopup(this);
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluVUkvc2NyaXB0cy9VSVNob3BCb3hCdXkuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJib3hBZEJ0blBhbmVsIiwiTm9kZSIsImJ1eUJ0biIsImZyZWVCdG4iLCJuYW1lTGFiZWwiLCJMYWJlbCIsInByaWNlTGFiZWwiLCJib3hTcHJpdGUiLCJTcHJpdGUiLCJiYXNlSXRlbU5vZGUiLCJyZXdhcmRQYXJlbnQiLCJpbml0QnkiLCJlIiwidCIsImkiLCJvIiwiYm94SWQiLCJzaG9wQm94SnNvbiIsImlzQ2FuQWRCdXkiLCJjYWxsQmFjayIsInByaWNlIiwic3RyaW5nIiwiYSIsInB2eiIsInV0aWxzIiwic2V0U3ByaXRlRnJhbWUiLCJvbkNoZWNrQm94QWRCdG5HcmF5Iiwib25Cb3hSZXdhcmRTaG93IiwiVEFVdGlscyIsInRyYWNrQWRVSVNob3ciLCJHYW1lQ29uZmlnIiwiQWRUeXBlIiwiTWF0aCIsImZsb29yIiwibGVuZ3RoIiwicmV3YXJkRGF0YSIsImdldFJld2FyZEl0ZW0iLCJwdXNoIiwiZ2V0Q29tcG9uZW50IiwiaW5pdEJveFJld2FyZEl0ZW0iLCJjIiwicyIsImluc3RhbnRpYXRlIiwicGFyZW50IiwiYWN0aXZlIiwiY2hpbGRyZW5Db3VudCIsImNoaWxkcmVuIiwic2V0TWF0ZXJpYWwiLCJKc29uQ29udHJvbCIsIm1hdGVyaWFsTGlzdCIsIm9uQ2xpY2tBZEJveCIsIlVJU2hvcCIsImlzTG9va0FkIiwib25BZENsb3NlIiwiQWRVdGlscyIsInNob3dBZFJld2FyZFZpZGVvIiwiUGxheWVyRGF0YSIsInVwZGF0ZVNob3BCb3hEYXRlIiwiRGF0ZSIsIm5vdyIsInVwZGF0ZVNob3BCb3hFeHAiLCJwb3B1cE1hbmFnZXIiLCJyZW1vdmVQb3B1cCIsInBvcHVwIiwiYWQiLCJzY2FsZSIsIm9uQ2xpY2tCdXlCb3giLCJpc0l0ZW1Fbm91Z2giLCJJdGVtVHlwZSIsImNoYW5nZUl0ZW1OdW0iLCJvbkNoZWtCb3hMdlVwIiwiaXNIYXZlQWRCdXlCYW5rVGltZXMiLCJzaG93VG9hc3QiLCJvbkNsb3NlVUkiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0VBQ0wsV0FBU0QsRUFBRSxDQUFDRSxTQURQO0VBRUxDLFVBQVUsRUFBRTtJQUNSQyxhQUFhLEVBQUVKLEVBQUUsQ0FBQ0ssSUFEVjtJQUVSQyxNQUFNLEVBQUVOLEVBQUUsQ0FBQ0ssSUFGSDtJQUdSRSxPQUFPLEVBQUVQLEVBQUUsQ0FBQ0ssSUFISjtJQUlSRyxTQUFTLEVBQUVSLEVBQUUsQ0FBQ1MsS0FKTjtJQUtSQyxVQUFVLEVBQUVWLEVBQUUsQ0FBQ1MsS0FMUDtJQU1SRSxTQUFTLEVBQUVYLEVBQUUsQ0FBQ1ksTUFOTjtJQU9SQyxZQUFZLEVBQUViLEVBQUUsQ0FBQ0ssSUFQVDtJQVFSUyxZQUFZLEVBQUVkLEVBQUUsQ0FBQ0s7RUFSVCxDQUZQO0VBWUxVLE1BQU0sRUFBRSxnQkFBVUMsQ0FBVixFQUFhQyxDQUFiLEVBQWdCQyxDQUFoQixFQUFtQkMsQ0FBbkIsRUFBc0I7SUFDMUIsSUFBSSxLQUFLLENBQUwsS0FBV0QsQ0FBZixFQUFrQjtNQUNkQSxDQUFDLEdBQUcsQ0FBQyxDQUFMO0lBQ0g7O0lBQ0QsSUFBSSxLQUFLLENBQUwsS0FBV0MsQ0FBZixFQUFrQjtNQUNkQSxDQUFDLEdBQUcsSUFBSjtJQUNIOztJQUNELEtBQUtDLEtBQUwsR0FBYUosQ0FBYjtJQUNBLEtBQUtLLFdBQUwsR0FBbUJKLENBQW5CO0lBQ0EsS0FBS0ssVUFBTCxHQUFrQkosQ0FBbEI7SUFDQSxLQUFLSyxRQUFMLEdBQWdCSixDQUFoQjtJQUNBLEtBQUtLLEtBQUwsR0FBYSxLQUFLSCxXQUFMLENBQWlCLFlBQVksS0FBS0QsS0FBbEMsQ0FBYjtJQUNBLEtBQUtWLFVBQUwsQ0FBZ0JlLE1BQWhCLEdBQXlCLEtBQUtELEtBQTlCOztJQUNBLElBQUksS0FBSyxLQUFLSixLQUFkLEVBQXFCO01BQ2pC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QWhCLENBQ0ksUUFESixFQUVJLFlBRkosRUFHSSxpQkFISixFQUlJO1VBQ0lDLEVBQUUsRUFBRSxDQUFDLENBRFQ7VUFFSUMsS0FBSyxFQUFFLENBQUM7UUFGWixDQUpKLEVBUUksS0FBS2pELEtBUlQsRUFTSSxLQUFLbUIsVUFUVCxFQVVJLFlBQVk7VUFDUnZDLEVBQUUsQ0FBQ3VELE1BQUgsQ0FBVW1CLGFBQVY7UUFDSCxDQVpMO01BY0gsQ0FsQkQsTUFrQk8sSUFBSTFFLEVBQUUsQ0FBQzJCLEdBQUgsQ0FBT2lDLFVBQVAsQ0FBa0JlLG9CQUFsQixDQUF1QyxDQUF2QyxDQUFKLEVBQStDO1FBQ2xELElBQUkzRCxDQUFDLEdBQUdoQixFQUFFLENBQUMyQixHQUFILENBQU9DLEtBQVAsQ0FBYVksYUFBYixDQUEyQnhDLEVBQUUsQ0FBQzJCLEdBQUgsQ0FBT08sVUFBUCxDQUFrQnNDLFFBQWxCLENBQTJCLElBQTNCLENBQTNCLEVBQTZELEdBQTdELENBQVI7UUFDQXhFLEVBQUUsQ0FBQ2lFLFlBQUgsQ0FBZ0JFLEtBQWhCLENBQ0ksUUFESixFQUVJLFNBRkosRUFHSSxTQUhKLEVBSUk7VUFDSUMsRUFBRSxFQUFFLENBQUMsQ0FEVDtVQUVJQyxLQUFLLEVBQUUsQ0FBQztRQUZaLENBSkosRUFRSXJELENBUko7TUFVSCxDQVpNLE1BWUE7UUFDSGhCLEVBQUUsQ0FBQ2lFLFlBQUgsQ0FBZ0JXLFNBQWhCLENBQTBCLE9BQTFCO01BQ0g7SUFDSjtFQUNKLENBckpJO0VBc0pMQyxTQUFTLEVBQUUscUJBQVk7SUFDbkI3RSxFQUFFLENBQUNpRSxZQUFILENBQWdCQyxXQUFoQixDQUE0QixJQUE1QjtFQUNIO0FBeEpJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBib3hBZEJ0blBhbmVsOiBjYy5Ob2RlLFxuICAgICAgICBidXlCdG46IGNjLk5vZGUsXG4gICAgICAgIGZyZWVCdG46IGNjLk5vZGUsXG4gICAgICAgIG5hbWVMYWJlbDogY2MuTGFiZWwsXG4gICAgICAgIHByaWNlTGFiZWw6IGNjLkxhYmVsLFxuICAgICAgICBib3hTcHJpdGU6IGNjLlNwcml0ZSxcbiAgICAgICAgYmFzZUl0ZW1Ob2RlOiBjYy5Ob2RlLFxuICAgICAgICByZXdhcmRQYXJlbnQ6IGNjLk5vZGVcbiAgICB9LFxuICAgIGluaXRCeTogZnVuY3Rpb24gKGUsIHQsIGksIG8pIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gaSkge1xuICAgICAgICAgICAgaSA9ICExO1xuICAgICAgICB9XG4gICAgICAgIGlmICh2b2lkIDAgPT09IG8pIHtcbiAgICAgICAgICAgIG8gPSBudWxsO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYm94SWQgPSBlO1xuICAgICAgICB0aGlzLnNob3BCb3hKc29uID0gdDtcbiAgICAgICAgdGhpcy5pc0NhbkFkQnV5ID0gaTtcbiAgICAgICAgdGhpcy5jYWxsQmFjayA9IG87XG4gICAgICAgIHRoaXMucHJpY2UgPSB0aGlzLnNob3BCb3hKc29uW1wiY29uc3VtZVwiICsgdGhpcy5ib3hJZF07XG4gICAgICAgIHRoaXMucHJpY2VMYWJlbC5zdHJpbmcgPSB0aGlzLnByaWNlO1xuICAgICAgICBpZiAoMSA9PSB0aGlzLmJveElkKSB7XG4gICAgICAgICAgICB0aGlzLm5hbWVMYWJlbC5zdHJpbmcgPSBcIumTtuiJsuWuneeusVwiO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5uYW1lTGFiZWwuc3RyaW5nID0gXCLpu4Tph5Hlrp3nrrFcIjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgYTtcbiAgICAgICAgaWYgKDEgPT0gdGhpcy5ib3hJZCkge1xuICAgICAgICAgICAgYSA9IFwiMTJcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGEgPSBcIjExXCI7XG4gICAgICAgIH1cbiAgICAgICAgY2MucHZ6LnV0aWxzLnNldFNwcml0ZUZyYW1lKHRoaXMuYm94U3ByaXRlLCBcInVpSW1hZ2VcIiwgXCJzaG9wL3Nob3BcIiArIGEpO1xuICAgICAgICB0aGlzLm9uQ2hlY2tCb3hBZEJ0bkdyYXkoIXRoaXMuaXNDYW5BZEJ1eSk7XG4gICAgICAgIHRoaXMub25Cb3hSZXdhcmRTaG93KCk7XG4gICAgICAgIGlmICh0aGlzLmlzQ2FuQWRCdXkgJiYgMiA9PSB0aGlzLmJveElkKSB7XG4gICAgICAgICAgICBjYy5wdnouVEFVdGlscy50cmFja0FkVUlTaG93KGNjLnB2ei5HYW1lQ29uZmlnLkFkVHlwZVtcIuWVhuW6l+WuneeusVwiXSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQm94UmV3YXJkU2hvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IHRoaXMuc2hvcEJveEpzb25bXCJib3hcIiArIHRoaXMuYm94SWRdO1xuICAgICAgICB2YXIgdCA9IE1hdGguZmxvb3IoZS5sZW5ndGggLyAyKTtcbiAgICAgICAgdmFyIGkgPSAwO1xuICAgICAgICB0aGlzLnJld2FyZERhdGEgPSBbXTtcbiAgICAgICAgZm9yICh2YXIgbyA9IDA7IG8gPCB0OyBvKyspIHtcbiAgICAgICAgICAgIHZhciBhID0gY2MucHZ6LnV0aWxzLmdldFJld2FyZEl0ZW0oZVtpXSwgZVtpICsgMV0pO1xuICAgICAgICAgICAgdGhpcy5yZXdhcmREYXRhLnB1c2goYSk7XG4gICAgICAgICAgICBpICs9IDI7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5iYXNlSXRlbU5vZGUuZ2V0Q29tcG9uZW50KFwiUmV3YXJkSXRlbVwiKS5pbml0Qm94UmV3YXJkSXRlbSh0aGlzLnJld2FyZERhdGFbMF0pO1xuICAgICAgICBmb3IgKHZhciBjID0gMTsgYyA8IHQ7IGMrKykge1xuICAgICAgICAgICAgdmFyIHMgPSBjYy5pbnN0YW50aWF0ZSh0aGlzLmJhc2VJdGVtTm9kZSk7XG4gICAgICAgICAgICBzLnBhcmVudCA9IHRoaXMucmV3YXJkUGFyZW50O1xuICAgICAgICAgICAgcy5nZXRDb21wb25lbnQoXCJSZXdhcmRJdGVtXCIpLmluaXRCb3hSZXdhcmRJdGVtKHRoaXMucmV3YXJkRGF0YVtjXSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2hlY2tCb3hBZEJ0bkdyYXk6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGlmICgxID09IHRoaXMuYm94SWQpIHtcbiAgICAgICAgICAgIHRoaXMuYm94QWRCdG5QYW5lbC5hY3RpdmUgPSAhMTtcbiAgICAgICAgICAgIHRoaXMuZnJlZUJ0bi5hY3RpdmUgPSAhZTtcbiAgICAgICAgICAgIHRoaXMuYnV5QnRuLmFjdGl2ZSA9IGU7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuYm94QWRCdG5QYW5lbC5jaGlsZHJlbkNvdW50OyB0KyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJveEFkQnRuUGFuZWwuY2hpbGRyZW5bdF1cbiAgICAgICAgICAgICAgICAgICAgLmdldENvbXBvbmVudChjYy5TcHJpdGUpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbCgwLCBjYy5Kc29uQ29udHJvbC5tYXRlcmlhbExpc3RbZSA/IDEgOiAwXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmZyZWVCdG4uYWN0aXZlID0gITE7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tBZEJveDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGlmIChjYy5VSVNob3AuaXNMb29rQWQpIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NhbkFkQnV5KSB7XG4gICAgICAgICAgICAgICAgaWYgKDEgPT0gdGhpcy5ib3hJZCkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLm9uQWRDbG9zZSghMCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgKGNjLlVJU2hvcC5pc0xvb2tBZCA9ICEwKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLnB2ei5BZFV0aWxzLnNob3dBZFJld2FyZFZpZGVvKGNjLnB2ei5HYW1lQ29uZmlnLkFkVHlwZVtcIuWVhuW6l+WuneeusVwiXSwgZnVuY3Rpb24gKHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlLm9uQWRDbG9zZSh0KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25BZENsb3NlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBjYy5VSVNob3AuaXNMb29rQWQgPSAhMTtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLnVwZGF0ZVNob3BCb3hEYXRlKHRoaXMuYm94SWQsIERhdGUubm93KCkpO1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNDYW5BZEJ1eSAmJiAyID09IHRoaXMuYm94SWQpIHtcbiAgICAgICAgICAgICAgICBjYy5wdnouUGxheWVyRGF0YS51cGRhdGVTaG9wQm94RXhwKHRoaXMucHJpY2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnJlbW92ZVBvcHVwKHRoaXMpO1xuICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnBvcHVwKFxuICAgICAgICAgICAgICAgIFwibWFpblVJXCIsXG4gICAgICAgICAgICAgICAgXCJTaG9wQm94RWZ0XCIsXG4gICAgICAgICAgICAgICAgXCJVSVNob3BCb3hSZXdhcmRcIixcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFkOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICEwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGlzLmJveElkLFxuICAgICAgICAgICAgICAgIHRoaXMucmV3YXJkRGF0YSxcbiAgICAgICAgICAgICAgICB0aGlzLmNhbGxCYWNrXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkNsaWNrQnV5Qm94OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghY2MuVUlTaG9wLmlzTG9va0FkKSB7XG4gICAgICAgICAgICBpZiAoY2MucHZ6LlBsYXllckRhdGEuaXNJdGVtRW5vdWdoKGNjLnB2ei5HYW1lQ29uZmlnLkl0ZW1UeXBlW1wi6ZK755+zXCJdLCB0aGlzLnByaWNlKSkge1xuICAgICAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLnVwZGF0ZVNob3BCb3hFeHAodGhpcy5wcmljZSk7XG4gICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEuY2hhbmdlSXRlbU51bShjYy5wdnouR2FtZUNvbmZpZy5JdGVtVHlwZVtcIumSu+efs1wiXSwgLXRoaXMucHJpY2UpO1xuICAgICAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5yZW1vdmVQb3B1cCh0aGlzKTtcbiAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgICAgIFwibWFpblVJXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiU2hvcEJveEVmdFwiLFxuICAgICAgICAgICAgICAgICAgICBcIlVJU2hvcEJveFJld2FyZFwiLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZDogITEsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogITBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5ib3hJZCxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZXdhcmREYXRhLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5VSVNob3Aub25DaGVrQm94THZVcCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2MucHZ6LlBsYXllckRhdGEuaXNIYXZlQWRCdXlCYW5rVGltZXMoMSkpIHtcbiAgICAgICAgICAgICAgICB2YXIgZSA9IGNjLnB2ei51dGlscy5nZXRSZXdhcmRJdGVtKGNjLnB2ei5HYW1lQ29uZmlnLkl0ZW1UeXBlW1wi6ZK755+zXCJdLCAxMDApO1xuICAgICAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5wb3B1cChcbiAgICAgICAgICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgICAgICAgICAgXCJhZGJ1eVVJXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiVUlBZEJ1eVwiLFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBhZDogITEsXG4gICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogITBcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5zaG93VG9hc3QoXCLpkrvnn7PkuI3otrPvvIFcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xvc2VVSTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5wb3B1cE1hbmFnZXIucmVtb3ZlUG9wdXAodGhpcyk7XG4gICAgfVxufSk7XG4iXX0=