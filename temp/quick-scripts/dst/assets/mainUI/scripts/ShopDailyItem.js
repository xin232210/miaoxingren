
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/mainUI/scripts/ShopDailyItem.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'cf5deVGeqVHgZCPbKd20P7a', 'ShopDailyItem');
// mainUI/scripts/ShopDailyItem.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    nameLabel: cc.Label,
    spine: sp.Skeleton,
    qualitySprite: cc.Sprite,
    countLabel: cc.Label,
    priceSprite: cc.Sprite,
    priceLabel: cc.Label,
    finishNode: cc.Node,
    buyPanel: cc.Node,
    discountPanel: cc.Node,
    discountSprite: cc.Sprite,
    freeNode: cc.Node,
    adPanel: cc.Node,
    adTimesLabel: cc.Label,
    cdTimeLabel: cc.Label
  },
  initShopDailyItem: function initShopDailyItem(e, t) {
    var i = this;
    this.isLookAd = !1;
    this.shopId = e;
    this.shopData = cc.pvz.PlayerData.getShopData(this.shopId);
    this.shopJson = t;
    this.itemId = this.shopData.itemId;
    this.isFinish = this.shopData.buyTimes <= 0;
    this.finishNode.active = this.isFinish;

    if (1 != this.shopId) {
      this.toolId = this.shopData.toolId;

      if (this.itemId === cc.pvz.GameConfig.ItemType["固定碎片"]) {
        var o = cc.JsonControl.getToolJson(this.toolId);
        cc.JsonControl.getQualityBgIcon(this.qualitySprite, o.quality);
        var a = cc.pvz.PlayerData.getToolData(this.toolId);
        var c = cc.pvz.utils.getLevelInterval(a.lv);
        this.spine.node.scale = o.scale;
        cc.pvz.utils.useBundleAsset("actors", "character/Characters", sp.SkeletonData, function (e) {
          i.spine.skeletonData = e;
          i.spine.setAnimation(0, "Idle", !0);
        });
        this.nameLabel.string = o.name;
      }

      this.countLabel.string = "x" + this.shopData.count;
      this.discountPanel.active = this.shopData.discount < 10;

      if (this.shopData.discount < 10) {
        cc.pvz.utils.setSpriteFrame(this.discountSprite, "uiImage", "shop/zhekou" + this.shopData.discount);
      }

      this.buyPanel.active = !this.isFinish;
      this.priceLabel.string = this.shopData.price;
      var s = cc.JsonControl.getItemJson(this.shopData.priceType);
      cc.JsonControl.getItemIcon(this.priceSprite, s.Icon);
      this.rewardData = cc.pvz.utils.getRewardToolItem(this.toolId, this.shopData.count);
    } else {
      this.isFree = 1 == cc.pvz.PlayerData.getShopTimes(cc.pvz.GameConfig.ShopTimesType["钻石免费"]);
      var n = (this.isFree, 100);
      this.countLabel.string = "x" + n;
      this.freeNode.active = this.isFree && !this.isFinish;
      this.adPanel.active = !this.isFree && !this.isFinish;
      this.cdTimeLabel.node.active = !1;
      this.adTimesLabel.string = "(" + this.shopData.buyTimes + ")";
      this.rewardData = cc.pvz.utils.getRewardItem(this.itemId, n);
    }
  },
  onClickInfoBuy: function onClickInfoBuy() {
    var e = this;

    if (cc.UIShop.isLookAd) {//
    } else {
      if (this.isFinish) {
        cc.popupManager.showToast("已售罄！");
      } else {
        cc.UIShop.onStopShopScroll(), cc.popupManager.popup("mainUI", "shopbuyUI", "UIShopBuy", {
          ad: !1,
          scale: !0
        }, this.rewardData, [this.shopData.priceType, this.shopData.price], function () {
          cc.pvz.PlayerData.updateShopDataBuy(e.shopId, 1);
          e.initShopDailyItem(e.shopId, e.shopJson);
        }, !0);
      }
    }
  },
  onClickBuy: function onClickBuy() {
    var e = this;

    if (!cc.UIShop.isLookAd) {
      if (this.isFinish) {
        cc.popupManager.showToast("已售罄！");
      } else if (cc.UIShop.onStopShopScroll(), 1 == this.shopId) {
        if (this.isFree) {
          cc.pvz.PlayerData.updateShopTimes(cc.pvz.GameConfig.ShopTimesType["钻石免费"]);
          cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["每日商店购买n次物品"], 1);
          cc.popupManager.popup("mainUI", "getrewardUI", "UIReward", {
            ad: !1,
            scale: !1
          }, [this.rewardData], cc.pvz.GameConfig.UIFromType["每日商店"], function () {
            e.initShopDailyItem(e.shopId, e.shopJson);
            cc.UIShop.updateRedTip();
          });
        } else {
          cc.UIShop.isLookAd = !0;
          cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["商店钻石"], function (t) {
            e.onAdClose(t);
          });
        }
      } else if (cc.pvz.PlayerData.isItemEnough(this.shopData.priceType, this.shopData.price)) {
        cc.pvz.PlayerData.updateShopDataBuy(this.shopId, 1);
        cc.pvz.PlayerData.changeItemNum(this.shopData.priceType, -this.shopData.price);
        cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["每日商店购买n次物品"], 1);
        cc.popupManager.popup("mainUI", "getrewardUI", "UIReward", {
          ad: !1,
          scale: !1
        }, [this.rewardData], cc.pvz.GameConfig.UIFromType["每日商店"], function () {
          e.initShopDailyItem(e.shopId, e.shopJson);
        });
      } else {
        var t = 2 == this.shopData.priceType;

        if (cc.pvz.PlayerData.isHaveAdBuyBankTimes(t ? 0 : 1)) {
          var i = cc.pvz.utils.getRewardItem(this.shopData.priceType, t ? 2500 : 100);
          cc.popupManager.popup("mainUI", "adbuyUI", "UIAdBuy", {
            ad: !1,
            scale: !0
          }, i);
        } else {
          var o;

          if (2 == this.shopData.priceType) {
            o = "金币";
          } else {
            o = "钻石";
          }

          cc.popupManager.showToast(o + "不足！");
        }
      }
    }
  },
  onAdClose: function onAdClose(e) {
    var t = this;
    cc.UIShop.isLookAd = !1;

    if (e) {
      cc.pvz.PlayerData.updateShopDataBuy(this.shopId, 1);
      cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["每日商店购买n次物品"], 1);
      cc.popupManager.popup("mainUI", "getrewardUI", "UIReward", {
        ad: !1,
        scale: !1
      }, [this.rewardData], cc.pvz.GameConfig.UIFromType["每日商店"], function () {
        t.initShopDailyItem(t.shopId, t.shopJson);
      });
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluVUkvc2NyaXB0cy9TaG9wRGFpbHlJdGVtLmpzIl0sIm5hbWVzIjpbImNjIiwiQ2xhc3MiLCJDb21wb25lbnQiLCJwcm9wZXJ0aWVzIiwibmFtZUxhYmVsIiwiTGFiZWwiLCJzcGluZSIsInNwIiwiU2tlbGV0b24iLCJxdWFsaXR5U3ByaXRlIiwiU3ByaXRlIiwiY291bnRMYWJlbCIsInByaWNlU3ByaXRlIiwicHJpY2VMYWJlbCIsImZpbmlzaE5vZGUiLCJOb2RlIiwiYnV5UGFuZWwiLCJkaXNjb3VudFBhbmVsIiwiZGlzY291bnRTcHJpdGUiLCJmcmVlTm9kZSIsImFkUGFuZWwiLCJhZFRpbWVzTGFiZWwiLCJjZFRpbWVMYWJlbCIsImluaXRTaG9wRGFpbHlJdGVtIiwiZSIsInQiLCJpIiwiaXNMb29rQWQiLCJzaG9wSWQiLCJzaG9wRGF0YSIsInB2eiIsIlBsYXllckRhdGEiLCJnZXRTaG9wRGF0YSIsInNob3BKc29uIiwiaXRlbUlkIiwiaXNGaW5pc2giLCJidXlUaW1lcyIsImFjdGl2ZSIsInRvb2xJZCIsIkdhbWVDb25maWciLCJJdGVtVHlwZSIsIm8iLCJKc29uQ29udHJvbCIsImdldFRvb2xKc29uIiwiZ2V0UXVhbGl0eUJnSWNvbiIsInF1YWxpdHkiLCJhIiwiZ2V0VG9vbERhdGEiLCJjIiwidXRpbHMiLCJnZXRMZXZlbEludGVydmFsIiwibHYiLCJub2RlIiwic2NhbGUiLCJ1c2VCdW5kbGVBc3NldCIsIlNrZWxldG9uRGF0YSIsInNrZWxldG9uRGF0YSIsInNldEFuaW1hdGlvbiIsInN0cmluZyIsIm5hbWUiLCJjb3VudCIsImRpc2NvdW50Iiwic2V0U3ByaXRlRnJhbWUiLCJwcmljZSIsInMiLCJnZXRJdGVtSnNvbiIsInByaWNlVHlwZSIsImdldEl0ZW1JY29uIiwiSWNvbiIsInJld2FyZERhdGEiLCJnZXRSZXdhcmRUb29sSXRlbSIsImlzRnJlZSIsImdldFNob3BUaW1lcyIsIlNob3BUaW1lc1R5cGUiLCJuIiwiZ2V0UmV3YXJkSXRlbSIsIm9uQ2xpY2tJbmZvQnV5IiwiVUlTaG9wIiwicG9wdXBNYW5hZ2VyIiwic2hvd1RvYXN0Iiwib25TdG9wU2hvcFNjcm9sbCIsInBvcHVwIiwiYWQiLCJ1cGRhdGVTaG9wRGF0YUJ1eSIsIm9uQ2xpY2tCdXkiLCJ1cGRhdGVTaG9wVGltZXMiLCJhZGRNaXNzaW9uUHJvZ3Jlc3MiLCJNaXNzaW9uVHlwZSIsIlVJRnJvbVR5cGUiLCJ1cGRhdGVSZWRUaXAiLCJBZFV0aWxzIiwic2hvd0FkUmV3YXJkVmlkZW8iLCJBZFR5cGUiLCJvbkFkQ2xvc2UiLCJpc0l0ZW1Fbm91Z2giLCJjaGFuZ2VJdGVtTnVtIiwiaXNIYXZlQWRCdXlCYW5rVGltZXMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0VBQ0wsV0FBU0QsRUFBRSxDQUFDRSxTQURQO0VBRUxDLFVBQVUsRUFBRTtJQUNSQyxTQUFTLEVBQUVKLEVBQUUsQ0FBQ0ssS0FETjtJQUVSQyxLQUFLLEVBQUVDLEVBQUUsQ0FBQ0MsUUFGRjtJQUdSQyxhQUFhLEVBQUVULEVBQUUsQ0FBQ1UsTUFIVjtJQUlSQyxVQUFVLEVBQUVYLEVBQUUsQ0FBQ0ssS0FKUDtJQUtSTyxXQUFXLEVBQUVaLEVBQUUsQ0FBQ1UsTUFMUjtJQU1SRyxVQUFVLEVBQUViLEVBQUUsQ0FBQ0ssS0FOUDtJQU9SUyxVQUFVLEVBQUVkLEVBQUUsQ0FBQ2UsSUFQUDtJQVFSQyxRQUFRLEVBQUVoQixFQUFFLENBQUNlLElBUkw7SUFTUkUsYUFBYSxFQUFFakIsRUFBRSxDQUFDZSxJQVRWO0lBVVJHLGNBQWMsRUFBRWxCLEVBQUUsQ0FBQ1UsTUFWWDtJQVdSUyxRQUFRLEVBQUVuQixFQUFFLENBQUNlLElBWEw7SUFZUkssT0FBTyxFQUFFcEIsRUFBRSxDQUFDZSxJQVpKO0lBYVJNLFlBQVksRUFBRXJCLEVBQUUsQ0FBQ0ssS0FiVDtJQWNSaUIsV0FBVyxFQUFFdEIsRUFBRSxDQUFDSztFQWRSLENBRlA7RUFrQkxrQixp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QUFsRjtNQUNBdkYsRUFBRSxDQUFDOEUsWUFBSCxDQUFnQkcsS0FBaEIsQ0FDSSxRQURKLEVBRUksYUFGSixFQUdJLFVBSEosRUFJSTtRQUNJQyxFQUFFLEVBQUUsQ0FBQyxDQURUO1FBRUk3QixLQUFLLEVBQUUsQ0FBQztNQUZaLENBSkosRUFRSSxDQUFDLEtBQUtnQixVQUFOLENBUkosRUFTSXJFLEVBQUUsQ0FBQzhCLEdBQUgsQ0FBT1MsVUFBUCxDQUFrQmlELFVBQWxCLENBQTZCLE1BQTdCLENBVEosRUFVSSxZQUFZO1FBQ1IvRCxDQUFDLENBQUNGLGlCQUFGLENBQW9CRSxDQUFDLENBQUNHLE1BQXRCLEVBQThCSCxDQUFDLENBQUNRLFFBQWhDO01BQ0gsQ0FaTDtJQWNIO0VBQ0o7QUF6TEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIG5hbWVMYWJlbDogY2MuTGFiZWwsXG4gICAgICAgIHNwaW5lOiBzcC5Ta2VsZXRvbixcbiAgICAgICAgcXVhbGl0eVNwcml0ZTogY2MuU3ByaXRlLFxuICAgICAgICBjb3VudExhYmVsOiBjYy5MYWJlbCxcbiAgICAgICAgcHJpY2VTcHJpdGU6IGNjLlNwcml0ZSxcbiAgICAgICAgcHJpY2VMYWJlbDogY2MuTGFiZWwsXG4gICAgICAgIGZpbmlzaE5vZGU6IGNjLk5vZGUsXG4gICAgICAgIGJ1eVBhbmVsOiBjYy5Ob2RlLFxuICAgICAgICBkaXNjb3VudFBhbmVsOiBjYy5Ob2RlLFxuICAgICAgICBkaXNjb3VudFNwcml0ZTogY2MuU3ByaXRlLFxuICAgICAgICBmcmVlTm9kZTogY2MuTm9kZSxcbiAgICAgICAgYWRQYW5lbDogY2MuTm9kZSxcbiAgICAgICAgYWRUaW1lc0xhYmVsOiBjYy5MYWJlbCxcbiAgICAgICAgY2RUaW1lTGFiZWw6IGNjLkxhYmVsXG4gICAgfSxcbiAgICBpbml0U2hvcERhaWx5SXRlbTogZnVuY3Rpb24gKGUsIHQpIHtcbiAgICAgICAgdmFyIGkgPSB0aGlzO1xuICAgICAgICB0aGlzLmlzTG9va0FkID0gITE7XG4gICAgICAgIHRoaXMuc2hvcElkID0gZTtcbiAgICAgICAgdGhpcy5zaG9wRGF0YSA9IGNjLnB2ei5QbGF5ZXJEYXRhLmdldFNob3BEYXRhKHRoaXMuc2hvcElkKTtcbiAgICAgICAgdGhpcy5zaG9wSnNvbiA9IHQ7XG4gICAgICAgIHRoaXMuaXRlbUlkID0gdGhpcy5zaG9wRGF0YS5pdGVtSWQ7XG4gICAgICAgIHRoaXMuaXNGaW5pc2ggPSB0aGlzLnNob3BEYXRhLmJ1eVRpbWVzIDw9IDA7XG4gICAgICAgIHRoaXMuZmluaXNoTm9kZS5hY3RpdmUgPSB0aGlzLmlzRmluaXNoO1xuICAgICAgICBpZiAoMSAhPSB0aGlzLnNob3BJZCkge1xuICAgICAgICAgICAgdGhpcy50b29sSWQgPSB0aGlzLnNob3BEYXRhLnRvb2xJZDtcbiAgICAgICAgICAgIGlmICh0aGlzLml0ZW1JZCA9PT0gY2MucHZ6LkdhbWVDb25maWcuSXRlbVR5cGVbXCLlm7rlrprnoo7niYdcIl0pIHtcbiAgICAgICAgICAgICAgICB2YXIgbyA9IGNjLkpzb25Db250cm9sLmdldFRvb2xKc29uKHRoaXMudG9vbElkKTtcbiAgICAgICAgICAgICAgICBjYy5Kc29uQ29udHJvbC5nZXRRdWFsaXR5QmdJY29uKHRoaXMucXVhbGl0eVNwcml0ZSwgby5xdWFsaXR5KTtcbiAgICAgICAgICAgICAgICB2YXIgYSA9IGNjLnB2ei5QbGF5ZXJEYXRhLmdldFRvb2xEYXRhKHRoaXMudG9vbElkKTtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IGNjLnB2ei51dGlscy5nZXRMZXZlbEludGVydmFsKGEubHYpO1xuICAgICAgICAgICAgICAgIHRoaXMuc3BpbmUubm9kZS5zY2FsZSA9IG8uc2NhbGU7XG4gICAgICAgICAgICAgICAgY2MucHZ6LnV0aWxzLnVzZUJ1bmRsZUFzc2V0KFwiYWN0b3JzXCIsIFwiY2hhcmFjdGVyL0NoYXJhY3RlcnNcIiwgc3AuU2tlbGV0b25EYXRhLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBpLnNwaW5lLnNrZWxldG9uRGF0YSA9IGU7XG4gICAgICAgICAgICAgICAgICAgIGkuc3BpbmUuc2V0QW5pbWF0aW9uKDAsIFwiSWRsZVwiLCAhMCk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgdGhpcy5uYW1lTGFiZWwuc3RyaW5nID0gby5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5jb3VudExhYmVsLnN0cmluZyA9IFwieFwiICsgdGhpcy5zaG9wRGF0YS5jb3VudDtcbiAgICAgICAgICAgIHRoaXMuZGlzY291bnRQYW5lbC5hY3RpdmUgPSB0aGlzLnNob3BEYXRhLmRpc2NvdW50IDwgMTA7XG4gICAgICAgICAgICBpZiAodGhpcy5zaG9wRGF0YS5kaXNjb3VudCA8IDEwKSB7XG4gICAgICAgICAgICAgICAgY2MucHZ6LnV0aWxzLnNldFNwcml0ZUZyYW1lKHRoaXMuZGlzY291bnRTcHJpdGUsIFwidWlJbWFnZVwiLCBcInNob3Avemhla291XCIgKyB0aGlzLnNob3BEYXRhLmRpc2NvdW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMuYnV5UGFuZWwuYWN0aXZlID0gIXRoaXMuaXNGaW5pc2g7XG4gICAgICAgICAgICB0aGlzLnByaWNlTGFiZWwuc3RyaW5nID0gdGhpcy5zaG9wRGF0YS5wcmljZTtcbiAgICAgICAgICAgIHZhciBzID0gY2MuSnNvbkNvbnRyb2wuZ2V0SXRlbUpzb24odGhpcy5zaG9wRGF0YS5wcmljZVR5cGUpO1xuICAgICAgICAgICAgY2MuSnNvbkNvbnRyb2wuZ2V0SXRlbUljb24odGhpcy5wcmljZVNwcml0ZSwgcy5JY29uKTtcbiAgICAgICAgICAgIHRoaXMucmV3YXJkRGF0YSA9IGNjLnB2ei51dGlscy5nZXRSZXdhcmRUb29sSXRlbSh0aGlzLnRvb2xJZCwgdGhpcy5zaG9wRGF0YS5jb3VudCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmlzRnJlZSA9IDEgPT0gY2MucHZ6LlBsYXllckRhdGEuZ2V0U2hvcFRpbWVzKGNjLnB2ei5HYW1lQ29uZmlnLlNob3BUaW1lc1R5cGVbXCLpkrvnn7PlhY3otLlcIl0pO1xuICAgICAgICAgICAgdmFyIG4gPSAodGhpcy5pc0ZyZWUsIDEwMCk7XG4gICAgICAgICAgICB0aGlzLmNvdW50TGFiZWwuc3RyaW5nID0gXCJ4XCIgKyBuO1xuICAgICAgICAgICAgdGhpcy5mcmVlTm9kZS5hY3RpdmUgPSB0aGlzLmlzRnJlZSAmJiAhdGhpcy5pc0ZpbmlzaDtcbiAgICAgICAgICAgIHRoaXMuYWRQYW5lbC5hY3RpdmUgPSAhdGhpcy5pc0ZyZWUgJiYgIXRoaXMuaXNGaW5pc2g7XG4gICAgICAgICAgICB0aGlzLmNkVGltZUxhYmVsLm5vZGUuYWN0aXZlID0gITE7XG4gICAgICAgICAgICB0aGlzLmFkVGltZXNMYWJlbC5zdHJpbmcgPSBcIihcIiArIHRoaXMuc2hvcERhdGEuYnV5VGltZXMgKyBcIilcIjtcbiAgICAgICAgICAgIHRoaXMucmV3YXJkRGF0YSA9IGNjLnB2ei51dGlscy5nZXRSZXdhcmRJdGVtKHRoaXMuaXRlbUlkLCBuKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25DbGlja0luZm9CdXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICBpZiAoY2MuVUlTaG9wLmlzTG9va0FkKSB7XG4gICAgICAgICAgICAvL1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNGaW5pc2gpIHtcbiAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIuc2hvd1RvYXN0KFwi5bey5ZSu572E77yBXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5VSVNob3Aub25TdG9wU2hvcFNjcm9sbCgpLFxuICAgICAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgICAgICAgICBcIm1haW5VSVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJzaG9wYnV5VUlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiVUlTaG9wQnV5XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNjYWxlOiAhMFxuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMucmV3YXJkRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFt0aGlzLnNob3BEYXRhLnByaWNlVHlwZSwgdGhpcy5zaG9wRGF0YS5wcmljZV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEudXBkYXRlU2hvcERhdGFCdXkoZS5zaG9wSWQsIDEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuaW5pdFNob3BEYWlseUl0ZW0oZS5zaG9wSWQsIGUuc2hvcEpzb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICEwXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tCdXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICBpZiAoIWNjLlVJU2hvcC5pc0xvb2tBZCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuaXNGaW5pc2gpIHtcbiAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIuc2hvd1RvYXN0KFwi5bey5ZSu572E77yBXCIpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgoY2MuVUlTaG9wLm9uU3RvcFNob3BTY3JvbGwoKSwgMSA9PSB0aGlzLnNob3BJZCkpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5pc0ZyZWUpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEudXBkYXRlU2hvcFRpbWVzKGNjLnB2ei5HYW1lQ29uZmlnLlNob3BUaW1lc1R5cGVbXCLpkrvnn7PlhY3otLlcIl0pO1xuICAgICAgICAgICAgICAgICAgICBjYy5wdnouUGxheWVyRGF0YS5hZGRNaXNzaW9uUHJvZ3Jlc3MoY2MucHZ6LkdhbWVDb25maWcuTWlzc2lvblR5cGVbXCLmr4/ml6XllYblupfotK3kubBu5qyh54mp5ZOBXCJdLCAxKTtcbiAgICAgICAgICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnBvcHVwKFxuICAgICAgICAgICAgICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiZ2V0cmV3YXJkVUlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiVUlSZXdhcmRcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhZDogITEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICExXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgW3RoaXMucmV3YXJkRGF0YV0sXG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5q+P5pel5ZWG5bqXXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUuaW5pdFNob3BEYWlseUl0ZW0oZS5zaG9wSWQsIGUuc2hvcEpzb24pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLlVJU2hvcC51cGRhdGVSZWRUaXAoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBjYy5VSVNob3AuaXNMb29rQWQgPSAhMDtcbiAgICAgICAgICAgICAgICAgICAgY2MucHZ6LkFkVXRpbHMuc2hvd0FkUmV3YXJkVmlkZW8oY2MucHZ6LkdhbWVDb25maWcuQWRUeXBlW1wi5ZWG5bqX6ZK755+zXCJdLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5vbkFkQ2xvc2UodCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gZWxzZSBpZiAoY2MucHZ6LlBsYXllckRhdGEuaXNJdGVtRW5vdWdoKHRoaXMuc2hvcERhdGEucHJpY2VUeXBlLCB0aGlzLnNob3BEYXRhLnByaWNlKSkge1xuICAgICAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLnVwZGF0ZVNob3BEYXRhQnV5KHRoaXMuc2hvcElkLCAxKTtcbiAgICAgICAgICAgICAgICBjYy5wdnouUGxheWVyRGF0YS5jaGFuZ2VJdGVtTnVtKHRoaXMuc2hvcERhdGEucHJpY2VUeXBlLCAtdGhpcy5zaG9wRGF0YS5wcmljZSk7XG4gICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEuYWRkTWlzc2lvblByb2dyZXNzKGNjLnB2ei5HYW1lQ29uZmlnLk1pc3Npb25UeXBlW1wi5q+P5pel5ZWG5bqX6LSt5LmwbuasoeeJqeWTgVwiXSwgMSk7XG4gICAgICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnBvcHVwKFxuICAgICAgICAgICAgICAgICAgICBcIm1haW5VSVwiLFxuICAgICAgICAgICAgICAgICAgICBcImdldHJld2FyZFVJXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiVUlSZXdhcmRcIixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICExXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFt0aGlzLnJld2FyZERhdGFdLFxuICAgICAgICAgICAgICAgICAgICBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5q+P5pel5ZWG5bqXXCJdLFxuICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmluaXRTaG9wRGFpbHlJdGVtKGUuc2hvcElkLCBlLnNob3BKc29uKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHZhciB0ID0gMiA9PSB0aGlzLnNob3BEYXRhLnByaWNlVHlwZTtcbiAgICAgICAgICAgICAgICBpZiAoY2MucHZ6LlBsYXllckRhdGEuaXNIYXZlQWRCdXlCYW5rVGltZXModCA/IDAgOiAxKSkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgaSA9IGNjLnB2ei51dGlscy5nZXRSZXdhcmRJdGVtKHRoaXMuc2hvcERhdGEucHJpY2VUeXBlLCB0ID8gMjUwMCA6IDEwMCk7XG4gICAgICAgICAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5wb3B1cChcbiAgICAgICAgICAgICAgICAgICAgICAgIFwibWFpblVJXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICBcImFkYnV5VUlcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIFwiVUlBZEJ1eVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFkOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzY2FsZTogITBcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICBpXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG87XG4gICAgICAgICAgICAgICAgICAgIGlmICgyID09IHRoaXMuc2hvcERhdGEucHJpY2VUeXBlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvID0gXCLph5HluIFcIjtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG8gPSBcIumSu+efs1wiO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5zaG93VG9hc3QobyArIFwi5LiN6Laz77yBXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25BZENsb3NlOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdCA9IHRoaXM7XG4gICAgICAgIGNjLlVJU2hvcC5pc0xvb2tBZCA9ICExO1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEudXBkYXRlU2hvcERhdGFCdXkodGhpcy5zaG9wSWQsIDEpO1xuICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEuYWRkTWlzc2lvblByb2dyZXNzKGNjLnB2ei5HYW1lQ29uZmlnLk1pc3Npb25UeXBlW1wi5q+P5pel5ZWG5bqX6LSt5LmwbuasoeeJqeWTgVwiXSwgMSk7XG4gICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgICAgICBcImdldHJld2FyZFVJXCIsXG4gICAgICAgICAgICAgICAgXCJVSVJld2FyZFwiLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZTogITFcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIFt0aGlzLnJld2FyZERhdGFdLFxuICAgICAgICAgICAgICAgIGNjLnB2ei5HYW1lQ29uZmlnLlVJRnJvbVR5cGVbXCLmr4/ml6XllYblupdcIl0sXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB0LmluaXRTaG9wRGFpbHlJdGVtKHQuc2hvcElkLCB0LnNob3BKc29uKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfVxufSk7Il19