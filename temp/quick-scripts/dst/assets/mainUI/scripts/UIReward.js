
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/mainUI/scripts/UIReward.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'c7576jyMIdBMZD68DvkmUF7', 'UIReward');
// mainUI/scripts/UIReward.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    baseItemNode: cc.Node,
    parentOnePanel: cc.Node,
    parentMorePanel: cc.Node,
    closeBtn: cc.Node,
    effectSpine: sp.Skeleton,
    bgSpine: sp.Skeleton,
    rewardSound: cc.AudioClip
  },
  onLoad: function onLoad() {
    cc.UIReward = this;
    this.baseItemNode.active = !1;
    this.effectSpine.node.active = !1;
  },
  showEffectSpine: function showEffectSpine() {
    var e = this;
    this.effectSpine.node.active = !0;
    this.effectSpine.setAnimation(0, "caidai", !1);
    this.effectSpine.setCompleteListener(function () {
      e.effectSpine.node.active = !1;
      e.effectSpine.setCompleteListener(null);
    });
  },
  initBy: function initBy(e, t, i, o) {
    var a = this;

    if (void 0 === i) {
      i = null;
    }

    if (void 0 === o) {
      o = null;
    }

    this.fromType = t;
    this.callBack = i;
    this.getItemEffectPosCb = o;
    this.closeBtn.active = !1;
    this.onCheckRewardData(e);
    this.bgSpine.setEventListener(function (e, t) {
      if ("ShowItem" == t.data.name) {
        a.initUIInfo();
        a.showEffectSpine();
      }
    });
    this.bgSpine.setAnimation(0, "get1", !1);
    this.bgSpine.setCompleteListener(function () {
      a.bgSpine.setAnimation(0, "get2", !0);
      a.bgSpine.setCompleteListener(null);
    });
    cc.butler.playEffect(this.rewardSound);
  },
  onCheckRewardData: function onCheckRewardData(e) {
    this.rewardData = [];
    this.effectItemList = [];

    for (var t = 0; t < e.length; t++) {
      var i = e[t];

      if (i.itemId >= 5 && i.itemId <= 7) {
        cc.pvz.utils.onCheckRandomTool(i, this.rewardData, this.fromType != cc.pvz.GameConfig.UIFromType["签到"]);
      } else {
        this.rewardData.push(i);
        i.itemId >= 2 && i.itemId <= 4 && this.effectItemList.push(i.itemId);
      }
    }
  },
  initUIInfo: function initUIInfo() {
    this.closeBtn.active = !0;
    var e = this.rewardData.length;
    var t;

    if (e <= 5) {
      t = this.parentOnePanel;
    } else {
      t = this.parentMorePanel;
    }

    this.baseItemNode.active = !0;
    this.baseItemNode.parent = t;
    this.baseItemNode.position = cc.v2(0, 0);
    var i = this.fromType != cc.pvz.GameConfig.UIFromType["双倍结算"];
    this.baseItemNode.getComponent("RewardItem").initRewardItem(this.rewardData[0], i);

    for (var o = 1; o < e; o++) {
      var a = cc.instantiate(this.baseItemNode);
      a.parent = t;
      a.getComponent("RewardItem").initRewardItem(this.rewardData[o], i);
    }
  },
  onCloseUI: function onCloseUI() {
    cc.popupManager.removePopup(this);

    if (this.fromType != cc.pvz.GameConfig.UIFromType["双倍结算"]) {
      if (this.effectItemList.length > 0) {
        var e = -1;

        for (var t = 0; t < this.effectItemList.length; t++) {
          var i = this.effectItemList[t];

          for (var o = cc.math.randomRangeInt(1, 4); -1 != e && e == o;) {
            o = cc.math.randomRangeInt(1, 4);
          }

          e = o;

          if (this.fromType == cc.pvz.GameConfig.UIFromType["日常任务"] || this.fromType == cc.pvz.GameConfig.UIFromType["周常任务"] || this.fromType == cc.pvz.GameConfig.UIFromType["成就"]) {
            cc.popupManager.showEffectFly(i, cc.UITask.getItemEffectPos(i), o);
          } else {
            if (this.fromType == cc.pvz.GameConfig.UIFromType["基金"]) {
              cc.popupManager.showEffectFly(i, this.getItemEffectPosCb(i), o);
            } else {
              cc.popupManager.showEffectFly(i, cc.MainControl.getItemEffectPos(i), o);
            }
          }
        }
      }

      if (this.fromType === cc.pvz.GameConfig.UIFromType["关卡宝箱"]) {
        cc.MainControl.checkPowerInfo();
      }

      if (this.callBack) {
        this.callBack();
      }

      cc.MainControl.updateItemInfo();
      cc.RedControl.refreshAllRedTip();
    } else {
      if (this.callBack) {
        this.callBack();
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluVUkvc2NyaXB0cy9VSVJld2FyZC5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImJhc2VJdGVtTm9kZSIsIk5vZGUiLCJwYXJlbnRPbmVQYW5lbCIsInBhcmVudE1vcmVQYW5lbCIsImNsb3NlQnRuIiwiZWZmZWN0U3BpbmUiLCJzcCIsIlNrZWxldG9uIiwiYmdTcGluZSIsInJld2FyZFNvdW5kIiwiQXVkaW9DbGlwIiwib25Mb2FkIiwiVUlSZXdhcmQiLCJhY3RpdmUiLCJub2RlIiwic2hvd0VmZmVjdFNwaW5lIiwiZSIsInNldEFuaW1hdGlvbiIsInNldENvbXBsZXRlTGlzdGVuZXIiLCJpbml0QnkiLCJ0IiwiaSIsIm8iLCJhIiwiZnJvbVR5cGUiLCJjYWxsQmFjayIsImdldEl0ZW1FZmZlY3RQb3NDYiIsIm9uQ2hlY2tSZXdhcmREYXRhIiwic2V0RXZlbnRMaXN0ZW5lciIsImRhdGEiLCJuYW1lIiwiaW5pdFVJSW5mbyIsImJ1dGxlciIsInBsYXlFZmZlY3QiLCJyZXdhcmREYXRhIiwiZWZmZWN0SXRlbUxpc3QiLCJsZW5ndGgiLCJpdGVtSWQiLCJwdnoiLCJ1dGlscyIsIm9uQ2hlY2tSYW5kb21Ub29sIiwiR2FtZUNvbmZpZyIsIlVJRnJvbVR5cGUiLCJwdXNoIiwicGFyZW50IiwicG9zaXRpb24iLCJ2MiIsImdldENvbXBvbmVudCIsImluaXRSZXdhcmRJdGVtIiwiaW5zdGFudGlhdGUiLCJvbkNsb3NlVUkiLCJwb3B1cE1hbmFnZXIiLCJyZW1vdmVQb3B1cCIsIm1hdGgiLCJyYW5kb21SYW5nZUludCIsInNob3dFZmZlY3RGbHkiLCJVSVRhc2siLCJnZXRJdGVtRWZmZWN0UG9zIiwiTWFpbkNvbnRyb2wiLCJjaGVja1Bvd2VySW5mbyIsInVwZGF0ZUl0ZW1JbmZvIiwiUmVkQ29udHJvbCIsInJlZnJlc2hBbGxSZWRUaXAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FB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Q0FBd0JMLENBQXhCLENBQWpDLEVBQTZEQyxDQUE3RDtZQUNILENBRkQsTUFFTztjQUNIMUIsRUFBRSxDQUFDdUQsWUFBSCxDQUFnQkksYUFBaEIsQ0FBOEJsQyxDQUE5QixFQUFpQ3pCLEVBQUUsQ0FBQzhELFdBQUgsQ0FBZUQsZ0JBQWYsQ0FBZ0NwQyxDQUFoQyxDQUFqQyxFQUFxRUMsQ0FBckU7WUFDSDtVQUNKO1FBQ0o7TUFDSjs7TUFDRCxJQUFJLEtBQUtFLFFBQUwsS0FBa0I1QixFQUFFLENBQUMwQyxHQUFILENBQU9HLFVBQVAsQ0FBa0JDLFVBQWxCLENBQTZCLE1BQTdCLENBQXRCLEVBQTREO1FBQ3hEOUMsRUFBRSxDQUFDOEQsV0FBSCxDQUFlQyxjQUFmO01BQ0g7O01BQ0QsSUFBSSxLQUFLbEMsUUFBVCxFQUFtQjtRQUNmLEtBQUtBLFFBQUw7TUFDSDs7TUFDRDdCLEVBQUUsQ0FBQzhELFdBQUgsQ0FBZUUsY0FBZjtNQUNBaEUsRUFBRSxDQUFDaUUsVUFBSCxDQUFjQyxnQkFBZDtJQUNILENBaENELE1BZ0NPO01BQ0gsSUFBSSxLQUFLckMsUUFBVCxFQUFtQjtRQUNmLEtBQUtBLFFBQUw7TUFDSDtJQUNKO0VBQ0o7QUEvSEksQ0FBVCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuQ2xhc3Moe1xuICAgIGV4dGVuZHM6IGNjLkNvbXBvbmVudCxcbiAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgIGJhc2VJdGVtTm9kZTogY2MuTm9kZSxcbiAgICAgICAgcGFyZW50T25lUGFuZWw6IGNjLk5vZGUsXG4gICAgICAgIHBhcmVudE1vcmVQYW5lbDogY2MuTm9kZSxcbiAgICAgICAgY2xvc2VCdG46IGNjLk5vZGUsXG4gICAgICAgIGVmZmVjdFNwaW5lOiBzcC5Ta2VsZXRvbixcbiAgICAgICAgYmdTcGluZTogc3AuU2tlbGV0b24sXG4gICAgICAgIHJld2FyZFNvdW5kOiBjYy5BdWRpb0NsaXBcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5VSVJld2FyZCA9IHRoaXM7XG4gICAgICAgIHRoaXMuYmFzZUl0ZW1Ob2RlLmFjdGl2ZSA9ICExO1xuICAgICAgICB0aGlzLmVmZmVjdFNwaW5lLm5vZGUuYWN0aXZlID0gITE7XG4gICAgfSxcbiAgICBzaG93RWZmZWN0U3BpbmU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSB0aGlzO1xuICAgICAgICB0aGlzLmVmZmVjdFNwaW5lLm5vZGUuYWN0aXZlID0gITA7XG4gICAgICAgIHRoaXMuZWZmZWN0U3BpbmUuc2V0QW5pbWF0aW9uKDAsIFwiY2FpZGFpXCIsICExKTtcbiAgICAgICAgdGhpcy5lZmZlY3RTcGluZS5zZXRDb21wbGV0ZUxpc3RlbmVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGUuZWZmZWN0U3BpbmUubm9kZS5hY3RpdmUgPSAhMTtcbiAgICAgICAgICAgIGUuZWZmZWN0U3BpbmUuc2V0Q29tcGxldGVMaXN0ZW5lcihudWxsKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBpbml0Qnk6IGZ1bmN0aW9uIChlLCB0LCBpLCBvKSB7XG4gICAgICAgIHZhciBhID0gdGhpcztcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gaSkge1xuICAgICAgICAgICAgaSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gbykge1xuICAgICAgICAgICAgbyA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5mcm9tVHlwZSA9IHQ7XG4gICAgICAgIHRoaXMuY2FsbEJhY2sgPSBpO1xuICAgICAgICB0aGlzLmdldEl0ZW1FZmZlY3RQb3NDYiA9IG87XG4gICAgICAgIHRoaXMuY2xvc2VCdG4uYWN0aXZlID0gITE7XG4gICAgICAgIHRoaXMub25DaGVja1Jld2FyZERhdGEoZSk7XG4gICAgICAgIHRoaXMuYmdTcGluZS5zZXRFdmVudExpc3RlbmVyKGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgICAgICBpZiAoXCJTaG93SXRlbVwiID09IHQuZGF0YS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgYS5pbml0VUlJbmZvKCk7XG4gICAgICAgICAgICAgICAgYS5zaG93RWZmZWN0U3BpbmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYmdTcGluZS5zZXRBbmltYXRpb24oMCwgXCJnZXQxXCIsICExKTtcbiAgICAgICAgdGhpcy5iZ1NwaW5lLnNldENvbXBsZXRlTGlzdGVuZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgYS5iZ1NwaW5lLnNldEFuaW1hdGlvbigwLCBcImdldDJcIiwgITApO1xuICAgICAgICAgICAgYS5iZ1NwaW5lLnNldENvbXBsZXRlTGlzdGVuZXIobnVsbCk7XG4gICAgICAgIH0pO1xuICAgICAgICBjYy5idXRsZXIucGxheUVmZmVjdCh0aGlzLnJld2FyZFNvdW5kKTtcbiAgICB9LFxuICAgIG9uQ2hlY2tSZXdhcmREYXRhOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLnJld2FyZERhdGEgPSBbXTtcbiAgICAgICAgdGhpcy5lZmZlY3RJdGVtTGlzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IGUubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgIHZhciBpID0gZVt0XTtcbiAgICAgICAgICAgIGlmIChpLml0ZW1JZCA+PSA1ICYmIGkuaXRlbUlkIDw9IDcpIHtcbiAgICAgICAgICAgICAgICBjYy5wdnoudXRpbHMub25DaGVja1JhbmRvbVRvb2woXG4gICAgICAgICAgICAgICAgICAgIGksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmV3YXJkRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5mcm9tVHlwZSAhPSBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi562+5YiwXCJdXG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXdhcmREYXRhLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgaS5pdGVtSWQgPj0gMiAmJiBpLml0ZW1JZCA8PSA0ICYmIHRoaXMuZWZmZWN0SXRlbUxpc3QucHVzaChpLml0ZW1JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIGluaXRVSUluZm86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5jbG9zZUJ0bi5hY3RpdmUgPSAhMDtcbiAgICAgICAgdmFyIGUgPSB0aGlzLnJld2FyZERhdGEubGVuZ3RoO1xuICAgICAgICB2YXIgdDtcbiAgICAgICAgaWYgKGUgPD0gNSkge1xuICAgICAgICAgICAgdCA9IHRoaXMucGFyZW50T25lUGFuZWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0ID0gdGhpcy5wYXJlbnRNb3JlUGFuZWw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5iYXNlSXRlbU5vZGUuYWN0aXZlID0gITA7XG4gICAgICAgIHRoaXMuYmFzZUl0ZW1Ob2RlLnBhcmVudCA9IHQ7XG4gICAgICAgIHRoaXMuYmFzZUl0ZW1Ob2RlLnBvc2l0aW9uID0gY2MudjIoMCwgMCk7XG4gICAgICAgIHZhciBpID0gdGhpcy5mcm9tVHlwZSAhPSBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5Y+M5YCN57uT566XXCJdO1xuICAgICAgICB0aGlzLmJhc2VJdGVtTm9kZS5nZXRDb21wb25lbnQoXCJSZXdhcmRJdGVtXCIpLmluaXRSZXdhcmRJdGVtKHRoaXMucmV3YXJkRGF0YVswXSwgaSk7XG4gICAgICAgIGZvciAodmFyIG8gPSAxOyBvIDwgZTsgbysrKSB7XG4gICAgICAgICAgICB2YXIgYSA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYmFzZUl0ZW1Ob2RlKTtcbiAgICAgICAgICAgIGEucGFyZW50ID0gdDtcbiAgICAgICAgICAgIGEuZ2V0Q29tcG9uZW50KFwiUmV3YXJkSXRlbVwiKS5pbml0UmV3YXJkSXRlbSh0aGlzLnJld2FyZERhdGFbb10sIGkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkNsb3NlVUk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnJlbW92ZVBvcHVwKHRoaXMpO1xuICAgICAgICBpZiAodGhpcy5mcm9tVHlwZSAhPSBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5Y+M5YCN57uT566XXCJdKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5lZmZlY3RJdGVtTGlzdC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgdmFyIGUgPSAtMTtcbiAgICAgICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuZWZmZWN0SXRlbUxpc3QubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLmVmZmVjdEl0ZW1MaXN0W3RdO1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBvID0gY2MubWF0aC5yYW5kb21SYW5nZUludCgxLCA0KTsgLTEgIT0gZSAmJiBlID09IG87ICkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbyA9IGNjLm1hdGgucmFuZG9tUmFuZ2VJbnQoMSwgNCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZSA9IG87XG4gICAgICAgICAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuZnJvbVR5cGUgPT0gY2MucHZ6LkdhbWVDb25maWcuVUlGcm9tVHlwZVtcIuaXpeW4uOS7u+WKoVwiXSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5mcm9tVHlwZSA9PSBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5ZGo5bi45Lu75YqhXCJdIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLmZyb21UeXBlID09IGNjLnB2ei5HYW1lQ29uZmlnLlVJRnJvbVR5cGVbXCLmiJDlsLFcIl1cbiAgICAgICAgICAgICAgICAgICAgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIuc2hvd0VmZmVjdEZseShpLCBjYy5VSVRhc2suZ2V0SXRlbUVmZmVjdFBvcyhpKSwgbyk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5mcm9tVHlwZSA9PSBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5Z+66YeRXCJdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnNob3dFZmZlY3RGbHkoaSwgdGhpcy5nZXRJdGVtRWZmZWN0UG9zQ2IoaSksIG8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIuc2hvd0VmZmVjdEZseShpLCBjYy5NYWluQ29udHJvbC5nZXRJdGVtRWZmZWN0UG9zKGkpLCBvKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmZyb21UeXBlID09PSBjYy5wdnouR2FtZUNvbmZpZy5VSUZyb21UeXBlW1wi5YWz5Y2h5a6d566xXCJdKSB7XG4gICAgICAgICAgICAgICAgY2MuTWFpbkNvbnRyb2wuY2hlY2tQb3dlckluZm8oKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmNhbGxCYWNrKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jYWxsQmFjaygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2MuTWFpbkNvbnRyb2wudXBkYXRlSXRlbUluZm8oKTtcbiAgICAgICAgICAgIGNjLlJlZENvbnRyb2wucmVmcmVzaEFsbFJlZFRpcCgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKHRoaXMuY2FsbEJhY2spIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNhbGxCYWNrKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59KTtcbiJdfQ==