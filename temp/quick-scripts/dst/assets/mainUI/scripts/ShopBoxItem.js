
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/mainUI/scripts/ShopBoxItem.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'd2decYhKsZDGJRhlQcEjCjq', 'ShopBoxItem');
// mainUI/scripts/ShopBoxItem.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    boxCdTimes: cc.Label,
    boxCdPanel: cc.Node,
    boxAdBtnPanel: cc.Node,
    boxBuyBtn: cc.Node,
    tipLabel: cc.RichText
  },
  initShopBoxItem: function initShopBoxItem(e, t, i) {
    if (void 0 === i) {
      i = null;
    }

    this.boxId = e;
    this.shopBoxJson = t;
    this.callBack = i;
    this.price = this.shopBoxJson["consume" + this.boxId];
    this.shopBoxData = cc.pvz.PlayerData.getShopBoxData();
    var o = this.shopBoxData.date[this.boxId - 1];
    var a = Math.floor((Date.now() - o) / 1e3);
    this.ShopBoxCD = cc.pvz.GameConfig.ShopBoxCD[this.boxId - 1];

    if (a >= this.ShopBoxCD) {
      this.boxCdPanel.active = !1;
      this.isCanAdBuy = !0;
      this.onCheckBoxAdBtnGray(!1);
      this.unscheduleAllCallbacks();
    } else {
      this.boxCdPanel.active = !0;
      this.isCanAdBuy = !1;
      this.onCheckBoxAdBtnGray(!0);
      this.lastTime = Math.floor(this.ShopBoxCD - a);
      this.boxCdTimes.string = cc.pvz.utils.formatSeconds3(this.lastTime);
      this.schedule(this.refreshCDTime, 1);
    }

    var c = this.shopBoxJson["box" + this.boxId];
    var s = c[c.length - 2];
    this.tipLabel.string = cc.pvz.GameConfig.BoxTipNames[s - 5];
    var n = Math.floor(c.length / 2);
    var r = 0;
    this.rewardData = [];

    for (var h = 0; h < n; h++) {
      var p = cc.pvz.utils.getRewardItem(c[r], c[r + 1]);
      this.rewardData.push(p);
      r += 2;
    }
  },
  refreshCDTime: function refreshCDTime() {
    this.lastTime--;
    this.boxCdTimes.string = cc.pvz.utils.formatSeconds3(this.lastTime);

    if (this.lastTime <= 0) {
      this.boxCdPanel.active = !1;
      this.isCanAdBuy = !0;
      this.onCheckBoxAdBtnGray(!1);
      this.unschedule(this.refreshCDTime, this);
    }
  },
  showBoxCdTime: function showBoxCdTime() {
    this.boxCdPanel.active = !0;
    this.isCanAdBuy = !1;
    this.onCheckBoxAdBtnGray(!0);
    this.lastTime = this.ShopBoxCD;
    this.boxCdTimes.string = cc.pvz.utils.formatSeconds3(this.lastTime);
    this.schedule(this.refreshCDTime, 1);
  },
  onCheckBoxAdBtnGray: function onCheckBoxAdBtnGray(e) {
    if (1 == this.boxId) {
      this.boxAdBtnPanel.active = !e;
      this.boxBuyBtn && (this.boxBuyBtn.active = e);
    } else {
      for (var t = 0; t < this.boxAdBtnPanel.childrenCount; t++) {
        this.boxAdBtnPanel.children[t].getComponent(cc.Sprite).setMaterial(0, cc.JsonControl.materialList[e ? 1 : 0]);
      }
    }
  },
  onClickBoxInfo: function onClickBoxInfo() {
    var e = this;

    if (cc.UIShop.isLookAd) {//
    } else {
      cc.UIShop.onStopShopScroll();
      cc.popupManager.popup("mainUI", "shopboxBuy", "UIShopBoxBuy", {
        ad: !1,
        scale: !0
      }, this.boxId, this.shopBoxJson, this.isCanAdBuy, function () {
        if (e.callBack) {
          e.callBack();
        }

        e.showBoxCdTime();
      });
    }
  },
  onClickAdBox: function onClickAdBox() {
    var e = this;

    if (cc.UIShop.isLookAd) {//
    } else {
      if (this.isCanAdBuy) {
        cc.UIShop.onStopShopScroll();

        if (1 == this.boxId) {
          this.onAdClose(!0);
        } else {
          cc.UIShop.isLookAd = !0, cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["商店宝箱"], function (t) {
            e.onAdClose(t);
          });
        }
      }
    }
  },
  onAdClose: function onAdClose(e) {
    cc.UIShop.isLookAd = !1;

    if (e) {
      cc.pvz.PlayerData.updateShopBoxDate(this.boxId, Date.now());

      if (this.isCanAdBuy && 2 == this.boxId) {
        cc.pvz.PlayerData.updateShopBoxExp(this.price);
      }

      this.showBoxCdTime();
      cc.popupManager.popup("mainUI", "ShopBoxEft", "UIShopBoxReward", {
        ad: !1,
        scale: !0
      }, this.boxId, this.rewardData, this.callBack);
    }
  },
  onClickBuyBox: function onClickBuyBox() {
    if (!cc.UIShop.isLookAd) {
      cc.UIShop.onStopShopScroll();

      if (cc.pvz.PlayerData.isItemEnough(cc.pvz.GameConfig.ItemType["钻石"], this.price)) {
        cc.pvz.PlayerData.updateShopBoxExp(this.price);
        cc.pvz.PlayerData.changeItemNum(cc.pvz.GameConfig.ItemType["钻石"], -this.price);
        cc.popupManager.popup("mainUI", "ShopBoxEft", "UIShopBoxReward", {
          ad: !1,
          scale: !0
        }, this.boxId, this.rewardData, this.callBack);
      } else if (cc.pvz.PlayerData.isHaveAdBuyBankTimes(1)) {
        var e = cc.pvz.utils.getRewardItem(cc.pvz.GameConfig.ItemType["钻石"], 100);
        cc.popupManager.popup("mainUI", "adbuyUI", "UIAdBuy", {
          ad: !1,
          scale: !0
        }, e);
      } else {
        cc.popupManager.showToast("钻石不足！");
      }
    }
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluVUkvc2NyaXB0cy9TaG9wQm94SXRlbS5qcyJdLCJuYW1lcyI6WyJjYyIsIkNsYXNzIiwiQ29tcG9uZW50IiwicHJvcGVydGllcyIsImJveENkVGltZXMiLCJMYWJlbCIsImJveENkUGFuZWwiLCJOb2RlIiwiYm94QWRCdG5QYW5lbCIsImJveEJ1eUJ0biIsInRpcExhYmVsIiwiUmljaFRleHQiLCJpbml0U2hvcEJveEl0ZW0iLCJlIiwidCIsImkiLCJib3hJZCIsInNob3BCb3hKc29uIiwiY2FsbEJhY2siLCJwcmljZSIsInNob3BCb3hEYXRhIiwicHZ6IiwiUGxheWVyRGF0YSIsImdldFNob3BCb3hEYXRhIiwibyIsImRhdGUiLCJhIiwiTWF0aCIsImZsb29yIiwiRGF0ZSIsIm5vdyIsIlNob3BCb3hDRCIsIkdhbWVDb25maWciLCJhY3RpdmUiLCJpc0NhbkFkQnV5Iiwib25DaGVja0JveEFkQnRuR3JheSIsInVuc2NoZWR1bGVBbGxDYWxsYmFja3MiLCJsYXN0VGltZSIsInN0cmluZyIsInV0aWxzIiwiZm9ybWF0U2Vjb25kczMiLCJzY2hlZHVsZSIsInJlZnJlc2hDRFRpbWUiLCJjIiwicyIsImxlbmd0aCIsIkJveFRpcE5hbWVzIiwibiIsInIiLCJyZXdhcmREYXRhIiwiaCIsInAiLCJnZXRSZXdhcmRJdGVtIiwicHVzaCIsInVuc2NoZWR1bGUiLCJzaG93Qm94Q2RUaW1lIiwiY2hpbGRyZW5Db3VudCIsImNoaWxkcmVuIiwiZ2V0Q29tcG9uZW50IiwiU3ByaXRlIiwic2V0TWF0ZXJpYWwiLCJKc29uQ29udHJvbCIsIm1hdGVyaWFsTGlzdCIsIm9uQ2xpY2tCb3hJbmZvIiwiVUlTaG9wIiwiaXNMb29rQWQiLCJvblN0b3BTaG9wU2Nyb2xsIiwicG9wdXBNYW5hZ2VyIiwicG9wdXAiLCJhZCIsInNjYWxlIiwib25DbGlja0FkQm94Iiwib25BZENsb3NlIiwiQWRVdGlscyIsInNob3dBZFJld2FyZFZpZGVvIiwiQWRUeXBlIiwidXBkYXRlU2hvcEJveERhdGUiLCJ1cGRhdGVTaG9wQm94RXhwIiwib25DbGlja0J1eUJveCIsImlzSXRlbUVub3VnaCIsIkl0ZW1UeXBlIiwiY2hhbmdlSXRlbU51bSIsImlzSGF2ZUFkQnV5QmFua1RpbWVzIiwic2hvd1RvYXN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztFQUNMLFdBQVNELEVBQUUsQ0FBQ0UsU0FEUDtFQUVMQyxVQUFVLEVBQUU7SUFDUkMsVUFBVSxFQUFFSixFQUFFLENBQUNLLEtBRFA7SUFFUkMsVUFBVSxFQUFFTixFQUFFLENBQUNPLElBRlA7SUFHUkMsYUFBYSxFQUFFUixFQUFFLENBQUNPLElBSFY7SUFJUkUsU0FBUyxFQUFFVCxFQUFFLENBQUNPLElBSk47SUFLUkcsUUFBUSxFQUFFVixFQUFFLENBQUNXO0VBTEwsQ0FGUDtFQVNMQyxlQUFlLEVBQUUseUJBQVVDLENBQVYsRUFBYUMsQ0FBYixFQUFnQkMsQ0FBaEIsRUFBbUI7SUFDaEMsSUFBSSxLQUFLLENBQUwsS0FBV0EsQ0FBZixFQUFrQjtNQUNkQSxDQUFDLEdBQUcsSUFBSjtJQUNIOztJQUNELEtBQUtDLEtBQUwsR0FBYUgsQ0FBYjtJQUNBLEtBQUtJLFdBQUwsR0FBbUJILENBQW5CO0lBQ0EsS0FBS0ksUUFBTCxHQUFnQkgsQ0FBaEI7SUFDQSxLQUFLSSxLQUFMLEdBQWEsS0FBS0YsV0FBTCxDQUFpQixZQUFZLEtBQUtELEtBQWxDLENBQWI7SUFDQSxLQUFLSSxXQUFMLEdBQW1CcEIsRUFBRSxDQUFDcUIsR0FBSCxDQUFPQyxVQUFQLENBQWtCQyxjQUFsQixFQUFuQjtJQUNBLElBQUlDLENBQUMsR0FBRyxLQUFLSixXQUFMLENBQWlCSyxJQUFqQixDQUFzQixLQUFLVCxLQUFMLEdBQWEsQ0FBbkMsQ0FBUjtJQUNBLElBQUlVLENBQUMsR0FBR0MsSUFBSSxDQUFDQyxLQUFMLENBQVcsQ0FBQ0MsSUFBSSxDQUFDQyxHQUFMLEtBQWFOLENBQWQsSUFBbUIsR0FB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QUF4RTtRQUNBbkIsRUFBRSxDQUFDbUUsWUFBSCxDQUFnQkMsS0FBaEIsQ0FDSSxRQURKLEVBRUksWUFGSixFQUdJLGlCQUhKLEVBSUk7VUFDSUMsRUFBRSxFQUFFLENBQUMsQ0FEVDtVQUVJQyxLQUFLLEVBQUUsQ0FBQztRQUZaLENBSkosRUFRSSxLQUFLdEQsS0FSVCxFQVNJLEtBQUtpQyxVQVRULEVBVUksS0FBSy9CLFFBVlQ7TUFZSCxDQWZELE1BZU8sSUFBSWxCLEVBQUUsQ0FBQ3FCLEdBQUgsQ0FBT0MsVUFBUCxDQUFrQjRELG9CQUFsQixDQUF1QyxDQUF2QyxDQUFKLEVBQStDO1FBQ2xELElBQUlyRSxDQUFDLEdBQUdiLEVBQUUsQ0FBQ3FCLEdBQUgsQ0FBT2tCLEtBQVAsQ0FBYWEsYUFBYixDQUEyQnBELEVBQUUsQ0FBQ3FCLEdBQUgsQ0FBT1csVUFBUCxDQUFrQmdELFFBQWxCLENBQTJCLElBQTNCLENBQTNCLEVBQTZELEdBQTdELENBQVI7UUFDQWhGLEVBQUUsQ0FBQ21FLFlBQUgsQ0FBZ0JDLEtBQWhCLENBQ0ksUUFESixFQUVJLFNBRkosRUFHSSxTQUhKLEVBSUk7VUFDSUMsRUFBRSxFQUFFLENBQUMsQ0FEVDtVQUVJQyxLQUFLLEVBQUUsQ0FBQztRQUZaLENBSkosRUFRSXpELENBUko7TUFVSCxDQVpNLE1BWUE7UUFDSGIsRUFBRSxDQUFDbUUsWUFBSCxDQUFnQmdCLFNBQWhCLENBQTBCLE9BQTFCO01BQ0g7SUFDSjtFQUNKO0FBaExJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBib3hDZFRpbWVzOiBjYy5MYWJlbCxcbiAgICAgICAgYm94Q2RQYW5lbDogY2MuTm9kZSxcbiAgICAgICAgYm94QWRCdG5QYW5lbDogY2MuTm9kZSxcbiAgICAgICAgYm94QnV5QnRuOiBjYy5Ob2RlLFxuICAgICAgICB0aXBMYWJlbDogY2MuUmljaFRleHRcbiAgICB9LFxuICAgIGluaXRTaG9wQm94SXRlbTogZnVuY3Rpb24gKGUsIHQsIGkpIHtcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gaSkge1xuICAgICAgICAgICAgaSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ib3hJZCA9IGU7XG4gICAgICAgIHRoaXMuc2hvcEJveEpzb24gPSB0O1xuICAgICAgICB0aGlzLmNhbGxCYWNrID0gaTtcbiAgICAgICAgdGhpcy5wcmljZSA9IHRoaXMuc2hvcEJveEpzb25bXCJjb25zdW1lXCIgKyB0aGlzLmJveElkXTtcbiAgICAgICAgdGhpcy5zaG9wQm94RGF0YSA9IGNjLnB2ei5QbGF5ZXJEYXRhLmdldFNob3BCb3hEYXRhKCk7XG4gICAgICAgIHZhciBvID0gdGhpcy5zaG9wQm94RGF0YS5kYXRlW3RoaXMuYm94SWQgLSAxXTtcbiAgICAgICAgdmFyIGEgPSBNYXRoLmZsb29yKChEYXRlLm5vdygpIC0gbykgLyAxZTMpO1xuICAgICAgICB0aGlzLlNob3BCb3hDRCA9IGNjLnB2ei5HYW1lQ29uZmlnLlNob3BCb3hDRFt0aGlzLmJveElkIC0gMV07XG4gICAgICAgIGlmIChhID49IHRoaXMuU2hvcEJveENEKSB7XG4gICAgICAgICAgICB0aGlzLmJveENkUGFuZWwuYWN0aXZlID0gITE7XG4gICAgICAgICAgICB0aGlzLmlzQ2FuQWRCdXkgPSAhMDtcbiAgICAgICAgICAgIHRoaXMub25DaGVja0JveEFkQnRuR3JheSghMSk7XG4gICAgICAgICAgICB0aGlzLnVuc2NoZWR1bGVBbGxDYWxsYmFja3MoKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYm94Q2RQYW5lbC5hY3RpdmUgPSAhMDtcbiAgICAgICAgICAgIHRoaXMuaXNDYW5BZEJ1eSA9ICExO1xuICAgICAgICAgICAgdGhpcy5vbkNoZWNrQm94QWRCdG5HcmF5KCEwKTtcbiAgICAgICAgICAgIHRoaXMubGFzdFRpbWUgPSBNYXRoLmZsb29yKHRoaXMuU2hvcEJveENEIC0gYSk7XG4gICAgICAgICAgICB0aGlzLmJveENkVGltZXMuc3RyaW5nID0gY2MucHZ6LnV0aWxzLmZvcm1hdFNlY29uZHMzKHRoaXMubGFzdFRpbWUpO1xuICAgICAgICAgICAgdGhpcy5zY2hlZHVsZSh0aGlzLnJlZnJlc2hDRFRpbWUsIDEpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBjID0gdGhpcy5zaG9wQm94SnNvbltcImJveFwiICsgdGhpcy5ib3hJZF07XG4gICAgICAgIHZhciBzID0gY1tjLmxlbmd0aCAtIDJdO1xuICAgICAgICB0aGlzLnRpcExhYmVsLnN0cmluZyA9IGNjLnB2ei5HYW1lQ29uZmlnLkJveFRpcE5hbWVzW3MgLSA1XTtcbiAgICAgICAgdmFyIG4gPSBNYXRoLmZsb29yKGMubGVuZ3RoIC8gMik7XG4gICAgICAgIHZhciByID0gMDtcbiAgICAgICAgdGhpcy5yZXdhcmREYXRhID0gW107XG4gICAgICAgIGZvciAodmFyIGggPSAwOyBoIDwgbjsgaCsrKSB7XG4gICAgICAgICAgICB2YXIgcCA9IGNjLnB2ei51dGlscy5nZXRSZXdhcmRJdGVtKGNbcl0sIGNbciArIDFdKTtcbiAgICAgICAgICAgIHRoaXMucmV3YXJkRGF0YS5wdXNoKHApO1xuICAgICAgICAgICAgciArPSAyO1xuICAgICAgICB9XG4gICAgfSxcbiAgICByZWZyZXNoQ0RUaW1lOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMubGFzdFRpbWUtLTtcbiAgICAgICAgdGhpcy5ib3hDZFRpbWVzLnN0cmluZyA9IGNjLnB2ei51dGlscy5mb3JtYXRTZWNvbmRzMyh0aGlzLmxhc3RUaW1lKTtcbiAgICAgICAgaWYgKHRoaXMubGFzdFRpbWUgPD0gMCkge1xuICAgICAgICAgICAgdGhpcy5ib3hDZFBhbmVsLmFjdGl2ZSA9ICExO1xuICAgICAgICAgICAgdGhpcy5pc0NhbkFkQnV5ID0gITA7XG4gICAgICAgICAgICB0aGlzLm9uQ2hlY2tCb3hBZEJ0bkdyYXkoITEpO1xuICAgICAgICAgICAgdGhpcy51bnNjaGVkdWxlKHRoaXMucmVmcmVzaENEVGltZSwgdGhpcyk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNob3dCb3hDZFRpbWU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ib3hDZFBhbmVsLmFjdGl2ZSA9ICEwO1xuICAgICAgICB0aGlzLmlzQ2FuQWRCdXkgPSAhMTtcbiAgICAgICAgdGhpcy5vbkNoZWNrQm94QWRCdG5HcmF5KCEwKTtcbiAgICAgICAgdGhpcy5sYXN0VGltZSA9IHRoaXMuU2hvcEJveENEO1xuICAgICAgICB0aGlzLmJveENkVGltZXMuc3RyaW5nID0gY2MucHZ6LnV0aWxzLmZvcm1hdFNlY29uZHMzKHRoaXMubGFzdFRpbWUpO1xuICAgICAgICB0aGlzLnNjaGVkdWxlKHRoaXMucmVmcmVzaENEVGltZSwgMSk7XG4gICAgfSxcbiAgICBvbkNoZWNrQm94QWRCdG5HcmF5OiBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoMSA9PSB0aGlzLmJveElkKSB7XG4gICAgICAgICAgICB0aGlzLmJveEFkQnRuUGFuZWwuYWN0aXZlID0gIWU7XG4gICAgICAgICAgICB0aGlzLmJveEJ1eUJ0biAmJiAodGhpcy5ib3hCdXlCdG4uYWN0aXZlID0gZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuYm94QWRCdG5QYW5lbC5jaGlsZHJlbkNvdW50OyB0KyspIHtcbiAgICAgICAgICAgICAgICB0aGlzLmJveEFkQnRuUGFuZWwuY2hpbGRyZW5bdF1cbiAgICAgICAgICAgICAgICAgICAgLmdldENvbXBvbmVudChjYy5TcHJpdGUpXG4gICAgICAgICAgICAgICAgICAgIC5zZXRNYXRlcmlhbCgwLCBjYy5Kc29uQ29udHJvbC5tYXRlcmlhbExpc3RbZSA/IDEgOiAwXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tCb3hJbmZvOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgaWYgKGNjLlVJU2hvcC5pc0xvb2tBZCkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLlVJU2hvcC5vblN0b3BTaG9wU2Nyb2xsKCk7XG4gICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgICAgICBcInNob3Bib3hCdXlcIixcbiAgICAgICAgICAgICAgICBcIlVJU2hvcEJveEJ1eVwiLFxuICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgICAgICBzY2FsZTogITBcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHRoaXMuYm94SWQsXG4gICAgICAgICAgICAgICAgdGhpcy5zaG9wQm94SnNvbixcbiAgICAgICAgICAgICAgICB0aGlzLmlzQ2FuQWRCdXksXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZS5jYWxsQmFjaykge1xuICAgICAgICAgICAgICAgICAgICAgICAgZS5jYWxsQmFjaygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGUuc2hvd0JveENkVGltZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tBZEJveDogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IHRoaXM7XG4gICAgICAgIGlmIChjYy5VSVNob3AuaXNMb29rQWQpIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NhbkFkQnV5KSB7XG4gICAgICAgICAgICAgICAgY2MuVUlTaG9wLm9uU3RvcFNob3BTY3JvbGwoKTtcbiAgICAgICAgICAgICAgICBpZiAoMSA9PSB0aGlzLmJveElkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25BZENsb3NlKCEwKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAoY2MuVUlTaG9wLmlzTG9va0FkID0gITApLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2MucHZ6LkFkVXRpbHMuc2hvd0FkUmV3YXJkVmlkZW8oY2MucHZ6LkdhbWVDb25maWcuQWRUeXBlW1wi5ZWG5bqX5a6d566xXCJdLCBmdW5jdGlvbiAodCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGUub25BZENsb3NlKHQpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkFkQ2xvc2U6IGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGNjLlVJU2hvcC5pc0xvb2tBZCA9ICExO1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEudXBkYXRlU2hvcEJveERhdGUodGhpcy5ib3hJZCwgRGF0ZS5ub3coKSk7XG4gICAgICAgICAgICBpZiAodGhpcy5pc0NhbkFkQnV5ICYmIDIgPT0gdGhpcy5ib3hJZCkge1xuICAgICAgICAgICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLnVwZGF0ZVNob3BCb3hFeHAodGhpcy5wcmljZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnNob3dCb3hDZFRpbWUoKTtcbiAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5wb3B1cChcbiAgICAgICAgICAgICAgICBcIm1haW5VSVwiLFxuICAgICAgICAgICAgICAgIFwiU2hvcEJveEVmdFwiLFxuICAgICAgICAgICAgICAgIFwiVUlTaG9wQm94UmV3YXJkXCIsXG4gICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICBhZDogITEsXG4gICAgICAgICAgICAgICAgICAgIHNjYWxlOiAhMFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgdGhpcy5ib3hJZCxcbiAgICAgICAgICAgICAgICB0aGlzLnJld2FyZERhdGEsXG4gICAgICAgICAgICAgICAgdGhpcy5jYWxsQmFja1xuICAgICAgICAgICAgKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25DbGlja0J1eUJveDogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoIWNjLlVJU2hvcC5pc0xvb2tBZCkge1xuICAgICAgICAgICAgY2MuVUlTaG9wLm9uU3RvcFNob3BTY3JvbGwoKTtcbiAgICAgICAgICAgIGlmIChjYy5wdnouUGxheWVyRGF0YS5pc0l0ZW1Fbm91Z2goY2MucHZ6LkdhbWVDb25maWcuSXRlbVR5cGVbXCLpkrvnn7NcIl0sIHRoaXMucHJpY2UpKSB7XG4gICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEudXBkYXRlU2hvcEJveEV4cCh0aGlzLnByaWNlKTtcbiAgICAgICAgICAgICAgICBjYy5wdnouUGxheWVyRGF0YS5jaGFuZ2VJdGVtTnVtKGNjLnB2ei5HYW1lQ29uZmlnLkl0ZW1UeXBlW1wi6ZK755+zXCJdLCAtdGhpcy5wcmljZSk7XG4gICAgICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnBvcHVwKFxuICAgICAgICAgICAgICAgICAgICBcIm1haW5VSVwiLFxuICAgICAgICAgICAgICAgICAgICBcIlNob3BCb3hFZnRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJVSVNob3BCb3hSZXdhcmRcIixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICEwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYm94SWQsXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmV3YXJkRGF0YSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxsQmFja1xuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKGNjLnB2ei5QbGF5ZXJEYXRhLmlzSGF2ZUFkQnV5QmFua1RpbWVzKDEpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGUgPSBjYy5wdnoudXRpbHMuZ2V0UmV3YXJkSXRlbShjYy5wdnouR2FtZUNvbmZpZy5JdGVtVHlwZVtcIumSu+efs1wiXSwgMTAwKTtcbiAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgICAgIFwibWFpblVJXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiYWRidXlVSVwiLFxuICAgICAgICAgICAgICAgICAgICBcIlVJQWRCdXlcIixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICEwXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVcbiAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIuc2hvd1RvYXN0KFwi6ZK755+z5LiN6Laz77yBXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxufSk7XG4iXX0=