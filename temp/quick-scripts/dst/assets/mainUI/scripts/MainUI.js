
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/mainUI/scripts/MainUI.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'bf8a4Zf/1BFk5/iJ9B1k3XW', 'MainUI');
// mainUI/scripts/MainUI.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    stageLeftBtn: cc.Node,
    stageRigthBtn: cc.Node,
    levelPlayerPanel: cc.Node,
    levelMapPanel: cc.Node,
    leftRedNode: cc.Node,
    rigthRedNode: cc.Node,
    shareBtnNode: cc.Node
  },
  onLoad: function onLoad() {
    cc.MainUI = this;
  },
  start: function start() {
    this.isLookAd = !1;
    console.log("  Start Main ");
    cc.pvz.PlayerData.checkAndResetGameDate();
    cc.pvz.PlayerData.checkAndResetAdData();
    cc.pvz.PlayerData.checkAndResetShare();
    this.initMainUI();
  },
  initMainUI: function initMainUI() {
    this.stageLevel = cc.pvz.PlayerData.getStageLevel();
    this.curStageLevel = this.stageLevel;
    this.refreshLevelMapShow(this.stageLevel);
    this.refreshLevelEnemyShow(this.stageLevel);
    this.refreshLevelPlayerShow();
    this.refreshPageBtnShow();
    cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["关卡扫荡"]);
  },
  refreshLevelMapShow: function refreshLevelMapShow(e) {
    if (this.levelMap) {//
    } else {
      this.levelMap = this.levelMapPanel.getComponent("LevelMap");
    }

    this.levelMap.initLevelMap(e);
  },
  refreshLevelPlayerShow: function refreshLevelPlayerShow() {
    if (this.levelPlayer) {//
    } else {
      this.levelPlayer = this.levelPlayerPanel.getComponent("LevelPlayer");
    }

    this.levelPlayer.initHeroShow();
  },
  refreshLevelEnemyShow: function refreshLevelEnemyShow(e) {
    if (this.levelPlayer) {//
    } else {
      this.levelPlayer = this.levelPlayerPanel.getComponent("LevelPlayer");
    }

    this.levelPlayer.initEnemyShow(e);
  },
  refreshPageBtnShow: function refreshPageBtnShow() {
    if (1 == this.curStageLevel) {
      this.stageLeftBtn.active = !1;
      this.stageRigthBtn.active = !0;
      this.onCheckPageBtnRedTip(!1);
    } else {
      if (this.curStageLevel == cc.pvz.GameConfig.MaxLevel || this.curStageLevel - this.stageLevel == 2) {
        this.stageRigthBtn.active = !1, this.stageLeftBtn.active = !0, this.onCheckPageBtnRedTip(!0);
      } else {
        this.stageLeftBtn.active = !0, this.stageRigthBtn.active = !0, this.onCheckPageBtnRedTip(!0), this.onCheckPageBtnRedTip(!1);
      }
    }
  },
  onCheckPageBtnRedTip: function onCheckPageBtnRedTip(e) {
    if (e) {
      for (var t = this.curStageLevel - 1; t > 0; t--) {
        var i = this.stageLevel > t;
        var o = cc.pvz.PlayerData.getLevelBoxData(t);
        var a = cc.JsonControl.getLevelJson(t);

        for (var c = 0; c < o.length; c++) {
          var s = a["wave" + (c + 1)];

          if (0 == o[c]) {
            if (i) {
              return void (this.leftRedNode.active = !0);
            }

            if (this.levelMap.maxWave >= s && this.stageLevel == t) {
              return void (this.leftRedNode.active = !0);
            }
          }
        }
      }

      this.leftRedNode.active = !1;
    } else {
      for (var n = this.curStageLevel + 1; n <= this.stageLevel; n++) {
        var r = this.stageLevel > n;
        var h = cc.pvz.PlayerData.getLevelBoxData(n);
        var p = cc.JsonControl.getLevelJson(n);

        for (var l = 0; l < h.length; l++) {
          var d = p["wave" + (l + 1)];

          if (0 == h[l]) {
            if (r) {
              return void (this.rigthRedNode.active = !0);
            }

            if (this.levelMap.maxWave >= d && this.stageLevel == n) {
              return void (this.rigthRedNode.active = !0);
            }
          }
        }
      }

      this.rigthRedNode.active = !1;
    }
  },
  showMainUI: function showMainUI() {
    this.node.active = !0;
    cc.pvz.utils.fadeInBtn(this.node);
    this.stageLevel = cc.pvz.PlayerData.getStageLevel();
    this.curStageLevel = this.stageLevel;
    this.refreshLevelMapShow(this.stageLevel);
    this.levelPlayerPanel.active = !0;
    this.refreshLevelEnemyShow(this.stageLevel);
    this.refreshPageBtnShow();
    cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["关卡扫荡"]);
    this.setClubBtnVisible(!0);
    cc.RedControl.onCheckMissionRed();

    if (cc.UITool && cc.UITool.isChangeArray) {
      this.refreshLevelPlayerShow();
    }
  },
  onHideLvBoxPanel: function onHideLvBoxPanel() {
    if (this.levelMap) {//
    } else {
      this.levelMap = this.levelMapPanel.getComponent("LevelMap");
    }

    this.levelMap.onHideBoxRewardPanel();
  },
  hideMainUI: function hideMainUI() {
    this.onHideLvBoxPanel();
    this.node.active = !1;
    this.setClubBtnVisible(!1);
  },
  setClubBtnVisible: function setClubBtnVisible() {},
  onPopup1st: function onPopup1st() {
    this.onHideLvBoxPanel();
    this.setClubBtnVisible(!1);
  },
  onAllClosed: function onAllClosed() {
    if (this.node.active) {
      this.setClubBtnVisible(!0);
    }
  },
  onClickStagePage: function onClickStagePage(e, t) {
    if (this.isLookAd) {//
    } else {
      if (parseInt(t) < 0) {
        this.curStageLevel--;
      } else {
        this.curStageLevel++;
      }

      this.refreshLevelMapShow(this.curStageLevel);
      this.levelPlayerPanel.active = this.stageLevel >= this.curStageLevel;
      this.refreshLevelEnemyShow(this.curStageLevel);
      this.refreshPageBtnShow();
    }
  },
  onClickSet: function onClickSet() {
    if (this.isLookAd) {//
    } else {
      cc.popupManager.popup("mainUI", "set", "UISet", {
        ad: !1,
        scale: !0
      }, 0);
    }
  },
  onClickSign: function onClickSign() {
    if (this.isLookAd) {//
    } else {
      cc.popupManager.popup("mainUI", "signUI", "UISign", {
        ad: !1,
        scale: !0
      });
    }
  },
  onClickTask: function onClickTask() {
    if (this.isLookAd) {//
    } else {
      cc.popupManager.popup("mainUI", "TaskUI", "UITask", {
        ad: !1,
        scale: !1
      });
    }
  },
  onClickFund: function onClickFund() {
    if (this.isLookAd) {//
    } else {
      cc.popupManager.popup("mainUI", "FundUI", "UIFund", {
        ad: !1,
        scale: !1
      });
    }
  },
  onClickOther: function onClickOther() {
    this.onHideLvBoxPanel();
    cc.popupManager.showToast("暂未开启");
  },
  onClickShareUI: function onClickShareUI() {
    cc.popupManager.popup("mainUI", "FenxiangUI", "UIShare", {
      ad: !1,
      scale: !0
    });
  },
  onClickRankMode: function onClickRankMode() {
    cc.popupManager.popup("mainUI", "Rank", "UIRankMode", {
      ad: !1,
      scale: !1
    }, this.node);
  },
  enterGame2: function enterGame2() {
    cc.assetManager.loadBundle("game2", function (e, t) {
      if (t) {
        cc.director.loadScene("game2");
        cc.player.game2t = Date.now();
      }
    });
  },
  onClickGame2: function onClickGame2() {
    var e = cc.player.game2t || -1;

    if (Date.now() - e < 18e5) {
      cc.popupManager.popup("mainUI", "ModeTipUI", "UIAdGame2", {
        ad: !1,
        scale: !1
      }, this);
    } else {
      this.enterGame2();
    }
  },
  test: function test() {
    cc.view.emit("canvas-resize");
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluVUkvc2NyaXB0cy9NYWluVUkuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzdGFnZUxlZnRCdG4iLCJOb2RlIiwic3RhZ2VSaWd0aEJ0biIsImxldmVsUGxheWVyUGFuZWwiLCJsZXZlbE1hcFBhbmVsIiwibGVmdFJlZE5vZGUiLCJyaWd0aFJlZE5vZGUiLCJzaGFyZUJ0bk5vZGUiLCJvbkxvYWQiLCJNYWluVUkiLCJzdGFydCIsImlzTG9va0FkIiwiY29uc29sZSIsImxvZyIsInB2eiIsIlBsYXllckRhdGEiLCJjaGVja0FuZFJlc2V0R2FtZURhdGUiLCJjaGVja0FuZFJlc2V0QWREYXRhIiwiY2hlY2tBbmRSZXNldFNoYXJlIiwiaW5pdE1haW5VSSIsInN0YWdlTGV2ZWwiLCJnZXRTdGFnZUxldmVsIiwiY3VyU3RhZ2VMZXZlbCIsInJlZnJlc2hMZXZlbE1hcFNob3ciLCJyZWZyZXNoTGV2ZWxFbmVteVNob3ciLCJyZWZyZXNoTGV2ZWxQbGF5ZXJTaG93IiwicmVmcmVzaFBhZ2VCdG5TaG93IiwiVEFVdGlscyIsInRyYWNrQWRVSVNob3ciLCJHYW1lQ29uZmlnIiwiQWRUeXBlIiwiZSIsImxldmVsTWFwIiwiZ2V0Q29tcG9uZW50IiwiaW5pdExldmVsTWFwIiwibGV2ZWxQbGF5ZXIiLCJpbml0SGVyb1Nob3ciLCJpbml0RW5lbXlTaG93IiwiYWN0aXZlIiwib25DaGVja1BhZ2VCdG5SZWRUaXAiLCJNYXhMZXZlbCIsInQiLCJpIiwibyIsImdldExldmVsQm94RGF0YSIsImEiLCJKc29uQ29udHJvbCIsImdldExldmVsSnNvbiIsImMiLCJsZW5ndGgiLCJzIiwibWF4V2F2ZSIsIm4iLCJyIiwiaCIsInAiLCJsIiwiZCIsInNob3dNYWluVUkiLCJub2RlIiwidXRpbHMiLCJmYWRlSW5CdG4iLCJzZXRDbHViQnRuVmlzaWJsZSIsIlJlZENvbnRyb2wiLCJvbkNoZWNrTWlzc2lvblJlZCIsIlVJVG9vbCIsImlzQ2hhbmdlQXJyYXkiLCJvbkhpZGVMdkJveFBhbmVsIiwib25IaWRlQm94UmV3YXJkUGFuZWwiLCJoaWRlTWFpblVJIiwib25Qb3B1cDFzdCIsIm9uQWxsQ2xvc2VkIiwib25DbGlja1N0YWdlUGFnZSIsInBhcnNlSW50Iiwib25DbGlja1NldCIsInBvcHVwTWFuYWdlciIsInBvcHVwIiwiYWQiLCJzY2FsZSIsIm9uQ2xpY2tTaWduIiwib25DbGlja1Rhc2siLCJvbkNsaWNrRnVuZCIsIm9uQ2xpY2tPdGhlciIsInNob3dUb2FzdCIsIm9uQ2xpY2tTaGFyZVVJIiwib25DbGlja1JhbmtNb2RlIiwiZW50ZXJHYW1lMiIsImFzc2V0TWFuYWdlciIsImxvYWRCdW5kbGUiLCJkaXJlY3RvciIsImxvYWRTY2VuZSIsInBsYXllciIsImdhbWUydCIsIkRhdGUiLCJub3ciLCJvbkNsaWNrR2FtZTIiLCJ0ZXN0IiwidmlldyIsImVtaXQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0VBQ0wsV0FBU0QsRUFBRSxDQUFDRSxTQURQO0VBRUxDLFVBQVUsRUFBRTtJQUNSQyxZQUFZLEVBQUVKLEVBQUUsQ0FBQ0ssSUFEVDtJQUVSQyxhQUFhLEVBQUVOLEVBQUUsQ0FBQ0ssSUFGVjtJQUdSRSxnQkFBZ0IsRUFBRVAsRUFBRSxDQUFDSyxJQUhiO0lBSVJHLGFBQWEsRUFBRVIsRUFBRSxDQUFDSyxJQUpWO0lBS1JJLFdBQVcsRUFBRVQsRUFBRSxDQUFDSyxJQUxSO0lBTVJLLFlBQVksRUFBRVYsRUFBRSxDQUFDSyxJQU5UO0lBT1JNLFlBQVksRUFBRVgsRUFBRSxDQUFDSztFQVBULENBRlA7RUFXTE8sTUFBTSxFQUFFLGtCQUFZO0lBQ2hCWixFQUFFLENBQUNhLE1BQUgsR0FBWSxJQUFaO0VBQ0gsQ0FiSTtFQWNMQyxLQUFLLEVBQUUsaUJBQVk7SUFDZixLQUFLQyxRQUFMLEdBQWdCLENBQUMsQ0FBakI7SUFDQUMsT0FBTyxDQUFDQyxHQUFS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dCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgc3RhZ2VMZWZ0QnRuOiBjYy5Ob2RlLFxuICAgICAgICBzdGFnZVJpZ3RoQnRuOiBjYy5Ob2RlLFxuICAgICAgICBsZXZlbFBsYXllclBhbmVsOiBjYy5Ob2RlLFxuICAgICAgICBsZXZlbE1hcFBhbmVsOiBjYy5Ob2RlLFxuICAgICAgICBsZWZ0UmVkTm9kZTogY2MuTm9kZSxcbiAgICAgICAgcmlndGhSZWROb2RlOiBjYy5Ob2RlLFxuICAgICAgICBzaGFyZUJ0bk5vZGU6IGNjLk5vZGVcbiAgICB9LFxuICAgIG9uTG9hZDogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5NYWluVUkgPSB0aGlzO1xuICAgIH0sXG4gICAgc3RhcnQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5pc0xvb2tBZCA9ICExO1xuICAgICAgICBjb25zb2xlLmxvZyhcIiAgU3RhcnQgTWFpbiBcIik7XG4gICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLmNoZWNrQW5kUmVzZXRHYW1lRGF0ZSgpO1xuICAgICAgICBjYy5wdnouUGxheWVyRGF0YS5jaGVja0FuZFJlc2V0QWREYXRhKCk7XG4gICAgICAgIGNjLnB2ei5QbGF5ZXJEYXRhLmNoZWNrQW5kUmVzZXRTaGFyZSgpO1xuICAgICAgICB0aGlzLmluaXRNYWluVUkoKTtcbiAgICB9LFxuICAgIGluaXRNYWluVUk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zdGFnZUxldmVsID0gY2MucHZ6LlBsYXllckRhdGEuZ2V0U3RhZ2VMZXZlbCgpO1xuICAgICAgICB0aGlzLmN1clN0YWdlTGV2ZWwgPSB0aGlzLnN0YWdlTGV2ZWw7XG4gICAgICAgIHRoaXMucmVmcmVzaExldmVsTWFwU2hvdyh0aGlzLnN0YWdlTGV2ZWwpO1xuICAgICAgICB0aGlzLnJlZnJlc2hMZXZlbEVuZW15U2hvdyh0aGlzLnN0YWdlTGV2ZWwpO1xuICAgICAgICB0aGlzLnJlZnJlc2hMZXZlbFBsYXllclNob3coKTtcbiAgICAgICAgdGhpcy5yZWZyZXNoUGFnZUJ0blNob3coKTtcbiAgICAgICAgY2MucHZ6LlRBVXRpbHMudHJhY2tBZFVJU2hvdyhjYy5wdnouR2FtZUNvbmZpZy5BZFR5cGVbXCLlhbPljaHmiavojaFcIl0pO1xuICAgIH0sXG4gICAgcmVmcmVzaExldmVsTWFwU2hvdzogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKHRoaXMubGV2ZWxNYXApIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmxldmVsTWFwID0gdGhpcy5sZXZlbE1hcFBhbmVsLmdldENvbXBvbmVudChcIkxldmVsTWFwXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGV2ZWxNYXAuaW5pdExldmVsTWFwKGUpO1xuICAgIH0sXG4gICAgcmVmcmVzaExldmVsUGxheWVyU2hvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5sZXZlbFBsYXllcikge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMubGV2ZWxQbGF5ZXIgPSB0aGlzLmxldmVsUGxheWVyUGFuZWwuZ2V0Q29tcG9uZW50KFwiTGV2ZWxQbGF5ZXJcIik7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5sZXZlbFBsYXllci5pbml0SGVyb1Nob3coKTtcbiAgICB9LFxuICAgIHJlZnJlc2hMZXZlbEVuZW15U2hvdzogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKHRoaXMubGV2ZWxQbGF5ZXIpIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmxldmVsUGxheWVyID0gdGhpcy5sZXZlbFBsYXllclBhbmVsLmdldENvbXBvbmVudChcIkxldmVsUGxheWVyXCIpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubGV2ZWxQbGF5ZXIuaW5pdEVuZW15U2hvdyhlKTtcbiAgICB9LFxuICAgIHJlZnJlc2hQYWdlQnRuU2hvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoMSA9PSB0aGlzLmN1clN0YWdlTGV2ZWwpIHtcbiAgICAgICAgICAgIHRoaXMuc3RhZ2VMZWZ0QnRuLmFjdGl2ZSA9ICExO1xuICAgICAgICAgICAgdGhpcy5zdGFnZVJpZ3RoQnRuLmFjdGl2ZSA9ICEwO1xuICAgICAgICAgICAgdGhpcy5vbkNoZWNrUGFnZUJ0blJlZFRpcCghMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAodGhpcy5jdXJTdGFnZUxldmVsID09IGNjLnB2ei5HYW1lQ29uZmlnLk1heExldmVsIHx8IHRoaXMuY3VyU3RhZ2VMZXZlbCAtIHRoaXMuc3RhZ2VMZXZlbCA9PSAyKSB7XG4gICAgICAgICAgICAgICAgKHRoaXMuc3RhZ2VSaWd0aEJ0bi5hY3RpdmUgPSAhMSksICh0aGlzLnN0YWdlTGVmdEJ0bi5hY3RpdmUgPSAhMCksIHRoaXMub25DaGVja1BhZ2VCdG5SZWRUaXAoITApO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAodGhpcy5zdGFnZUxlZnRCdG4uYWN0aXZlID0gITApLFxuICAgICAgICAgICAgICAgICAgICAodGhpcy5zdGFnZVJpZ3RoQnRuLmFjdGl2ZSA9ICEwKSxcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNoZWNrUGFnZUJ0blJlZFRpcCghMCksXG4gICAgICAgICAgICAgICAgICAgIHRoaXMub25DaGVja1BhZ2VCdG5SZWRUaXAoITEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkNoZWNrUGFnZUJ0blJlZFRpcDogZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgIGZvciAodmFyIHQgPSB0aGlzLmN1clN0YWdlTGV2ZWwgLSAxOyB0ID4gMDsgdC0tKSB7XG4gICAgICAgICAgICAgICAgdmFyIGkgPSB0aGlzLnN0YWdlTGV2ZWwgPiB0O1xuICAgICAgICAgICAgICAgIHZhciBvID0gY2MucHZ6LlBsYXllckRhdGEuZ2V0TGV2ZWxCb3hEYXRhKHQpO1xuICAgICAgICAgICAgICAgIHZhciBhID0gY2MuSnNvbkNvbnRyb2wuZ2V0TGV2ZWxKc29uKHQpO1xuICAgICAgICAgICAgICAgIGZvciAodmFyIGMgPSAwOyBjIDwgby5sZW5ndGg7IGMrKykge1xuICAgICAgICAgICAgICAgICAgICB2YXIgcyA9IGFbXCJ3YXZlXCIgKyAoYyArIDEpXTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKDAgPT0gb1tjXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAodGhpcy5sZWZ0UmVkTm9kZS5hY3RpdmUgPSAhMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sZXZlbE1hcC5tYXhXYXZlID49IHMgJiYgdGhpcy5zdGFnZUxldmVsID09IHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAodGhpcy5sZWZ0UmVkTm9kZS5hY3RpdmUgPSAhMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLmxlZnRSZWROb2RlLmFjdGl2ZSA9ICExO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZm9yICh2YXIgbiA9IHRoaXMuY3VyU3RhZ2VMZXZlbCArIDE7IG4gPD0gdGhpcy5zdGFnZUxldmVsOyBuKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgciA9IHRoaXMuc3RhZ2VMZXZlbCA+IG47XG4gICAgICAgICAgICAgICAgdmFyIGggPSBjYy5wdnouUGxheWVyRGF0YS5nZXRMZXZlbEJveERhdGEobik7XG4gICAgICAgICAgICAgICAgdmFyIHAgPSBjYy5Kc29uQ29udHJvbC5nZXRMZXZlbEpzb24obik7XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbCA9IDA7IGwgPCBoLmxlbmd0aDsgbCsrKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBkID0gcFtcIndhdmVcIiArIChsICsgMSldO1xuICAgICAgICAgICAgICAgICAgICBpZiAoMCA9PSBoW2xdKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiB2b2lkICh0aGlzLnJpZ3RoUmVkTm9kZS5hY3RpdmUgPSAhMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5sZXZlbE1hcC5tYXhXYXZlID49IGQgJiYgdGhpcy5zdGFnZUxldmVsID09IG4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdm9pZCAodGhpcy5yaWd0aFJlZE5vZGUuYWN0aXZlID0gITApO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5yaWd0aFJlZE5vZGUuYWN0aXZlID0gITE7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHNob3dNYWluVUk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5ub2RlLmFjdGl2ZSA9ICEwO1xuICAgICAgICBjYy5wdnoudXRpbHMuZmFkZUluQnRuKHRoaXMubm9kZSk7XG4gICAgICAgIHRoaXMuc3RhZ2VMZXZlbCA9IGNjLnB2ei5QbGF5ZXJEYXRhLmdldFN0YWdlTGV2ZWwoKTtcbiAgICAgICAgdGhpcy5jdXJTdGFnZUxldmVsID0gdGhpcy5zdGFnZUxldmVsO1xuICAgICAgICB0aGlzLnJlZnJlc2hMZXZlbE1hcFNob3codGhpcy5zdGFnZUxldmVsKTtcbiAgICAgICAgdGhpcy5sZXZlbFBsYXllclBhbmVsLmFjdGl2ZSA9ICEwO1xuICAgICAgICB0aGlzLnJlZnJlc2hMZXZlbEVuZW15U2hvdyh0aGlzLnN0YWdlTGV2ZWwpO1xuICAgICAgICB0aGlzLnJlZnJlc2hQYWdlQnRuU2hvdygpO1xuICAgICAgICBjYy5wdnouVEFVdGlscy50cmFja0FkVUlTaG93KGNjLnB2ei5HYW1lQ29uZmlnLkFkVHlwZVtcIuWFs+WNoeaJq+iNoVwiXSk7XG4gICAgICAgIHRoaXMuc2V0Q2x1YkJ0blZpc2libGUoITApO1xuICAgICAgICBjYy5SZWRDb250cm9sLm9uQ2hlY2tNaXNzaW9uUmVkKCk7XG4gICAgICAgIGlmIChjYy5VSVRvb2wgJiYgY2MuVUlUb29sLmlzQ2hhbmdlQXJyYXkpIHtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaExldmVsUGxheWVyU2hvdygpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkhpZGVMdkJveFBhbmVsOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmxldmVsTWFwKSB7XG4gICAgICAgICAgICAvL1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5sZXZlbE1hcCA9IHRoaXMubGV2ZWxNYXBQYW5lbC5nZXRDb21wb25lbnQoXCJMZXZlbE1hcFwiKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmxldmVsTWFwLm9uSGlkZUJveFJld2FyZFBhbmVsKCk7XG4gICAgfSxcbiAgICBoaWRlTWFpblVJOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMub25IaWRlTHZCb3hQYW5lbCgpO1xuICAgICAgICB0aGlzLm5vZGUuYWN0aXZlID0gITE7XG4gICAgICAgIHRoaXMuc2V0Q2x1YkJ0blZpc2libGUoITEpO1xuICAgIH0sXG4gICAgc2V0Q2x1YkJ0blZpc2libGU6IGZ1bmN0aW9uICgpIHt9LFxuICAgIG9uUG9wdXAxc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vbkhpZGVMdkJveFBhbmVsKCk7XG4gICAgICAgIHRoaXMuc2V0Q2x1YkJ0blZpc2libGUoITEpO1xuICAgIH0sXG4gICAgb25BbGxDbG9zZWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMubm9kZS5hY3RpdmUpIHtcbiAgICAgICAgICAgIHRoaXMuc2V0Q2x1YkJ0blZpc2libGUoITApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkNsaWNrU3RhZ2VQYWdlOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICBpZiAodGhpcy5pc0xvb2tBZCkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChwYXJzZUludCh0KSA8IDApIHtcbiAgICAgICAgICAgICAgICB0aGlzLmN1clN0YWdlTGV2ZWwtLTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJTdGFnZUxldmVsKys7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aGlzLnJlZnJlc2hMZXZlbE1hcFNob3codGhpcy5jdXJTdGFnZUxldmVsKTtcbiAgICAgICAgICAgIHRoaXMubGV2ZWxQbGF5ZXJQYW5lbC5hY3RpdmUgPSB0aGlzLnN0YWdlTGV2ZWwgPj0gdGhpcy5jdXJTdGFnZUxldmVsO1xuICAgICAgICAgICAgdGhpcy5yZWZyZXNoTGV2ZWxFbmVteVNob3codGhpcy5jdXJTdGFnZUxldmVsKTtcbiAgICAgICAgICAgIHRoaXMucmVmcmVzaFBhZ2VCdG5TaG93KCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tTZXQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNMb29rQWQpIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXG4gICAgICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgICAgICBcInNldFwiLFxuICAgICAgICAgICAgICAgIFwiVUlTZXRcIixcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFkOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICEwXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAwXG4gICAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkNsaWNrU2lnbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAodGhpcy5pc0xvb2tBZCkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5wb3B1cChcIm1haW5VSVwiLCBcInNpZ25VSVwiLCBcIlVJU2lnblwiLCB7XG4gICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgIHNjYWxlOiAhMFxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tUYXNrOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICh0aGlzLmlzTG9va0FkKSB7XG4gICAgICAgICAgICAvL1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnBvcHVwKFwibWFpblVJXCIsIFwiVGFza1VJXCIsIFwiVUlUYXNrXCIsIHtcbiAgICAgICAgICAgICAgICBhZDogITEsXG4gICAgICAgICAgICAgICAgc2NhbGU6ICExXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25DbGlja0Z1bmQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuaXNMb29rQWQpIHtcbiAgICAgICAgICAgIC8vXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXCJtYWluVUlcIiwgXCJGdW5kVUlcIiwgXCJVSUZ1bmRcIiwge1xuICAgICAgICAgICAgICAgIGFkOiAhMSxcbiAgICAgICAgICAgICAgICBzY2FsZTogITFcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkNsaWNrT3RoZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5vbkhpZGVMdkJveFBhbmVsKCk7XG4gICAgICAgIGNjLnBvcHVwTWFuYWdlci5zaG93VG9hc3QoXCLmmoLmnKrlvIDlkK9cIik7XG4gICAgfSxcbiAgICBvbkNsaWNrU2hhcmVVSTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5wb3B1cE1hbmFnZXIucG9wdXAoXCJtYWluVUlcIiwgXCJGZW54aWFuZ1VJXCIsIFwiVUlTaGFyZVwiLCB7XG4gICAgICAgICAgICBhZDogITEsXG4gICAgICAgICAgICBzY2FsZTogITBcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBvbkNsaWNrUmFua01vZGU6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnBvcHVwKFxuICAgICAgICAgICAgXCJtYWluVUlcIixcbiAgICAgICAgICAgIFwiUmFua1wiLFxuICAgICAgICAgICAgXCJVSVJhbmtNb2RlXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgYWQ6ICExLFxuICAgICAgICAgICAgICAgIHNjYWxlOiAhMVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRoaXMubm9kZVxuICAgICAgICApO1xuICAgIH0sXG4gICAgZW50ZXJHYW1lMjogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5hc3NldE1hbmFnZXIubG9hZEJ1bmRsZShcImdhbWUyXCIsIGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgICAgICBpZiAodCkge1xuICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZShcImdhbWUyXCIpO1xuICAgICAgICAgICAgICAgIGNjLnBsYXllci5nYW1lMnQgPSBEYXRlLm5vdygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIG9uQ2xpY2tHYW1lMjogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgZSA9IGNjLnBsYXllci5nYW1lMnQgfHwgLTE7XG4gICAgICAgIGlmIChEYXRlLm5vdygpIC0gZSA8IDE4ZTUpIHtcbiAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5wb3B1cChcbiAgICAgICAgICAgICAgICBcIm1haW5VSVwiLFxuICAgICAgICAgICAgICAgIFwiTW9kZVRpcFVJXCIsXG4gICAgICAgICAgICAgICAgXCJVSUFkR2FtZTJcIixcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGFkOiAhMSxcbiAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICExXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB0aGlzXG4gICAgICAgICAgICApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5lbnRlckdhbWUyKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHRlc3Q6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2Mudmlldy5lbWl0KFwiY2FudmFzLXJlc2l6ZVwiKTtcbiAgICB9XG59KTtcbiJdfQ==