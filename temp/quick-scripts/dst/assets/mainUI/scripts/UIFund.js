
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/mainUI/scripts/UIFund.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, 'aadb1zjTaNPYp4j50uxmlxf', 'UIFund');
// mainUI/scripts/UIFund.js

"use strict";

var $prefabInfo = require("../../scripts/PrefabInfo");

cc.Class({
  "extends": cc.Component,
  properties: {
    rowPrefab: $prefabInfo,
    fundsJsonFile: cc.JsonAsset,
    scorll: cc.ScrollView,
    barRoot: cc.Node,
    lineRoot: cc.Node,
    coinLabel: cc.Label,
    diamondLabel: cc.Label,
    panel: cc.Node
  },
  onLoad: function onLoad() {
    this.barRoot.zIndex = cc.macro.MIN_ZINDEX;
    this.lineRoot.parent.zIndex = cc.macro.MAX_ZINDEX;
  },
  updateItemInfo: function updateItemInfo() {
    var e = cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["金币"]);
    this.coinLabel.string = cc.pvz.utils.formatItemNum(e);
    var t = cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType["钻石"]);
    this.diamondLabel.string = cc.pvz.utils.formatItemNum(t);
  },
  initBy: function initBy() {
    var e = this;
    this.panel.scale = this.node.width / 720;
    this.scorll.node.height = this.scorll.node.height / this.panel.scale;
    this.roots = [];
    var t = this.fundsJsonFile.json.length;
    this.fundsJsonFile.json.forEach(function (i, o) {
      if (cc.player.level <= i.need && o < t) {
        t = o;
      }

      var a = new cc.Node();
      a.height = e.rowPrefab.prefab.height;
      a.parent = e.rowPrefab.root;
      e.roots[o] = a;
    });
    this.fillItems(0, 7);
    this.rowPrefab.root.height = this.fundsJsonFile.json.length * this.rowPrefab.prefab.height;
    this.barRoot.y = (0.5 - t) * this.rowPrefab.prefab.height;
    this.lineRoot.y = (this.fundsJsonFile.json.length - t) * this.rowPrefab.prefab.height;
    this.updateItemInfo();
    cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType["基金"]);
  },
  fillItems: function fillItems(e, t) {
    var i = this;
    var o = Math.min(t, this.fundsJsonFile.json.length);

    var a = function a() {
      var e = i.fundsJsonFile.json[c];
      var t = cc.player.level <= e.need;
      var o = i.rowPrefab.addNodeTo(i.roots[c]);
      cc.find("name", o).getComponent(cc.Label).string = e.need + "关";
      ["item", "itemAd", "itemAd2"].forEach(function (i, a) {
        var c = e["reward" + (a + 1)];
        var s = cc.find(i, o);
        s.getComponent("RewardItem").initRewardItem({
          itemId: c[0],
          count: c[1],
          toolId: -1
        }, !1);
        var n = !t && cc.pvz.PlayerData.hasFundGet(e.ID, a);
        cc.find("lock", s).active = t;
        cc.find("open", s).active = !t && !n;
        cc.find("finish", s).active = !t && n;
        s.getComponent(cc.Button).clickEvents[0].customEventData = e.ID + "," + a;
      });
    };

    var c = e;

    for (var s = o; c < s; c++) {
      a();
    }

    this.beginIndex = e;
    this.endIndex = o;
  },
  onScrollEvent: function onScrollEvent(e) {
    var t = Math.floor(e.content.y / this.rowPrefab.prefab.height) + 7;

    if (this.endIndex < t && this.endIndex < this.fundsJsonFile.json.length) {
      this.fillItems(this.endIndex, this.endIndex + 1);
    }
  },
  onClickGetFund: function onClickGetFund(e, t) {
    var i = this;
    var o = t.split(",");
    var a = parseInt(o[0]);
    var c = parseInt(o[1]);

    if (!cc.pvz.PlayerData.hasFundGet(a, c)) {
      var s = function s() {
        cc.pvz.PlayerData.setFundGetted(a, c);
        var t = e.target.getComponent("RewardItem");
        cc.find("open", t.node).active = !1;
        cc.find("finish", t.node).active = !0;
        cc.popupManager.popup("mainUI", "getrewardUI", "UIReward", {
          ad: !0,
          scale: !1
        }, [{
          itemId: t.itemId,
          count: t.count,
          toolId: -1
        }], cc.pvz.GameConfig.UIFromType["基金"], function () {
          i.updateItemInfo();
          cc.MainControl.updateItemInfo();
        }, function (e) {
          if (e === cc.pvz.GameConfig.ItemType["钻石"]) {
            return i.diamondLabel.node.convertToWorldSpaceAR(cc.v2());
          } else {
            return i.coinLabel.node.convertToWorldSpaceAR(cc.v2());
          }
        });
      };

      if (c > 0) {
        cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType["基金"], function (e) {
          if (e) {
            s();
          }
        });
      } else {
        s();
      }
    }
  },
  onClickClose: function onClickClose() {
    cc.popupManager.removePopup(this);
    cc.RedControl.refreshAllRedTip();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluVUkvc2NyaXB0cy9VSUZ1bmQuanMiXSwibmFtZXMiOlsiJHByZWZhYkluZm8iLCJyZXF1aXJlIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJyb3dQcmVmYWIiLCJmdW5kc0pzb25GaWxlIiwiSnNvbkFzc2V0Iiwic2NvcmxsIiwiU2Nyb2xsVmlldyIsImJhclJvb3QiLCJOb2RlIiwibGluZVJvb3QiLCJjb2luTGFiZWwiLCJMYWJlbCIsImRpYW1vbmRMYWJlbCIsInBhbmVsIiwib25Mb2FkIiwiekluZGV4IiwibWFjcm8iLCJNSU5fWklOREVYIiwicGFyZW50IiwiTUFYX1pJTkRFWCIsInVwZGF0ZUl0ZW1JbmZvIiwiZSIsInB2eiIsIlBsYXllckRhdGEiLCJnZXRJdGVtTnVtIiwiR2FtZUNvbmZpZyIsIkl0ZW1UeXBlIiwic3RyaW5nIiwidXRpbHMiLCJmb3JtYXRJdGVtTnVtIiwidCIsImluaXRCeSIsInNjYWxlIiwibm9kZSIsIndpZHRoIiwiaGVpZ2h0Iiwicm9vdHMiLCJqc29uIiwibGVuZ3RoIiwiZm9yRWFjaCIsImkiLCJvIiwicGxheWVyIiwibGV2ZWwiLCJuZWVkIiwiYSIsInByZWZhYiIsInJvb3QiLCJmaWxsSXRlbXMiLCJ5IiwiVEFVdGlscyIsInRyYWNrQWRVSVNob3ciLCJBZFR5cGUiLCJNYXRoIiwibWluIiwiYyIsImFkZE5vZGVUbyIsImZpbmQiLCJnZXRDb21wb25lbnQiLCJzIiwiaW5pdFJld2FyZEl0ZW0iLCJpdGVtSWQiLCJjb3VudCIsInRvb2xJZCIsIm4iLCJoYXNGdW5kR2V0IiwiSUQiLCJhY3RpdmUiLCJCdXR0b24iLCJjbGlja0V2ZW50cyIsImN1c3RvbUV2ZW50RGF0YSIsImJlZ2luSW5kZXgiLCJlbmRJbmRleCIsIm9uU2Nyb2xsRXZlbnQiLCJmbG9vciIsImNvbnRlbnQiLCJvbkNsaWNrR2V0RnVuZCIsInNwbGl0IiwicGFyc2VJbnQiLCJzZXRGdW5kR2V0dGVkIiwidGFyZ2V0IiwicG9wdXBNYW5hZ2VyIiwicG9wdXAiLCJhZCIsIlVJRnJvbVR5cGUiLCJNYWluQ29udHJvbCIsImNvbnZlcnRUb1dvcmxkU3BhY2VBUiIsInYyIiwiQWRVdGlscyIsInNob3dBZFJld2FyZFZpZGVvIiwib25DbGlja0Nsb3NlIiwicmVtb3ZlUG9wdXAiLCJSZWRDb250cm9sIiwicmVmcmVzaEFsbFJlZFRpcCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFJQSxXQUFXLEdBQUdDLE9BQU8sQ0FBQywwQkFBRCxDQUF6Qjs7QUFDQUMsRUFBRSxDQUFDQyxLQUFILENBQVM7RUFDTCxXQUFTRCxFQUFFLENBQUNFLFNBRFA7RUFFTEMsVUFBVSxFQUFFO0lBQ1JDLFNBQVMsRUFBRU4sV0FESDtJQUVSTyxhQUFhLEVBQUVMLEVBQUUsQ0FBQ00sU0FGVjtJQUdSQyxNQUFNLEVBQUVQLEVBQUUsQ0FBQ1EsVUFISDtJQUlSQyxPQUFPLEVBQUVULEVBQUUsQ0FBQ1UsSUFKSjtJQUtSQyxRQUFRLEVBQUVYLEVBQUUsQ0FBQ1UsSUFMTDtJQU1SRSxTQUFTLEVBQUVaLEVBQUUsQ0FBQ2EsS0FOTjtJQU9SQyxZQUFZLEVBQUVkLEVBQUUsQ0FBQ2EsS0FQVDtJQVFSRSxLQUFLLEVBQUVmLEVBQUUsQ0FBQ1U7RUFSRixDQUZQO0VBWUxNLE1BQU0sRUFBRSxrQkFBWTtJQUNoQixLQUFLUCxPQUFMLENBQWFRLE1BQWIsR0FBc0JqQixFQUFFLENBQUNrQixLQUFILENBQVNDLFVBQS9CO0lBQ0EsS0FBS1IsUUFBTCxDQUFjUyxNQUFkLENBQXFCSCxNQUFyQixHQUE4QmpCLEVBQUUsQ0FBQ2tCLEtBQUgsQ0FBU0csVUFBdkM7RUFDSCxDQWZJO0VBZ0JMQyxjQUFjLEVBQUUsMEJBQVk7SUFDeEIsSUFBSUMsQ0FBQyxHQUFHdkIsRUFBRSxDQUFDd0IsR0FBSCxDQUFPQyxVQUFQLENBQWtCQyxVQUFsQixDQUE2QjFCLEVBQUUsQ0FBQ3dCLEdBQUgsQ0FBT0csVUFBUCxDQUFrQkMsUUFBbEIsQ0FBMkIs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QUpEO01BS0gsQ0FORCxNQU1PO1FBQ0hBLENBQUM7TUFDSjtJQUNKO0VBQ0osQ0FySUk7RUFzSUwrQixZQUFZLEVBQUUsd0JBQVk7SUFDdEI1RixFQUFFLENBQUNtRixZQUFILENBQWdCVSxXQUFoQixDQUE0QixJQUE1QjtJQUNBN0YsRUFBRSxDQUFDOEYsVUFBSCxDQUFjQyxnQkFBZDtFQUNIO0FBeklJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbInZhciAkcHJlZmFiSW5mbyA9IHJlcXVpcmUoXCIuLi8uLi9zY3JpcHRzL1ByZWZhYkluZm9cIik7XG5jYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgcm93UHJlZmFiOiAkcHJlZmFiSW5mbyxcbiAgICAgICAgZnVuZHNKc29uRmlsZTogY2MuSnNvbkFzc2V0LFxuICAgICAgICBzY29ybGw6IGNjLlNjcm9sbFZpZXcsXG4gICAgICAgIGJhclJvb3Q6IGNjLk5vZGUsXG4gICAgICAgIGxpbmVSb290OiBjYy5Ob2RlLFxuICAgICAgICBjb2luTGFiZWw6IGNjLkxhYmVsLFxuICAgICAgICBkaWFtb25kTGFiZWw6IGNjLkxhYmVsLFxuICAgICAgICBwYW5lbDogY2MuTm9kZVxuICAgIH0sXG4gICAgb25Mb2FkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuYmFyUm9vdC56SW5kZXggPSBjYy5tYWNyby5NSU5fWklOREVYO1xuICAgICAgICB0aGlzLmxpbmVSb290LnBhcmVudC56SW5kZXggPSBjYy5tYWNyby5NQVhfWklOREVYO1xuICAgIH0sXG4gICAgdXBkYXRlSXRlbUluZm86IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIGUgPSBjYy5wdnouUGxheWVyRGF0YS5nZXRJdGVtTnVtKGNjLnB2ei5HYW1lQ29uZmlnLkl0ZW1UeXBlW1wi6YeR5biBXCJdKTtcbiAgICAgICAgdGhpcy5jb2luTGFiZWwuc3RyaW5nID0gY2MucHZ6LnV0aWxzLmZvcm1hdEl0ZW1OdW0oZSk7XG4gICAgICAgIHZhciB0ID0gY2MucHZ6LlBsYXllckRhdGEuZ2V0SXRlbU51bShjYy5wdnouR2FtZUNvbmZpZy5JdGVtVHlwZVtcIumSu+efs1wiXSk7XG4gICAgICAgIHRoaXMuZGlhbW9uZExhYmVsLnN0cmluZyA9IGNjLnB2ei51dGlscy5mb3JtYXRJdGVtTnVtKHQpO1xuICAgIH0sXG4gICAgaW5pdEJ5OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgdGhpcy5wYW5lbC5zY2FsZSA9IHRoaXMubm9kZS53aWR0aCAvIDcyMDtcbiAgICAgICAgdGhpcy5zY29ybGwubm9kZS5oZWlnaHQgPSB0aGlzLnNjb3JsbC5ub2RlLmhlaWdodCAvIHRoaXMucGFuZWwuc2NhbGU7XG4gICAgICAgIHRoaXMucm9vdHMgPSBbXTtcbiAgICAgICAgdmFyIHQgPSB0aGlzLmZ1bmRzSnNvbkZpbGUuanNvbi5sZW5ndGg7XG4gICAgICAgIHRoaXMuZnVuZHNKc29uRmlsZS5qc29uLmZvckVhY2goZnVuY3Rpb24gKGksIG8pIHtcbiAgICAgICAgICAgIGlmIChjYy5wbGF5ZXIubGV2ZWwgPD0gaS5uZWVkICYmIG8gPCB0KSB7XG4gICAgICAgICAgICAgICAgdCA9IG87XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgYSA9IG5ldyBjYy5Ob2RlKCk7XG4gICAgICAgICAgICBhLmhlaWdodCA9IGUucm93UHJlZmFiLnByZWZhYi5oZWlnaHQ7XG4gICAgICAgICAgICBhLnBhcmVudCA9IGUucm93UHJlZmFiLnJvb3Q7XG4gICAgICAgICAgICBlLnJvb3RzW29dID0gYTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZmlsbEl0ZW1zKDAsIDcpO1xuICAgICAgICB0aGlzLnJvd1ByZWZhYi5yb290LmhlaWdodCA9IHRoaXMuZnVuZHNKc29uRmlsZS5qc29uLmxlbmd0aCAqIHRoaXMucm93UHJlZmFiLnByZWZhYi5oZWlnaHQ7XG4gICAgICAgIHRoaXMuYmFyUm9vdC55ID0gKDAuNSAtIHQpICogdGhpcy5yb3dQcmVmYWIucHJlZmFiLmhlaWdodDtcbiAgICAgICAgdGhpcy5saW5lUm9vdC55ID0gKHRoaXMuZnVuZHNKc29uRmlsZS5qc29uLmxlbmd0aCAtIHQpICogdGhpcy5yb3dQcmVmYWIucHJlZmFiLmhlaWdodDtcbiAgICAgICAgdGhpcy51cGRhdGVJdGVtSW5mbygpO1xuICAgICAgICBjYy5wdnouVEFVdGlscy50cmFja0FkVUlTaG93KGNjLnB2ei5HYW1lQ29uZmlnLkFkVHlwZVtcIuWfuumHkVwiXSk7XG4gICAgfSxcbiAgICBmaWxsSXRlbXM6IGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgIHZhciBpID0gdGhpcztcbiAgICAgICAgdmFyIG8gPSBNYXRoLm1pbih0LCB0aGlzLmZ1bmRzSnNvbkZpbGUuanNvbi5sZW5ndGgpO1xuICAgICAgICB2YXIgYSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBlID0gaS5mdW5kc0pzb25GaWxlLmpzb25bY107XG4gICAgICAgICAgICB2YXIgdCA9IGNjLnBsYXllci5sZXZlbCA8PSBlLm5lZWQ7XG4gICAgICAgICAgICB2YXIgbyA9IGkucm93UHJlZmFiLmFkZE5vZGVUbyhpLnJvb3RzW2NdKTtcbiAgICAgICAgICAgIGNjLmZpbmQoXCJuYW1lXCIsIG8pLmdldENvbXBvbmVudChjYy5MYWJlbCkuc3RyaW5nID0gZS5uZWVkICsgXCLlhbNcIjtcbiAgICAgICAgICAgIFtcIml0ZW1cIiwgXCJpdGVtQWRcIiwgXCJpdGVtQWQyXCJdLmZvckVhY2goZnVuY3Rpb24gKGksIGEpIHtcbiAgICAgICAgICAgICAgICB2YXIgYyA9IGVbXCJyZXdhcmRcIiArIChhICsgMSldO1xuICAgICAgICAgICAgICAgIHZhciBzID0gY2MuZmluZChpLCBvKTtcbiAgICAgICAgICAgICAgICBzLmdldENvbXBvbmVudChcIlJld2FyZEl0ZW1cIikuaW5pdFJld2FyZEl0ZW0oXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1JZDogY1swXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiBjWzFdLFxuICAgICAgICAgICAgICAgICAgICAgICAgdG9vbElkOiAtMVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAhMVxuICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgdmFyIG4gPSAhdCAmJiBjYy5wdnouUGxheWVyRGF0YS5oYXNGdW5kR2V0KGUuSUQsIGEpO1xuICAgICAgICAgICAgICAgIGNjLmZpbmQoXCJsb2NrXCIsIHMpLmFjdGl2ZSA9IHQ7XG4gICAgICAgICAgICAgICAgY2MuZmluZChcIm9wZW5cIiwgcykuYWN0aXZlID0gIXQgJiYgIW47XG4gICAgICAgICAgICAgICAgY2MuZmluZChcImZpbmlzaFwiLCBzKS5hY3RpdmUgPSAhdCAmJiBuO1xuICAgICAgICAgICAgICAgIHMuZ2V0Q29tcG9uZW50KGNjLkJ1dHRvbikuY2xpY2tFdmVudHNbMF0uY3VzdG9tRXZlbnREYXRhID0gZS5JRCArIFwiLFwiICsgYTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB2YXIgYyA9IGU7XG4gICAgICAgIGZvciAodmFyIHMgPSBvOyBjIDwgczsgYysrKSB7XG4gICAgICAgICAgICBhKCk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5iZWdpbkluZGV4ID0gZTtcbiAgICAgICAgdGhpcy5lbmRJbmRleCA9IG87XG4gICAgfSxcbiAgICBvblNjcm9sbEV2ZW50OiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB2YXIgdCA9IE1hdGguZmxvb3IoZS5jb250ZW50LnkgLyB0aGlzLnJvd1ByZWZhYi5wcmVmYWIuaGVpZ2h0KSArIDc7XG4gICAgICAgIGlmICh0aGlzLmVuZEluZGV4IDwgdCAmJiB0aGlzLmVuZEluZGV4IDwgdGhpcy5mdW5kc0pzb25GaWxlLmpzb24ubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLmZpbGxJdGVtcyh0aGlzLmVuZEluZGV4LCB0aGlzLmVuZEluZGV4ICsgMSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xpY2tHZXRGdW5kOiBmdW5jdGlvbiAoZSwgdCkge1xuICAgICAgICB2YXIgaSA9IHRoaXM7XG4gICAgICAgIHZhciBvID0gdC5zcGxpdChcIixcIik7XG4gICAgICAgIHZhciBhID0gcGFyc2VJbnQob1swXSk7XG4gICAgICAgIHZhciBjID0gcGFyc2VJbnQob1sxXSk7XG4gICAgICAgIGlmICghY2MucHZ6LlBsYXllckRhdGEuaGFzRnVuZEdldChhLCBjKSkge1xuICAgICAgICAgICAgdmFyIHMgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgY2MucHZ6LlBsYXllckRhdGEuc2V0RnVuZEdldHRlZChhLCBjKTtcbiAgICAgICAgICAgICAgICB2YXIgdCA9IGUudGFyZ2V0LmdldENvbXBvbmVudChcIlJld2FyZEl0ZW1cIik7XG4gICAgICAgICAgICAgICAgY2MuZmluZChcIm9wZW5cIiwgdC5ub2RlKS5hY3RpdmUgPSAhMTtcbiAgICAgICAgICAgICAgICBjYy5maW5kKFwiZmluaXNoXCIsIHQubm9kZSkuYWN0aXZlID0gITA7XG4gICAgICAgICAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnBvcHVwKFxuICAgICAgICAgICAgICAgICAgICBcIm1haW5VSVwiLFxuICAgICAgICAgICAgICAgICAgICBcImdldHJld2FyZFVJXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiVUlSZXdhcmRcIixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgYWQ6ICEwLFxuICAgICAgICAgICAgICAgICAgICAgICAgc2NhbGU6ICExXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIFtcbiAgICAgICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtSWQ6IHQuaXRlbUlkLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdW50OiB0LmNvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvb2xJZDogLTFcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgY2MucHZ6LkdhbWVDb25maWcuVUlGcm9tVHlwZVtcIuWfuumHkVwiXSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaS51cGRhdGVJdGVtSW5mbygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2MuTWFpbkNvbnRyb2wudXBkYXRlSXRlbUluZm8oKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChlID09PSBjYy5wdnouR2FtZUNvbmZpZy5JdGVtVHlwZVtcIumSu+efs1wiXSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpLmRpYW1vbmRMYWJlbC5ub2RlLmNvbnZlcnRUb1dvcmxkU3BhY2VBUihjYy52MigpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGkuY29pbkxhYmVsLm5vZGUuY29udmVydFRvV29ybGRTcGFjZUFSKGNjLnYyKCkpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBpZiAoYyA+IDApIHtcbiAgICAgICAgICAgICAgICBjYy5wdnouQWRVdGlscy5zaG93QWRSZXdhcmRWaWRlbyhjYy5wdnouR2FtZUNvbmZpZy5BZFR5cGVbXCLln7rph5FcIl0sIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgcygpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkNsaWNrQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2MucG9wdXBNYW5hZ2VyLnJlbW92ZVBvcHVwKHRoaXMpO1xuICAgICAgICBjYy5SZWRDb250cm9sLnJlZnJlc2hBbGxSZWRUaXAoKTtcbiAgICB9XG59KTtcbiJdfQ==