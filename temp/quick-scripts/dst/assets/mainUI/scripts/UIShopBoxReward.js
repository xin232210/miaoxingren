
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/mainUI/scripts/UIShopBoxReward.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '64e05oAh8RHAZyr36OZ372A', 'UIShopBoxReward');
// mainUI/scripts/UIShopBoxReward.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {
    boxSpine: sp.Skeleton,
    closeBtn: cc.Node,
    uiTip: cc.Node,
    baseItemNode: cc.Node,
    parentOnePanel: cc.Node,
    parentMorePanel: cc.Node
  },
  onLoad: function onLoad() {
    this.baseItemNode.active = !1;
    this.uiTip.active = !1;
    this.closeBtn.active = !1;
  },
  initBy: function initBy(e, t, i) {
    var o = this;

    if (void 0 === i) {
      i = null;
    }

    var a = e;
    this.callBack = i;
    this.onCheckRewardData(t);
    this.boxSpine.setEventListener(function (e, t) {
      if ("kapai" == t.data.name) {
        o.onShowBoxReward();
      }
    });
    this.boxSpine.node.active = !0;
    this.boxSpine.setAnimation(0, "BX" + a + "_1", !1);
    this.boxSpine.setCompleteListener(function () {
      o.boxSpine.setAnimation(0, "BX" + a + "_2", !0);
      o.boxSpine.setCompleteListener(null);
    });
    cc.butler.playEffect(cc.MainControl.rewardSound);

    if (2 == a) {
      cc.pvz.PlayerData.addMissionProgress(cc.pvz.GameConfig.MissionType["高级宝箱抽取装备n次"], 1);
    }
  },
  onShowBoxReward: function onShowBoxReward() {
    var e = this;
    this.uiTip.active = !0;
    var t = this.rewardData.length;
    var i;

    if (t <= 5) {
      i = this.parentOnePanel;
    } else {
      i = this.parentMorePanel;
    }

    this.baseItemNode.active = !0;
    this.baseItemNode.parent = i;

    if (t > 5) {
      cc.pvz.utils.fadeInBtn(this.baseItemNode);
    }

    this.baseItemNode.position = cc.v2(0, 0);
    this.baseItemNode.getComponent("RewardItem").initRewardItem(this.rewardData[0], !0);

    if (t <= 5) {
      for (var o = 1; o < t; o++) {
        var a = cc.instantiate(this.baseItemNode);
        a.parent = i;
        a.getComponent("RewardItem").initRewardItem(this.rewardData[o], !0);

        if (o == t - 1) {
          this.closeBtn.active = !0;
        }
      }
    } else {
      var c = function c(o) {
        setTimeout(function () {
          var a = cc.instantiate(e.baseItemNode);
          a.parent = i;
          cc.pvz.utils.fadeInBtn(a);
          a.getComponent("RewardItem").initRewardItem(e.rewardData[o], !0);

          if (o == t - 1) {
            e.closeBtn.active = !0;
          }
        }, 40 * (o - 1) + 120);
      };

      for (var s = 1; s < t; s++) {
        c(s);
      }
    }
  },
  onCheckRewardData: function onCheckRewardData(e) {
    this.rewardData = [];
    this.effectItemList = [];

    for (var t = 0; t < e.length; t++) {
      var i = e[t];

      if (i.itemId >= 5 && i.itemId <= 7) {
        cc.pvz.utils.onCheckRandomTool(i, this.rewardData);
      } else {
        this.rewardData.push(i);
        i.itemId >= 2 && i.itemId <= 4 && this.effectItemList.push(i.itemId);
      }
    }
  },
  onCloseUI: function onCloseUI() {
    cc.popupManager.removePopup(this);

    if (this.effectItemList.length > 0) {
      var e = -1;

      for (var t = 0; t < this.effectItemList.length; t++) {
        var i = this.effectItemList[t];

        for (var o = cc.math.randomRangeInt(1, 4); -1 != e && e == o;) {
          o = cc.math.randomRangeInt(1, 4);
        }

        e = o;
        cc.popupManager.showEffectFly(i, cc.MainControl.getItemEffectPos(i), o);
      }
    }

    if (this.callBack) {
      this.callBack();
    }

    cc.MainControl.updateItemInfo();
    cc.RedControl.refreshAllRedTip();
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9tYWluVUkvc2NyaXB0cy9VSVNob3BCb3hSZXdhcmQuanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJib3hTcGluZSIsInNwIiwiU2tlbGV0b24iLCJjbG9zZUJ0biIsIk5vZGUiLCJ1aVRpcCIsImJhc2VJdGVtTm9kZSIsInBhcmVudE9uZVBhbmVsIiwicGFyZW50TW9yZVBhbmVsIiwib25Mb2FkIiwiYWN0aXZlIiwiaW5pdEJ5IiwiZSIsInQiLCJpIiwibyIsImEiLCJjYWxsQmFjayIsIm9uQ2hlY2tSZXdhcmREYXRhIiwic2V0RXZlbnRMaXN0ZW5lciIsImRhdGEiLCJuYW1lIiwib25TaG93Qm94UmV3YXJkIiwibm9kZSIsInNldEFuaW1hdGlvbiIsInNldENvbXBsZXRlTGlzdGVuZXIiLCJidXRsZXIiLCJwbGF5RWZmZWN0IiwiTWFpbkNvbnRyb2wiLCJyZXdhcmRTb3VuZCIsInB2eiIsIlBsYXllckRhdGEiLCJhZGRNaXNzaW9uUHJvZ3Jlc3MiLCJHYW1lQ29uZmlnIiwiTWlzc2lvblR5cGUiLCJyZXdhcmREYXRhIiwibGVuZ3RoIiwicGFyZW50IiwidXRpbHMiLCJmYWRlSW5CdG4iLCJwb3NpdGlvbiIsInYyIiwiZ2V0Q29tcG9uZW50IiwiaW5pdFJld2FyZEl0ZW0iLCJpbnN0YW50aWF0ZSIsImMiLCJzZXRUaW1lb3V0IiwicyIsImVmZmVjdEl0ZW1MaXN0IiwiaXRlbUlkIiwib25DaGVja1JhbmRvbVRvb2wiLCJwdXNoIiwib25DbG9zZVVJIiwicG9wdXBNYW5hZ2VyIiwicmVtb3ZlUG9wdXAiLCJtYXRoIiwicmFuZG9tUmFuZ2VJbnQiLCJzaG93RWZmZWN0Rmx5IiwiZ2V0SXRlbUVmZmVjdFBvcyIsInVwZGF0ZUl0ZW1JbmZvIiwiUmVkQ29udHJvbCIsInJlZnJlc2hBbGxSZWRUaXAiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFT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QkFBZDtFQUNIO0FBakhJLENBQVQiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLkNsYXNzKHtcbiAgICBleHRlbmRzOiBjYy5Db21wb25lbnQsXG4gICAgcHJvcGVydGllczoge1xuICAgICAgICBib3hTcGluZTogc3AuU2tlbGV0b24sXG4gICAgICAgIGNsb3NlQnRuOiBjYy5Ob2RlLFxuICAgICAgICB1aVRpcDogY2MuTm9kZSxcbiAgICAgICAgYmFzZUl0ZW1Ob2RlOiBjYy5Ob2RlLFxuICAgICAgICBwYXJlbnRPbmVQYW5lbDogY2MuTm9kZSxcbiAgICAgICAgcGFyZW50TW9yZVBhbmVsOiBjYy5Ob2RlXG4gICAgfSxcbiAgICBvbkxvYWQ6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5iYXNlSXRlbU5vZGUuYWN0aXZlID0gITE7XG4gICAgICAgIHRoaXMudWlUaXAuYWN0aXZlID0gITE7XG4gICAgICAgIHRoaXMuY2xvc2VCdG4uYWN0aXZlID0gITE7XG4gICAgfSxcbiAgICBpbml0Qnk6IGZ1bmN0aW9uIChlLCB0LCBpKSB7XG4gICAgICAgIHZhciBvID0gdGhpcztcbiAgICAgICAgaWYgKHZvaWQgMCA9PT0gaSkge1xuICAgICAgICAgICAgaSA9IG51bGw7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGEgPSBlO1xuICAgICAgICB0aGlzLmNhbGxCYWNrID0gaTtcbiAgICAgICAgdGhpcy5vbkNoZWNrUmV3YXJkRGF0YSh0KTtcbiAgICAgICAgdGhpcy5ib3hTcGluZS5zZXRFdmVudExpc3RlbmVyKGZ1bmN0aW9uIChlLCB0KSB7XG4gICAgICAgICAgICBpZiAoXCJrYXBhaVwiID09IHQuZGF0YS5uYW1lKSB7XG4gICAgICAgICAgICAgICAgby5vblNob3dCb3hSZXdhcmQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuYm94U3BpbmUubm9kZS5hY3RpdmUgPSAhMDtcbiAgICAgICAgdGhpcy5ib3hTcGluZS5zZXRBbmltYXRpb24oMCwgXCJCWFwiICsgYSArIFwiXzFcIiwgITEpO1xuICAgICAgICB0aGlzLmJveFNwaW5lLnNldENvbXBsZXRlTGlzdGVuZXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgby5ib3hTcGluZS5zZXRBbmltYXRpb24oMCwgXCJCWFwiICsgYSArIFwiXzJcIiwgITApO1xuICAgICAgICAgICAgby5ib3hTcGluZS5zZXRDb21wbGV0ZUxpc3RlbmVyKG51bGwpO1xuICAgICAgICB9KTtcbiAgICAgICAgY2MuYnV0bGVyLnBsYXlFZmZlY3QoY2MuTWFpbkNvbnRyb2wucmV3YXJkU291bmQpO1xuICAgICAgICBpZiAoMiA9PSBhKSB7XG4gICAgICAgICAgICBjYy5wdnouUGxheWVyRGF0YS5hZGRNaXNzaW9uUHJvZ3Jlc3MoY2MucHZ6LkdhbWVDb25maWcuTWlzc2lvblR5cGVbXCLpq5jnuqflrp3nrrHmir3lj5boo4XlpIdu5qyhXCJdLCAxKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25TaG93Qm94UmV3YXJkOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBlID0gdGhpcztcbiAgICAgICAgdGhpcy51aVRpcC5hY3RpdmUgPSAhMDtcbiAgICAgICAgdmFyIHQgPSB0aGlzLnJld2FyZERhdGEubGVuZ3RoO1xuICAgICAgICB2YXIgaTtcbiAgICAgICAgaWYgKHQgPD0gNSkge1xuICAgICAgICAgICAgaSA9IHRoaXMucGFyZW50T25lUGFuZWw7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpID0gdGhpcy5wYXJlbnRNb3JlUGFuZWw7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5iYXNlSXRlbU5vZGUuYWN0aXZlID0gITA7XG4gICAgICAgIHRoaXMuYmFzZUl0ZW1Ob2RlLnBhcmVudCA9IGk7XG4gICAgICAgIGlmICh0ID4gNSkge1xuICAgICAgICAgICAgY2MucHZ6LnV0aWxzLmZhZGVJbkJ0bih0aGlzLmJhc2VJdGVtTm9kZSk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5iYXNlSXRlbU5vZGUucG9zaXRpb24gPSBjYy52MigwLCAwKTtcbiAgICAgICAgdGhpcy5iYXNlSXRlbU5vZGUuZ2V0Q29tcG9uZW50KFwiUmV3YXJkSXRlbVwiKS5pbml0UmV3YXJkSXRlbSh0aGlzLnJld2FyZERhdGFbMF0sICEwKTtcbiAgICAgICAgaWYgKHQgPD0gNSkge1xuICAgICAgICAgICAgZm9yICh2YXIgbyA9IDE7IG8gPCB0OyBvKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgYSA9IGNjLmluc3RhbnRpYXRlKHRoaXMuYmFzZUl0ZW1Ob2RlKTtcbiAgICAgICAgICAgICAgICBhLnBhcmVudCA9IGk7XG4gICAgICAgICAgICAgICAgYS5nZXRDb21wb25lbnQoXCJSZXdhcmRJdGVtXCIpLmluaXRSZXdhcmRJdGVtKHRoaXMucmV3YXJkRGF0YVtvXSwgITApO1xuICAgICAgICAgICAgICAgIGlmIChvID09IHQgLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuY2xvc2VCdG4uYWN0aXZlID0gITA7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIGMgPSBmdW5jdGlvbiAobykge1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYSA9IGNjLmluc3RhbnRpYXRlKGUuYmFzZUl0ZW1Ob2RlKTtcbiAgICAgICAgICAgICAgICAgICAgYS5wYXJlbnQgPSBpO1xuICAgICAgICAgICAgICAgICAgICBjYy5wdnoudXRpbHMuZmFkZUluQnRuKGEpO1xuICAgICAgICAgICAgICAgICAgICBhLmdldENvbXBvbmVudChcIlJld2FyZEl0ZW1cIikuaW5pdFJld2FyZEl0ZW0oZS5yZXdhcmREYXRhW29dLCAhMCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChvID09IHQgLSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBlLmNsb3NlQnRuLmFjdGl2ZSA9ICEwO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSwgNDAgKiAobyAtIDEpICsgMTIwKTtcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBmb3IgKHZhciBzID0gMTsgcyA8IHQ7IHMrKykge1xuICAgICAgICAgICAgICAgIGMocyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2hlY2tSZXdhcmREYXRhOiBmdW5jdGlvbiAoZSkge1xuICAgICAgICB0aGlzLnJld2FyZERhdGEgPSBbXTtcbiAgICAgICAgdGhpcy5lZmZlY3RJdGVtTGlzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IGUubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgIHZhciBpID0gZVt0XTtcbiAgICAgICAgICAgIGlmIChpLml0ZW1JZCA+PSA1ICYmIGkuaXRlbUlkIDw9IDcpIHtcbiAgICAgICAgICAgICAgICBjYy5wdnoudXRpbHMub25DaGVja1JhbmRvbVRvb2woaSwgdGhpcy5yZXdhcmREYXRhKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZXdhcmREYXRhLnB1c2goaSk7XG4gICAgICAgICAgICAgICAgaS5pdGVtSWQgPj0gMiAmJiBpLml0ZW1JZCA8PSA0ICYmIHRoaXMuZWZmZWN0SXRlbUxpc3QucHVzaChpLml0ZW1JZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIG9uQ2xvc2VVSTogZnVuY3Rpb24gKCkge1xuICAgICAgICBjYy5wb3B1cE1hbmFnZXIucmVtb3ZlUG9wdXAodGhpcyk7XG4gICAgICAgIGlmICh0aGlzLmVmZmVjdEl0ZW1MaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhciBlID0gLTE7XG4gICAgICAgICAgICBmb3IgKHZhciB0ID0gMDsgdCA8IHRoaXMuZWZmZWN0SXRlbUxpc3QubGVuZ3RoOyB0KyspIHtcbiAgICAgICAgICAgICAgICB2YXIgaSA9IHRoaXMuZWZmZWN0SXRlbUxpc3RbdF07XG4gICAgICAgICAgICAgICAgZm9yICh2YXIgbyA9IGNjLm1hdGgucmFuZG9tUmFuZ2VJbnQoMSwgNCk7IC0xICE9IGUgJiYgZSA9PSBvOyApIHtcbiAgICAgICAgICAgICAgICAgICAgbyA9IGNjLm1hdGgucmFuZG9tUmFuZ2VJbnQoMSwgNCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGUgPSBvO1xuICAgICAgICAgICAgICAgIGNjLnBvcHVwTWFuYWdlci5zaG93RWZmZWN0Rmx5KGksIGNjLk1haW5Db250cm9sLmdldEl0ZW1FZmZlY3RQb3MoaSksIG8pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmNhbGxCYWNrKSB7XG4gICAgICAgICAgICB0aGlzLmNhbGxCYWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgY2MuTWFpbkNvbnRyb2wudXBkYXRlSXRlbUluZm8oKTtcbiAgICAgICAgY2MuUmVkQ29udHJvbC5yZWZyZXNoQWxsUmVkVGlwKCk7XG4gICAgfVxufSk7XG4iXX0=