{"version":3,"sources":["assets/game/scripts/GameHub.js"],"names":["$prefabInfo","require","cc","Class","Component","properties","bagRoot","Node","gameRoot","ani","Animation","actBuffPanel","moneyLabel","Label","waveLabel","lvLabel","expBar","ProgressBar","lvupEffect","lvupAudio","AudioClip","levelsJsonFile","JsonAsset","lvupJsonFile","onLoad","active","bag","getComponent","game","enabled","hub","start","pvz","runtimeData","mode","initActBuffInfo","t","json","level","JsonControl","ActLevelJson","rankLevelJsonFile","levelData","updateLevel","updateExp","updateMoney","butler","node","on","onGetMoney","onPopup1st","onAllClosed","string","wave","money","lv","exp","progress","showLvupEffect","addNodeByWorldPos","playEffect","onClickStart","checkStartGame","play","wrapMode","WrapMode","Normal","once","cbs","startLogic","backToBag","onBackFromGame","Reverse","autoTimes","doRefreshLogic","saveRuntimeData","onClickPause","popupManager","popup","scale"],"mappings":"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","sourceRoot":"/","sourcesContent":["var $prefabInfo = require(\"../../scripts/PrefabInfo\");\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        bagRoot: cc.Node,\n        gameRoot: cc.Node,\n        ani: cc.Animation,\n        actBuffPanel: cc.Node,\n        moneyLabel: cc.Label,\n        waveLabel: cc.Label,\n        lvLabel: cc.Label,\n        expBar: cc.ProgressBar,\n        lvupEffect: $prefabInfo,\n        lvupAudio: cc.AudioClip,\n        levelsJsonFile: cc.JsonAsset,\n        lvupJsonFile: cc.JsonAsset\n    },\n    onLoad: function () {\n        this.bagRoot.active = !0;\n        this.bag = this.bagRoot.getComponent(\"game1\");\n        this.gameRoot.active = !1;\n        this.game = this.gameRoot.getComponent(\"game\");\n        this.game.enabled = !1;\n        this.bag.hub = this;\n        this.bag.game = this.game;\n        this.game.hub = this;\n        this.game.bag = this.bag;\n    },\n    start: function () {\n        this.actBuffPanel.active = 1 == cc.pvz.runtimeData.mode;\n        if (this.actBuffPanel.active) {\n            this.actBuffPanel.getComponent(\"ActBuffPanel\").initActBuffInfo();\n        }\n        var t = null;\n        switch (cc.pvz.runtimeData.mode) {\n            case 0:\n                t = this.levelsJsonFile.json[cc.pvz.runtimeData.level - 1];\n                break;\n            case 1:\n                t = cc.JsonControl.ActLevelJson[cc.pvz.runtimeData.level - 1];\n                break;\n            case 2:\n                t = cc.JsonControl.rankLevelJsonFile.json[0];\n        }\n        this.levelData = t;\n        this.updateLevel();\n        this.updateExp();\n        this.updateMoney();\n        cc.butler.node.on(\"money\", this.onGetMoney, this);\n    },\n    onPopup1st: function () {\n        if (this.bag.onPopup1st) {\n            this.bag.onPopup1st();\n        }\n        if (this.game.onPopup1st) {\n            this.game.onPopup1st();\n        }\n    },\n    onAllClosed: function () {\n        if (this.bag.onAllClosed) {\n            this.bag.onAllClosed();\n        }\n        if (this.game.onAllClosed) {\n            this.game.onAllClosed();\n        }\n    },\n    onGetMoney: function () {\n        this.updateMoney();\n    },\n    updateLevel: function () {\n        if (2 == cc.pvz.runtimeData.mode) {\n            this.waveLabel.string = \"第\" + (cc.pvz.runtimeData.wave + 1) + \"波\";\n        } else {\n            this.waveLabel.node.active = this.levelData.wave > 0;\n            this.waveLabel.node.active &&\n                (this.waveLabel.string = \"第\" + (cc.pvz.runtimeData.wave + 1) + \"/\" + this.levelData.wave + \"波\");\n        }\n    },\n    updateMoney: function () {\n        this.moneyLabel.string = cc.pvz.runtimeData.money;\n    },\n    updateExp: function () {\n        var t = this.lvupJsonFile.json[cc.pvz.runtimeData.lv].exp;\n        this.lvLabel.string = cc.pvz.runtimeData.lv + 1;\n        this.expBar.progress = cc.pvz.runtimeData.exp / t;\n    },\n    showLvupEffect: function (t) {\n        this.lvupEffect.addNodeByWorldPos(t);\n        cc.butler.playEffect(this.lvupAudio);\n    },\n    onClickStart: function () {\n        var t = this;\n        if (this.bag.checkStartGame(this.onClickStart)) {\n            this.ani.play(\"bag-to-game\").wrapMode = cc.WrapMode.Normal;\n            this.ani.once(\"finished\", function () {\n                t.game.cbs = [];\n                t.bag.onClickStart(t.game);\n                t.game.startLogic(t.bag);\n            });\n        }\n    },\n    backToBag: function () {\n        var t = this;\n        this.game.onBackFromGame();\n        this.bag.onBackFromGame();\n        this.updateLevel();\n        this.ani.play(\"bag-to-game\").wrapMode = cc.WrapMode.Reverse;\n        this.ani.once(\"finished\", function () {\n            if (cc.pvz.runtimeData.autoTimes > 0) {\n                cc.pvz.runtimeData.autoTimes--;\n                t.bag.doRefreshLogic(!0);\n                t.bag.saveRuntimeData();\n            }\n        });\n    },\n    onClickPause: function () {\n        cc.popupManager.popup(\"game\", \"fightset\", \"UIGamePause\", {\n            scale: !1\n        });\n    }\n});\n"]}