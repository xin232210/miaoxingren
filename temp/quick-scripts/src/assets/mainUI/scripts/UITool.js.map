{"version":3,"sources":["assets/mainUI/scripts/UITool.js"],"names":["$toolCard","require","cc","Class","Component","properties","topTools","Node","scrollPanel","ScrollView","replaceRoot","baseToolCard","openPanel","openTip","line","baseLockCard","lockPanel","replaceItem","lockList","lockTops","Sprite","onLoad","UITool","node","active","initBy","e","pvz","utils","fadeInBtn","isChangeArray","refreshLockArrayShow","initToolItemData","tempGuideIndex","setTimeout","t","children","guideManager","showGuide","tip","focus","btn","y","stageLevel","PlayerData","getStageLevel","GameConfig","ArrayPlaceOpLv","usePosCount","setSpriteFrame","toPlaceId","OpenToolList","LockToolList","Array","fill","i","MaxToolCount","o","ToolLockLevel","a","player","toolData","pos","push","position","Vec2","ZERO","forEach","find","destroy","instantiate","c","parent","getComponent","initToolCardItem","initOpenToolItem","initLockToolItem","length","childrenCount","s","n","r","h","initToolLockCard","onCloseUI","onClickCancelUp","onClickCard","popupManager","popup","ad","scale","toolId","onLvUpRefreshCard","convertToWorldSpaceAR","convertToNodeSpaceAR","runAction","sequence","moveTo","destroySelf","callFunc","putOnByPos","onClickUp","Set","map","size","values","next","value","Animation","play","stop","putDownToolById","console","log","onDataChanged","onClickDown","onClickPlace","parseInt","onCardDragEnded","getBoundingBoxToWorld","Intersection","rectRect","contains"],"mappings":"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","sourceRoot":"/","sourcesContent":["var $toolCard = require(\"./ToolCard\");\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        topTools: cc.Node,\n        scrollPanel: cc.ScrollView,\n        replaceRoot: cc.Node,\n        baseToolCard: cc.Node,\n        openPanel: cc.Node,\n        openTip: cc.Node,\n        line: cc.Node,\n        baseLockCard: cc.Node,\n        lockPanel: cc.Node,\n        replaceItem: $toolCard,\n        lockList: [cc.Node],\n        lockTops: [cc.Sprite]\n    },\n    onLoad: function () {\n        cc.UITool = this;\n        this.scrollPanel.node.active = !0;\n        this.replaceRoot.active = !1;\n    },\n    initBy: function () {\n        var e = this;\n        cc.pvz.utils.fadeInBtn(this.node);\n        this.node.active = !0;\n        this.isChangeArray = !1;\n        this.refreshLockArrayShow();\n        this.initToolItemData();\n        if (1 == cc.tempGuideIndex) {\n            setTimeout(function () {\n                var t = e.topTools.children[0];\n                cc.guideManager.showGuide(\n                    0,\n                    [\n                        {\n                            tip: \"选择练习生\",\n                            focus: t,\n                            btn: \"item\",\n                            y: -200\n                        }\n                    ],\n                    function (e) {\n                        if (e) {\n                            cc.tempGuideIndex = 2;\n                        }\n                    }\n                );\n            });\n        }\n    },\n    refreshLockArrayShow: function () {\n        this.stageLevel = cc.pvz.PlayerData.getStageLevel();\n        this.lockList[0].active = this.stageLevel <= cc.pvz.GameConfig.ArrayPlaceOpLv[0];\n        this.lockList[1].active = this.stageLevel <= cc.pvz.GameConfig.ArrayPlaceOpLv[1];\n        this.usePosCount = 6;\n        if (this.stageLevel > cc.pvz.GameConfig.ArrayPlaceOpLv[1]) {\n            this.usePosCount = 8;\n            cc.pvz.utils.setSpriteFrame(this.lockTops[1], \"uiImage\", \"plant/zwdi\");\n            cc.pvz.utils.setSpriteFrame(this.lockTops[0], \"uiImage\", \"plant/zwdi\");\n        } else {\n            if (this.stageLevel > cc.pvz.GameConfig.ArrayPlaceOpLv[0]) {\n                this.usePosCount = 7;\n                cc.pvz.utils.setSpriteFrame(this.lockTops[0], \"uiImage\", \"plant/zwdi\");\n            }\n        }\n    },\n    initToolItemData: function () {\n        var e = this;\n        this.toPlaceId = -1;\n        this.OpenToolList = [];\n        this.LockToolList = [];\n        this.baseToolCard.active = !1;\n        this.baseLockCard.active = !1;\n        var t = new Array(8).fill(-1);\n        for (var i = 0; i < cc.pvz.GameConfig.MaxToolCount; i++) {\n            var o = i + 1;\n            if (cc.pvz.GameConfig.ToolLockLevel[i] < this.stageLevel) {\n                var a = cc.player.toolData[o].pos;\n                if (-1 != a) {\n                    t[a] = o;\n                } else {\n                    this.OpenToolList.push(o);\n                }\n            } else {\n                this.LockToolList.push(o);\n            }\n        }\n        this.baseToolCard.position = cc.Vec2.ZERO;\n        this.topTools.children.forEach(function (i, o) {\n            var a = cc.find(\"item\", i);\n            if (-1 == t[o]) {\n                if (a) {\n                    a.destroy();\n                }\n            } else {\n                if (!a) {\n                    a = cc.instantiate(e.baseToolCard);\n                    var c = e.topTools.children[o];\n                    cc.find(\"black\", c).active = !1;\n                    a.parent = c;\n                    a.active = !0;\n                }\n                a.getComponent(\"ToolCard\").initToolCardItem(e, t[o]);\n            }\n        });\n        this.initOpenToolItem();\n        this.initLockToolItem();\n    },\n    initOpenToolItem: function () {\n        var e = this.OpenToolList.length;\n        var t = this.openPanel.childrenCount;\n        var i = e - t;\n        this.openTip.active = e > 0;\n        this.openPanel.active = e > 0;\n        if (!(e <= 0)) {\n            if (i > 0) {\n                for (var o = 0; o < t; o++) {\n                    var a = this.openPanel.children[o];\n                    a.active = !0;\n                    a.getComponent(\"ToolCard\").initToolCardItem(this, this.OpenToolList[o]);\n                }\n                for (var c = t; c < e; c++) {\n                    var s = cc.instantiate(this.baseToolCard);\n                    s.parent = this.openPanel;\n                    s.active = !0;\n                    s.getComponent(\"ToolCard\").initToolCardItem(this, this.OpenToolList[c]);\n                }\n            } else {\n                for (var n = 0; n < e; n++) {\n                    var r = this.openPanel.children[n];\n                    r.active = !0;\n                    r.getComponent(\"ToolCard\").initToolCardItem(this, this.OpenToolList[n]);\n                }\n                for (var h = e; h < t; h++) {\n                    this.openPanel.children[h].active = !1;\n                }\n            }\n        }\n    },\n    initLockToolItem: function () {\n        this.line.active = this.LockToolList.length > 0;\n        var e = this.LockToolList.length;\n        var t = this.lockPanel.childrenCount;\n        if (e - t > 0) {\n            for (var i = 0; i < t; i++) {\n                var o = this.lockPanel.children[i];\n                o.active = !0;\n                o.getComponent(\"ToolLockCard\").initToolLockCard(this, this.LockToolList[i]);\n            }\n            for (var a = t; a < e; a++) {\n                var c = cc.instantiate(this.baseLockCard);\n                c.parent = this.lockPanel;\n                c.active = !0;\n                c.getComponent(\"ToolLockCard\").initToolLockCard(this, this.LockToolList[a]);\n            }\n        } else {\n            for (var s = 0; s < e; s++) {\n                var n = this.lockPanel.children[s];\n                n.active = !0;\n                n.getComponent(\"ToolLockCard\").initToolLockCard(this, this.LockToolList[s]);\n            }\n            for (var r = e; r < t; r++) {\n                this.lockPanel.children[r].active = !1;\n            }\n        }\n    },\n    onCloseUI: function () {\n        if (-1 != this.toPlaceId) {\n            this.onClickCancelUp();\n        }\n        this.node.active = !1;\n    },\n    onClickCard: function (e) {\n        var t = this;\n        if (-1 == this.toPlaceId) {\n            cc.popupManager.popup(\n                \"mainUI\",\n                \"plantInfo\",\n                \"UIToolInfo\",\n                {\n                    ad: !1,\n                    scale: !0\n                },\n                this,\n                e.toolId,\n                !1,\n                function () {\n                    e.onLvUpRefreshCard();\n                }\n            );\n        } else {\n            var i = cc.player.toolData[e.toolId].pos;\n            if (-1 != i) {\n                var o = this.replaceItem.node;\n                var a = e.node;\n                var c = o.convertToWorldSpaceAR(cc.Vec2.ZERO);\n                var s = this.node.convertToNodeSpaceAR(c);\n                var n = a.convertToWorldSpaceAR(cc.Vec2.ZERO);\n                var r = this.node.convertToNodeSpaceAR(n);\n                var h = cc.instantiate(o);\n                h.position = s;\n                h.parent = this.node;\n                h.runAction(\n                    cc.sequence(\n                        cc.moveTo(0.24, r),\n                        cc.destroySelf(),\n                        cc.callFunc(function () {\n                            t.putOnByPos(i);\n                        })\n                    )\n                );\n                this.replaceRoot.active = !1;\n            }\n        }\n    },\n    onClickUp: function (e) {\n        this.toPlaceId = e.toolId;\n        var t = new Set(\n            new Array(this.usePosCount).fill(0).map(function (e, t) {\n                return t;\n            })\n        );\n        for (var i = 0; i < cc.pvz.GameConfig.MaxToolCount; i++) {\n            var o = cc.player.toolData[i + 1].pos;\n            if (-1 != o) {\n                t.delete(o);\n            }\n        }\n        if (t.size > 0) {\n            var a = t.values().next().value;\n            this.putOnByPos(a);\n            this.openTip.active = this.openPanel.childrenCount > 0;\n            this.openPanel.active = this.openPanel.childrenCount > 0;\n        } else {\n            this.scrollPanel.node.active = !1;\n            this.replaceRoot.active = !0;\n            this.replaceItem.initToolCardItem(this, e.toolId);\n            for (var c = 0; c < this.topTools.childrenCount; c++) {\n                var s = this.topTools.children[c];\n                if (6 == c && this.stageLevel <= cc.pvz.GameConfig.ArrayPlaceOpLv[0]) {\n                    break;\n                }\n                if (7 == c && this.stageLevel <= cc.pvz.GameConfig.ArrayPlaceOpLv[1]) {\n                    break;\n                }\n                s.getComponent(cc.Animation).play(\"plantputon\");\n            }\n        }\n    },\n    onClickCancelUp: function () {\n        this.toPlaceId = -1;\n        this.scrollPanel.node.active = !0;\n        this.replaceRoot.active = !1;\n        this.topTools.children.forEach(function (e) {\n            return e.getComponent(cc.Animation).stop();\n        });\n    },\n    putDownToolById: function (e) {\n        var t = this.topTools.children.find(function (t) {\n            var i = cc.find(\"item\", t);\n            return i && i.getComponent(\"ToolCard\").toolId == e;\n        });\n        cc.find(\"item\", t).parent = this.openPanel;\n        cc.find(\"black\", t).active = !0;\n    },\n    putOnByPos: function (e, t) {\n        var i = this;\n        if (void 0 === t) {\n            t = !1;\n        }\n        if (-1 != this.toPlaceId && (console.log(\" change array \" + e), !(e >= this.usePosCount))) {\n            for (var o = 0; o < cc.pvz.GameConfig.MaxToolCount; o++) {\n                if (cc.player.toolData[o + 1].pos == e) {\n                    cc.player.toolData[o + 1].pos = -1;\n                    this.putDownToolById(o + 1);\n                }\n            }\n            cc.player.toolData[this.toPlaceId].pos = e;\n            cc.pvz.PlayerData.onDataChanged();\n            var a = this.topTools.children[e];\n            if (!t) {\n                var c = this.openPanel.children.find(function (e) {\n                    return e.getComponent(\"ToolCard\").toolId == i.toPlaceId;\n                });\n                c.position = cc.Vec2.ZERO;\n                c.parent = a;\n            }\n            cc.find(\"black\", a).active = !1;\n            this.onClickCancelUp();\n        }\n    },\n    onClickDown: function (e) {\n        cc.player.toolData[e].pos = -1;\n        cc.pvz.PlayerData.onDataChanged();\n        this.putDownToolById(e);\n        this.openTip.active = this.openPanel.childrenCount > 0;\n        this.openPanel.active = this.openPanel.childrenCount > 0;\n    },\n    onClickPlace: function (e, t) {\n        var i = parseInt(t);\n        this.putOnByPos(i);\n    },\n    onCardDragEnded: function (e, t) {\n        var i = this;\n        var o = e.node.getBoundingBoxToWorld();\n        var a = this.topTools.getBoundingBoxToWorld();\n        if (cc.Intersection.rectRect(o, a)) {\n            this.topTools.children.forEach(function (e) {\n                if (e.getBoundingBoxToWorld().contains(t)) {\n                    var o = cc.find(\"item\", e);\n                    if (o) {\n                        var a = o.getComponent(\"ToolCard\");\n                        var c = cc.player.toolData[a.toolId].pos;\n                        return void i.putOnByPos(c);\n                    }\n                }\n            });\n        }\n    }\n});\n"]}