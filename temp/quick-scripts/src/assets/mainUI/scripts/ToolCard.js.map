{"version":3,"sources":["assets/mainUI/scripts/ToolCard.js"],"names":["cc","Class","Component","properties","spine","sp","Skeleton","qualitySprite","Sprite","typeSprite","nameLabel","Label","levelLabel","fragLabel","lvProgressBar","ProgressBar","maxFragLine","Node","lvTipNode","fragTipNode","initToolCardItem","e","t","i","ui","toolId","stageLevel","pvz","PlayerData","getStageLevel","toolJson","JsonControl","getToolJson","string","name","getToolTypeIcon","lattice","node","scale","utils","useBundleAsset","SkeletonData","console","log","skeletonData","skinName","findSkin","setSkin","refreshToolSpineShow","warn","error","onLvUpRefreshCard","getToolData","lv","getLevelInterval","setAnimation","toolData","toollvJson","getToolLvUpJson","getQualityCardIcon","quality","GameConfig","ToolLockLevel","isMaxLv","MaxToolLv","isEnoughFrag","c","progress","active","onClickCard"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        spine: sp.Skeleton,\n        qualitySprite: cc.Sprite,\n        typeSprite: cc.Sprite,\n        nameLabel: cc.Label,\n        levelLabel: cc.Label,\n        fragLabel: cc.Label,\n        lvProgressBar: cc.ProgressBar,\n        maxFragLine: cc.Node,\n        lvTipNode: cc.Node,\n        fragTipNode: cc.Node\n    },\n    initToolCardItem: function (e, t) {\n        var i = this;\n        this.ui = e;\n        this.toolId = t;\n        this.stageLevel = cc.pvz.PlayerData.getStageLevel();\n        this.toolJson = cc.JsonControl.getToolJson(this.toolId);\n        this.nameLabel.string = this.toolJson.name;\n        cc.JsonControl.getToolTypeIcon(this.typeSprite, this.toolJson.lattice);\n        this.spine.node.scale = this.toolJson.scale;\n        \n        // 修改为使用character目录下的资源，并添加错误处理\n        cc.pvz.utils.useBundleAsset(\"actors\", \"character/Characters\", sp.SkeletonData, function (e) {\n            if (e) {\n                console.log(\"角色资源加载成功:\", e);\n                i.spine.skeletonData = e;\n                // 根据toolId设置对应的皮肤，确保皮肤名称正确\n                var skinName = \"Character\" + (i.toolId < 10 ? \"0\" + i.toolId : i.toolId);\n                if (i.spine.findSkin(skinName)) {\n                    console.log(\"找到皮肤:\", skinName);\n                    i.spine.setSkin(skinName);\n                    i.refreshToolSpineShow();\n                } else {\n                    console.warn(\"皮肤不存在:\", skinName);\n                    // 如果皮肤不存在，尝试使用默认皮肤\n                    i.refreshToolSpineShow();\n                }\n            } else {\n                console.error(\"无法加载角色资源\");\n            }\n        });\n        \n        this.onLvUpRefreshCard(!1);\n    },\n    refreshToolSpineShow: function () {\n        var e = cc.pvz.PlayerData.getToolData(this.toolId).lv;\n        var t = cc.pvz.utils.getLevelInterval(e);\n        this.spine.setAnimation(0, \"stand\" + t, !0);\n    },\n    onLvUpRefreshCard: function (e) {\n        if (void 0 === e) {\n            e = !0;\n        }\n\n        this.toolData = cc.pvz.PlayerData.getToolData(this.toolId);\n        this.toollvJson = cc.JsonControl.getToolLvUpJson(this.toolData.lv);\n\n        if (e) {\n            this.refreshToolSpineShow();\n        }\n\n        cc.JsonControl.getQualityCardIcon(this.qualitySprite, this.toolJson.quality);\n        this.toolJson.quality;\n        var t = this.stageLevel <= cc.pvz.GameConfig.ToolLockLevel[this.toolId - 1];\n\n        if (t) {\n            this.levelLabel.string = \"未解锁\";\n        } else {\n            this.levelLabel.string = \"等级\" + this.toolData.lv;\n        }\n\n        this.isMaxLv = this.toolData.lv >= cc.pvz.GameConfig.MaxToolLv;\n        var i = this.toollvJson[\"sp\" + this.toolJson.quality];\n        this.isEnoughFrag = this.toolData.c >= i;\n\n        if (this.isMaxLv) {\n            this.fragLabel.string = \"已满级\";\n        } else {\n            this.fragLabel.string = this.toolData.c + \"/\" + i;\n        }\n\n        this.lvProgressBar.progress = this.toolData.c / i;\n        this.lvProgressBar.node.active = !this.isEnoughFrag || !this.isMaxLv;\n        this.maxFragLine.active = this.isEnoughFrag || this.isMaxLv;\n        this.lvTipNode.active = this.isEnoughFrag && !this.isMaxLv;\n        this.fragTipNode.active = !this.isEnoughFrag || this.isMaxLv;\n    },\n    onClickCard: function () {\n        this.ui.onClickCard(this);\n    }\n});"]}