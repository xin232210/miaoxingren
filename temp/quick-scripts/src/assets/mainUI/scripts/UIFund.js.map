{"version":3,"sources":["assets/mainUI/scripts/UIFund.js"],"names":["$prefabInfo","require","cc","Class","Component","properties","rowPrefab","fundsJsonFile","JsonAsset","scorll","ScrollView","barRoot","Node","lineRoot","coinLabel","Label","diamondLabel","panel","onLoad","zIndex","macro","MIN_ZINDEX","parent","MAX_ZINDEX","updateItemInfo","e","pvz","PlayerData","getItemNum","GameConfig","ItemType","string","utils","formatItemNum","t","initBy","scale","node","width","height","roots","json","length","forEach","i","o","player","level","need","a","prefab","root","fillItems","y","TAUtils","trackAdUIShow","AdType","Math","min","c","addNodeTo","find","getComponent","s","initRewardItem","itemId","count","toolId","n","hasFundGet","ID","active","Button","clickEvents","customEventData","beginIndex","endIndex","onScrollEvent","floor","content","onClickGetFund","split","parseInt","setFundGetted","target","popupManager","popup","ad","UIFromType","MainControl","convertToWorldSpaceAR","v2","AdUtils","showAdRewardVideo","onClickClose","removePopup","RedControl","refreshAllRedTip"],"mappings":"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","sourceRoot":"/","sourcesContent":["var $prefabInfo = require(\"../../scripts/PrefabInfo\");\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        rowPrefab: $prefabInfo,\n        fundsJsonFile: cc.JsonAsset,\n        scorll: cc.ScrollView,\n        barRoot: cc.Node,\n        lineRoot: cc.Node,\n        coinLabel: cc.Label,\n        diamondLabel: cc.Label,\n        panel: cc.Node\n    },\n    onLoad: function () {\n        this.barRoot.zIndex = cc.macro.MIN_ZINDEX;\n        this.lineRoot.parent.zIndex = cc.macro.MAX_ZINDEX;\n    },\n    updateItemInfo: function () {\n        var e = cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType[\"金币\"]);\n        this.coinLabel.string = cc.pvz.utils.formatItemNum(e);\n        var t = cc.pvz.PlayerData.getItemNum(cc.pvz.GameConfig.ItemType[\"钻石\"]);\n        this.diamondLabel.string = cc.pvz.utils.formatItemNum(t);\n    },\n    initBy: function () {\n        var e = this;\n        this.panel.scale = this.node.width / 720;\n        this.scorll.node.height = this.scorll.node.height / this.panel.scale;\n        this.roots = [];\n        var t = this.fundsJsonFile.json.length;\n        this.fundsJsonFile.json.forEach(function (i, o) {\n            if (cc.player.level <= i.need && o < t) {\n                t = o;\n            }\n            var a = new cc.Node();\n            a.height = e.rowPrefab.prefab.height;\n            a.parent = e.rowPrefab.root;\n            e.roots[o] = a;\n        });\n        this.fillItems(0, 7);\n        this.rowPrefab.root.height = this.fundsJsonFile.json.length * this.rowPrefab.prefab.height;\n        this.barRoot.y = (0.5 - t) * this.rowPrefab.prefab.height;\n        this.lineRoot.y = (this.fundsJsonFile.json.length - t) * this.rowPrefab.prefab.height;\n        this.updateItemInfo();\n        cc.pvz.TAUtils.trackAdUIShow(cc.pvz.GameConfig.AdType[\"基金\"]);\n    },\n    fillItems: function (e, t) {\n        var i = this;\n        var o = Math.min(t, this.fundsJsonFile.json.length);\n        var a = function () {\n            var e = i.fundsJsonFile.json[c];\n            var t = cc.player.level <= e.need;\n            var o = i.rowPrefab.addNodeTo(i.roots[c]);\n            cc.find(\"name\", o).getComponent(cc.Label).string = e.need + \"关\";\n            [\"item\", \"itemAd\", \"itemAd2\"].forEach(function (i, a) {\n                var c = e[\"reward\" + (a + 1)];\n                var s = cc.find(i, o);\n                s.getComponent(\"RewardItem\").initRewardItem(\n                    {\n                        itemId: c[0],\n                        count: c[1],\n                        toolId: -1\n                    },\n                    !1\n                );\n                var n = !t && cc.pvz.PlayerData.hasFundGet(e.ID, a);\n                cc.find(\"lock\", s).active = t;\n                cc.find(\"open\", s).active = !t && !n;\n                cc.find(\"finish\", s).active = !t && n;\n                s.getComponent(cc.Button).clickEvents[0].customEventData = e.ID + \",\" + a;\n            });\n        };\n        var c = e;\n        for (var s = o; c < s; c++) {\n            a();\n        }\n        this.beginIndex = e;\n        this.endIndex = o;\n    },\n    onScrollEvent: function (e) {\n        var t = Math.floor(e.content.y / this.rowPrefab.prefab.height) + 7;\n        if (this.endIndex < t && this.endIndex < this.fundsJsonFile.json.length) {\n            this.fillItems(this.endIndex, this.endIndex + 1);\n        }\n    },\n    onClickGetFund: function (e, t) {\n        var i = this;\n        var o = t.split(\",\");\n        var a = parseInt(o[0]);\n        var c = parseInt(o[1]);\n        if (!cc.pvz.PlayerData.hasFundGet(a, c)) {\n            var s = function () {\n                cc.pvz.PlayerData.setFundGetted(a, c);\n                var t = e.target.getComponent(\"RewardItem\");\n                cc.find(\"open\", t.node).active = !1;\n                cc.find(\"finish\", t.node).active = !0;\n                cc.popupManager.popup(\n                    \"mainUI\",\n                    \"getrewardUI\",\n                    \"UIReward\",\n                    {\n                        ad: !0,\n                        scale: !1\n                    },\n                    [\n                        {\n                            itemId: t.itemId,\n                            count: t.count,\n                            toolId: -1\n                        }\n                    ],\n                    cc.pvz.GameConfig.UIFromType[\"基金\"],\n                    function () {\n                        i.updateItemInfo();\n                        cc.MainControl.updateItemInfo();\n                    },\n                    function (e) {\n                        if (e === cc.pvz.GameConfig.ItemType[\"钻石\"]) {\n                            return i.diamondLabel.node.convertToWorldSpaceAR(cc.v2());\n                        } else {\n                            return i.coinLabel.node.convertToWorldSpaceAR(cc.v2());\n                        }\n                    }\n                );\n            };\n            if (c > 0) {\n                cc.pvz.AdUtils.showAdRewardVideo(cc.pvz.GameConfig.AdType[\"基金\"], function (e) {\n                    if (e) {\n                        s();\n                    }\n                });\n            } else {\n                s();\n            }\n        }\n    },\n    onClickClose: function () {\n        cc.popupManager.removePopup(this);\n        cc.RedControl.refreshAllRedTip();\n    }\n});\n"]}