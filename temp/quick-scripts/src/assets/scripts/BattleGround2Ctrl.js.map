{"version":3,"sources":["assets/scripts/BattleGround2Ctrl.js"],"names":["$soundManager","require","$tool","$pool","$bullet2","$dieEff2","$gate2","$num2","$role2","p","cc","_decorator","d","ccclass","h","property","f","e","t","apply","arguments","jsonAssets","pools","startNode","endNode","hpProgBar","hitAni","atkStr","WIDTH","state","baseLineY","endLineY","player","winTCount","hp","waveEnemyHandles","bulletHandles","o","__extends","prototype","start","JSONManager","n","json","map","a","id","i","length","y","createNewPlayer","setTimeout","playBgm","director","getCollisionManager","enabled","getComponent","getNewPoolItem","setPosition","Vec2","init","team","rId","par","createNewEnemy","config","createNewBullet","createNewHpNum","initAsHp","createNewHitNum","createNewDieEff","position","createNewGate","push","c","randomFromArr2","shuffle","s","gateInfo","beHit","play","progress","console","log","popupManager","popup","ad","scale","refreshAtk","string","bulletConfig","dmg","showPauseMenu","hidePauseMenu","update","ConfigBattle","__decorate","JsonAsset","Node","ProgressBar","Animation","Label","Component","exports"],"mappings":"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","sourceRoot":"/","sourcesContent":["var $soundManager = require(\"./SoundManager\");\nvar $tool = require(\"./Tool\");\nvar $pool = require(\"./Pool\");\nvar $bullet2 = require(\"./Bullet2\");\nvar $dieEff2 = require(\"./DieEff2\");\nvar $gate2 = require(\"./Gate2\");\nvar $num2 = require(\"./Num2\");\nvar $role2 = require(\"./Role2\");\nvar p = cc._decorator;\nvar d = p.ccclass;\nvar h = p.property;\nvar f = (function (e) {\n    function t() {\n        var t = (null !== e && e.apply(this, arguments)) || this;\n        t.jsonAssets = [];\n        t.pools = [];\n        t.startNode = null;\n        t.endNode = null;\n        t.hpProgBar = null;\n        t.hitAni = null;\n        t.atkStr = null;\n        t.WIDTH = 600;\n        t.state = 10;\n        t.baseLineY = -500;\n        t.endLineY = -500;\n        t.player = null;\n        t.winTCount = -99999999;\n        t.hp = [3, 3];\n        t.waveEnemyHandles = [[], [], [], [], [], []];\n        t.bulletHandles = [];\n        return t;\n    }\n    var o;\n    __extends(t, e);\n    o = t;\n    t.prototype.start = function () {\n        var e = [\"ConfigBattle\"];\n        var t = function (t) {\n            o.JSONManager[e[t]] = {};\n            n.jsonAssets[t].json.map(function (a) {\n                o.JSONManager[e[t]][a.id] = a;\n            });\n        };\n        var n = this;\n        for (var i = 0; i < this.jsonAssets.length; i++) {\n            t(i);\n        }\n        this.baseLineY = this.startNode.y;\n        this.endLineY = this.endNode.y;\n        this.state = 10;\n        this.createNewPlayer();\n        setTimeout(function () {\n            $soundManager.default.playBgm(0);\n        }, 1e3);\n        cc.director.getCollisionManager().enabled = !0;\n    };\n    t.prototype.createNewPlayer = function () {\n        var e = this.pools[4].getComponent($pool.default).getNewPoolItem();\n        this.player = e;\n        e.setPosition(new cc.Vec2(360, this.baseLineY));\n        e.getComponent($role2.default).init({\n            team: 0,\n            rId: 1,\n            par: this\n        });\n    };\n    t.prototype.createNewEnemy = function (e, t, o) {\n        if (void 0 === o) {\n            o = {};\n        }\n        var a = this.pools[0].getComponent($pool.default).getNewPoolItem();\n        a.setPosition(new cc.Vec2(e, t));\n        a.getComponent($role2.default).init({\n            team: 1,\n            rId: o.rId,\n            config: o.config,\n            par: this\n        });\n        return a;\n    };\n    t.prototype.createNewBullet = function (e, t, o) {\n        var a = this.pools[2].getComponent($pool.default).getNewPoolItem();\n        o.par = this;\n        a.getComponent($bullet2.default).init(e, t, o);\n    };\n    t.prototype.createNewHpNum = function (e) {\n        var t = this.pools[1].getComponent($pool.default).getNewPoolItem();\n        t.getComponent($num2.default).initAsHp(e);\n        return t;\n    };\n    t.prototype.createNewHitNum = function () {};\n    t.prototype.createNewDieEff = function (e) {\n        var t = this.pools[5].getComponent($pool.default).getNewPoolItem();\n        t.setPosition(e.position);\n        t.getComponent($dieEff2.default).init();\n    };\n    t.prototype.createNewGate = function (e) {\n        if (void 0 === e) {\n            e = {};\n        }\n        var t = this.pools[3].getComponent($pool.default).getNewPoolItem();\n        t.y = 800;\n        var o = [];\n        for (var a = 1; a <= 5; a++) {\n            if (0 !== e[\"door\" + a]) {\n                o.push(a);\n            }\n        }\n        var c = $tool.default.randomFromArr2(o, 2);\n        $tool.default.shuffle(c);\n        var s = [\n            [c[0], e[\"door\" + c[0]]],\n            [c[1], e[\"door\" + c[1]]]\n        ];\n        t.getComponent($gate2.default).init({\n            par: this,\n            gateInfo: s\n        });\n    };\n    t.prototype.beHit = function () {\n        this.hitAni.play();\n        this.hp[0]--;\n        this.hpProgBar.progress = this.hp[0] / this.hp[1];\n        if (this.hp[0] <= 0) {\n            console.log(\"game over.\");\n            cc.popupManager.popup(\n                \"game2\",\n                \"win\",\n                \"UIGame2End\",\n                {\n                    ad: !1,\n                    scale: !0\n                },\n                !1\n            );\n            this.state = 0;\n        }\n    };\n    t.prototype.refreshAtk = function () {\n        this.atkStr.string = \"\" + this.player.getComponent($role2.default).bulletConfig.dmg;\n    };\n    t.prototype.showPauseMenu = function () {\n        this.state = 0;\n        cc.popupManager.popup(\n            \"game2\",\n            \"set\",\n            \"UIGame2Set\",\n            {\n                scale: !1\n            },\n            this\n        );\n    };\n    t.prototype.hidePauseMenu = function () {\n        this.state = 10;\n    };\n    t.prototype.update = function (e) {\n        if (10 === this.state && this.winTCount > 0) {\n            this.winTCount -= e;\n            if (this.winTCount <= 0) {\n                cc.popupManager.popup(\n                    \"game2\",\n                    \"win\",\n                    \"UIGame2End\",\n                    {\n                        ad: !1,\n                        scale: !0\n                    },\n                    !0\n                );\n            }\n        }\n    };\n    t.JSONManager = {\n        ConfigBattle: {}\n    };\n    __decorate([h(cc.JsonAsset)], t.prototype, \"jsonAssets\", void 0);\n    __decorate([h(cc.Node)], t.prototype, \"pools\", void 0);\n    __decorate([h(cc.Node)], t.prototype, \"startNode\", void 0);\n    __decorate([h(cc.Node)], t.prototype, \"endNode\", void 0);\n    __decorate([h(cc.ProgressBar)], t.prototype, \"hpProgBar\", void 0);\n    __decorate([h(cc.Animation)], t.prototype, \"hitAni\", void 0);\n    __decorate([h(cc.Label)], t.prototype, \"atkStr\", void 0);\n    return (o = __decorate([d], t));\n})(cc.Component);\nexports.default = f;"]}