{"version":3,"sources":["assets/scripts/GuideManager.js"],"names":["cc","Class","Component","properties","spine","sp","Skeleton","focusNode","Node","fingerSpine","guideNode","guideLabel","Label","onLoad","e","guideManager","active","hackButton","director","on","Director","EVENT_AFTER_SCENE_LAUNCH","t","node","parent","isGuiding","showGuide","o","a","n","length","hideGuideDialog","guideConfig","i","showGuideDialog","btn","r","cb","zIndex","macro","MAX_ZINDEX","y","setAnimation","setCompleteListener","string","tip","stopAllActions","opacity","runAction","fadeIn","focus","getBoundingBoxToWorld","rect","convertToNodeSpaceAR","center","x","width","height","tween","to","start","hideFinger","fingerAni","fadeOut","guideLogAndCheckBtnClick","onStepFinished","onClickGuide","console","log","hasHackButton","Button","prototype","_onTouchEnded","interactable","enabledInHierarchy","_pressed","name","call"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        spine: sp.Skeleton,\n        focusNode: cc.Node,\n        fingerSpine: sp.Skeleton,\n        guideNode: cc.Node,\n        guideLabel: cc.Label\n    },\n    onLoad: function () {\n        var e = this;\n        cc.guideManager = this;\n        if (this.guideNode) {\n            this.guideNode.active = !1;\n        }\n        this.hackButton();\n        cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH, function (t) {\n            e.node.parent = t;\n        });\n    },\n    isGuiding: function () {\n        return this.guideNode.active;\n    },\n    showGuide: function (e, t, o) {\n        var a = this;\n        var n = -1;\n        !(function e() {\n            if (++n >= t.length) {\n                a.hideGuideDialog();\n                a.guideConfig = null;\n                o && o(!0);\n            } else {\n                var i = t[n];\n                a.showGuideDialog(i, e);\n                if (o) {\n                    o(!1, n);\n                }\n            }\n        })();\n    },\n    showGuideDialog: function (e, t) {\n        var o = this;\n        this.guideConfig = {\n            btn: e.btn,\n            r: e.r,\n            cb: t\n        };\n        this.guideNode.zIndex = cc.macro.MAX_ZINDEX;\n        this.guideNode.active = !0;\n        if (e.y) {\n            this.spine.node.y = e.y;\n        } else {\n            if (e.t) {\n                this.spine.node.y = 200;\n            } else {\n                this.spine.node.y = 0;\n            }\n        }\n        this.spine.setAnimation(0, e.r ? \"jiaoxue1_R\" : \"jiaoxue1\", !1);\n        this.spine.setCompleteListener(function () {\n            o.spine.setAnimation(0, e.r ? \"jiaoxue2_R\" : \"jiaoxue2\", !0);\n            o.spine.setCompleteListener(null);\n        });\n        this.guideLabel.string = e.tip;\n        this.guideLabel.node.stopAllActions();\n        this.guideLabel.node.opacity = 0;\n        this.guideLabel.node.runAction(cc.fadeIn(0.5));\n        var a;\n        if (e.focus) {\n            a = e.focus.getBoundingBoxToWorld();\n        } else {\n            a = cc.rect();\n        }\n        var n = this.guideNode.parent.convertToNodeSpaceAR(a.center);\n        this.focusNode.active = !0;\n        this.focusNode.x = n.x;\n        this.focusNode.y = n.y;\n        this.focusNode.width = this.focusNode.height = 0;\n        this.focusNode.opacity = 255;\n        cc.tween(this.focusNode)\n            .to(0.5, {\n                width: a.width,\n                height: a.height\n            })\n            .start();\n        this.fingerSpine.node.active = !e.hideFinger;\n        if (this.fingerSpine.node.active) {\n            this.fingerSpine.setAnimation(0, e.fingerAni || \"dianji\", !0);\n        }\n    },\n    hideGuideDialog: function () {\n        var e = this;\n        this.spine.setAnimation(0, this.guideConfig.r ? \"jiaoxue3_R\" : \"jiaoxue3\", !1);\n        this.spine.setCompleteListener(function () {\n            e.guideNode.active = !1;\n            e.spine.setCompleteListener(null);\n        });\n        this.guideLabel.node.runAction(cc.fadeOut(0.2));\n        this.focusNode.width = 0;\n        this.focusNode.height = 0;\n        this.focusNode.active = !1;\n        this.fingerSpine.node.active = !1;\n    },\n    guideLogAndCheckBtnClick: function (e) {\n        if (this.guideConfig && this.guideConfig.btn == e) {\n            this.onStepFinished();\n        }\n    },\n    onStepFinished: function () {\n        if (this.guideConfig && this.guideConfig.cb) {\n            this.guideConfig.cb();\n        }\n    },\n    onClickGuide: function () {\n        console.log(\"onClickGuide\");\n        if (this.guideConfig) {\n            if (this.guideConfig.btn) {\n                //\n            } else {\n                this.onStepFinished();\n            }\n        }\n    },\n    hackButton: function () {\n        if (!cc.hasHackButton) {\n            cc.hasHackButton = !0;\n            var e = cc.Button.prototype._onTouchEnded;\n            cc.Button.prototype._onTouchEnded = function (t) {\n                if (this.interactable && this.enabledInHierarchy && this._pressed) {\n                    cc.guideManager.guideLogAndCheckBtnClick(this.node.name);\n                }\n                e.call(this, t);\n            };\n        }\n    }\n});\n"]}