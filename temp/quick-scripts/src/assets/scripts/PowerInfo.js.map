{"version":3,"sources":["assets/scripts/PowerInfo.js"],"names":["cc","Class","Component","properties","powerLabel","Label","powerTimeLabel","updatePowerInfo","lastTime","e","t","pvz","PlayerData","getPowerDate","o","Math","abs","Date","now","parseInt","GameConfig","CdPowerTime","isMaxPower","addPower","a","getPower","n","getMaxPower","string","node","active","player","powerDate","i","utils","formatSeconds2","schedule","onRefreshTime","unschedule","checkPowerShow","unscheduleAllCallbacks"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n    properties: {\n        powerLabel: cc.Label,\n        powerTimeLabel: cc.Label\n    },\n    updatePowerInfo: function () {\n        this.lastTime = 0;\n        var e = 0;\n        var t = cc.pvz.PlayerData.getPowerDate();\n        if (t > 0) {\n            var o = Math.abs(Date.now() - t) / 1e3;\n            e = parseInt(o / cc.pvz.GameConfig.CdPowerTime);\n        }\n        if (e > 0 && !cc.pvz.PlayerData.isMaxPower()) {\n            cc.pvz.PlayerData.addPower(e);\n        }\n        var a = cc.pvz.PlayerData.getPower();\n        var n = cc.pvz.PlayerData.getMaxPower();\n        this.powerLabel.string = a + \"/\" + n;\n        this.isMaxPower = cc.pvz.PlayerData.isMaxPower();\n        this.powerTimeLabel.node.active = !this.isMaxPower;\n        if (!this.isMaxPower) {\n            if (t < 0) {\n                cc.player.powerDate = Date.now() + 1e3 * cc.pvz.GameConfig.CdPowerTime;\n                t = cc.player.powerDate;\n            }\n            var i = Math.abs(Date.now() - t) / 1e3;\n            this.lastTime = parseInt(i) - e * cc.pvz.GameConfig.CdPowerTime;\n            this.powerTimeLabel.string = cc.pvz.utils.formatSeconds2(this.lastTime);\n            this.schedule(this.onRefreshTime, 1);\n        }\n    },\n    onRefreshTime: function () {\n        this.lastTime--;\n        if (0 == this.lastTime) {\n            if (cc.pvz.PlayerData.isMaxPower()) {\n                //\n            } else {\n                cc.pvz.PlayerData.addPower(1);\n            }\n            var e = cc.pvz.PlayerData.getPower();\n            var t = cc.pvz.PlayerData.getMaxPower();\n            this.powerLabel.string = e + \"/\" + t;\n            this.isMaxPower = cc.pvz.PlayerData.isMaxPower();\n            if (this.isMaxPower) {\n                this.powerTimeLabel.node.active = !1;\n                return void this.unschedule(this.onRefreshTime, this);\n            }\n            this.lastTime = cc.pvz.GameConfig.CdPowerTime;\n        }\n        this.powerTimeLabel.string = cc.pvz.utils.formatSeconds2(this.lastTime);\n    },\n    checkPowerShow: function () {\n        var e = cc.pvz.PlayerData.getPower();\n        var t = cc.pvz.PlayerData.getMaxPower();\n        this.powerLabel.string = e + \"/\" + t;\n        if (e >= t) {\n            this.powerTimeLabel.node.active = !1;\n            return void this.unscheduleAllCallbacks();\n        }\n        if (this.powerTimeLabel.node.active) {\n            //\n        } else {\n            this.lastTime = cc.pvz.GameConfig.CdPowerTime;\n            this.powerTimeLabel.node.active = !0;\n            this.powerTimeLabel.string = cc.pvz.utils.formatSeconds2(this.lastTime);\n            this.schedule(this.onRefreshTime, 1);\n        }\n    }\n});\n"]}